{"_default": {"1": {"achronop": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2161", "title": "rr replay failed on Assert `nwritten == buf_size'", "body": "[FATAL /home/achronop/myrepos/rr_project/rr/src/Task.cc:2234:write_bytes_helper() errno: EIO] \r\n (task 25352 (rec:22951) at time 131221)\r\n -> Assertion `nwritten == buf_size' failed to hold. Should have written 155648 bytes to 0x7f53bf725000, but only wrote -1\r\n=== Start rr backtrace:\r\nrr(_ZN2rr13dump_rr_stackEv+0x33)[0x7d7565]\r\nrr(_ZN2rr9GdbServer15emergency_debugEPNS_4TaskE+0x168)[0x695328]\r\nrr[0x6b6b11]\r\nrr(_ZN2rr21EmergencyDebugOstreamD1Ev+0x5a)[0x6b6cfe]\r\nrr(_ZN2rr4Task18write_bytes_helperENS_10remote_ptrIvEElPKvPbj+0x40f)[0x7ac833]\r\nrr(_ZN2rr10ReplayTask33apply_all_data_records_from_traceEv+0xd9)[0x7698ad]\r\nrr(_ZN2rr13ReplaySession12exit_syscallEPNS_10ReplayTaskE+0x63)[0x75516b]\r\nrr(_ZN2rr13ReplaySession18try_one_trace_stepEPNS_10ReplayTaskERKNS0_15StepConstraintsE+0xeb)[0x75870b]\r\nrr(_ZN2rr13ReplaySession11replay_stepERKNS0_15StepConstraintsE+0x14c)[0x759986]\r\nrr(_ZN2rr14ReplayTimeline19replay_step_forwardENS_10RunCommandEl+0xf9)[0x772dfb]\r\nrr(_ZN2rr9GdbServer14debug_one_stepERNS_10GdbRequestE+0x56e)[0x692ada]\r\nrr(_ZN2rr9GdbServer12serve_replayERKNS0_15ConnectionFlagsE+0x463)[0x694611]\r\nrr[0x750d94]\r\nrr(_ZN2rr13ReplayCommand3runERSt6vectorINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESaIS7_EE+0x35f)[0x751665]\r\nrr(main+0x1e8)[0x7ed9ea]\r\n/lib64/libc.so.6(__libc_start_main+0xea)[0x7f753b23688a]\r\nrr(_start+0x2a)[0x616ffa]\r\n=== End rr backtrace\r\nLaunch gdb with\r\n  gdb '-l' '10000' '-ex' 'set sysroot /' '-ex' 'target extended-remote 127.0.0.1:25352' /home/achronop/.local/share/rr/firefox-10/mmap_hardlink_3_firefox\r\n\r\nNothing happens after that\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2161/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "emilio": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2160", "title": "After a (not so long) debugging sesssion, rc stops working, and it's impossible to recover", "body": "In particular, `rc` hangs, and pressing ctrl + C only results in `Invalid remote reply` messages.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2160/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2128", "title": "Bug hard to hunt down under rr even with --chaos", "body": "I remember @rocallahan was interested on this kind of thing, so I'm opening an issue.\r\n\r\nSee: https://github.com/servo/ipc-channel/pull/179\r\n\r\nWhen I run the test on my machine, like:\r\n\r\n```\r\n$ true; while [ $? -eq 0 ];do RUST_BACKTRACE=1 ./target/release/deps/ipc_channel-6611382eff9c2dbb stress ; done\r\n```\r\n\r\nI manage to get something like:\r\n\r\n<details>\r\n\r\n```\r\nfailures:\r\n\r\n---- test::stress_in_process stdout ----\r\n\tthread 'test::stress_in_process' panicked at 'recv: Io(Error { repr: Os { code: 104, message: \"Connection reset by peer\" } })', /checkout/src/libcore/result.rs:906:4\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n             at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::_print\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:69\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:58\r\n             at /checkout/src/libstd/panicking.rs:381\r\n   3: std::panicking::default_hook\r\n             at /checkout/src/libstd/panicking.rs:391\r\n   4: std::panicking::rust_panic_with_hook\r\n             at /checkout/src/libstd/panicking.rs:577\r\n   5: std::panicking::begin_panic\r\n             at /checkout/src/libstd/panicking.rs:538\r\n   6: std::panicking::begin_panic_fmt\r\n             at /checkout/src/libstd/panicking.rs:522\r\n   7: rust_begin_unwind\r\n             at /checkout/src/libstd/panicking.rs:498\r\n   8: core::panicking::panic_fmt\r\n             at /checkout/src/libcore/panicking.rs:71\r\n   9: core::result::unwrap_failed\r\n  10: ipc_channel::test::stress_in_process\r\n  11: _ZN42_$LT$F$u20$as$u20$test..FnBox$LT$T$GT$$GT$8call_box17hee77675d0689c9f5E.llvm.313E8C1E\r\n             at /checkout/src/libtest/lib.rs:1480\r\n             at /checkout/src/libcore/ops/function.rs:223\r\n             at /checkout/src/libtest/lib.rs:141\r\n  12: __rust_maybe_catch_panic\r\n             at /checkout/src/libpanic_unwind/lib.rs:99\r\n\r\n\r\nfailures:\r\n    test::stress_in_process\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 69 filtered out\r\n```\r\n\r\n</details>\r\n\r\nAfter 20 / 60 iterations consistently.\r\n\r\nSo the next logical step was to try hunting it with rr, using:\r\n\r\n```\r\n$ true; while [ $? -eq 0 ];do RUST_BACKTRACE=1 rr record --chaos ./target/debug/deps/ipc_channel-0a671e7e49351578 stress && rm -rf ~/.local/share/rr/ipc_channel-*; done\r\n```\r\n\r\nSo far I haven't succeeded yet (it's been 90 iterations already, which take more than a minute when recording, both on debug and release).\r\n\r\nJust filing to see if it rings a bell or you find it interesting, it's mostly a bunch of `socketpair` / `sendmsg` / `recvmsg` syscalls.\r\n\r\nI'm running rr as of 244151f05a0a0c9315675c6278580a98cb97db69.\r\n\r\nAlso, something I've noticed about this test-case is that recording it under rr is much slower than not doing it even in release, but that's kinda expected given it's very syscall-intensive.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2128/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "jld": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2159", "title": "20x slowdown recording Firefox `SandboxBrokerTest.MultiThread*` unit tests", "body": "The Firefox GTests `SandboxBrokerTest.MultiThreadOpen` and `SandboxBrokerTest.MultiThreadStat` run 20x slower than native (constrained to one core) when being recorded with rr 5.1.0.\r\n\r\nThese are unit tests of the Linux sandbox file broker; seccomp-bpf is not involved.  They construct a broker instance and send it a lot of requests from several threads at once in a tight loop, within the same process.  (And they're the least unreliable reproducer we have for a [mysterious intermittent bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1243108).)  For each request, a `socketpair` is created and one end is sent to the broker with `SCM_RIGHTS` to carry the response.\r\n\r\nI'm not surprised that rr has to do nontrivial work for this, and it's probably not something a normal application would do on the critical path, but this is a lot of slowdown.\r\n\r\nFor reference, the command I've been running is `MOZ_RUN_GTEST=True GTEST_FILTER=SandboxBrokerTest.MultiThread\\* rr record obj-x86_64-pc-linux-gnu/dist/bin/firefox -unittest`, and I'm using a non-debug build.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "hotsphink": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2154", "title": "rr assertion during recording of firefox/mochitest run: !is_in_untraced_syscall() || 0 == (SYSCALLBUF_LOCKED_TRACEE & read_mem(REMOTE_PTR_FIELD(syscallbuf_child, locked)))", "body": "Using rr ed91e251d4840f54add6a2cb4f2b784171301bdc (rr version 5.0.0).\r\n\r\n[FATAL /home/sfink/src/rr/src/Task.cc:2012:reset_syscallbuf()] \r\n (task 27107 (rec:27107) at time 6815702)\r\n -> Assertion `!is_in_untraced_syscall() || 0 == (SYSCALLBUF_LOCKED_TRACEE & read_mem(REMOTE_PTR_FIELD(syscallbuf_child, locked)))' failed to hold. \r\n=== Start rr backtrace:\r\nrr(_ZN2rr13dump_rr_stackEv+0x28)[0x544118]\r\nrr(_ZN2rr9GdbServer15emergency_debugEPNS_4TaskE+0x615)[0x4892f5]\r\nrr(_ZN2rr21EmergencyDebugOstreamD2Ev+0xe1)[0x4952f1]\r\nrr(_ZN2rr4Task16reset_syscallbufEv+0x82)[0x529e02]\r\nrr(_ZN2rr10RecordTask22maybe_reset_syscallbufEv+0x6c)[0x4e92bc]\r\nrr(_ZN2rr10RecordTask12record_eventERKNS_5EventENS0_15FlushSyscallbufEPKNS_9RegistersE+0x14e)[0x4e8b4e]\r\nrr[0x4b1193]\r\nrr(_ZN2rr13RecordSession11record_stepEv+0x184)[0x4b4ee4]\r\nrr(_ZN2rr13RecordCommand3runERSt6vectorINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESaIS7_EE+0xbae)[0x4aca9e]\r\nrr(main+0x1e8)[0x54c49a]\r\n/lib64/libc.so.6(__libc_start_main+0xf1)[0x7f07ff8db431]\r\nrr(_start+0x2a)[0x43f35a]\r\n=== End rr backtrace\r\nLaunch gdb with\r\n  gdb '-l' '10000' '-ex' 'set sysroot /' '-ex' 'target extended-remote 127.0.0.1:27107' /home/sfink/src/mozilla2/obj-x86_64-pc-linux-gnu/dist/bin/xpcshell\r\n\r\ntail of rr dump -t 27107 is:\r\n\r\n{\r\n  real_time:32321.485824 global_time:6815657, event:`SYSCALLBUF_ABORT_COMMIT' tid:27107, ticks:175252\r\n}\r\n{\r\n  real_time:32321.485880 global_time:6815658, event:`SYSCALL: rrcall_notify_syscall_hook_exit' (state:ENTERING_SYSCALL) tid:27107, ticks:175260\r\nrax:0xffffffffffffffda rbx:0x7fc03f758fa0 rcx:0xffffffffffffffff rdx:0xffffffff rsi:0x2 rdi:0xd0e62518ad0 rbp:0x1 rsp:0x7fc03f758e20 r8:0x0 r9:0x59f670d0 r10:0x0 r11:0x246 r12:0xd0e62518ad0 r13:0x7fc03f459306 r14:0xffffffff r15:0x10 rip:0x70000005 eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x1bc fs_base:0xd0e6251a700 gs_base:0x0\r\n}\r\n{\r\n  real_time:32321.485882 global_time:6815659, event:`SYSCALLBUF_RESET' tid:27107, ticks:175260\r\n}\r\n{\r\n  real_time:32321.485894 global_time:6815660, event:`SYSCALL: rrcall_notify_syscall_hook_exit' (state:EXITING_SYSCALL) tid:27107, ticks:175260\r\nrax:0x1 rbx:0x7fc03f758fa0 rcx:0xffffffffffffffff rdx:0xffffffff rsi:0x2 rdi:0xd0e62518ad0 rbp:0x1 rsp:0x7fc03f758e20 r8:0x0 r9:0x59f670d0 r10:0x0 r11:0x246 r12:0xd0e62518ad0 r13:0x7fc03f459306 r14:0xffffffff r15:0x10 rip:0x70000005 eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x7 fs_base:0xd0e6251a700 gs_base:0x0\r\n}\r\n{\r\n  real_time:32321.486054 global_time:6815661, event:`SYSCALLBUF_FLUSH' tid:27107, ticks:183241\r\n}\r\n{\r\n  real_time:32321.486056 global_time:6815662, event:`SYSCALL: poll' (state:ENTERING_SYSCALL) tid:27107, ticks:183241\r\nrax:0xffffffffffffffda rbx:0x7fc03f4592e6 rcx:0xffffffffffffffff rdx:0xffffffffffffffff rsi:0x2 rdi:0x7fc03f4592f6 rbp:0x7fc03f4592f6 rsp:0x7fc03f758e00 r8:0x0 r9:0x0 r10:0x0 r11:0x246 r12:0xd0e62518ad0 r13:0x7fc03f459306 r14:0xffffffff r15:0x10 rip:0x7000000e eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x7 fs_base:0xd0e6251a700 gs_base:0x0\r\n}\r\n{\r\n  real_time:32321.486260 global_time:6815670, event:`SYSCALL: poll' (state:EXITING_SYSCALL) tid:27107, ticks:183241\r\nrax:0x1 rbx:0x7fc03f4592e6 rcx:0xffffffffffffffff rdx:0xffffffffffffffff rsi:0x2 rdi:0x7fc03f4592f6 rbp:0x7fc03f4592f6 rsp:0x7fc03f758e00 r8:0x0 r9:0x0 r10:0x0 r11:0x246 r12:0xd0e62518ad0 r13:0x7fc03f459306 r14:0xffffffff r15:0x10 rip:0x7000000e eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x7 fs_base:0xd0e6251a700 gs_base:0x0\r\n}\r\n{\r\n  real_time:32321.486261 global_time:6815671, event:`SYSCALLBUF_ABORT_COMMIT' tid:27107, ticks:183241\r\n}\r\n{\r\n  real_time:32321.487074 global_time:6815701, event:`SCHED' tid:27107, ticks:183246\r\nrax:0x0 rbx:0x7fc03f459000 rcx:0xffffffffffffffff rdx:0x0 rsi:0x2401 rdi:0x67 rbp:0x7fc03f4592e6 rsp:0x7fc03f758e00 r8:0x0 r9:0x0 r10:0x0 r11:0x246 r12:0x1 r13:0x7fc03f459306 r14:0xffffffff r15:0x10 rip:0x70000017 eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x10 fs_base:0xd0e6251a700 gs_base:0x0\r\n}\r\n\r\nBacktrace of that process:\r\n\r\n(gdb) bt\r\nbt\r\n#0  0x0000000070000017 in  ()\r\n#1  0x0000013e561a2222 in _raw_syscall () at /home/sfink/src/rr/src/preload/raw_syscall.S:120\r\n#2  0x0000013e5619ee33 in disarm_desched_event () at /home/sfink/src/rr/src/preload/syscallbuf.c:729\r\n#3  0x0000013e5619ee33 in commit_raw_syscall (syscallno=syscallno@entry=7, record_end=record_end@entry=0x7fc03f459306, ret=1) at /home/sfink/src/rr/src/preload/syscallbuf.c:894\r\n#4  0x0000013e561a0dc7 in sys_poll (call=0x7fc03f758fa0)\r\n    at /home/sfink/src/rr/src/preload/syscallbuf.c:1698\r\n#5  0x0000013e561a0dc7 in syscall_hook_internal (call=0x7fc03f758fa0)\r\n    at /home/sfink/src/rr/src/preload/syscallbuf.c:2489\r\n#6  0x0000013e561a0dc7 in syscall_hook (call=0x7fc03f758fa0)\r\n    at /home/sfink/src/rr/src/preload/syscallbuf.c:2576\r\n#7  0x0000013e5619eaca in _syscall_hook_trampoline ()\r\n    at /home/sfink/src/rr/src/preload/syscall_hook.S:282\r\n#8  0x0000013e5619eafa in __morestack () at /home/sfink/src/rr/src/preload/syscall_hook.S:417\r\n#9  0x0000013e5619eb2a in _syscall_hook_trampoline_48_8b_3c_24 ()\r\n    at /home/sfink/src/rr/src/preload/syscall_hook.S:433\r\n#10 0x000018055f96ff41 in poll () at ../sysdeps/unix/syscall-template.S:84\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2154/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2066", "title": "Unable to break while running backwards: Assertion `req.is_resume_request() || req.type == DREQ_INTERRUPT'", "body": "Usually if I try to interrupt gdb, rr crashes. Just now I was doing a reverse-continue with a watchpoint set, it was taking a very long time, so I hit ctrl-C:\r\n\r\n(rr) rc\r\nContinuing.  C-c C-c\r\nrr: /home/sfink/src/rr/src/GdbConnection.cc:1346: void rr::GdbConnection::notify_stop(rr::GdbThreadId, int, uintptr_t): Assertion `req.is_resume_request() || req.type == DREQ_INTERRUPT' failed.\r\nRemote communication error.  Target disconnected.: Connection reset by peer.\r\n\r\nI normally avoid breaking during an rr replay to avoid this, but it would be nice if it could work.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2066/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1930", "title": "Recording Firefox with Gecko Profiler causes crash", "body": "For https://bugzilla.mozilla.org/show_bug.cgi?id=1322559 I was trying to record a --disable-profiling build of Firefox with the (new) Gecko Profiler enabled ( https://raw.githubusercontent.com/mstange/Gecko-Profiler-Addon/master/gecko_profiler.xpi ). I was seeing a crash in GeckoSampler::doNativeBacktrace, which is actually what I wanted to see and debug, but it appears that it is behaving differently when rr is recording so it isn't the crash I was looking for. (To be clear, this is not a problem of divergence between record and replay; this is the recording affecting the initial run.)\r\n\r\nWhat appears to be happening is that when a SIGPROF signal handler gets invoked, the stack pointer stored in its context argument is the stack pointer for rr's syscall hooking code, which is in a completely different stack from the actual executing program:\r\n````\r\n(rr) bt 14\r\n#0  0x00007f9ea85830f5 in GeckoSampler::doNativeBacktrace(ThreadProfile&, TickSample*) (this=this@entry=0x7f9e6fca3ca0, aProfile=..., aSample=aSample@entry=0x681ff6d8) at /home/sfink/src/mozilla/tools/profiler/core/GeckoSampler.cpp:1139\r\n#1  0x00007f9ea8583694 in GeckoSampler::InplaceTick(TickSample*) (this=0x7f9e6fca3ca0, sample=0x681ff6d8)\r\n    at /home/sfink/src/mozilla/tools/profiler/core/GeckoSampler.cpp:1219\r\n#2  0x00007f9ea857f209 in (anonymous namespace)::ProfilerSignalHandler(int, siginfo_t*, void*) (signal=<optimized out>, info=<optimized out>, context=0x681ff740) at /home/sfink/src/mozilla/tools/profiler/core/platform-linux.cc:252\r\n#3  0x00007f9eb6c09c30 in <signal handler called> () at /lib64/libpthread.so.0\r\n#4  0x000000007000000e in  ()\r\n#5  0x00007f9eb700e233 in _raw_syscall () at /home/sfink/src/rr/src/preload/raw_syscall.S:120\r\n#6  0x00007f9eb700b082 in untraced_syscall_base (syscallno=syscallno@entry=7, a0=a0@entry=140319650562601, a1=a1@entry=1, a2=a2@entry=-1, a3=a3@entry=0, a4=a4@entry=0, a5=0, syscall_instruction=0x7000000c) at /home/sfink/src/rr/src/preload/preload.c:334\r\n#7  0x00007f9eb700c362 in syscall_hook (call=0x681fffa0) at /home/sfink/src/rr/src/preload/preload.c:1753\r\n#8  0x00007f9eb700c362 in syscall_hook (call=0x681fffa0) at /home/sfink/src/rr/src/preload/preload.c:2402\r\n#9  0x00007f9eb700c362 in syscall_hook (call=0x681fffa0) at /home/sfink/src/rr/src/preload/preload.c:2456\r\n#10 0x00007f9eb700e26a in _syscall_hook_trampoline () at /home/sfink/src/rr/src/preload/syscall_hook.S:216\r\n#11 0x00007f9eb700e293 in __morestack () at /home/sfink/src/rr/src/preload/syscall_hook.S:348\r\n#12 0x00007f9eb700e2cd in _syscall_hook_trampoline_48_8b_3c_24 () at /home/sfink/src/rr/src/preload/syscall_hook.S:364\r\n#13 0x00007f9eb5e82571 in poll () at /lib64/libc.so.6\r\n#14 0x00007f9eaff93f80 in _xcb_conn_wait () at /lib64/libxcb.so.1\r\n\r\n(rr) f 4\r\n#4  0x000000007000000e in ?? ()\r\n(rr) p/x $rsp\r\n$14 = 0x681ffdf0\r\n(rr) f 12\r\n#12 0x00007f9eb700e2cd in _syscall_hook_trampoline_48_8b_3c_24 () at /home/sfink/src/rr/src/preload/syscall_hook.S:364\r\n(rr) p/x $rsp\r\n$17 = 0x681ffff0\r\n(rr) f 13\r\n#13 0x00007f9eb5e82571 in poll () from /lib64/libc.so.6\r\n(rr) p/x $rsp\r\n$18 = 0x7ffe68e53a90\r\n````\r\ndoNativeBacktrace grabs a chunk of the stack to memcpy, and ends up biting off more than it can chew -- I mean, access. I guess what I'd like it to do is give the signal handler the register state as of the \"call\" to _syscall_hook_trampoline?\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1930/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1758", "title": "Remote connection closed when stepping backwards", "body": "I made a recording with rr record ./mach run then navigating to file:///tmp/bug1252511.html until it seg faulted. I then replayed the recording, continued to the seg fault, did rn get to the seg fault again, then rn to step to the previous line, and then rr said \"Remote connection closed\"\n\nIf I preattach to the rr process, I get this stack:\n#0  0x00007f47d2e2e816 in __memcpy_sse2_unaligned () from /lib64/libc.so.6\n#1  0x000000000072c81d in rr::Task::write_bytes_helper (this=0x860dea0, addr=..., buf_size=1048576, buf=0x8005c10, ok=0x0)\n\n```\nat /home/sfink/src/rr/src/Task.cc:1880\n```\n#2  0x0000000000718087 in rr::Session::finish_initializing (this=0x7ebab40) at /home/sfink/src/rr/src/Session.cc:375\n#3  0x00000000006dc3c8 in rr::ReplaySession::clone (this=0x7ebab40) at /home/sfink/src/rr/src/ReplaySession.cc:154\n#4  0x00000000006f167a in rr::ReplayTimeline::seek_to_before_key (this=0x7ffc7be367d0, key=...)\n\n```\nat /home/sfink/src/rr/src/ReplayTimeline.cc:315\n```\n#5  0x00000000006f5eec in rr::ReplayTimeline::reverse_singlestep(rr::ReplayTimeline::Mark const&, rr::TaskishUidrr::Task const&, long, std::function<bool (rr::ReplayTask*)> const&, std::function<bool ()> const&) (this=0x7ffc7be367d0, origin=...,\n\n```\nstep_tuid=..., step_ticks=489259560, stop_filter=..., interrupt_check=...) at /home/sfink/src/rr/src/ReplayTimeline.cc:1056\n```\n#6  0x00000000006f7ab9 in rr::ReplayTimeline::reverse_singlestep(rr::TaskishUidrr::Task const&, long, std::function<bool (rr::ReplayTask*)> const&, std::function<bool ()> const&) (this=0x7ffc7be367d0, tuid=..., tuid_ticks=489259560, stop_filter=...,\n\n```\ninterrupt_check=...) at /home/sfink/src/rr/src/ReplayTimeline.cc:1329\n```\n#7  0x0000000000654a68 in rr::GdbServer::debug_one_step (this=0x7ffc7be36790, last_resume_request=...)\n\n```\nat /home/sfink/src/rr/src/GdbServer.cc:1017\n```\n#8  0x0000000000655c2d in rr::GdbServer::serve_replay (this=0x7ffc7be36790, flags=...)\n\n```\nat /home/sfink/src/rr/src/GdbServer.cc:1257\n```\n#9  0x00000000006da702 in rr::replay (trace_dir=\"\", flags=...) at /home/sfink/src/rr/src/ReplayCommand.cc:397\n#10 0x00000000006dafde in rr::ReplayCommand::run (this=0xa055b0 rr::ReplayCommand::singleton,\n\n```\nargs=std::vector of length 0, capacity 4) at /home/sfink/src/rr/src/ReplayCommand.cc:504\n```\n#11 0x0000000000743da5 in main (argc=4, argv=0x7ffc7be37078) at /home/sfink/src/rr/src/main.cc:270\n\nThis is with rr 8fc5abc0b9896540f03540be8a01ebeb7cd73838\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1758/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "gaasedelen": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2143", "title": "RR can get stuck in an infinite loop during reverse-step", "body": "Filing this so it doesn't get lost/forgotten. I haven't had a chance to investigate this.\r\n\r\n## Overview\r\n\r\nThere appears to be a bug where rr can get stuck in an infinite loop while attempting to complete a `reverse-step` request. Based on the repro steps, the bug may stem from the use of hardware breakpoints while stepping around or over syscalls. \r\n\r\nDemo of the issue: https://asciinema.org/a/1pu9AI7IQHYUn4TcWIbpP36A4\r\n\r\n## Stack Trace\r\n\r\nI attached to the stuck proc and dumped its stack trace. Seems stuck in a loop.\r\n\r\n```\r\n(gdb) bt\r\n#0  0x00007fa2e03c3dee in ptrace (request=32) at ../sysdeps/unix/sysv/linux/ptrace.c:45\r\n#1  0x0000000000522728 in rr::Task::fallible_ptrace (this=0xee6340, request=32, addr=..., data=0x0) at ../src/Task.cc:1922\r\n#2  rr::Task::ptrace_if_alive (this=0xee6340, request=32, addr=..., data=0x0) at ../src/Task.cc:2259\r\n#3  0x000000000051edcc in rr::Task::resume_execution (this=0xee6340, how=rr::RESUME_SYSEMU_SINGLESTEP, wait_how=<optimized out>, tick_period=rr::RESUME_UNLIMITED_TICKS, sig=0) at ../src/Task.cc:1049\r\n#4  0x000000000045e243 in rr::fast_forward_through_instruction (t=0xee6340, how=rr::RESUME_SYSEMU_SINGLESTEP, states=std::vector of length 1, capacity 1 = {...}) at ../src/fast_forward.cc:164\r\n#5  0x00000000004e871b in rr::ReplaySession::cont_syscall_boundary (this=0xea9ae0, t=0xee6340, constraints=...) at ../src/ReplaySession.cc:357\r\n#6  0x00000000004e8e20 in rr::ReplaySession::enter_syscall (this=0xea9ae0, t=0xee6340, constraints=...) at ../src/ReplaySession.cc:456\r\n#7  0x00000000004ed9c9 in rr::ReplaySession::replay_step (this=0xea9ae0, constraints=...) at ../src/ReplaySession.cc:1477\r\n#8  0x0000000000508789 in rr::ReplayTimeline::reverse_singlestep(rr::ReplayTimeline::Mark const&, rr::TaskishUid<rr::Task> const&, long, std::function<bool (rr::ReplayTask*)> const&, std::function<bool ()> const&) (\r\n    this=<optimized out>, origin=..., step_tuid=..., step_ticks=<optimized out>, stop_filter=..., interrupt_check=...) at ../src/ReplayTimeline.cc:1190\r\n#9  0x000000000050aeac in rr::ReplayTimeline::reverse_singlestep(rr::TaskishUid<rr::Task> const&, long, std::function<bool (rr::ReplayTask*)> const&, std::function<bool ()> const&) (this=0x7fff1d085eb8, tuid=..., tuid_ticks=31,\r\n    stop_filter=..., interrupt_check=...) at ../src/ReplayTimeline.cc:1366\r\n#10 0x000000000047ae43 in rr::GdbServer::debug_one_step (this=<optimized out>, last_resume_request=...) at ../src/GdbServer.cc:1205\r\n#11 0x000000000047c66b in rr::GdbServer::serve_replay (this=<optimized out>, flags=...) at ../src/GdbServer.cc:1537\r\n#12 0x00000000004e5af2 in rr::replay (trace_dir=..., flags=...) at ../src/ReplayCommand.cc:452\r\n#13 rr::ReplayCommand::run (this=<optimized out>, args=...) at ../src/ReplayCommand.cc:567\r\n#14 0x000000000054779e in main (argc=3, argv=0x7fff1d086798) at ../src/main.cc:237\r\n```\r\n\r\n## Reproduction steps\r\n\r\nDownload the [trace.zip](https://github.com/mozilla/rr/files/1502730/trace.zip) of the `simple_32` unit test and load it via `rr replay`. The following GDB commands will trigger the issue. \r\n\r\n```\r\nhbreak * 0x70000003 \r\nc\r\nstepi\r\nreverse-stepi\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2143/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/3def9783ca1e6b6feea524a4d77854c3f140d079", "message": "retain std::string host address where appropriate"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/766f15bac2949ec87de78404fdd2f5058ecf2e2e", "message": "enable remote replay debugging via user specified host address"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "BusyJay": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2141", "title": "sched_getcpu doesn't keep consistent with sysconf(_SC_NPROCESSORS_ONLN)", "body": "When calling `sysconf(_SC_NPROCESSORS_ONLN)`, the returned value is always 1. However when call `sched_getcpu`, the actual cpu number is returned, which may be larger than 1. It may lead to unexpected index out of range access in some program.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2141/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "pm215": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2132", "title": "^C in gdb ignored when doing reverse-execution of a replay with conditional-bp", "body": "I was trying to debug a replay, and I set up a conditional bp and did a reverse-continue. It took longer than I was expecting, so I tried to ^C to interrupt and get back to a debug prompt. rr ignored the ^C and I had to resort to killing the whole debug session and restarting it.\r\n```\r\n(rr) cond 9 (itb->pc - 0xffffadea4000) == 9e6924\r\n(rr) rc\r\nContinuing.\r\n^C\r\n^CInterrupted while waiting for the program.\r\nGive up waiting? (y or n) n\r\n^C^CInterrupted while waiting for the program.\r\nGive up waiting? (y or n) y\r\nQuit\r\n```\r\n\r\nThe bp condition was of a form that meant it couldn't be executed on the rr end ('info bp' said \"host evals\"), so slowness is perhaps expected, but the user should always be able to regain control with ^C.\r\n\r\n(This is with rr commit b8821907e0ed.)\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2132/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1726", "title": "rr: proc-mem_32 test fails", "body": "I built rr from commit 958f2cc and (after fixing issue #1725) all the tests pass except for two:\n1099:proc_mem-32\n1100:proc_mem-32-no-syscallbuf\n\nLastTest.log says:\n\n```\n1099/1684 Testing: proc_mem-32\n1099/1684 Test: proc_mem-32\nCommand: \"/bin/bash\" \"/home/petmay01/src/rr/src/test/basic_test.run\" \"-b\" \"/home/petmay01/src/rr\" \"/home/petmay01/src/rr-obj64\" \"proc_mem_32\"\nDirectory: /home/petmay01/src/rr-obj64\n\"proc_mem-32\" start time: Jun 07 15:13 BST\nOutput:\n----------------------------------------------------------\nTest 'proc_mem_32' FAILED: : error during recording:\n--------------------------------------------------\nproc_mem_32-4LaeLtNmg: /home/petmay01/src/rr-obj64/32/proc_mem.c:101: do_test: Assertion `\"FAILED: !\" && check_cond(sizeof(COOKIE) == pwritev(fd, iov, 2, (off_t)&cookie2))' failed.\n--------------------------------------------------\nrecord.out:\n--------------------------------------------------\nFAILED: errno=5 (Input/output error)\n--------------------------------------------------\nTest proc_mem_32 failed, leaving behind /tmp/rr-test-proc_mem_32-4LaeLtNmg\nTo replay the failed test, run\n  _RR_TRACE_DIR=/tmp/rr-test-proc_mem_32-4LaeLtNmg rr replay\n<end of output>\nTest time =   0.26 sec\n----------------------------------------------------------\nTest Fail Reason:\nError regular expression found in output. Regex=[FAILED]\n\"proc_mem-32\" end time: Jun 07 15:13 BST\n\"proc_mem-32\" time elapsed: 00:00:00\n----------------------------------------------------------\n\n1100/1684 Testing: proc_mem-32-no-syscallbuf\n1100/1684 Test: proc_mem-32-no-syscallbuf\nCommand: \"/bin/bash\" \"/home/petmay01/src/rr/src/test/basic_test.run\" \"-n\" \"/home/petmay01/src/rr\" \"/home/petmay01/src/rr-obj64\" \"proc_mem_32\"\nDirectory: /home/petmay01/src/rr-obj64\n\"proc_mem-32-no-syscallbuf\" start time: Jun 07 15:13 BST\nOutput:\n----------------------------------------------------------\nTest 'proc_mem_32' FAILED: : error during recording:\n--------------------------------------------------\nproc_mem_32-TtoHLXllu: /home/petmay01/src/rr-obj64/32/proc_mem.c:101: do_test: Assertion `\"FAILED: !\" && check_cond(sizeof(COOKIE) == pwritev(fd, iov, 2, (off_t)&cookie2))' failed.\n--------------------------------------------------\nrecord.out:\n--------------------------------------------------\nFAILED: errno=5 (Input/output error)\n--------------------------------------------------\nTest proc_mem_32 failed, leaving behind /tmp/rr-test-proc_mem_32-TtoHLXllu\nTo replay the failed test, run\n  _RR_TRACE_DIR=/tmp/rr-test-proc_mem_32-TtoHLXllu rr replay\n<end of output>\nTest time =   0.19 sec\n----------------------------------------------------------\nTest Fail Reason:\nError regular expression found in output. Regex=[FAILED]\n\"proc_mem-32-no-syscallbuf\" end time: Jun 07 15:13 BST\n\"proc_mem-32-no-syscallbuf\" time elapsed: 00:00:00\n----------------------------------------------------------\n```\n\nThe native-64-bit version of the test passes.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1726/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "theres-waldo": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2131", "title": "reverse-continue to a checkpoint", "body": "I often want to use the following workflow:\r\n\r\n  1. Mark where I currently am\r\n  1. Go forward a bit\r\n  1. Go back to the place I marked\r\n\r\nI can do the first with `when`, which gives me an event number that marks my position, but the only way I know to do the third is with `run <event-number>`, which restarts the replay from the beginning.\r\n\r\nI'd like to be able to reverse-continue to the marked event instead. Depending on how long the replay is and how far I've gone forward from the marked place, that can be significantly faster than starting from the beginning.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2131/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "khuey": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2130", "title": "Certain ptrace-like permissions checks may fail due to our emulated ptrace setup.", "body": "The kernel uses the ptrace permissions model for checks of other things, such as parts of the proc filesystem and syscalls like `process_vm_writev`.  On systems with yama enabled at `ptrace_scope=1`, processes are usually restricted to ptracing their descendants. Yama does make an exception to that rule for processes that are *already* ptracing a process, allowing ptracing to continue even in the case of a ptraced grandchild where the child exits and the grandparent is reparented to init. Under rr though, the process that thinks it's ptracing is never the real ptracer as seen by the kernel, because  rr is. In any case where an operation was relying on that \"already ptracing\" exception to succeed it will fail under rr.\r\n\r\nI think we could work around this by injecting a `prctl(PR_SET_TRACER)` into the traced process. The other exception to the yama rules is for processes designated via this mechanism, and there's nothing that requires it to be the same as the actual ptracer. The main question is *when* to inject that syscall. I tried adding code to do it from `set_emulated_ptracer` but that blew up pretty quickly (among other problems, after a PTRACE_DETACH the tracee is not stopped there!).", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2130/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1886", "title": "Failing tests under docker", "body": "Probably due to docker weirdness.\r\n\r\nThe following tests FAILED:\r\n\t 41 - chown (Failed)\r\n\t 42 - chown-no-syscallbuf (Failed)\r\n\t 67 - cwd_inaccessible (Failed)\r\n\t 68 - cwd_inaccessible-no-syscallbuf (Failed)\r\n\t419 - setuid (Failed)\r\n\t420 - setuid-no-syscallbuf (Failed)\r\n\t547 - unshare (Failed)\r\n\t548 - unshare-no-syscallbuf (Failed)\r\n\t765 - ttyname (Failed)\r\n\t989 - chown-32 (Failed)\r\n\t990 - chown-32-no-syscallbuf (Failed)\r\n\t1015 - cwd_inaccessible-32 (Failed)\r\n\t1016 - cwd_inaccessible-32-no-syscallbuf (Failed)\r\n\t1367 - setuid-32 (Failed)\r\n\t1368 - setuid-32-no-syscallbuf (Failed)\r\n\t1495 - unshare-32 (Failed)\r\n\t1496 - unshare-32-no-syscallbuf (Failed)\r\n\t1713 - ttyname-32 (Failed)\r\n\r\nThe chown one at least is due to the `getgroups` call failing.  Didn't look at any others yet.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1886/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1794", "title": "'threads' fails checksum validation", "body": "With --checksum=after-syscalls:\n\n> [FATAL /home/khuey/dev/rr/src/util.cc:312:iterate_checksums() errno: SUCCESS](task 19090 %28rec:19063%29 at time 228)\n>  -> Assertion `rec_start_addr == m.map.start() && rec_end_addr == m.map.end()' failed to hold. Segment 0x7fa741e71000-0x7fa741f71000 changed to 0x7fa742171000-0x7fa742172000 ---p 00000000 00:00 0          ??\n> Launch gdb with \n>   gdb '-l' '-1' '-ex' 'target extended-remote :19090' /home/khuey/.local/share/rr/latest-trace/mmap_hardlink_2_threads\n\nIt's at shutdown and seems to be related to pthreads somehow.  Filing so I don't forget.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1460", "title": "build in \"strace\"", "body": "Something I find myself wanting occasionally is to run strace on a recording.  rr should be able to dump that information.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1460/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1373", "title": "Support ARM", "body": "Should file this since I'm working on it.\n\nhttps://github.com/khuey/rr/compare/arm\n\nRequires a couple kernel patches at the moment too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1373/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/756f0c1f13e692f4d3152d850f81aacf9a31aa08", "message": "Use EBX instead of ECX to get the XSAVE area as determined by the set of features enabled in XCR0, rather than the theoretical maximum.\n\nFixes #2157."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9d9a5e947516227aa0c36f237e2c542f6d726ef4", "message": "Restore memset that was removed in 5a9324ed because there are still registers (like fsbase) that are in the 64 bit struct but not the 32 bit struct."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e6717d6ce6974492ec7b2272131db1243e0e4b5e", "message": "Fix handling at exec boundary."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c0e518175ac47482b0af295b23146bb4760b3e82", "message": "When skipping through the replay to a specified starting event, skip a bunch of the singlestep handling logic.\n\nold_task might have died here, so it's not safe to access it."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5cac6e702ed1a79b73b346d7de8efadeda321da4", "message": "Bound the recorded sighandler frame size to the mapping that contains it.  Fixes #2137."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ecf66e92694314c0e561bf3a199e7157169d166c", "message": "Fix zombie detection to actually work, and use it in kill_all_tasks."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1132d840469ad37139668f007e92c9e56454267e", "message": "Be more particular about what query/resume_task are reset to."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/199c486d7126b428c8a0101e7b49b97f59de0d61", "message": "Make sure to send SIGKILL to the right thread."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c71809f1f9845d2d916fc22ce835554cf8aae4e1", "message": "Don't resume_execution in continue_or_step with the same tick_request twice."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/599cd2c6cbb28191aa441258f294e97a32da2ae2", "message": "Test that checkpoints don't mess up replacement mappings."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3bdc26a4cc07c2e027a2b0941791f7c5180e4cbc", "message": "Fix replace mappings test to work on 64 bit, and actually check results of mmap calls."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8257bdee0558b72f49d946f1619b47d568794369", "message": "Fix tests on Ubuntu."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a74ed472c710d7a1294db440ab2d3eba8eb301e3", "message": "Test asynchronous events for rr inside rr."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/155c0bb62f72d97adba3de8ec5bf98524f236338", "message": "Be careful not to step on existing mappings occupying the place of the preload thread locals."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/fdd2cbe2f4006dd714b725469cbd2351ee1da7ce", "message": "Support basic virtualization of pmc interrupts, sufficient to record an rr replay that uses asynchronous events."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9d2c67479027c5d67cb5133b2e7b4a12d0107785", "message": "Be careful not to clobber the \"initial\"[0] registers in AutoRemoteSyscalls when restore_state_to()ing.\n\nIf we're restoring the state multiple times to multiple different processes (e.g. after cloning a checkpoint) clobbering initial_regs.ip with initial_ip will cause us to write replaced_bytes back to the wrong location if the ip did in fact change.\n\n[0] we should rename this."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7193d3e55ebfe76679e017d7272ceb1f2e188a8a", "message": "Copy over the cpuid instruction state when cloning a RecordTask."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5df3a1c888e84c8545dfdb84f0c70ce5dc1ca657", "message": "Fix off by one error that results in not sending ymm15h."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/df044a12aba6c662d8178e1b4c9b2b2159bb01b3", "message": "`syscall` clobbers rcx and r11, be sure to tell gcc."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6f61cc311c608299bc8349f9dd6b1407e0e7f129", "message": "Fix 32 bit build."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7a7d025ed14d52c5c9ac47f7e1ae5dcec81f42e1", "message": "Detect the Xen PMI bug."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/375103b26f7daeab421755fab1d35b66e68bae47", "message": "Add RR_LOG_FILE."}], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/19103320", "body": "Yeah, we could add the debugging commands from #1803 as a test.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19103320/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19108007", "body": "`std::shared_ptr` is not implicitly convertible to `bool`.  This is common for well-designed C++ smart pointer classes.\n\nIt is negatable though. The `!!` idiom  follows from that. Not sure how common that is, we used to use it in Gecko a lot which is where I picked it up.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19108007/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19183355", "body": "Ok, I can reproduce this, and think I know what's going on.  I don't really understand why it seems to be no-syscallbuf only though.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19183355/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19850397", "body": "It is a KVM bug.  I'm looking at fixing it.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19850397/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19976789", "body": "I sent patches to the KVM folks.  See http://marc.info/?l=kvm&m=148030677426335&w=2.  I'm not going to die on this hill though, so if they get a ton of review pushback I'll probably abandon them.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19976789/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993466", "body": "It could be ENODEV if it's a hardware issue, not software, so I didn't bother.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993466/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993467", "body": "Indeed.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993471", "body": "Good catch.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993471/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19994118", "body": "It's pedantic, but yeah, you're right.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19994118/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19994143", "body": "Indeed.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19994143/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/20460271", "body": "Thomas Gleixner hasn't responded to my emails in a while.  I should try it again.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/20460271/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26328204", "body": "I don't understand.  The issue here is structure packing.  The sizes of the variables themselves are already correct on all three architectures, but on x86-32 a uint64_t can be 32 bit aligned, while on ARM 64 bit values require 8 byte alignment.  Thus declaring it with 64 bit values in rr while the kernel uses two 32 bit values leads to incorrect structure packing.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26328204/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26349312", "body": "Aha, I had missed that there are separate definitions of __kernel_time_t.  Alright, yes, we'll need to split it up by arch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26349312/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77467110", "body": "The comment should probably say something like \"Now record the new part of the mapping, possibly overlapping the last page of the previous mapping if additional bytes were mapped into that page\"\n\nThe problem is slightly below here.  If we have a file with a length between pages `N` and `N+1`,  then using `old_size` (which is really `ceil_page_size(old_length)`) will give us a `KernelMapping` with `file_offset_bytes()` at `page_size * (N+1)`.  `st.st_size` is somewhere below that, so we end up with a negative value for `end` and `record_remote` explodes.\n\nIf we instead start our `KernelMapping` at `floor_page_size(old_length)` we guarantee that `end` will be positive and `record_remote` will pick up any existing bytes mapped into the page that already exists.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77467110/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77468063", "body": "_sigh_ that's what I get for modifying the testcase after writing the patch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77468063/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77468684", "body": "Indeed.  Fixed.  I should stop writing code tonight before I destroy anything else :P\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77468684/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77922357", "body": "Good catch. `offset_adjustment` is left over from before I realized that dirents only have relative offsets anyways and should removed.\n\nAnd yes, you're right.\n\nI suspect this worked because when Chromium enumerates through the fds only the root_fd exists.  I'll write some more tests.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77922357/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77926529", "body": "It only denies the features listed in the file ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77926529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927538", "body": "protect_rr_fds does that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927538/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927696", "body": "set_data_from_trace. done.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927696/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77928399", "body": "Now that I look at it again, the iteration through all fds is a fallback if /proc/<pid>/fd isn't available for some reason (which it wasn't when I was hacking things together because I commented out the code that opened it).  I'll add `fstat`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77928399/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77928523", "body": "Done.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77928523/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77929052", "body": "No, we still need this or something similar, because we need to be able to hide rr's fds from /proc/pid/fd/ (and not hide tracee fds) which requires us to know exactly which fds belong to rr.  The alternative would be to specifically keep track of that somewhere, but that would be non-trivial too (and is somewhat observable), and this code is already written.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77929052/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77929176", "body": "Don't even have to keep track, just use t->session().vms().\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77929176/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930212", "body": "> We're already tracking which fds should be hidden, effectively: we add a PreserveFileMonitor for the rootdir fd, desched_fd_child and cloned_file_data_fd_child. FileMonitor::allow_close just needs a name change (and value inversion) to is_rr_fd or something like that, then you can call into FdTable from the /proc/.../fd censoring code.\n\nAh, that's true.\n\n>  What did you mean by \"somewhat observable\"?\n\nThe tracee can see magical holes in the fd space that are unused but it can't dup to/etc.\n\n> I appreciate that this code is already written, but it does add overhead as well as complexity.\n\nFair\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930212/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930337", "body": "> Also, it just occurred to me that if we really do need to put rr's fds beyond the tracee's apparent fd-limit for some reason, it would probably be a lot simpler to just fake the result of getrlimit instead of really lowering the limit.\n\nThe reason I didn't do that is that fds created by the kernel would naturally \"float\" beyond the apparent fd-limit.  That would break anything that expected to be able to close all its own fds this way.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930337/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80172763", "body": "Ok.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80172763/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80172946", "body": "The kernel only does this for SIGSEGV.  See https://github.com/torvalds/linux/blob/2b1ecc3d1a6b10f8fbac7f83d80db30b5a2c2791/kernel/signal.c#L1446\n\n`clone_bad_stack` triggers this.  Setting up the signal handler frame for `SYSCALLBUF_DESCHED_SIGNAL` fails because the stack is bad.  That triggers a SIGSEGV which puts us in this block of code here.  If we default away `SYSCALLBUF_DESCHED_SIGNAL` then `verify_signal_state` asserts.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80172946/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80175268", "body": "I don't think this is actually the case.  Note that this is before we call `rrcall_init_preload`, so rr doesn't know the syscallbuf is enabled yet, and `RecordTask::is_in_syscallbuf()` will return false anyways.  Also it would be safe to deliver signals in a traced syscall.  The only possible behavior difference I can see is that not using the rr page could make us skip `fixup_syscall_registers` at the end of `Task::did_waitpid`.  But that's also for untraced syscalls.\n\nThis is also a bit of a PITA to fix, because the libc wrapper sets up the restore trampoline for us, so if we can avoid this it would be nice.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80175268/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80181018", "body": "Ah, right, forgot about that.  I'll add a comment and we can worry about it if it ever comes up.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80181018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477948", "body": "We support 64 bit userspace now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477948/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477977", "body": "system requirements\nIntel CPU\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477977/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81478128", "body": "Yeah, the presentation is ancient :/\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81478128/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "rocallahan": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2129", "title": "Add unmap events to trace?", "body": "Traces contain explicit records for all mappings, but currently tools that want to extract unmap events from the trace have to study rr's inner workings to determine exactly what is unmapped and when. For example in `Task::clone` we unmap some tasks' syscall buffers and scratch buffers after a fork, and these decisions are not recorded in the trace. It would be much cleaner for tools other than rr itself if we recorded these unmap events in the trace.\r\n\r\nHowever, it would be good if the ecosystem around rr traces can consume any trace in the rr 5.0+ format. So maybe we should just document the unmap rules carefully instead, and if we ever change them, enhance the trace to record unmaps and add a flag to say to use those recorded events instead of the default rules. This approach is more complex for consumers though.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2129/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2127", "title": "Investigate mmap behavior with changing file lengths", "body": "Right now we assume that the size of an mmapped file never changes (except possibly accompanies by an `mremap`). However I think it's possible to mmap a file and then use ftruncate to change its length. This would require special handling in rr.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2127/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2120", "title": "multiple tracee seccomp filters won't be treated with the right priorities", "body": "We turn all tracee resutls into `SECCOMP_RET_TRACE`. For multiple filters, the kernel chooses the first filter result whose action is the lowest action number, which means that among the tracee filters it will always choose the first filter's result. So if the first tracee filter was supposed to return `SECCOMP_RET_ERRNO` and the second tracee filter was supposed to return `SECCOMP_RET_TRAP`, we'll actually emulate the former instead of the latter.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2120/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2108", "title": "`exec_from_other_thread` test is failing intermittently", "body": "Undoubtedly a recent regression.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2108/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2100", "title": "`SECCOMP_RET_KILL` under rr reports the terminating signal as `SIGKILL` instead of `SIGSYS`", "body": "This is tricky to fix because `SIGSYS` can be blocked or handled, unlike `SIGKILL`, so we can't just send `SIGSYS` instead of `SIGKILL`. We can try unblocking `SIGSYS` and setting its handler to default, and then sending it or stashing it, but that could behave oddly when `SECCOMP_RET_KILL` is used for a buffered syscall.\r\n\r\nWe could try to send `SIGKILL` and then try to lie about the `waitpid` status using `RecordTask::emulated_stop_code`. That is perhaps the best approach.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2100/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2099", "title": "Fix `clone_share_vm` test", "body": "This test is trickier than I thought.\r\n\r\nThe problem is the handling of `cloned_file_data_fd_child` when we restore captured state in `Task::copy_state`. For correct replay, that fd *must* refer to the opened cloned-data file for this task. But consider the case where this task has been cloned from a group-leader task holding its address space, but during recording this task had a different file descriptor table to that group-leader task (e.g. because this task was cloned with `CLONE_VM` but not `CLONE_FILES`); this task's `cloned_file_data_fd_child` and the group-leader's `cloned_file_data_fd_child` could be equal. During replay this task and the group-leader task currently always share file-descriptor tables so we can't have that same file descriptor value assigned to the two different files.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2099/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2095", "title": "Recording fails when you bombard the tracee with SIGCONT", "body": "If you apply this patch:\r\n````\r\ndiff --git a/src/test/thread_exit_signal.run b/src/test/thread_exit_signal.run\r\nindex f39c19ee6..d022b8b1f 100644\r\n--- a/src/test/thread_exit_signal.run\r\n+++ b/src/test/thread_exit_signal.run\r\n@@ -6,11 +6,13 @@ until grep -q ready record.out; do\r\n   sleep 0\r\n done\r\n \r\n+PID=$(pidof $TESTNAME-$nonce)\r\n for i in $(seq 1 100); do\r\n   sleep 0.001\r\n-  kill -CHLD $(pidof $TESTNAME-$nonce) >& /dev/null\r\n+  kill -CHLD $PID >& /dev/null\r\n+  kill -CONT $PID >& /dev/null\r\n done\r\n-kill -USR2 $(pidof $TESTNAME-$nonce) >& /dev/null\r\n+kill -USR2 $PID >& /dev/null\r\n \r\n # Wait for 'record' to actually terminate. Otherwise we might start\r\n # replaying before the trace file has been completely written.\r\n````\r\nyou get all sorts of failures. It appears that when a `PTRACE_SINGLESTEP` races with a `SIGCONT` the kernel reports `PTRACE_EVENT_STOP` with a `SIGTRAP` and those can be reported in all sorts of places. ", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2095/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2090", "title": "Support loading symbols for shared libraries from the trace", "body": "Currently gdb tries to load symbols for shared libraries by grabbing the file names from tracee memory and trying to read those files in the local filesystem. That won't work well when the local files have changed or are simply not there. In those cases gdb needs to read symbols from files in our trace.\r\n\r\nIn 6b272d5a27a73c071ed492db0e4a2ccfcb04536f we added support for `vFile` in the remote protocol, and gdb would normally use this to load files from the remote target, but we disabled that by forcing `set sysroot /`. If we remove that command then gdb will request files from rr, so in principle we could return the contents of files from our trace, but there are a couple of problems:\r\n* Shoveling large files through the remote protocol socket is slow. I don't think there's much we can do about this without modifying gdb.\r\n* The filenames in tracee memory (and thus supplied by gdb) often refer to symbolic links to the real files. The \"original file names\" in the rr trace are obtained from `/proc/.../maps`, which gives the real names. Thus, identifying the correct trace file for the name provided by gdb is difficult.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2090/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2034", "title": "Support AMD Ryzen?", "body": "Ryzen has a conditional branch counter. I have patches to use it here: https://github.com/mozilla/rr/tree/ryzen\r\n\r\nTo make it work reliably I had to increase the skid counter to 1000. That's pretty high, but OK. The patches make the skid size configurable per-architecture so we don't take that hit on Intel.\r\n\r\nWith these patches, most tests pass and the rest seem to be intermittent. In one run I get 10 failures out of 2068:\r\n````\r\n        327 - proc_fds (Failed)\r\n        388 - ptracer_death_multithread_peer-no-syscallbuf (Failed)\r\n        688 - condvar_stress-no-syscallbuf (Failed)\r\n        835 - thread_stress (Failed)\r\n        904 - checkpoint_prctl_name-no-syscallbuf (Failed)\r\n        1362 - proc_fds-32-no-syscallbuf (Failed)\r\n        1679 - async_signal_syscalls2-32 (Failed)\r\n        1722 - condvar_stress-32-no-syscallbuf (Failed)\r\n        1869 - thread_stress-32 (Failed)\r\n        1870 - thread_stress-32-no-syscallbuf (Failed)\r\n````\r\n\r\nIt appears that all these failures are due to intermittent overcounting. In most of them, during recording we seem to have overcounted a few conditional branches in the leadup to some syscall. In the rest, we seem to have overcounted during replay.\r\n\r\nOne interesting thing is that most of the syscalls where we detect the overcount are an `mprotect` (or a syscall following a syscall-buffered `mprotect`) that followed an `mmap`. There are two exceptions, one a `read` syscall and one a `write` syscall. I need to think about what this might mean.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2034/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1987", "title": "Intermittent test failure in `daemon_read`", "body": "I've seen this on and off. It just happened on `ci.rr-project.org`. Relevant log: https://ci.rr-project.org/#/builders/2/builds/142/steps/7/logs/stdio", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1987/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1980", "title": "`thread_exit_signal` fails intermittently", "body": "This I can reproduce locally using\r\n````\r\nbash thread_exit_signal.run -b ~/rr/rr '' &  thread_exit_signal.run -b ~/rr/rr '' & bash thread_exit_signal.run -b ~/rr/rr '' & bash thread_exit_signal.run -b ~/rr/rr '' & \r\n````", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1980/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1978", "title": "`rr_ps_ns` sometimes times out", "body": "On my machine. It looks like the test hangs during recording. It's not easily reproducible.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1978/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1961", "title": "disturbing behavior of `perf stat` and HLE events", "body": "chdir to a Linux kernel checkout and then do:\r\n````\r\nperf stat -e el-start ls\r\n...\r\n Performance counter stats for 'ls':\r\n                 0      el-start\r\n````\r\n````\r\nperf stat -e el-start -e el-abort ls\r\n...\r\n Performance counter stats for 'ls':\r\n                 0      el-start                                                    \r\n                 1      el-abort\r\n````\r\n````\r\nperf stat -e el-abort -e el-start ls\r\n...\r\n Performance counter stats for 'ls':\r\n                 0      el-abort                                                    \r\n                 1      el-start\r\n````", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1961/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1937", "title": "Use `process_vm_readv`/`process_vm_writev`instead of opening `/proc/<pid>/mem`?", "body": "These are available in Linux 3.2 so it would be no trouble to depend on them. I think this would simplify the code a bit since we might be able to use that syscall in all situations and not have to reopen the mem-fd or worry about the state where it's not open.\r\n\r\nMy only concern is whether there are cases where we are ptracing a process but those syscalls don't work due to permissions. Might need to experiment.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1937/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1916", "title": "Rework trace storage", "body": "The current trace storage approach has some issues that we need to fix:\r\n* Traces are written directly by the rr process and buffered data is not always flushed, so `SIGKILL` directed at the rr process (not uncommon, when rr is used as a wrapper around some program that normally is `SIGKILL`ed by other code, e.g. on timeout) leaves an unusable trace.\r\n* rr must finish writing a trace before anything can start consuming the trace. If we fixed this then you could start an `rr replay` concurrently with an `rr record` and be ready to debug as soon as an error is encountered instead of having to wait for the replay.\r\n* There is no currently way to efficiently package a trace for copying or streaming to another machine for replay.\r\n* Currently trace versioning is very primitive and there is no way for `rr replay` to consume trace versions other than the 'current' version.\r\n\r\nOn the other hand it has some important features we need to preserve:\r\n* We avoid copying data by hardlinking and `FICLONERANGE`ing files into the trace directory.\r\n* Certain data records like memory-maps and trace-events are stored in their own files so tools can efficiently read those records without having to scan the whole trace.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1827", "title": "Support wireless ioctls", "body": "The ioctls in `/usr/include/linux/wireless.h` are irregular so they are silently allowed by rr even though some of them return data to user-space. On my system, `chromium-browser` uses some of them and this causes divergence. I see it using at least `SIOCGIWNAME` and `SIOCGIWESSID`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1827/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1670", "title": "hardlinks to system libraries make system unbootable due to SELinux (?)", "body": "After running rr as root and recording some stuff that used libraries like libselinux.so, I was unable to boot, apparently because loading some system libraries was being blocked by SELinux. This may have been because rr created hardlinks to system libraries and changed their SELinux contexts.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1590", "title": "Slow reverse execution when many signals fire", "body": "If you record Firefox with the Gecko profiler running, reverse execution is very slow. This is because a lot of async signals are delivered. Every time we encounter a signal during reverse execution, we restore the full session state to the point of signal delivery and return a signal-stop to gdb. This necessarily requires cloning a checkpoint, doing some execution to get to the signal-stop, and doing that tens of thousands of times is slow. This is a waste when those signals are ignored by gdb, which they are by default.\n\ngdb has no way to tell the agent which signals it can ignore. The only way to fix this would be to lazily restore the state (like we do for reverse-stepping): i.e., report the signal-stop to gdb without actually restoring the program state. Then if gdb tells us to reverse-continue immediately, we never have to restore the state. In practice, for an ignored signal gdb doesn't tell us to reverse-continue immediately; it reads registers, reads the byte at the current PC (twice!), and then does reverse-continue. So `ReplayTimeline::reverse_continue` would do a forward execution, and for every signal encountered, store the current registers and the byte at the current PC. Then it would report the last signal to gdb without restoring the state. If gdb just does read-registers and read-byte-at-PC and then reverse-continue, we can proceed to report the previous signal-stop without restoring any state. If gdb does anything else, we restore the state normally and continue.\n\nWhat makes it a little more complicated is that we need to report the state just _before_ the signal is delivered because during reverse execution, that's the state we report after the signal-stop. Currently we implement that by doing a `reverse-singlestep` after the forward-execution signal-stop. We need to avoid that. That will require an extra feature in `ReplaySession` to report that a signal is about to be delivered.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1590/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1585", "title": "Large read-only shared mappings can be unnecessarily expensive", "body": "Firefox stackwalking code reads a lot of symbol information by walking `/proc/.../maps`, mapping the entirety of every file it finds `MAP_SHARED` and `PROT_READ`, processing symbol data, and then unmapping the file. One of these files is `libxul.so` which is 800MB (including debug info!) on my system. During recording we copy all that data into the trace. Then during replay `finish_shared_mmap` creates an EmuFs entry and copies that data into a temporary EmuFs file. Even worse, the processing takes quite a long time and happens off the main thread, so during debugging a number of session clones are created --- each on of which makes its own copy of all that data. On one replay run I see 11 copies of `libxul.so` being created in `/dev/shm`, at which point it fills up and we can't replay any more... This is all entirely pointless since `libxul.so` does not change during the recorded run!\n\nA number of other `r--s` mappings occur persistently in Firefox --- fontconfig cache, `mime.cache`, `gconf-modules.cache`. So if we can detect shared mappings that never change and reduce the cost of them, that would really help.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1585/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1573", "title": "Divergence involving socket ioctls", "body": "Spun off from #1571.\n\n> The events before the problematic socketcall is executed: https://gist.github.com/DarkPlayer/147f8f3f20cd4a2c8f35\n\nThe dump belongs to:\n\n```\n[FATAL /home/michael/projects/rr/src/ReplaySession.cc:837:check_ticks_consistency() errno: 0 'Success'] \n (task 27207 (rec:27070) at time 2888468)\n ->  Assertion `llabs(ticks_now - trace_ticks) <= ticks_slack' failed to hold. ticks mismatch for 'SYSCALL: socketcall'; expected 291893881, got 291893891\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1573/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1249", "title": "pulseaudio thread blocks all signals, disabling syscallbuf", "body": "It blocks all signals using `sigfillset`/`sigprocmask`. This causes us to disable syscallbuf for that thread.\n\nThis isn't a big deal, but we could probably work around this by having syscallbuf `vsyscall_hook` intercept `sigprocmask`/`rt_sigprocmask` and remove `SIGSYS` from the blocked signal set.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1249/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1234", "title": "Handle file open/close during experimental sessions", "body": "Some Gecko debugging helpers dump data to named files. This would require support stdio open/write/close. At least open() would need to be explicitly allowed and executed. Maybe we should only allow open() to create a file that doesn't already exist, to avoid a replaying process accidentally damaging the file system.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1234/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1233", "title": "Warning: Syscall `clock_gettime' not handled during experimental session.", "body": "I get this every time I call nsFrame::PrintDisplayList from the debugger.\n\nNo big deal, since everything continues to work just fine, but we could probably suppress this warning by handling clock_gettime in some way. It would probably be fine to just execute the system call.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1230", "title": "Handle futex waits in experiment sessions", "body": "roc:\nOne thing I've been thinking about but forgot to mention earlier is that it's easy to imagine cases where the user-called function needs to acquire a lock which is currently held by another task. E.g., anything that calls malloc can probably hit this. In that case, we'll see the main task do a futex_wait. I think we can handle that by allowing a context switch to any other runnable task and letting that task run until it hits a syscall, and then blocking it and trying to resume execution of the main task. Of course, the other task could hit a futex_wait itself. So in general we need to keep waking up tasks and letting them run, perhaps in round-robin fashion, and allowing all futex_waits to retry, until the main task completes.\n\nI'm not 100% sure this is going to be a real problem, so let's not solve it just yet.\n\ncjones:\n\nThat's a good point. That could get pretty complex. For the common futex cases, we could have rr track the dag of \"blocked\" tasks and then emulate futex semantics (for experiment mode). Then rr could maybe know when its \"target\" task becomes unblocked and it can continue on normally.\n\nA problem there is that the list of already blocked tasks, from before the switch into experiment mode / blocking futex call, won't be available to rr or the kernel. So neither just executing the syscalls, nor emulating futex in rr, is going to work in general without more effort.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1230/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1188", "title": "Tracee current working directory changes are not tracked", "body": "chdir and related syscalls are emulated so changes to the tracee cwd are not tracked. Since almost all syscalls depending on the cwd are also emulated, as far as I know, tracee replay behavior only depends on the cwd in one case --- execve. It's easy to write a testcase that does a chdir followed by an execve with a relative pathname, whose replay diverges because the exec which succeeded during recording fails during replay.\n\nThere's a related and in practice more serious problem, which is that currently if you record an executable with a relative path, change directory and then try to replay it, the replay will fail.\n\nThis is not simple to fix. Changing the path passed to execve during replay causes divergence because the process state is different after the exec. Changing the path passed to execve during recording (e.g. making it an absolute path) might change tracee behavior in unwanted ways. I developed a patch which records the cwd at the point of execve and forces a chdir to that directory when replaying the execve, but that's a bit ugly and fragile, because doing remote syscalls during an execve doesn't seem to work reliably.\n\nMy current plan is to create a temporary directory for each ReplaySession and make it the cwd for all processes in that session, always. When an execve is recorded we'll add a mmapped_file trace record with the absolute path of the exec'ed file. During replay of an execve, we know the path passed to execve and the absolute path of the executable we want it to resolve to. We can synthesize a filesystem subtree in and around the ReplaySession cwd (with the help of links) so that the execve path resolves to the desired file. When the execve has completed we can tear down this filesystem subtree.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1188/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1186", "title": "Assertion `t->regs().original_syscallno() == syscallno' failed to hold", "body": "On my machine, if I edit condvar_stress to have -c40 in RECORD_ARGS, I get this assertion (plus \"Should be entering munmap, but instead at gettid\"). I'll try debugging this locally since it may be relevant to issue #1182 and fixing it will probably help debugging of #1182 at least.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1186/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/581ec5a6c7137eef1088fec49a942f370d5720b3", "message": "Warn about field offset that shouldn't change"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1de6464ab2742691f5df9c8b9ff800e8b865feeb", "message": "Use case-insensitive check for debug build type"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3d936461b2951b5072b7a150d953ea22e872cb54", "message": "Bump version to 5.1.0."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e3d558a9634acd3acf7c63f4ac5a8e25f44aaf4c", "message": "Avoid calling detect_syscall_arch in PTRACE_EVENT_EXIT"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dfbf9713ba8581c95fb28471ce2540953285de2a", "message": "Make run_end test wait before responding to some prompts to fix hang"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/11bb87bbbfbdd05142aa5f152dea1fe6cc07eb4a", "message": "Record robust futex changes before we send SIGKILL in case the SIGKILL destroys the threadgroup without sending a proper PTRACE_EVENT_EXIT"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a1b782d89cbad5365a988a1ff1e290c8bbfc051e", "message": "Make signal_numbers test more strict about waiting so we don't send 'y' confirmation early"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e64c04da2f7c5ebb723392da04bcd2cebeb56366", "message": "SIOCGIFMAP takes an ifreq not an ifmap"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ed91e251d4840f54add6a2cb4f2b784171301bdc", "message": "Flush RR_LOG_FILE on exit"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/68250e31d8ea1231e9ae315b8e1c855976f021ab", "message": "Handle cases where expected sigframe area is completely unmapped"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a6ddc8c867d24bab08ccbe0a761fd175f12a177f", "message": "Make ThreadDb owned by GdbServer\n\nResolves #2136"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a684eb1f8df131f9737e1196865d9bd9c785d8f6", "message": "Ensure that when we treat a file as assumed-immutable, we use the immutable path for the backing file"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/61a33aea15bafe7ee41b455bb9fb0dd8a0f3203b", "message": "Fix late start"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/33b87594f64f73f6c9b072ceb78fabf53e9ec97e", "message": "Clear first two parameter registers"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b8f6da11904370d597acae364e6aa0c69a2d2113", "message": "Align stack for function call"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5a9324edef78b3bd4e087bc10f3d7e6b431c8924", "message": "Support all registers in rerun register-dumping"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/742e462b37e269213f62c465ead6af0ae71df4a5", "message": "Reformat"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c841d529ef6d14f1858462a8d9403ef8dcdd46b7", "message": "Support text-format register dumping and singlestepping through a diversion function"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/747fbbd3ac1f6cb477d46cd0f9c2dccc5d42721d", "message": "Add 0x50650 Skylake model"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3410cb4b6394af77d98d11da0f346a35f801517a", "message": "Don't die with fatal error in should_copy_mmap_region; just warn and hope for the best\n\nResolves #2142"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3e44d07db5bf530f2fc0729d95a4bc7475c36931", "message": "Add help text to rr's gdb commands\n\nResolves #2134"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/569771f6f17543469cfd0615194c1bbab96697c7", "message": "Simplify logic some more"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/85ddf432a165864e65a48de55c9b36cf4f0ddc65", "message": "Simplify logic for releasing buffers"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/571252482ee84ac59c34ca03472496e7c0a9ba41", "message": "Don't apply size-inflation hack to zero-sized regular files"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b62091519ce97a3e868fb1bb2b5de6ef6711a715", "message": "Ensure we always record shmat contents in trace"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/07fcd4ae83c5ed9d6af191c226fc1f725e43a3f1", "message": "Dump device/inode"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e6b44a6191281b4f364804fd67bc2a2e3b01608d", "message": "Fix interactions of shmdt and munmap by tracking shm sizes explicitly"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8015f6ddbca1f0ef4526022e462da24870d47645", "message": "Compute correct offset to replace with 'x'"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/60173b0f05257406f0499e4c1c32151e17a62ea0", "message": "Pass all six parameters explicitly to mmap, since a non-page-aligned offset parameter causes mmap to fail"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e3070edcd44b3d663634cb296461a220cea806c1", "message": "Ensure gdb can produce accurate stack traces when we stop inside a buffered VDSO syscall"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/244151f05a0a0c9315675c6278580a98cb97db69", "message": "Check microarch for compatibility when replaying a transported trace and CPUID faulting is not available\n\nResolves #2122"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/33fdbb22c1f98cf58598efe42d6ab01fb15bcdb9", "message": "Reformat"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1db21d95123bcf985d9d6bf559999aa13d1b57ce", "message": "print directory if realpath fails"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/67c9d90dc28dd5c8da8dff91563e5b227cee8af4", "message": "Treat openat with absolute path names just like open"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ee911bc83d0e6de3a7cd9cd9ec14e45e1d140e7d", "message": "Reformat"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/28c1e533478bd055f73952c2380e6e82b2164c9a", "message": "Make file blacklisting work correctly with openat"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6924addc07c46ea27bb27ed26ce8d1579645a485", "message": "Make CPU-related fatal errors CLEAN_FATAL"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a12d2366e954378277629f388ecf64ea4b886007", "message": "Add CLEAN_FATAL errors"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/fcefe6133e59224dbccc7e17ef864a65b199966d", "message": "Don't print errno if no error is known\n\nThis doesn't make much difference for now since errno is usually nonzero due\nto expected syscall errors."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2912ced2b929b04eb3cd88846fea2c529bd02ec8", "message": "Check CPU vendor string and report a more useful message for AMD CPUs\n\nResolves #2107"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c94cf838c2964e24f65fd36f6020eda66875d1b9", "message": "Left this out of 798df8f60f71e7a0ed603183b1c9f3268d69f079"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6a0f0510225219e1ab7cec6e7c8c115bfb9d310d", "message": "Fix display of first result when trace_start is not at the beginning"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b5613a64ec661a7fa1ffdaccef1dd367529b3eaf", "message": "Don't skip instructions leading up to a signal"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a8c6dc5a41e98ab95f8ae7995b8cda14b254d0ae", "message": "Dump state at start of first step"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d0ef67848843963c80ec8719ca4ee982d7ed05aa", "message": "Fix dumb command-line-parameter error"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8daf7730a0611c6020a28d390694a0053116db8d", "message": "Allow dumping fsbase/gsbase while singlestepping"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/798df8f60f71e7a0ed603183b1c9f3268d69f079", "message": "Handle cases where a PTRACE_EVENT_EXIT masks a syscall-entry.\n\nThis should fix the intermittent exec_from_other_thread failure."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/fa3deeb0ef7340e489ccb4c9573d3da1f6b90f77", "message": "Add comment warning"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8d29ddffd4bf8aaf671b820c33fcf0c95e0a4bfe", "message": "add syscall buffering for openat() since glibc has started using it for open()"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3b1206dc768a082d43025932c042512645ea3a29", "message": "Hack to stop sssd clients using shared memory"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e6f3f03ebdec408e577f7d2213eb4e61ceb77a0e", "message": "Eliminate pexpect delay"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dd95b406bf71b54f76673b8146d96f5910248875", "message": "Create RR_TMPDIR/TMPDIR if the environment variable is specified but the directory does not exist"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b730564dfe182edf8f30546b65a72e21d2f9683e", "message": "Store base address of executable mapping of /proc/.../exe in the trace\n\nWhen present, this avoids the need for heuristics to detect which executable\nmapping is the exec'ed binary (e.g. to pass to a debugger).\n\nAt some point in the future, we could drop compatibility with very\nold traces and remove the heuristic."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cd5c9d5884d0fcce1763f271c49961ea462c413d", "message": "Simplify code"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c2ef4003f3efebd58aaa0ac364c111cac8f2b5d0", "message": "Increase the maximum allowed number of open files to 65536 if possible"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d05e517fe20c18d7787ccc86407276b233038c7b", "message": "Try hard to copy executable binaries into the trace rather than compressing them into the trace data"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6b65cd4c72a033f7b11d765a35d8864a9a45cd09", "message": "Implement gdb protocol exec-file query"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c42702d2557326065456bbc0432501428988091a", "message": "Record process execution up to an unexpected exit"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c55b9fc898ddb169de7039a45f4a24fbc1a81a6e", "message": "Avoid unnecessary push/pop_event"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/90ab402297dcec31c89e905bd854041f7012586e", "message": "Don't stop debugging at failed execve"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cb18c022417e0ede34fa84d7533732c08abb5377", "message": "Fix missing getrlimit syscall number on x86"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/104ad095aa8e0ce02f7743a04367c67908acbc7a", "message": "Improve seccomp status logging"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8130c923726d8ae880a4a8187758010a4b81d21a", "message": "Support SECCOMP_RET_KILL"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/59f18d849296b31dfa23ef06667f3a08cec7f8e1", "message": "Don't connect to the target more than once"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cd10a5add2a552f22dd1eff60262960feac5005e", "message": "Connect to target before any user-specified \"continue\" command.\n\nResolves #2098"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e619fc4fb092200d0811180b8912cf63d12be8ad", "message": "Disable not-yet-working test"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/671f62bdcc4dbad663f4951202366a65f9b6a402", "message": "Iterate over all processes sharing the same address space, not just the thread group"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7b19876557f851c02ccb3223154236e4d87ae5ad", "message": "Fix some session-cloning terminology"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/fdecf2900938745004c33d6c1e855e956306a530", "message": "Some more TaskGroup to ThreadGroup renamings"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c51ea8726331f513c29128d997960a5daeb84e3b", "message": "Change 'task group' to 'thread group' in comments"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/aa907fdb53843643dcd34a4bef6d8f1021b71a2b", "message": "Rename TASK_GROUP to THREAD_GROUP"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2fddb43e91807d390ecf4db7ca6343aa48de6b86", "message": "More task_group to thread_group renames"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/946ed83419f0fa36926e146dffe13325598964f2", "message": "Rename task_group to thread_group"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c4f1f8e141868844df0971afae204d2b1ee013fd", "message": "Rename TaskGroup to ThreadGroup"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b8821907e0edb829fc87f9eb69ba3a088a2cfb2a", "message": "Restore syscall arguments before dispatching to a SIGSYS handler so output buffers written by the handler go to the application's buffers"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/744e26867f2be2c92383b2d95b29f1e0e461963c", "message": "Support epoll_pwait"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2332a1d8acb4dc4495b778af7abfb4d66cad86db", "message": "Don't clear wait_status when we stash a signal\n\nWe don't need to do this. Leaving the wait_status in place means\nthat if rr chooses to deliver the signal, it will see that the\ntask is already in a signal-delivery-stop that it can use. This\navoids invoking the signal-delivery-path which can cause\nproblems in some cases, and is less efficient."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cc7f9698040fc7b7cdde520c82a68ff0b0922ae5", "message": "Support some more socket ioctls\n\nNo tests because these seem to only work on actual hardware and are privileged\n\nResolves #2091"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7875085863e2bac129baab3374625a84c9a2a328", "message": "Fix warning\n\nResolves #2093"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d164ce1f607c571a96fe0d71d914f6fbcd648155", "message": "Link to the build-and-install wiki instructions when a package is missing\n\nResolves #2094"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6b272d5a27a73c071ed492db0e4a2ccfcb04536f", "message": "Support /proc/.../maps remote loading\n\nResolves #2088\nResolves #2032\nResolves #1834"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2c0c83432be955fc443bacc55d73d9c6c1dbe0b9", "message": "Print message when pack completes successfully"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6792855f55c777bb5b27aabc9f2bdc0ae414d1cb", "message": "rr pack needs to validate the trace and expand any default trace dir"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cdbc02d77155ae65e0c5ed3b5948c67155ca9713", "message": "Remove FOLL_COW kernel bug workaround\n\nThe kernel bug fix has been backported to every stable kernel as of three\nmonths ago. We just released rr 5.0 with the workaround, but the next\nstable release of rr shouldn't need it.\n\nResolves #2005"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b01384e6f2c4be2188acf6be8b51eb516618b56c", "message": "Bump version to 5.0.0."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/68bf7d7f1a901ea2343f01906e0e2eef447209a4", "message": "Check for 'capnp' command at configure time\n\nResolves #2085"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ba2c2a21a5d1c3f24235bd475a527c6f861e3507", "message": "Discard prepared-syscall state when a syscall is interrupted by tracee seccomp trap"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/bfe45b47779bb2265859f90f74650c55a6701ffd", "message": "Pass RecordTask to write_frame"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3c3ddf780c3fccee014e86ddfc5208c6c6f55690", "message": "Generate correct package name"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b7786d9656ed580e7333c2ce4e82030a9945b2ae", "message": "Remove unnecessary RPM spec stuff"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/528759c5576c489d9de06400bf8e3cf5bd3360d9", "message": "Add CMake configuration option to strip binaries"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/90c59cd83098ea871c77dd6a68617eb7e9d86e28", "message": "Explain default subcommand policy in usage message"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cca3b9ecb76a5b31dcb80a8cc75dc45ebbb3b0bc", "message": "If no subcommand is provided and the first argument is a directory, default to ReplayCommand"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ab53e48ea62482132f86ced87bfab25a3b3930c3", "message": "Fix morestack hack"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/34f0c6d995aedd0cb0467054cc4ece206267dc9d", "message": "Fix tests to print newlines"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/234b3eda2006567bc0e3590d89e7d8e25d689e5d", "message": "SYS_setsockopt is not defined in some old 32-bit kernels"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/bf5b3d8f8f2595b005205163ca669ddc7705b283", "message": "Allow patching near page boundaries"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7372a987608ebd1954efe385795f4f78f377d012", "message": "Add syscallbuf hook for the code sequence involving getpid"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/cb537e0b1a74ff9a76b5fff873d82953ba5c2b45", "message": "Buffer setsockopt syscalls"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/06592c49b3883481baca7b8ff3d9301411bdc74f", "message": "Fix build on Ubuntu 14.04"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e4a9cf9e63fe530f17cd74edd64068096bbad19d", "message": "Don't read /proc/.../maps if another task in the same taskgroup is doing an execve ... this could trigger a kernel bug"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/775f0b8559ec980c0d48f96c06d5d46d0f546b1f", "message": "Handle unexpected process termination while getting the seccomp data"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b117c7d918caa92a096ae46622454ef7fb14c297", "message": "Ensure Task::try_wait returns success when an unexpected-exit is pending"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/620e543001def3e76efaf264a7559743c55c2c71", "message": "Remove unnecessary WSTOPPED flags"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/35516552781e96ccea781d07595a25ca0eb4ebe6", "message": "Handle cases where we don't know which tid to wait for during replay due to off-main-thread execve"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/04987e9b6aa8965b478d224ddc3a8a650dbaa212", "message": "Make test more difficult"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/63d38a10d988cff60c5358815361f3ca78c7e377", "message": "Don't get confused by fake 'clone' task-event records inserted for off-main-thread execve"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/0ba35a09e1eeb4e27d67f339ee66d283d0b22d01", "message": "Fix comment"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1e53c9e61b6e85b0511426502d18142ed8cc885f", "message": "Handle task exits during exit_syscall processing"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/40ec2ea1b52060590543665b36507ec7819b13d8", "message": "Support input ioctls --- no tests yet"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a79e26e40ab0a2682e3ab1f5024aa222ec1ebde3", "message": "Fix 32-bit stack walking"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c2f5127f872cf42c7ef8a0d6c385a24b2104f1ca", "message": "Reformat with clang-format 4.0.1"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/bb016bb9e38d9c774dd16bab5a40ec0cf8e92c32", "message": "Make futex_priorities test more robust"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9dee1cf8bf4429ba935867e600cb2bbe906765ce", "message": "Handle cases where we don't get a task exit event for the thread-group leader when another thread is doing an execve"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e9bdbe81dc1b040a0522360b282f958c214f2344", "message": "Avoid setting CMAKE_C(XX)_FLAGS_DEBUG/RELEASE so we can reliably pick different settings per module"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/de263cb43628b96667c589580e647d2faeaa9d27", "message": "Make syscallbuf_signal_blocking_read allocate memory properly\n\nWe don't read any data, but if the buffer pointer plus the size wraps around\nthe end of a 32-bit address space then we'll get EFAULT even so."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7b03b47a27f7c6b2c9952542c4c6f022b7f5783b", "message": "Handle kernels lacking numa syscalls"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/152a546c25e28657b61f58844ef260634b9dddf1", "message": "Suppress warnings, particularly on i686 builds"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/77a166d7b7ea1475e702e6f41140485c16af5ca8", "message": "Force-enable MMX/SSE/SSE2 to fix i686 build"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dc90aa71f0de3a210bd337587f730fc57032b403", "message": "Silence clang warning in release build"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8497e2218e70c43ed1368d8831444926e48e8a14", "message": "Fix clang build error"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2abf4bf3528a8cbeaf2b284fa5620cdeb1c725b4", "message": "Stop 'base' from having leading zeroes which leads to different results in old kernels"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/626a5513393a3dd16a8514fc0ae655a3948bbc02", "message": "Fix keyctl test for newer 4.12 kernels that impose minimum DH prime size"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ad63d5a2a9502e3303b1e3b0b696ec87633db9c7", "message": "Skip early deletion of Task buffers"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6c0fc02aa9892c888dafed49228dd72d5b9e48b8", "message": "Use ucontext_t instead of ucontext to track glibc change\n\nResolves #2082"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6245d8178e566274ca7d562808775e50a3112c0c", "message": "Add some Monkeypatcher logging"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ac518d7875b6c46c80a4aaaef9ff012fb3d33f70", "message": "Add '--' option to 'rr replay' to pass all remaining parameters to gdb"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b9b4c498ddba81c7258ff2c5bef8805266c96f0d", "message": "Conditionally define some TUN ioctls\n\nResolves #2079"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1372a0a8a0b0e876d88c04b39a86810962ed0f6b", "message": "Fix TUN test so it won't fail if run on a 32-bit kernel"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/18b3cd2b661b0b2b118db5801b6f69f84d1efe67", "message": "Fix TUN ioctls for 32-bit"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ed45cd6aa6b0a7eb894e1161e6176191e554328c", "message": "Setup sighandlers before doing any AutoRemoteSyscalls in a cloned task, and avoid the singlestep AutoRemoteSyscalls path if there is a user handler for SIGTRAP or the syscall is modifying the status of SIGTRAP"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8274991479af7ea65eb7f022a042fd4b4377bd6c", "message": "Support TUN ioctls\n\nResolves #2074"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e92770bf38ecf18fcabc6e8b248bb7ec5baf2396", "message": "Remove unused headers"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/bc8b978992294760a85dc970e11ad8735e2e2bec", "message": "Make Event not depend on RecordTask"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/60e19c6c4d7f06025afb4267b8f17b4de3f62bd6", "message": "Move SignalBlocked where it belongs"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/544990d0612bb776d8883025c13c809868a9a818", "message": "Remove unneeded line"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dcf158edadb503caa0ad07131eadc965c6265f80", "message": "Simplify Event::Event(EventType) constructor"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e1b9c233eb4f7c1e8ebdf3800d0eb1a289d2f412", "message": "Make Event::Event(EventType) constructor private"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/31ae5d0e056bed563427d0aabc9d1886b101d0e6", "message": "Remove BaseEvent since it's no longer needed"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e76c4f5c52dd5789f8f3a59a3929c0210c2e2c55", "message": "Remove HasExecInfo since it's no longer needed"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8429fe8ff99aa7e333577bc7ac6fa5d80f5b475c", "message": "Make 'should record (extra) registers' logic type-based functions in Event"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ab68864635d060c8e278b02b54db146affbe1de0", "message": "Remove unused TraceFrame::set_exec_info"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c71c68d1ee74fcc654ece3bcadd36f7947c7f1f5", "message": "Remove some unnecessary arch parameters"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9361b102f9b1afa212f4c206605c9b5ab6dfb0c7", "message": "BaseEvent doesn't need an arch"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/27d47d682c8b27a692db110370a38d72d83c36b3", "message": "Remove Task::syscall_name() since it encourages bugs related to cross-arch syscalls"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/57d57bf149a845726503f70543cc28289edb23c7", "message": "Fix typo"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/097bab3ffe50c4338a401473bdc9f67d2b6bf6b3", "message": "Now that multiple set_regs() calls are efficient, split canonicalize_and_set_regs into set_regs() and canonicalize_regs()"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/287acba43090cc32136b943b75a623c5989c8083", "message": "Fix clone interruption test to handle edge case\n\nIt's possible for a rogue timeslice signal to interrupt the main thread's\nread() call so the main thread is scheduled between the auxiliary thread's\nfutex() call exiting and the SIGCHLD being delivered to the auxiliary thread.\nSo determine where to debug by looking for the signal delivery."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f277904b5ae01644fe648a719d25d2f478823b36", "message": "If test-monitor detects a timeout, force-close the rr trace so it can be examined later"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b143504ea99736b2ff11708f94a722adc22afd72", "message": "Only write registers back when we're about to resume execution"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5f2c944d6acfa28817df7dd654f09b186d23dbf7", "message": "Fix AutoRemoteSyscalls scope"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d5443eea3b288f8e270af517bb3df2905c1f9736", "message": "Tiny optimization"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5edcaa230ff15c3c175bac5759186e0d837f580c", "message": "Handle preload-init when the process already has more than one thread\n\nThis requires us to handle situations where we can't safely patch a syscall\nbecause a task is blocked in/around it.\n\nResolves #2072"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d27285bd77e0268d0a8344c38fe1a35359bba85a", "message": "Fix test"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/0863f17d2796cbd84dc25cbd168e62c6f264ecd4", "message": "Advance raw-data read pointer so we can dump syscallbuf data correctly"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1ed09244c89bee08d65b1be8c5b616a15a0eaf11", "message": "Remove unsupported 'verbose' flag\n\nResolves #2073"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/70f7f8844320b8bad6341ebd11d2369c6a60c693", "message": "Pass the local address 127.0.0.1 directly to gdb"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/955b5e0d6fb7f0c21172f0264eaddf264f15f887", "message": "AutoRemoteSyscalls should reserve wait status in more cases, especially the SIGTRAP case"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/fa24c20c7511bd539d22af9593837a0229202ae8", "message": "Supply a non-SIGTRAP using slow path for AutoRemoteSyscall"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f24e09c2e6dda80e8782cc2ca0406c7fb1e39359", "message": "Avoid signals interrupting tracee connect() call and causing a deadlock by accept()ing the connection on a different thread and using the synchronous AutoRemoteSyscall path for all syscalls\n\nHaving made all AutoRemoteSyscalls synchronous, we can simplify the logic."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c0999029474d612a9d5e4a71bfacee19d9ff8fac", "message": "No need to fix registers here since we'll overwrite them one way or another"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5c9348d83ff23f8c3553854391c9907e96e4da39", "message": "Reduce number of ptrace-continues required for AutoRemoteSyscall"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5d78da949fa57aeaed0da958c26199b843ec2c7e", "message": "Remove another 'parent' parameter"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/414197506a9d35bae7c0e2b942881695d2c91a34", "message": "Remove 'parent' parameter in favour of AutoRemoteSyscalls::task()"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/78c973003cf1710ef5a36af6fa3eb5ac53ab34ff", "message": "Use sig_set_t in more places"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a45b32cef7933a6d94165b5579458fe89e24db46", "message": "Don't let the test-monitor's gdb sessions fiddle with tty settings on stdin"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f12edcb8b6d1ffe09b360208e58b3a74930c8f68", "message": "Don't do work if the counter is not already counting"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9120d498577c9564d92a89fe7abc739c68201ea7", "message": "Just use the same filter whether we're using the syscallbuf or not. We want untraced syscalls used by AutoRemoteSyscalls to be  untraced even when syscallbuf is disabled."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3be2b182ac89116274378db9acb1c0254e2e7ee6", "message": "Unescape newlines in file names in /proc/.../maps"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/67908480a59b66f66f76ede211c79e8393fade5a", "message": "Support static linking of libcapnp/libkj"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d218a53f11ea465d01ad3e490c72ceac537617dc", "message": "Use DEBUG_ASSERT instead of assert"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a7bc217ab678d95569c387f76d1799a89bd20297", "message": "Remove Event.h include"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c1fac35ac4d11bfc46562f174c587269bc8b1d47", "message": "Switch assert to ASSERT"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ed88ba9fdb22c3f797630dc8685f587f1db7d5be", "message": "Upgrade assertions to use Task and reformat"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3ec32d84391e28e60027e151e85b3e51849b66b8", "message": "Add returns after fatal assertions"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/bc6f123f35c9c3ca0b2e602adff39c4364e7d354", "message": "Fix assertion to happen in release builds"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a2aeeeac6c14fc039e7d560327fd091e7e938348", "message": "Ensure chaosutil.h test_assert works in opt builds"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/daec1d7d9f9f1a9d3cdea8544e093f7bbefe0cb5", "message": "Set flags to ensure NDEBUG is not defined in any test code"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/755ea42d437fb379b18fa47f6fcc9a1b4b2357ab", "message": "Add trivial comment"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5f2b5f53f9ba23841c91ac04539fe5a8daa2c35e", "message": "Add comments to schema file"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d748e798062665885418c68801e9e2bef576a888", "message": "Add CString and Path for better documentation"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/0e8cc39b2a442369b32cb77b60d6e4f4f3c78daa", "message": "Track syscallbuf protocol version"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d88c6f835b2b28c27325b9d0baca0f375f68868f", "message": "Use stack scratch space for read_frame"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8d23352533370b0198b25c2d2e7f94ac4a576193", "message": "Use on-stack message buffer to write event"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b74f60a7b4155e00c3105e2dc9a41a950f544046", "message": "Detect and report incomplete traces"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2668746fda4eb473375a1aca28e5e0a3aa82afe4", "message": "Make TraceFrame use Capnproto"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7725c90962e3ff04660eeacc3b7625f8725089fc", "message": "Switch TaskEvents to use Capnproto"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/31030b2de300962af3152d15dd4b0dc6bec82581", "message": "Make mmaps use Capnproto"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c352d5b4f36d5b045a6e6104442df758a562f86f", "message": "Use Capnproto to store trace header in 'version' file"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6d90fc5ca7ba6b4f020c49a947bf68040be6a933", "message": "Clean up register output"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/94ed25261a1d099dfed12daa90c878059365524c", "message": "Statically ensure TraceWriter uses RecordTasks"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/526bc0fbdcde369c56e606c6cdd3f970f2953331", "message": "Make a second attempt to clone the file if replay is going to map it directly even though it's MAP_SHARED"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/48dd44bf4007bf359578b86ff06de239ba11aa28", "message": "Add simple perf test and cheat sheet"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/429ef4055defe32d038193c8b3d5ec6710672a5c", "message": "Remove performance-governor warning\n\nI ran a simple testcase --- 500K trivial non-buffered syscalls in a tight loop\n--- and recording performance was identical (on my Skylake 4-core laptop)\nwith or without the cpupower setting. So let's just remove this unless/until\nsomeone can prove it matters. I've been ignoring it for years except when\nrunning benchmarks.\n\nResolves #2069"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f26ca5557f6cc2ef1b86cea7978abb9b5fd235c4", "message": "Use references in Mapping iterators to avoid string copies"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d670bb6d17d9d9d44e9e9407a652b2e8ac690d7b", "message": "Fix build more"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2e9039685a71d836916ff86886984b3e1d13f73f", "message": "Fix build"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/87de67ba6a64cf3ff14d9b5c713053d96dce898a", "message": "Avoid canonicalizing and setting registers twice"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/8493fbcff2ce800b2d21db39ef1990540ecc1758", "message": "FIRST_INTERESTING_EVENT code does not compile"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5838a616f3523ca2880d31f690a034a1d8dee628", "message": "Avoid allocation and copy when writing Registers to a trace frame"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/82941236f7a6b4df184ca83e516269d373d80e7e", "message": "Reduce usage of TraceFrame during recording"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f8ca83af5da7ffeedbd14018f4f759a571ea0126", "message": "Reduce read_mem calls"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/e062a9c6e21f894703bc4b00b3066f60d392faff", "message": "Make page_size cache its result"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/051cc1c208c136b9e4c0c5d17360ba7cc1276a94", "message": "Move Task::local_mapping to AddressSpace and make it a bit more efficient"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3ecaf6b11fe29d7abb5e837f10be6da10fe50016", "message": "Add common case to reduce assertion overhead"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/27eea86183eee7c5765ec67904fc8a974ba63df3", "message": "Try to avoid reading tracee memory in get_syscall_instruction_arch"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/164d3b0348a666abdd58a05ea3260a93a6017e8a", "message": "Move TraceFrame::Time to toplevel FrameTime"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9df212151c0a737e3652e250f0addf40026fbc88", "message": "Don't save si_addr specially"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/12327d6e62d1015b48e053916792084a369759b3", "message": "Remove 'extra perf counters' code, since it hasn't been used for years"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/15f39ad75bf7b683bbec17b2f056c507a6c18a8c", "message": "No need to distinguish EV_UNSTABLE_EXIT from EV_EXIT"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/71b92d3e12c4dded6ea872ccb620fa7f952d7c8c", "message": "EV_SYSCALL_INTERRUPT doesn't occur in traces"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/4d94f404b9dc6cceebccead303fd95999e70525b", "message": "EV_EXIT_SIGHANDLER is unused"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/aa0fa8b0bc558c7e284b551e6fd44435a04cb066", "message": "EV_INTERRUPTED_SYSCALL_NOT_RESTARTED is not really used"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ab671c0397cd6afa41aee01e400f75c38482af4d", "message": "Don't emit TRACE_TERMINATION record, just infer it"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/5939eccfdfb8da289f8751d004c8e35c2192b9fe", "message": "Move fds_to_close out of TraceTaskEvent, where it doesn't really belong, to generic data for the execve syscall exit"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/43efb3d8dec538fb61ade483ff83eb2822e11732", "message": "Rename EV_SEGV_DISABLED_INSN to EV_INSTRUCTION_TRAP"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6b62b15f94ef975ea0f7efba95b2f7d4acc5a6fd", "message": "Build with brotli include files"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/479b9125655ec0ee4cda951e49ed5492326964de", "message": "Import brotli include files"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/928c23da81d0bcdc220d3938a71dbe93f8721b51", "message": "Switch compression from zlib to brotli"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/2748fc58b21f724db7e1412773bc2527d48e3beb", "message": "Import brotli 0.6.0"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/6b81c5d207c76ce4aafa8ee2ab25ed4b48c6c805", "message": "Revert \"Switch compression from zlib to brotli\"\n\nThis reverts commit efb69952e2cdfd616d0bf39a6acbcb8f928f0882.\n\nUbuntu doesn't package a brotli library so this would make rr difficult to build on Ubuntu."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/efb69952e2cdfd616d0bf39a6acbcb8f928f0882", "message": "Switch compression from zlib to brotli"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/05a58d6fc6b75270426d8d6be7c29d6c5c2511bc", "message": "Extend TraceFrame::Time to 64 bits"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dd17151ca1c2cf79038f27b56db6859752e683f3", "message": "Remove drm.h since it's unused"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dad5b26d2b4d4351ed8f29c0b32987f62e4e4169", "message": "Rename rrutil.py to util.py"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/35341adc5562b96f0ca1b7c7b7b8d49901f6a54f", "message": "Rename rrutil.h to util.h\n\nCurrently we have util.sh, rrutil.h and rrutil.py. That's confusing so\nlet's just rename everything to util.sh/util.h/util.py."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b21817bc3830204c4b43c99b81b0180ec16b276f", "message": "Remove obsolete documentation and reference the tech report instead"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/dbebece7ab89e3a8afa424d5b5c3e6257dd110ff", "message": "Move contents of src/script to scripts\n\nIt's just confusing to have two directories"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/aaaa68eda6ac9c29a85d2cff027e7f827aa00302", "message": "Block pulseaudio shared-memory usage by causing its open/memfd_create syscalls to fail instead of altering its config file\n\nThe approach of passing a modified config file doesn't work in some sandboxed situations\n(the file is not readable by the sandboxed process).\n\nResolves #2062"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/b079469dc0a5ae05a47fb8e4f5d0a237a04196ca", "message": "Handle PR_SET_NAME with parameters near the end of a mapped region"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/87e291063f8758aaf602077ce8ccd69199169be3", "message": "Reformat"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a5d23728cd7d01c6be0c79852af26c68160d4405", "message": "Try not to make heap allocations while the initial tracee is still running rr code before the initial exec"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/327271c68d5f828f5dc5463b40a281fd4bedd27f", "message": "Use cpackRPM defaults"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/43730b0f5032592c446ee87397ade40bd5d180ad", "message": "Don't strip debug info rr binaries, especially librrpreload"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/148671f7ddafb657093c67538dd43706fb925fd9", "message": "Print more data about the metadata mismatch"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3d35930f328c3979fa67b8958d0f25920b95928e", "message": "Don't do syscallbuf post-syscall processing for syscalls that were aborted by seccomp SIGSYS"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f1005b23304cdbb28597912a3ec9eddfc4db4319", "message": "Handle rr running inside a user namespace in which the real root user has no mapping"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/0f56af027508cdefda70f6c53f4029613a002171", "message": "Collect hypervisor CPUID leaves"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a68d384fb28b1b9efedf59f62ba84697658cab8a", "message": "Convert XSAVE layouts when reading ExtraRegisters"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/48b779e9f2dc05a2218dce7f35a0738ad4e89cd9", "message": "Always pass third parameter to 'ioctl' to avoid nondeterministic bugs if it is needed"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ec6213eef57eaecb72d4a4ed2ec2ad666d856b65", "message": "Revert \"Increase skid sizes now that we're checking for skid overshoot all the time\"\n\nThis reverts commit e414ce30b6d3c9c62cc0759c850a57a5580c2b2b.\n\nHopefully we don't need these skid size increases anymore now that we've fixed the\nskid check."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f8e865a3cff5327cb8b9f96aff28cc81088cdbb1", "message": "Fix skid check assertion to use interrupt_val if that's what we're returning"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/ca07326a7886cef304b284c8d538a53fae077722", "message": "Make io_setup return ENOSYS to stop applications from using it"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/9471f693564eabd099862195f6bc409cc59289f0", "message": "Support FIOASYNC ioctl"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/caf62654b5e37e990e295b65609912a1d830a126", "message": "During replay, if CPUID faulting is available, bind the tracees to a new random CPU"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/c0361b176f9f68f2d5293bcd34e7570f55abb4c8", "message": "Move choose_cpu to util"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/21957580bc7351b9f0b4eea8abcbe07aa277b23a", "message": "Add test for CPUID singlestepping with faulting during replay but not recording"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/3d6cb26951dadc545dba67b6200fd95a27005e6e", "message": "Add command-line option to disable usage of CPUID faulting"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d425c2c584549beb9dc6453d65d18439cfc9ce7b", "message": "Handle recording without CPUID faulting and replaying with CPUID faulting"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/168c645c8eef915a83b99a7dc391ed7d0cb95048", "message": "Remove recursive call to cont_syscall_boundary"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/033fadfd49ddcede6680cbcff09ba67e28e9fba8", "message": "Remove code that's redundant with the previous block"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/93c08dff8ec327707c1141e738c88e38249d797f", "message": "Stop advertising support for RTM instructions when CPUID faulting is available"}], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17578682", "body": "It's easy to collect counts of the number of syscalls by reading the rr trace files, especially for non-wrapped syscalls which are recorded in ASCII.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17578682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17755065", "body": "It worked for me a couple of months ago in Fedora 17.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17755065/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17910261", "body": "I don't follow. After the exec the replayer should be replacing the contents of the environment with the recorded environment.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17910261/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17911023", "body": "I see. Yes, we'll need to explicitly save and restore PATH, I think.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17911023/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17969627", "body": "The SECCOMP change looks fine.\n\nEnabling all the socket syscalls in wrap-syscalls doesn't look fine. Some of them are blocking right? So we can't currently support them.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17969627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17976593", "body": "OK, better put them in a separate patch then.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17976593/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18943220", "body": "How could it be a non-rr failure? We're not actually doing the stat call during replay I assume?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18943220/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19850599", "body": "I'm not sure how you'd fix shmem support...\n\nI think previously we just disabled MIT-SHM one way or another \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19850599/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19946436", "body": "The ultimate solution is probably to have the supervisor process catch the signal, see that it was triggered by the syscall-buffers code, and fix everything up.\n\nThis bug can be deferred of course.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19946436/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19949950", "body": "+#define SYSCALL_BUFFER_LIB_FILENAME        \"librr_wrap_syscalls.so\" \n\nChange to \"buffer\"?\n\nI think signals/context-switches inside the buffer library are still completely broken with this patch (but no worse than the state I had it in). I assume fixing that will be a followup patch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19949950/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018446", "body": "No, go ahead.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018446/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20089989", "body": "You've already gone way beyond me --- I just had a little test program and manually ran \"perf\" to observe the progress of the context-switch counter.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20089989/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20092181", "body": "Oooh, nice idea.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20092181/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168611", "body": "Any idea which symbols/how many symbols we'd need to override via LD_PRELOAD to catch most futex traffic?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168611/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20170723", "body": "Why is that needed?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20170723/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171090", "body": "Sounds reasonable.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171090/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20396364", "body": "Hmm, so will we have to do these two extra ioctls around every potentially-blocking syscall? That's very unfortunate. \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20396364/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20396973", "body": "True.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20396973/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20457177", "body": "I'm not sure how that would work. Somehow we'd have to avoid executing the system calls and instead pull the right register values from the trace buffer, all while preserving HPC counts for replay vs recording.\n\nMaybe we can do something fancy where the \"untraced system call\" entry point is padded with noops during recording, and during replay we replace that code with another sequence that loads registers from the trace buffer, using the same number of instructions and no conditional branches.\n\nA completely different tack would be to implement checkpointing so we just don't have to replay very long execution sequences. I kinda prefer that actually.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20457177/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20690092", "body": "The problem of \"all regs being the same\" is something we just accepted. We don't have any evidence it's a real problem.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20690092/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20690152", "body": "I think we can live with it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20690152/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20723140", "body": "I don't understand why this would be an issue. The contents of all memory in the address space (apart from scratch buffers) should be the same during recording and replay. It shouldn't matter whether they are \"properly initialized\" or not.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20723140/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21071388", "body": "I suspect the reason the skid region size is so important for performance is because once we've entered the skid region we single-step to our final destination, which is of course slow. One idea I had was, once we start skidding, set a breakpoint on the destination PC and repeatedly run to the breakpoint instead of single-stepping. That could massively reduce the number of ptrace interrupts we take.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21071388/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21080412", "body": "If you do this, you might want to use debug registers, to avoid the nasty case where the code is dynamically generated or modified between entering the skid region and reaching the destination.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21080412/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21223556", "body": "I'm not sure how that would help. Presumably PR_Lock requires everything the common case of pthread_mutex_lock does, so we'd end up writing a similar amount of code. (I assume we would write a specialized pthread_mutex_lock override that handles the common cases we care about and punts exotic cases back to the real implementation.) And of course support for pthread_mutex_lock is more generally useful to non-Firefox projects.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21223556/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21223811", "body": "I think it's a fairly large and scary leap from \"a few syscalls entangled with libc implementation\" to \"all of them\". I think this would make rr significantly more difficult to deploy. But maybe you're right.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21223811/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224965", "body": "That's a pretty cool idea :-).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224965/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21831337", "body": "You should probably tell the Linux kernel people about it somehow.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21831337/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/1880821", "body": "It looks like this code runs on every single write() to any file descriptor? That's not right :-)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/1880821/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/1884716", "body": "On Fri, Sep 21, 2012 at 9:50 AM, nimrodpar notifications@github.com wrote:\n\n> Well, for some of the tests i added, i do want to see a print to a file in\n> the standard output, but i guess printing ALL output is an overkill, we'll\n> just redirect stdout and stderr intended calls for now.\n\nRight. I think we should print to stdout whatever the recorded program\nwrote to stdout, and print to stderr whatever the recorded program wrote to\nstderr, but nothing else.\n## Rob\n\n\u201cYou have heard that it was said, \u2018Love your neighbor and hate your enemy.\u2019\nBut I tell you, love your enemies and pray for those who persecute you,\nthat you may be children of your Father in heaven. ... If you love those\nwho love you, what reward will you get? Are not even the tax collectors\ndoing that? And if you greet only your own people, what are you doing more\nthan others?\" [Matthew 5:43-47]\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/1884716/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7294076", "body": "Hmm. Now that I try it again, this doesn't seem to be necessary. I'll back it out. Not sure what happened last night...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7294076/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7415414", "body": "I don't know, but 0 is an invalid signal number so I don't think it matters.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7415414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7542948", "body": "I ran the test suite and it seemed OK but I didn't really do any measurements. I guess the suite could slow down a lot in some cases, where more than one of the long-running 'checkpoint' tests get pinned to the same CPU.\n\nWe can back out the followup commit to restore test-suite behavior.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7542948/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7564953", "body": "I backed out the testsuite changes.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7564953/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/9907801", "body": "If we allow the process to make itself undumpable, future attempts to call `perf_event_open` on the process will fail.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/9907801/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/9907802", "body": "I'll add a comment mentioning that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/9907802/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17686579", "body": "Fixed by https://github.com/mozilla/rr/commit/435d9c9c331b8c856087214cdf17fbec68c78e05 hopefully\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17686579/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17686939", "body": "Not worth investigating; there's no particular reason why it should take 25 steps. I'll bump it up to 50.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17686939/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976649", "body": "If `CLONE_VFORK` is set we replace it with `CLONE_VM`. I'm not sure what's unclear.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976710", "body": "True, but we need to avoid the scheduling effects.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976710/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976815", "body": "Ah I see, so if someone set `CLONE_VFORK` but not `CLONE_VM` during recording then we're changing behavior here. Good point, guess I'll fix that. (Though I can't imagine why anyone would actually use those flags...)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976815/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976970", "body": "OK, fixed. Thanks.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976970/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17977109", "body": "> If it's in the man page somebody will have used it, even if by mistake.\n\nI worked on Web browsers for 16 years, so that's the story of my life :-).\n\nFWIW, engineering rr to work for every single program anyone wrote anywhere would be a monumental task, probably impossible, so I don't aim to do that. I try to focus on supporting programs that either rr users need, or are easy to support anyhow. This issue is in the latter category.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17977109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/18086401", "body": "Fixed by https://github.com/mozilla/rr/commit/92c5d845bcb85b41b08005155eeb6d8573226352 hopefully?\n\nIs this clang? I probably should have tested that before releasing 4.3.0...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18086401/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/18087040", "body": "clang 3.8.0 builds for me now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18087040/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19178769", "body": "Great, thanks :-)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19178769/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19512576", "body": "Oops, fixed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19512576/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/20479523", "body": "I don't know. I'd have to check all places we check PROT_EXEC and think about them and I don't really care to if no-one uses this.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/20479523/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/21723240", "body": "OK", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/21723240/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/21723975", "body": " https://github.com/mozilla/rr/commit/fe36fef73617c3e49de58f92a9cd1f941fb0a892", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/21723975/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/23501173", "body": "Yes", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/23501173/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/11474642", "body": "Actually @skitt pointed out that mmap defines the offset to be multiples of 4096, not the page_size().\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/11474642/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12723056", "body": "I don't think so, because this patch makes a Task not own its Session.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12723056/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14431956", "body": "I think we should assert here that the value actually fits. But that can be a separate patch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14431956/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432065", "body": "I think this can just be size_t.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432065/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432111", "body": "Same here.\n\nWe aren't going to compile a 32-bit rr that works with 64-bit tracees, so whenever rr can just use the wider type, I think we should because it's a bit simpler. Same reason we've been using uinptr_t/intptr_t for register values.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432111/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432125", "body": "Can just use auto& I think.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432125/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432131", "body": "And auto& here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432131/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432179", "body": "And auto here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432179/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432238", "body": "More auto/size_t.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432238/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432335", "body": "size_t, auto\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432335/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432312", "body": "size_t\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432312/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432426", "body": "I think we should avoid mucking with these templated definitions by just moving record/restore_struct_(m)msghdr into record/replay_syscall.cc.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14432426/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14488532", "body": "We should still sleep() because we want to write out some '.'s before sending the signal, and calling sleep() makes that much more likely.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14488532/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14678835", "body": "I think this should template over the class rather than the enum value, for consistency with other templated code.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14678835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14678996", "body": "This is no longer needed, so you can remove this part of the comment as well as the redundant SYSCALL_UNDEFINED_X86_64()s.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14678996/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681721", "body": "Actually I wonder if we could make the Arch classes inherit from `Syscalls<Arch>`. Then we could write just `Arch::readv` etc which looks nicer than `Syscalls<Arch>::readv`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681721/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681967", "body": "OK I guess. Though I think we should reconsider this if it becomes a burden.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681967/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14685248", "body": "Sure, why not? :-)\n\n``` C++\n#include <stdio.h>\nclass Fwd1;\ntemplate <class F> struct A;\ntemplate<> struct A<Fwd1> {\n  enum X { p, q, r };\n};\nclass Fwd1 : public A<Fwd1> {};\nint main() {\n  printf(\"%d\\n\", (int)Fwd1::r);\n  return 0;\n}\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14685248/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14689648", "body": "How about just moving the syscall numbers directly into the arch classes in kernel_abi.h and get rid of syscalls.h? They are part of the ABI after all.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14689648/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16218402", "body": "This doesn't seem right to me. It means that when we compile on x86-64, we'll set `packed` even for the x86-32 definition of epoll_event. Is that OK?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16218402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16276730", "body": "I don't think it makes sense to use the compile-time #ifdef here. How about we define the non-packed structure in base_arch and override it with a separate packed definition in x86_64_arch?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16276730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16875409", "body": "Even if we're only going to do this check for 32-bit tracees, it needs to be a dynamic check not a compile-time check, or we'll fail when a 64-bit rr build replays a 32-bit tracee.\n\nI suggest using arg4() instead of esi and guarding the whole thing with t->arch() == x86.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16875409/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17393018", "body": "This commits us to an implementation where `Registers` uses `user_regs_struct` for storage. I guess that's OK since we only use this in a couple of places, making it easy to change.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17393018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17394347", "body": "I've pushed a commit to get rid of this ebp-setting code. Tests pass without it. Maybe there are some kernels that require it, but if we discover it's required, we can add it back with much better documentation.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17394347/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17461060", "body": "For consistency, I think this should be `has_##_name##_syscall`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17461060/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17461188", "body": "In names like `open_syscall_number`, it's natural to think of `open` as being the primary verb, which makes reading such code confusing.\n\nI suggest making it `get_open_syscall_number` or `syscall_number_for_open` or something like that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17461188/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17461274", "body": "This is where you introduced the `cpuid` regression. For a `geteuid32` syscall `!is_geteuid_syscall(ev.Syscall().number, t->arch())` is true so we take the early exit.\n\nWe don't need to check `has_geteuid32` here; if the arch doesn't have it, then `is_geteuid32_syscall` will simply return false. So we can just write this as\n\n```\n  if (!is_geteuid32_syscall(ev.Syscall().number, t->arch()) &&\n      !is_geteuid_syscall(ev.Syscall().number, t->arch())) {\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17461274/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274001", "body": "This doesn't look right. `__BITS_PER_LONG` here would be rr's `__BITS_PER_LONG`; to emulate what `asm-generic/shmbuf.h` is doing, we'd need to make this conditional on the `wordsize` template parameter, which I don't think we can do easily.\n\nI think the simplest thing to do is just provide separate definitions per architecture.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274001/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26349029", "body": "Right, I understand that. But if we add this patch, then when we build rr 64-bit, `X86Arch::shmid64_ds` will contain\n\n```\n    __kernel_time_t shm_atime;\n    __kernel_time_t shm_dtime;\n    __kernel_time_t shm_ctime;\n```\n\nwhich is incorrect since `X86Arch::__kernel_time_t` is only 32 bits.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26349029/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274111", "body": "I'm trying to keep all global single-letter options as capitals. Here I think we should just not have a single-letter option.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274111/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274177", "body": "Or, since that's a bit of a pain with the current option-parsing setup, let's just give it `-N`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274177/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274186", "body": "Rather than add this to `Flags`, which I'm trying to reduce/eliminate, let's just make it a static variable in `main.cc`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26274186/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26531079", "body": "I like what you've written here. I like to have the kernel_abi definitions match the actual header contents as closely as possible. So I guess you just need to add a typedef for `__u32` to `BaseArch`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26531079/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29232725", "body": "Stray space before )\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29232725/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29232741", "body": "Spaces: `} else {`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29232741/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29748779", "body": "I think it would be simpler to eliminate `vdso_pair()` and just have `vdso()` check the pseudodevice and return an empty `Mapping()` if there's no mapping or it's the wrong pseudodevice.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29748779/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29748899", "body": "Also I think we need a test here. It's a little bit tricky to write; you probably should modify test_lib.c's `constructor` function to unmap the VDSO, by reading /proc/self/maps, finding the [vdso] line, and unmapping that page range.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29748899/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29749043", "body": "Actually it's probably a good idea to only do that if some magic environment variable is set, e.g. RR_UNMAP_VDSO_PAGE, by checking for it using `getenv()`. And then set that environment variable in a test script, e.g. copy the `hardlink_mmapped_files.run` for a new test `unmap_vdso.run`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/29749043/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/30498185", "body": "Shouldn't we check `has_mapping(vdso_start_addr)` as well?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/30498185/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/30498233", "body": "I think it's enough to just check `vdso->num_bytes()` here?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/30498233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44064471", "body": "We don't need syscall buffering support unless some real workload does a lot of `readlinkat` calls, e.g. more than a thousand.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44064471/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44064512", "body": "We try to keep it ANSI-C so don't declare variables after statements.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44064512/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44193328", "body": "Test that errno == EINVAL.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44193328/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44193379", "body": "No point in doing this setuid again, is there?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44193379/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194407", "body": "C system headers (including `dirent.h` and `assert.h`) go first in their own section, followed by C++ system headers, followed by rr headers.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194407/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194526", "body": "`TraceInfo`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194526/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194535", "body": "`static`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194535/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194540", "body": "`static`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194540/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194582", "body": "`static`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194582/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194642", "body": "Rather than depend on these utilities I'd much prefer code that just `stat`s each file in the directory and adds up the sizes. Shouldn't be much code I think.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194642/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194713", "body": "`const string& traces_dir`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194713/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194774", "body": "To reduce indenting, invert this condition to put the error case first with an early return.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194774/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194930", "body": "If you're going to describe the format, put the components in the same order as you output them. In particular the command line goes last (as it should!).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194930/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194962", "body": "Use `printf` instead of `fprintf(stdout)`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44194962/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44195029", "body": "We don't need this check; using rr to debug `rr ls` should work fine.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44195029/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44195278", "body": "`extern` is not needed here, just remove it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/44195278/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/45128772", "body": "Unnecessary blank line...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/45128772/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/49686770", "body": "This message might not be true. It might just be that someone did `rr replay <path>` where `<path>` is not the name of an rr trace directory.\n\nAlso, I think we don't need a separate `file_exists` check here. If `vfile.good()` is false then we can assume the file doesn't exist. We should just print a different, better message saying that the trace was not found.\n\nActually what would be really useful is to change this constructor so that if an error occurs, it returns an error code (an enum) in an out-parameter and the caller can handle it. Then `ReplaySession`'s constructor can forward that error out to its caller, `ReplayCommand`, which can display the error message. Really the Command classes should be responsible for interacting with the user.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/49686770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/50815582", "body": "This is no longer used\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/50815582/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/50815998", "body": "Actually I guess it still is used. But we should replace the checkpoint commands with the new infrastructure, later.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/50815998/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51194822", "body": "remove this blank line\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51194822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51195120", "body": "\"when called\"\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51195120/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51195331", "body": "Unfortunately I don't understand this comment at all. I don't know what the auto arguments code is for.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51195331/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51196322", "body": "Hmm ... what about an alternative approach where we have a GdbCommandImpl which is a template whose parameters are the invoke function and the command name, and each GdbCommandImpl instance is a subclass of GdbCommand? I think GdbServer could then just refer to friend functions and we wouldn't have to name the command implementation classes.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51196322/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51196990", "body": "Ah, this is just to automatically parse the arguments vector to a typed parameter list. I honestly don't think it's worth it, certainly not with the commands we currently have.\n\nIf we end up with repetitive parsing code later, I'd suggest creating a varargs template `parse_to_tuple<T1, T2, ...>(const vector<string>& args)` that commands can call explicitly if they want to.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51196990/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51223882", "body": "I'm not suggesting using templated GdbCommandImpl to avoid friend declarations. I'm suggesting using it to avoid macros that generate named classes.\n\n> With templates we'd have to keep adding more and more to the template arguments and/or use traits.\n\nHere we'd have to add more and more macro parameters, would we not?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51223882/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51224198", "body": "Those are good points. However, I still get the feeling it's possible to simplify the setup. I might have to tinker with it myself.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51224198/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62117892", "body": "Seems to me that if all tasks for this AddressSpace die before this gets called, we could have an AddressSpace with no Tasks, in which case remove_breakpoint will crash because we don't find a usable Task to reset the memory through. Need to modify the AddressSpace code so that if there's no Task we don't try to do anything (since the memory is already gone in fact).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62117892/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119326", "body": "coding style is to put {} around all if/else bodies\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119326/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119504", "body": "I'm not sure why this code is needed. If it is, that seems like a bug.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119543", "body": "Why the initial check of syscall_bp_vm here?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119972", "body": "Why do we need to clear it here?\n\nAFAIK we won't start a new step until after enter_syscall has returned COMPLETE, in which case we should already have cleared it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120271", "body": "Ah. Then I think the correct fix is for ReplayTimeline to only unapply the breakpoints it knows about.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120271/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120490", "body": "To make that clearer, I think this should be\n\n```\n  if (!syscall_bp_vm && t->vm()->add_breakpoint(...)) {\n     syscall_bp_vm = ...;\n     syscall_bp_addr = ...;\n  }\n  use_breakpoint_optimization = true;\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120490/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120627", "body": "Er, that's slightly buggy if add_breakpoint fails and syscall_bp_vm was not set. But you can fix that by getting rid of use_breakpoint_optimization and just testing syscall_bp_vm instead.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120677", "body": "Also, clear syscall_bp_addr here too to avoid confusion.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120677/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251224", "body": "Don't we need to check here whether syscall_bp_addr and syscall_bp_vm refer to the same vm and address as t/syscall_instruction?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251224/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251652", "body": "Ah, because it would have been cleared otherwise, so syscall_bp_\\* must have been set by a prior enter_syscall for the same event. Yes, please add an assertion to that effect.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251652/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251682", "body": "And add a comment explaining why it holds!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255384", "body": "I assume that `local_addr` should point to the first byte of the map, otherwise we won't be able to use it effectively, in which case this assertion should _not_ hold. Instead we'll need to assert that `first_kv->second.local_addr + size == next->second.local_addr` ... and we'll need to update local_addr when splitting maps so that this assertion holds.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255384/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255565", "body": "Please make it explicit that this points to the first byte of this Mapping (once that's true!). And also note that responsibility for keeping local_addr alive at least as long as the Mapping rests with whoever mapped it in the first place.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255565/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255780", "body": "One question is whether the local mapping should always be read/write or whether it can be read-only or even PROT_NONE. Currently write_mem can write to memory regardless of tracee PROT_ status, so I think we should require that the local_addr be read-write if we can.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255780/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255879", "body": "Why do we need a special function for this? Seems to me we should just make record_remote use local mappings if we can, and not expose this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255879/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256469", "body": "Another possibly simpler approach would be to have the helper just return a pointer to the local data if the entire requested region is locally mapped, otherwise null. I can't think of real cases where being able to return a partial local map is useful. That simplifies things to two cases (locally mapped/not locally mapped) instead of three (locally mapped/not locally mapped/partially mapped) and means we don't need a callback.\n\nAlso, this helper can live in AddressSpace and probably should.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256469/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256604", "body": "Actually no, keep it in Task since it's a private helper for the read/write mem methods. But I think it can be a static function that doesn't need to be in Task.h.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256604/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62257857", "body": "I was hoping we'd remove Task::syscallbuf_hdr too. Is that infeasible?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62257857/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65270733", "body": "Maybe call this `ASSERT_ACTIONS`? `ASSERT2` is not very descriptive.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65270733/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65271114", "body": "\"is the whole range\" -> \"if the whole range\" in commit message\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65271114/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65651783", "body": "Hmm. Isn't this the only place where AddressSpace takes responsibility for modifying local mappings? Wouldn't it be more consistent to require callers to do this themselves?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65651783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65651933", "body": "In particular this would interact with `remap`; we `unmap_internal` the remapped memory. So either the caller already remapped the local mapping, in which case we shouldn't try to unmap it ourselves (e.g. consider a racing thread that mmaps the same area), or the caller didn't remap the local mapping in which case we'll be destroying it and leaving an invalid `local_addr` pointer.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65651933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652004", "body": "So I think we shouldn't touch any local mappings in AddressSpace and have the caller take responsibility for it. If it helps, we could add the ability to associate a callback with a mapped memory range that gets called when there are no more mapped pages.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652004/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652055", "body": "Just make this return bool, true if we succeeded and false if we didn't.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652055/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652090", "body": "{}\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652090/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652284", "body": "Just `remote.arch()`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652333", "body": "Use `MAP_FAILED`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652333/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652472", "body": "{}\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652472/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652631", "body": "() around `MAP_PRIVATE & flags`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652631/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652668", "body": "Use regs()->syscall_failed()\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652668/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652823", "body": "{} around the `if` body\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65652823/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65784363", "body": "I think it would be the caller's responsibility to update the local mapping in that case. Of course we'd have to give them a way to update the local mapping address(es). For now, clearing the local address(es) sounds fine to me.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65784363/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/66159384", "body": "I merged my fix into your commit so I don't have it handy, but the bug is here. The `remap()` call above may have invalidated `m`. I fixed it by making the `m` parameter a value instead of a reference.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/66159384/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145328", "body": "These should go in `kernel_supplement.h`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145328/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145400", "body": "Just use `NativeArch::memfd_create`. This has the bonus feature of also working on x86-32.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145400/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145467", "body": "Call this `rr_memfd_create` so it doesn't conflict with a libc version when that appears.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145600", "body": "Can you confirm that you really need this in practice? I'd prefer to not add another testing path without a confirmed need.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145657", "body": "`do {`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145757", "body": "```\n    if (c <= 0) {\n      break;\n    }\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145757/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145943", "body": "If `pwrite64` returns 0 then I guess we need to abort because the device is full...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67145943/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67146147", "body": "Why did you remove `SETSIG`?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67146147/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67146182", "body": "Remove blank line\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67146182/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67146422", "body": "No. It's supported since 2.6.35 and rr definitely doesn't work at all before 3.6 or thereabouts, so these fcntls will definitely be supported.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67146422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67247915", "body": "OK then...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67247915/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67250452", "body": "I guess that's true but I think we should abort for 0 instead of retrying, anyway. It's no more complicated to do that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67250452/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/69017587", "body": "While this is technically correct, using \"seeked\" as the past tense for a \"seek\" operation is pretty common. E.g. https://developer.mozilla.org/en-US/docs/Web/Events/seeked. So I'll leave this as-is. Thanks for the rest of the changes!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/69017587/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71232645", "body": "`proc_service.h` should be under `third_party`. Then this won't be needed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71232645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71235834", "body": "... in its own subdirectory, with a README explaining where you copied it and what must be done to comply with its license.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71235834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71236302", "body": "I think we should make this a `unique_ptr` so that we don't need to include `ThreadDB.h` here and `ThreadDB` will not need to be instantiated during recording, which doesn't need this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71236302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71236729", "body": "I think it would be a bit nicer to just get these directly from `Task::regs()`, abstracting away the ptrace usage.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71236729/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71237072", "body": "In modern Linux kernels every task in the task group must share VM, and you're assuming that here. Please make that explicit.\n\nOTOH tasks can share VM without being the same task group but I guess you're not assuming that here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71237072/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71237276", "body": "You can get these from Task::regs() on x86-64. Does this even get called (or work) on x86-32? Also this `PTRACE_ARCH_PRCTL` is undocumented... if you must use a syscall here, why not use `arch_prctl`?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71237276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71438809", "body": "That sounds OK. Thanks.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71438809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71438984", "body": "> I don't think arch_prctl can be used as, IIUC, it works on the current process, not some other process.\n\nOf course, right.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71438984/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653248", "body": "I'd prefer to have the address parsed in `GdbConnection`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653248/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653467", "body": "Call this `find_task_by_real_tid`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653696", "body": "Shouldn't we return the names of all symbols, whether or not they have been resolved? In case symbols already resolved need to be re-resolved to a different address?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653696/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653738", "body": "Can we remove this #include?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653738/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653977", "body": "\"with a list of symbols\"\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71653977/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71654972", "body": "\", which is enforced by clone(2).\"\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71654972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71655099", "body": "I think it's probably better to do\n\n```\nFATAL() << \"ps_pdwrite not implemented\";\n```\n\nIf we hit this, that'll be easier to diagnose than some more mysterious failure.\n\nSame below.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71655099/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71655334", "body": "Hmm. Why are we looking up a task by real-tid here? This is a bit of a dilemma, potentially; if libthreaddb uses /proc, then it will be wanting real-tids, but if it looks into data structures in the replaying process memory, it will be wanting recorded-tids. Have you considered this issue? Are you sure we're OK always using real-tids? If so, please document that clearly somewhere.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71655334/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71655464", "body": "So this is weird, because here you're returning the recorded tgid, so we're being inconsistent...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71655464/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71798631", "body": "What if we reverse-execute backward through the loading of libpthread? I think in that case they'll disappear and returning invalid values might be a problem.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71798631/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75243656", "body": "This is uninitialized on the other path. I'll fix it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75243656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75244626", "body": "You and me both, brother.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75244626/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75990852", "body": "\"by rr\"\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75990852/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77458883", "body": "I don't understand why we need to re-record the overlap page. Can you explain this in more detail?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77458883/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77467906", "body": "How can `st.st_size` be somewhere below that? `new_length` must be >= `page_size * (N + 1)`. It sounds like this must be a case where we're mapping one or more pages entirely beyond the current EOF? That does look like it would be a problem here ... but then I think the correct fix would simply be to max `end` with zero.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77467906/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77467986", "body": "In your testcase the file size is `2 * num_bytes` which looks like it should work with the current code.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77467986/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77468497", "body": "Surely you want `max` here?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77468497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77470448", "body": "This doesn't actually fix the testcase for me. I think the parameter type for `max` is inferred to be unsigned. I fixed this up by writing `max<off64_t>` explicitly.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77470448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77915821", "body": "Add a comment explaining that this denies _all_ gcrypt hardware features.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77915821/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919024", "body": "I think we should assert somewhere that the tracee doesn't raise its limit into our reserved area. Not that hard to do now, but could pay off bigtime in debugging later.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919024/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919366", "body": "Call this create_root_fd\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919366/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919519", "body": "Please apply the same fix to set_data_record_from_trace\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919519/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919961", "body": "Also I think this needs a test. I guess a test that tries to touch all fds up to the rlimit somehow (fstat?) and gets EBADF for everything.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77919961/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77920787", "body": "I think we should assert here that the mapping is MAP_SHARED. If it's not, i.e. a tracee writes to a MAP_PRIVATE file during recording, that could be really bad since it's not defined whether the tracee sees the old or new data. (It depends on whether the page has been faulted in, I guess.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77920787/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77920914", "body": "Technically we should scan the mappings in other processes also. That doesn't seem too hard to do? Just loop over all tasks and keep track of which AddressSpaces you've already seen so we don't process them multiple times.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77920914/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921020", "body": "If the file is mapped into multiple places, this will record multiple writes. That's not great but I guess we can live with it for now. Just mention it in a comment.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921020/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921132", "body": "I think we should check whether the monitor is already a MmappedFileMonitor. If it's another kind of monitor we have a problem!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921132/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921164", "body": "ditto\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921164/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921537", "body": "\"entries\"\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921537/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921745", "body": "This seems wrong ... `offset_adjustment` is never used\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921745/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921903", "body": "Shouldn't we reset next_off to current_offset here, and decrease `size`?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77921903/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77922044", "body": "and NEW_CGROUP\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77922044/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77922315", "body": "Also, this needs a test.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77922315/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77926993", "body": "Oops, I totally botched my review of this patch. Ignore.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77926993/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927161", "body": "Yeah it looks great. But this could use a test.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927161/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927782", "body": "It doesn't try `fstat` and if it did, I don't think it would pass.\n\nWhat exactly was Chromium doing that made you write this patch? Probably should have a test for that at least.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77927782/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77928567", "body": "Wait, so we don't actually need this patch? If not, I suggest putting it on ice for now. It adds complexity and overhead.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77928567/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77929929", "body": "We're already tracking which fds should be hidden, effectively: we add a PreserveFileMonitor for the rootdir fd, desched_fd_child and cloned_file_data_fd_child. `FileMonitor::allow_close` just needs a name change (and value inversion) to `is_rr_fd` or something like that, then you can call into `FdTable` from the /proc/.../fd censoring code.\n\nWhat did you mean by \"somewhat observable\"?\n\nI appreciate that this code is already written, but it does add overhead as well as complexity.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77929929/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930232", "body": "Also, it just occurred to me that if we really do need to put rr's fds beyond the tracee's apparent fd-limit for some reason, it would probably be a lot simpler to just fake the result of getrlimit instead of really lowering the limit.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930232/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930685", "body": "> That would break anything that expected to be able to close all its own fds this way.\n\nGood point.\n\n> The tracee can see magical holes in the fd space that are unused but it can't dup to/etc.\n\nTrue, though that's an existing issue that hasn't caused any problems so far. We could avoid it --- well, reduce it --- by allocating rr fds right at the top of the available range.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77930685/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77945640", "body": "As discussed, we need to do something here to record the region between the new and old buffer ends.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77945640/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78082706", "body": "You don't need these \"=a\"/\"a\" annotations, do you?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78082706/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77924743", "body": "isn't this inverted? We want to take a mark if we're replaying, and not if we're not replaying.\n\nBut shouldn't we just ignore the command completely if we're not replaying? I don't think you want these other effects.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/77924743/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78123249", "body": "> If you assume diversion are short-lived to perhaps evaluate a quick value, then yes you'd want no side effects.\n\nThat's all you can do with diversions right now.\n\nIf we ever change that, it will require adding new rr commands, which can take responsibility for clearing the forward stack etc.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78123249/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79702986", "body": "Can we do this only for `back`/`forward`, i.e. the commands that need it?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79702986/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79754292", "body": "Let's have a method that commands can call to do it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79754292/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79760935", "body": "static?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79760935/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80170821", "body": "Why this change?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80170821/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80171047", "body": "I think this needs to be a privileged traced syscall instead of calling the library function.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80171047/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80179442", "body": "In theory this should be privileged in case a seccomp filter blocks the `rt_sigaction` syscall. But I guess that's pretty unlikely.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80179442/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016645", "body": "Just `assert(f)`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016670", "body": "Just `assert(env)`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016816", "body": "Don't change this here, just make this `xmalloc` later\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016816/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016873", "body": "`if (!mem_ptr)`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80016873/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80017004", "body": "Squash this into the previous patch.  Every prefix of the list of commits should build and run.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80017004/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80017140", "body": "How do these test changes build, given that tests don't link to `util.cc`? I think you need to declare `xmalloc` in rrutil.h too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80017140/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/82539364", "body": "This is a bit scary. It's possible that the mapping was replaced by something else that gets a local mapping, and then this code will run and we'll scribble over it. That would be pretty hard to debug. Can we additionally check that the name starts with `preload_thread_locals`?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/82539364/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/82540013", "body": "> I didn't think anything that would get mapped there would actually get a local mapping\n\nThat's probably true at the moment but it's a fragile assumption.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/82540013/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/83986332", "body": "Document what this means/is for\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/83986332/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/84615210", "body": "There's nothing wrong with this change, but I would expect that if the tests are compiled with inlining then lots of other things would break. Is that not the case?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/84615210/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446448", "body": "Flip the order of the blocks so we don't have to use ! here\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446569", "body": "Use `is_recording` instead of `!is_replaying`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446569/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446606", "body": "{} around all if bodies\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446606/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446885", "body": "There's a potential issue here for concurrent writes to the same file.\n\nI _think_ we should probably make the write `PREVENT_SWITCH` if we're writing to a mapped file. That should fix it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85446885/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85447123", "body": "This `needs_offset` boilerplate is a bit unfortunate. Would it not be better to pass a couple of extra parameters (`Task*` and `fd`) to `did_write` etc so the `FileMonitor` can find the offset itself if needed?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85447123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85447176", "body": "(I don't think writes to a mapped file could be part of a deadlock.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85447176/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85447302", "body": "{} around if bodies\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85447302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85613533", "body": "Indeed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85613533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85613689", "body": "A slightly cleaner way to do it would be to encapsulate the logic in a `LazyOffset` object (that need not be lazy) which allows the callee to retrieve the offset if needed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85613689/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85613775", "body": "... and we should have a commit hook that runs clang-format on commit...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85613775/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87475890", "body": "{}\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87475890/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87475913", "body": "{}\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87475913/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87476082", "body": "Better to say \"bit 0\" and \"bit 1\"?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87476082/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87477321", "body": "Let's name the lock bits with named flags. `2` is too magical.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87477321/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/88201335", "body": "How can we reach here with child != 0?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/88201335/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/88201566", "body": "I dislike boolean parameters, they're hard to read at call sites. Can you just pass the parent pid here instead?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/88201566/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "WesleyYue": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2126", "title": "Get time since execution", "body": "I would like to be able to query the elapsed time (during the recording) when I am stopped at a breakpoint. Would this be a difficult feature to implement? Do you have any hints on how one might approach implementing this?", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2126/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "emk": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2123", "title": "Expected EINVAL for 'futex' but got result 1 (while debugging Rust's tokio)", "body": "Hello, I'm trying to use rr to debug a Rust application that uses the tokio async networking library. When I do this, I hit an unimplemented syscall:\r\n\r\n```\r\nDEBUG:tokio_core::reactor: loop poll - Duration { secs: 0, nanos: 2225926 }\r\nDEBUG:tokio_core::reactor: loop time - Instant { tv_sec: 2611, tv_nsec: 103246097 }\r\nTRACE:tokio_core::reactor: event Readable Token(0)\r\nDEBUG:tokio_core::reactor: consuming notification queue\r\nDEBUG:tokio_core::reactor: loop process - 1 events, Duration { secs: 0, nanos: 1760503 }\r\nDEBUG:tokio_core::reactor: loop poll - Duration { secs: 0, nanos: 2346041 }\r\nDEBUG:tokio_core::reactor: loop time - Instant { tv_sec: 2611, tv_nsec: 107812276 }\r\nDEBUG:tokio_core::reactor: loop process - 0 events, Duration { secs: 0, nanos: 892061 }\r\n[FATAL /home/rust/rr/rr/src/record_syscall.cc:4872:rec_process_syscall_arch()] \r\n (task 22765 (rec:22765) at time 458)\r\n -> Assertion `t->regs().syscall_result_signed() == -syscall_state.expect_errno' failed to hold. Expected EINVAL for 'futex' but got result 1 (errno errno(-1)); unknown futex(0x3)\r\n```\r\n\r\nI'd be willing to try and submit a PR. Do you have a guide for how to add new syscalls? Thank you for any pointers you can provide!", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "senjitsu": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2115", "title": "23% of tests fail on Ubuntu 16.04", "body": "Working on getting RR up and running and am seeing many test failures. I havent dug through all of them, but they all seem to generate the same / similar output. \r\n\r\nI am seeing 77% tests passing, but it took some additional work to even get that far from the normal install instructions. I had to get the perf tools setup and set the perf_event_paranoid flag to 1 from 3, prior to this.\r\n\r\nI am running Ubuntu 16.04 in VMware Workstation 14. \r\n\r\n```\r\nStart testing: Oct 23 06:58 PDT\r\n----------------------------------------------------------\r\n669/2141 Testing: block_clone_checkpoint-no-syscallbuf\r\n669/2141 Test: block_clone_checkpoint-no-syscallbuf\r\nCommand: \"/bin/bash\" \"/home/hive/rr/rr/src/test/block_clone_checkpoint.run\" \"block_clone_checkpoint\" \"-n\" \"/home/hive/rr/obj\" \"120\"\r\nDirectory: /home/hive/rr/obj\r\n\"block_clone_checkpoint-no-syscallbuf\" start time: Oct 23 06:58 PDT\r\nOutput:\r\n----------------------------------------------------------\r\nFAILED: sending \"b breakpoint\r\n\"\r\nexception: a float is required\r\nTest 'block_clone_checkpoint' FAILED: debug script failed\r\n--------------------------------------------------\r\ngdb_rr.log:\r\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1\r\nCopyright (C) 2016 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<http://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from /tmp/rr-test-block_clone_checkpoint-LgmRWzRup/block_clone_checkpoint-LgmRWzRup-0/mmap_hardlink_3_block_clone_checkpoint-LgmRWzRup...done.\r\nReally redefine built-in command \"restart\"? (y or n) [answered Y; input not from terminal]\r\nRemote debugging using 127.0.0.1:8458\r\nReading symbols from /lib64/ld-linux-x86-64.so.2...Reading symbols from /usr/lib/debug//lib/x86_64-linux-gnu/ld-2.23.so...done.\r\ndone.\r\n0x00007fcdbc703c30 in _start () from /lib64/ld-linux-x86-64.so.2\r\n(rr) --------------------------------------------------\r\ndebug.err:\r\ncat: debug.err: No such file or directory\r\n```\r\n\r\nWhen I go to rerun the /tmp/ test binary, I am not getting anything interesting as far as I can tell, however, I have never used anything of these tools. \r\n\r\n```\r\nStarting program: /tmp/rr-test-block_clone_checkpoint-LgmRWzRup/block_clone_checkpoint-LgmRWzRup \r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\nEXIT-SUCCESS\r\n[Inferior 1 (process 23208) exited normally]\r\n```\r\nI am currently trying to run the test as a replay, but wanted to get the issue started up here incase I am just missing something in the setup.\r\n\r\nEDIT: After running the replay, it looks as if the test is not running at all, and is just exiting / returning from ld64. ", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2115/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "mikeconley": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2105", "title": "Support hopping between recorded processes", "body": "I debug multi-process Firefox with rr all of the time, and it's absolutely great.\r\n\r\nOne thing I wish I could do is choose and switch which process I was \"inside\" while debugging.\r\n\r\nFor example, suppose I'm debugging the content processes reaction to a particular IPC message. This IPC message is sent frequently, but there's a time when it's sent and the parent is in a particular state where I want to see what the content process does.\r\n\r\nIt'd be lovely if I could break when I realize I'm in that state in the parent process, and then switch over to the content process and see how it deals with the IPC message.\r\n\r\nCurrently, I do this with stdio logging, and it's noisy but it gets the job done. I'd prefer rr if I can get it!", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2105/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "cirosantilli": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2089", "title": "Start reverse debugging immediately after record to run long running programs only once", "body": "My program takes a long time to reach a failure point which leads the process to exit.\r\n\r\nCurrently, I'm using:\r\n\r\n    rr record prog\r\n    rr replay\r\n\r\nwhich does the long execution twice up to the failure point.\r\n\r\nIs there a way to start reverse debugging from the point it exits immediately after the `rr record prog` so I don't have to wait twice?\r\n\r\nPossibly related to: https://github.com/mozilla/rr/issues/1989 At the limit this could be implemented by periodically snapshotting the running program.\r\n\r\nEDIT: or even better: start the program in a reverse-recorde enabled GDB shell like UndoDB does.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "vadimcn": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2078", "title": "rr does not support LLDB as a client", "body": "I hoped I could use LLDB to connect to rr in server mode, but this was not to be... Looks like rr's emulation of gdbserver is not complete.   \r\n\r\nA couple of problems I found during initial investigation:\r\n- rr reports process id=0, which LLDB considers invalid.\r\n- rr uses ['multiprocess' thread id format](https://sourceware.org/gdb/onlinedocs/gdb/Packets.html#thread_002did-syntax) even though LLDB did not indicate 'multiprocess' extension support in qSupported request.\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2078/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "pkmoore": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2057", "title": "Support for \"catch syscall\" or other means of breaking on system call entry and exit", "body": "Right now attempting to catch a syscall during replay results in an error indicating that the feature is not supported.  This means that the best a user can do is break execution on the libc wrappers that exist for some system calls.  This workaround isn't sufficient for breaking on all system call entries and exits.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2057/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "froydnj": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2041", "title": "visiting https://rr-project.org/ gives errors about insecure connections", "body": "Firefox says:\r\n\r\n```\r\nrr-project.org uses an invalid security certificate.\r\n\r\nThe certificate is only valid for the following names: *.github.com, github.com, *.github.io, github.io\r\n\r\nError code: SSL_ERROR_BAD_CERT_DOMAIN\r\n```\r\n\r\nIt'd be nice if we could link to https://rr-project.org/", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2041/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1324", "title": "Assertion `child_sig_gt_zero' failed to hold. Replaying `SCHED': expecting tracee signal or trap, but instead at `ioctl' (ticks: 55628)", "body": "I'm trying to enable `-fPIC` for librrpreload, since x86-64 is unhappy about having to link relocations related to `__thread` in non-`PIC` code.  As a start, I was trying to make sure that `-fPIC` works for 32-bit mode, but I get several test failures:\n- `async_signal_syscalls_100`\n- `async_signal_syscalls_1000`\n- `checkpoint_async_signal_syscalls_1000`\n- `deliver_async_signal_during_syscalls`\n- `syscallbuf_timeslice_250`\n\nIn attempting to debug `syscallbuf_timeslice_250`, I hit the assertion which is the title of this issue.  What can I do to figure out what's going wrong?  The recorded trace doesn't have any ioctl syscalls whatsoever in it.\n\nThe dump has a `SCHED` event at `ticks:55606`, an intervening `SYSCALLBUF_RESET` event, and then a `SCHED` event at `ticks:55928`.  Is it possible that the `ioctl` from fiddling with the syscallbuf is the system call we're seeing in the replay, and that somehow didn't happen in the record, or that it got recorded incorrectly?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1324/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/6893954", "body": "Aw, really?  I checked for C++11-ness there; I guess I didn't check hard enough for availability in appropriate GCC versions.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/6893954/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681372", "body": "I think being explicit about exactly what syscalls are undefined is better than silently letting undefinedness \"leak through\" multiple syscall definitions.  I realize the numbering scheme \"leaks through\", but I think numbering is different than undefinedness.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681372/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681423", "body": "Ah, so specialize on `x86_arch` instead?  That will probably work better once more things get templated.  I'll do that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14681423/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14682331", "body": "Making `base_arch<supported_arch arch>` inherit from `Syscalls<arch>` is pretty straightforward.  I think trying to make `x86_arch` inherit from `Syscalls<x86_arch>` might run into circularity problems, unless you can specialize `Syscalls` on a class that isn't yet defined...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14682331/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14687239", "body": "Very nice.\n\nBut then we have to forward-declare the list of all `*_arch` classes in `syscalls.h`; at that point, just having `Syscalls<supported_arch>` and letting `base_arch` inherit from that seems like more of a win.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14687239/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14725328", "body": "I would be fine with doing that, but I think I'll push the SyscallsX86_64 patch to another issue, then.  Getting SyscallsX86_64 to work as a part of the arch classes will require a raft of other things to be added to kernel_abi.h.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/14725328/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16218563", "body": "It is odd; I think it actually works out OK, because the not-packed and the packed structure definitions for x86-32 would be the same size, with members at the same offsets.  `uint64_t` on x86-32 only has 4-byte alignment, IIRC, so the union doesn't require padding between the `events` member and the `data` member.\n\nIf it does happily work out in our favor, there should be a comment explaining such.  If it doesn't happily work out, it should be fixed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16218563/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17491971", "body": "Thank you for spotting that!  I always screw those sorts of conditions up.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/17491971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "jrmuizel": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2037", "title": "Add support for time bisection", "body": "It might be useful to be able to specify a condition and have rr bisect the running of a program to the point when the condition transitions from true to false.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/2025", "title": "Assertion failure during reverse continue", "body": "I hit: /home/jrmuizel/src/rr/src/ReplayTimeline.cc:1001: rr::ReplayResult rr::ReplayTimeline::reverse_continue(const std::function<bool(rr::ReplayTask*)>&, const std::function<bool()>&): Assertion `!at_mark(end)' failed.\r\n\r\nduring a reverse-finish operation using a build of f80d1d2115af8f7f6a524a9270b7df6f8207155a from Sun Jan 15 09:39:18 2017", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2025/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1687", "title": "replay does not work with wine", "body": "Using http://people.mozilla.org/~jmuizelaar/ddb-bench.exe\n\n```\n$ rr wine ddb-bench.exe\nrr: Saving the execution of `wine' to trace directory `/home/jrmuizel/.rr/wine-0'.\nfixme:process:SetProcessDEPPolicy (1): stub\nfixme:wer:WerSetFlags (2) stub!\nfixme:heap:HeapSetInformation (nil) 1 (nil) 0\nfixme:process:SetProcessShutdownParameters (00000380, 00000000): partial stub.\nfixme:service:QueryServiceConfig2W Level 6 not implemented\nfixme:service:QueryServiceConfig2W Level 6 not implemented\nfixme:service:QueryServiceConfig2W Level 6 not implemented\nfixme:service:QueryServiceConfig2W Level 6 not implemented\nfixme:service:QueryServiceConfig2W Level 6 not implemented\nRGB\n3.239637 [-0.308137 +2.334563] ddb -> ddb\n3.210115 [-0.314715 +3.315385] dibsection -> ddb\n3.102141 [-0.287341 +3.123159] ddb -> dibsection\n3.058439 [-0.303839 +3.062961] dibsection -> dibsection\nBITFIELDS\n3.101682 [-0.273682 +2.528318] dibsection -> ddb\n3.175262 [-0.338062 +2.697338] ddb -> dibsection\n4.180140 [-1.393340 +2.466060] dibsection -> dibsection\nBITFIELDS_OPAQUE\n3.244291 [-0.403591 +4.325209] dibsection -> ddb\n3.094058 [-0.288058 +2.448342] ddb -> dibsection\n3.195503 [-0.293703 +2.602897] dibsection -> dibsection\nMIXED\n3.155186 [-0.280686 +2.294214] dibsection -> dibsection\n3.131569 [-0.298769 +2.651131] dibsection -> dibsection\nalpha\n23.760848 [-0.427348 +1.799352] ddb -> ddb\n23.769154 [-0.460754 +1.615446] dibsection -> ddb\n24.204612 [-0.507512 +1.193888] ddb -> dibsection\n24.891990 [-1.153390 +2.370010] dibsection -> dibsection\ntext\n2.016900 memcpy\n2.185100 memcpy\n2.419000 memcpy\n2.225400 memcpy\n2.281400 memcpy\n```\n\nrunning the replay I get:\n\n```\njrmuizel@hawkman:~/workspace/rr-wine$ rr replay\nGNU gdb (Ubuntu 7.10-1ubuntu2) 7.10\nCopyright (C) 2015 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\n/home/jrmuizel/.gdbinit:6: Error in sourced command file:\nA syntax error in expression, near `:$datadir/auto-load:/home/jrmuizel/src/gecko'.\nReading symbols from /usr/bin/wine...(no debugging symbols found)...done.\nReally redefine built-in command \"restart\"? (y or n) [answered Y; input not from terminal]\nRemote debugging using 127.0.0.1:13021\nwarning: limiting remote suggested packet size (17073526 bytes) to 16384\nwarning: remote target does not support file transfer, attempting to access files from local filesystem.\nReading symbols from /lib/ld-linux.so.2...(no debugging symbols found)...done.\n0xf77a2a90 in ?? () from /lib/ld-linux.so.2\n(rr) c\nContinuing.\n\n[Thread 12974.12974] #1 stopped.\n0x70000002 in ?? ()\n(rr) q\nA debugging session is active.\n\n    Inferior 1 [process 12974] will be detached.\n\nQuit anyway? (y or n) y\n```\n\n```\nrr ps\nPID PPID    CMD\n12974   --  wine ./ddb-bench.exe\n12976   12974   /usr/bin/wineserver\n12977   12976   (forked without exec)\n12978   12974   (forked without exec)\n12979   12978   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\system32\\wineboot.exe --init\n12980   12979   (forked without exec)\n12981   12980   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\system32\\winemenubuilder.exe -a -r\n12982   12979   (forked without exec)\n12983   12982   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\system32\\services.exe\n12986   12983   (forked without exec)\n12987   12986   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe\n12989   12981   (forked without exec)\n12990   12989   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\system32\\explorer.exe /desktop\n12998   12983   (forked without exec)\n12999   12998   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\system32\\winedevice.exe MountMgr\n13007   12983   (forked without exec)\n13008   13007   /usr/bin/wine-preloader /usr/bin/wine C:\\windows\\system32\\plugplay.exe\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1687/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1660", "title": "Give 'info checkpoints' the option of sorting by time", "body": "This would be very helpful for producing a timeline while debugging.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1660/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1555", "title": "Support data tracing", "body": "When using reverse watch points I find that I commonly need to follow a chain of data flow. This involves the following steps:\n1. Set a reverse watchpoint\n2. reverse-continue to the watchpoint\n3. read the code to see where the data was copied from\n4. set a reverse watchpoint on the source\n5. reverse-continue\n6. goto 3\n\nIf there are a lot of intermediate stages this process can be pretty tedious and potentially error prone (especially when debugging optimized code). It would be nice to automate this. A possible implementation would be as follows:\n- When a reverse watchpoint is hit look at the current instruction. This will give us a source register that is being stored in memory.\n- reverse single step backwards looking at each instruction to see if it loads into or otherwise modifies the source register\n- if we find a register that loads into the source register from memory set a reverse watchpoint on the address that we're loading from.\n\nIt seems like it should be possible to implement this as a python extension to gdb\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1555/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1495", "title": "Assertion `DETERMINISTIC_SIG == deterministic' failed.", "body": "I was able to get this by recording Firefox with a lower cpu event count.\n\ni.e. -c 5000\n\nrr: /home/jrmuizel/src/rr/src/ReplaySession.cc:481: TrapType ReplaySession::compute_trap_type(Task*, int, SignalDeterministic, ReplaySession::ExecStateType, const ReplaySession::StepConstraints&): Assertion `DETERMINISTIC_SIG == deterministic' failed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1495/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/18025804", "body": "FIWW, the gdb in Ubuntu has been updated to 7.11.1 now so updating gdb should be easier now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18025804/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}, "bennofs": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2015", "title": "reverse-stepi stepping more than one instruction", "body": "If I run reverse-stepi after running to a certain event with `rr replay -g`, then I've got a situation where `reverse-stepi` steps more than one instruction:\r\n\r\n```\r\n(rr) disas\r\nDump of assembler code for function core::slice::from_raw_parts<u8>:\r\n   0x000056197ad5aab0 <+0>:\tpush   %rbp\r\n   0x000056197ad5aab1 <+1>:\tmov    %rsp,%rbp\r\n   0x000056197ad5aab4 <+4>:\tmov    %rdi,-0x40(%rbp)\r\n   0x000056197ad5aab8 <+8>:\tmov    %rsi,-0x38(%rbp)\r\n   0x000056197ad5aabc <+12>:\tmov    -0x40(%rbp),%rax\r\n   0x000056197ad5aac0 <+16>:\tmov    %rax,-0x30(%rbp)\r\n   0x000056197ad5aac4 <+20>:\tmov    -0x38(%rbp),%rax\r\n   0x000056197ad5aac8 <+24>:\tmov    %rax,-0x28(%rbp)\r\n   0x000056197ad5aacc <+28>:\tmov    -0x30(%rbp),%rax\r\n   0x000056197ad5aad0 <+32>:\tmov    -0x28(%rbp),%rcx\r\n   0x000056197ad5aad4 <+36>:\tmov    %rax,-0x20(%rbp)\r\n   0x000056197ad5aad8 <+40>:\tmov    %rcx,-0x18(%rbp)\r\n   0x000056197ad5aadc <+44>:\tmov    -0x20(%rbp),%rax\r\n=> 0x000056197ad5aae0 <+48>:\tmov    -0x18(%rbp),%rcx\r\n   0x000056197ad5aae4 <+52>:\tmov    %rax,-0x10(%rbp)\r\n   0x000056197ad5aae8 <+56>:\tmov    %rcx,-0x8(%rbp)\r\n   0x000056197ad5aaec <+60>:\tmov    -0x10(%rbp),%rax\r\n   0x000056197ad5aaf0 <+64>:\tmov    -0x8(%rbp),%rdx\r\n   0x000056197ad5aaf4 <+68>:\tmov    %rax,-0x48(%rbp)\r\n   0x000056197ad5aaf8 <+72>:\tmov    %rdx,-0x50(%rbp)\r\n   0x000056197ad5aafc <+76>:\tmov    -0x48(%rbp),%rax\r\n   0x000056197ad5ab00 <+80>:\tmov    -0x50(%rbp),%rdx\r\n   0x000056197ad5ab04 <+84>:\tpop    %rbp\r\n   0x000056197ad5ab05 <+85>:\tretq   \r\nEnd of assembler dump.\r\n(rr) reverse-stepi\r\n\r\nThread 1 received signal SIGINT, Interrupt.\r\ncore::slice::{{impl}}::index<u8> (self=..., slice=...) at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/slice.rs:708\r\n708\tin /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/slice.rs\r\n(rr) disas\r\nDump of assembler code for function core::slice::{{impl}}::index<u8>:\r\n   0x000056197ad5b040 <+0>:\tpush   %rbp\r\n   0x000056197ad5b041 <+1>:\tmov    %rsp,%rbp\r\n   0x000056197ad5b044 <+4>:\tsub    $0x90,%rsp\r\n   0x000056197ad5b04b <+11>:\tmov    (%rdi),%rax\r\n   0x000056197ad5b04e <+14>:\tmov    %rax,-0x58(%rbp)\r\n   0x000056197ad5b052 <+18>:\tmov    0x8(%rdi),%rax\r\n   0x000056197ad5b056 <+22>:\tmov    %rax,-0x50(%rbp)\r\n   0x000056197ad5b05a <+26>:\tmov    %rsi,-0x48(%rbp)\r\n   0x000056197ad5b05e <+30>:\tmov    %rdx,-0x40(%rbp)\r\n   0x000056197ad5b062 <+34>:\tmov    -0x58(%rbp),%rax\r\n   0x000056197ad5b066 <+38>:\tmov    -0x50(%rbp),%rcx\r\n   0x000056197ad5b06a <+42>:\tmov    %rax,-0x38(%rbp)\r\n   0x000056197ad5b06e <+46>:\tmov    %rcx,-0x30(%rbp)\r\n   0x000056197ad5b072 <+50>:\tmov    -0x48(%rbp),%rax\r\n   0x000056197ad5b076 <+54>:\tmov    -0x40(%rbp),%rcx\r\n   0x000056197ad5b07a <+58>:\tmov    %rax,-0x28(%rbp)\r\n   0x000056197ad5b07e <+62>:\tmov    %rcx,-0x20(%rbp)\r\n   0x000056197ad5b082 <+66>:\tmov    -0x38(%rbp),%rax\r\n   0x000056197ad5b086 <+70>:\tcmp    -0x30(%rbp),%rax\r\n   0x000056197ad5b08a <+74>:\tjbe    0x56197ad5b099 <core::slice::{{impl}}::index<u8>+89>\r\n   0x000056197ad5b08c <+76>:\tmov    -0x38(%rbp),%rdi\r\n   0x000056197ad5b090 <+80>:\tmov    -0x30(%rbp),%rsi\r\n   0x000056197ad5b094 <+84>:\tcallq  0x56197af5c380 <core::slice::slice_index_order_fail>\r\n=> 0x000056197ad5b099 <+89>:\tmov    -0x30(%rbp),%rax\r\n   0x000056197ad5b09d <+93>:\tmov    -0x28(%rbp),%rdi\r\n   0x000056197ad5b0a1 <+97>:\tmov    -0x20(%rbp),%rsi\r\n   0x000056197ad5b0a5 <+101>:\tmov    %rax,-0x60(%rbp)\r\n---Type <return> to continue, or q <return> to quit---q\r\nQuit\r\n(rr) stepi\r\n\r\nThread 1 received signal SIGINT, Interrupt.\r\n0x000056197ad5aae0 in core::slice::from_raw_parts<u8> (p=0x56197af69140 <str.V> \"raw_capacity overflowraw_cap overflow\\000\", len=0) at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/slice.rs:2161\r\n2161\tin /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/slice.rs\r\n(rr) \r\n\r\nThread 1 received signal SIGKILL, Killed.\r\n0x000056197ad5aae0 in core::slice::from_raw_parts<u8> (p=0x56197af69140 <str.V> \"raw_capacity overflowraw_cap overflow\\000\", len=0) at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/slice.rs:2161\r\n2161\tin /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/slice.rs\r\n(rr) \r\n[Inferior 1 (process 26877) exited normally]\r\n(rr) \r\n```\r\n\r\nIf you need more information, please tell me what is necessary.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "aaptel": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/2013", "title": "Assertion while recording `ret == -ENOENT || ret == -ENODEV || ret == -ENOTBLK || ret == -EINVAL' failed to hold.  unknown quotactl(0x5805)", "body": "Me again unfortunately with another smbd issue. Recording fails with this assertion failure (using latest git 1022e348 ):\r\n\r\n    [FATAL /home/aaptel/prog/rr/rr.git/src/record_syscall.cc:5009:rec_process_syscall_arch() errno: SUCCESS] \r\n     (task 28255 (rec:28255) at time 61003)\r\n     -> Assertion `ret == -ENOENT || ret == -ENODEV || ret == -ENOTBLK || ret == -EINVAL' failed to hold.  unknown quotactl(0x5805)\r\n    Launch gdb with\r\n      gdb '-l' '10000' '-ex' 'target extended-remote :28255' /tmp/smb/sbin/smbd\r\n\r\n\r\nSteps to reproduce:\r\n\r\n\r\n    git clone git://git.samba.org/samba.git samba\r\n    cd samba\r\n    ./buildtools/bin/waf configure -C -j8 \\\r\n                                        --disable-cups --enable-selftest --with-libarchive  \\\r\n                                        --enable-debug --picky-developer \\\r\n                                        --enable-developer \\\r\n                                        --bundled-libraries=ALL \\\r\n                                        --prefix=/tmp/smb/ \\\r\n                                        --localstatedir=/tmp/smbstate\r\n    ./buildtools/bin/waf build -j8\r\n    ./buildtools/bin/waf install\r\n    rm -rf /tmp/share\r\n    mkdir -p /tmp/share\r\n    chmod 777 /tmp/share\r\n    cat <<EOF > /tmp/smb/etc/smb.conf\r\n    [global]\r\n    logging = ringbuf\r\n    log level = 0\r\n     \r\n    [share]\r\n    path = /tmp/share\r\n    read only = no\r\n    guest ok = yes\r\n    EOF\r\n    for i in $(seq 100 9000); do\r\n        echo ABC${i}DEF > /tmp/share/${i}xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\r\n    done\r\n\r\n\r\nas root:\r\n\r\n    rr record /tmp/smb/sbin/smbd -i\r\n\r\nin other shell:\r\n\r\n    /tmp/smb/bin/smbclient //localhost/share -U% -c ls\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/2013/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/2014", "title": "add support for XFS quotactl(Q_XGETQSTAT...", "body": "fixes #2013 \r\n\r\nthanks to @khuey for the hints\r\n", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "ojura": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1991", "title": "Support rewinding to event in the same process, or via breakpoints", "body": "Currently, the `run [event_number]` command terminates the existing process, and spawns a new one. Some IDE gdb-based debuggers (e.g.: CLion) detect this and immediately detach, which causes the rr server to shut down (see also #1990). This is unfortunate if reaching the bug event takes a long time, so we would like to avoid shutting down the rr server.\r\n\r\nA workaround for this would be either to introduce a version of the `run` command which rewinds inside the existing process, or, to [quote](https://mail.mozilla.org/pipermail/rr-dev/2017-February/000461.html) @rocallahan, to do this by setting an event-based breakpoint:\r\n\r\n> I think the right solution here might be a special rr command to go to\r\n> a specific event number by issuing a special command that sets a\r\n> breakpoint at that event number and then continuing in the correct\r\n> direction. I don't think that would be very hard to do at this point,\r\n> at least if you don't mind stopping if a regular breakpoint/watchpoint\r\n> is hit along the way, and you stay in the same process.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1991/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1990", "title": "Missing tests for persisting the debug server after detaching", "body": "It would be great if there was an option (perhaps called ``--persist``) which would enable rr to remain running after the gdb client detaches. This would be very handy when debugging an application where the bug appears a long time into the execution of the application, so we can keep rr running the whole time, with the debugged application being held frozen at the interesting event. When starting the next debug session, we could immediately start debugging by just connecting to the already running server, without having to wait for execution to reach the bug event.\r\n\r\nFor example:\r\n\r\n```\r\n# this takes a long time\r\n$ rr replay --dbgport 50505 -g 600000 --persist\r\n\r\n# after the bug event has been reached, open gdb:\r\n$ gdb application_image\r\n# assume that the rr gdbinit has been sourced\r\n(rr) target extended-remote :50505\r\n\r\n# ...do debugging...\r\n\r\n# rr server currently quits when doing this!\r\n(rr) detach\r\n(rr) quit\r\n\r\n# the debug server and the debugged application are still\r\n# working, so we can run gdb again, and we continue where\r\n# we left off in the last debugging session, without having \r\n# to wait again for execution to reach the event 600 000\r\n$ gdb application_image\r\n(rr) target extended-remote :50505\r\n\r\n# ...do some more debugging...\r\n(rr) detach\r\n(rr) quit\r\n```", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1990/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1989", "title": "Support saving and loading checkpoints to/from hard disk", "body": "This feature request was inspired by a scenario in which I had to debug an application where the bug occurs after a long time into the execution (in my example 20 minutes). I figured out the exact event number (around 600 000). Each time when I want to start debugging, I start rr with `-g 600000` and go grab a cup of coffee until the application execution reaches the interesting event. Once rr reaches this event, I can normally use forward and backward execution for debugging. The kicker is, I can always restart to the interesting event with `run 600000`, and I won't have to wait for long because rr can intelligently rewind to this event.\r\n\r\nThe feature request is the following: could I save the state of the application at the 600 000th event to a snapshot, and tell rr to load that snapshot on startup, instead of waiting for rr to run the application from beginning?\r\n\r\nBetter yet, rr could maintain a list of saved snapshots in a trace, and automatically choose the closest one when `run` is called, in order to minimize the time that the user will have to wait for the execution to reach that event. The workflow would look something like this:\r\n\r\n```\r\n# this takes 20 minutes\r\n$ rr record app\r\n\r\n# this also takes 20 minutes\r\n$ rr replay -g 600000\r\n\r\n(rr) save snapshot\r\nCreated snapshot at event 600000.\r\n(rr) quit\r\n\r\n# this time rr figures out that it has a snapshot,\r\n# so this is more or less instantaneous\r\n$ rr replay -g 600000 \r\n\r\n# ...do debugging...\r\n(rr) quit\r\n\r\n# The next time we start a debugging session, we decide \r\n# to go a little further back in time:\r\n$ rr replay -g 550000 \r\n# this is also significantly faster, because rr chooses \r\n# the nearest snapshot (in this case 600000), and replays\r\n# backwards from there\r\n```", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1989/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "yuyichao": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1985", "title": "Assertion failure after stackoverflow.", "body": "The following simple program triggers a stack overflow assuming a stack limit is set (default).\r\n\r\n```c\r\nvoid *global;\r\n\r\n__attribute__((noinline)) void f(void)\r\n{\r\n    void *buff[1024];\r\n    buff[0] = global;\r\n    global = buff;\r\n    asm volatile (\"\" :: \"r\"(buff) : \"memory\");\r\n    f();\r\n}\r\n\r\nint main()\r\n{\r\n    f();\r\n    return 0;\r\n}\r\n```\r\n\r\nDuring replay of this, if I access `$_siginfo` right after the segfault happens, rr fails with an assertion error.\r\n\r\n```\r\nReading symbols from /lib64/ld-linux-x86-64.so.2...(no debugging symbols found)...done.\r\n0x00007f7596254d70 in _start () from /lib64/ld-linux-x86-64.so.2\r\n(rr) c\r\nContinuing.\r\nwarning: Could not load shared library symbols for linux-vdso.so.1.\r\nDo you need \"set solib-search-path\" or \"set sysroot\"?\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x00000000004004d5 in f ()\r\n(rr) p $_siginfo\r\n$1 = {si_signo = 11, si_errno = 0, si_code = 1, _sifields = {_pad = {-1090681984, 32765,\r\n      0 <repeats 26 times>}, _kill = {si_pid = -1090681984, si_uid = 32765}, _timer = {\r\n[FATAL /build/rr-git/src/rr/src/Task.cc:2103:read_bytes_helper() errno: EIO]\r\n (task 15897 (rec:15865) at time 0)\r\n -> Assertion `false' failed to hold. Should have read 15 bytes from 0x7ffdbefd8371, but only read 0\r\n      si_tid = -1090681984, Launch gdb with\r\n  gdbsi_overrun = 32765, si_sigval = { '-l' '10000' '-ex' 'target extended-remote :15897' /home/yuyichao/.local/share/rr/latest-trace/mmap_clone_3_segfault\r\nsival_int = 0,\r\n        sival_ptr = 0x0}}, _rt = {si_pid = -1090681984, si_uid = 32765, si_sigval = {\r\n        sival_int = 0, sival_ptr = 0x0}}, _sigchld = {si_pid = -1090681984, si_uid = 32765,\r\n      si_status = 0, si_utime = 0, si_stime = 0}, _sigfault = {si_addr = 0x7ffdbefd8380,\r\n      _addr_lsb = 0, _addr_bnd = {_lower = 0x0, _upper = 0x0}}, _sigpoll = {\r\n      si_band = 140727807738752, si_fd = 0}}}\r\n```\r\n\r\nc.c. @Keno \r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1985/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1740", "title": "catch exec not working during replay", "body": "Not sure if this is a gdb issue or an rr issue but I get the following error when trying to catch the `exec` during replay.\n\n```\n(rr) catch exec\nCatchpoint 1 (exec)\n(rr) c\nContinuing.\nwarning: Error inserting catchpoint 1: Your system does not support this type\nof catchpoint.\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1740/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1738", "title": "Option to expose more than one CPU", "body": "Currently rr seems to be overwriting the number of CPU cores as 1. This means the libraries that use the CPU core number to determine the number of threads to use will only start one thread, making it harder to debug race conditions. It would be nice to have an option to overwrite the number of CPU cores seen by the process being recorded.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1738/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/77d94f5db970408e8c9009afc04b63f2b9952d3f", "message": "Fix AMD cpuid detection."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/70ac5b8e31fc07400de4bbc115530396c4829e3c", "message": "Fix release build\n\nraw_fd is 4bytes so the target register needs to be 4bytes too."}], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/16544547", "body": "Ooops, thanks. I opened the [doc](http://en.cppreference.com/w/cpp/types/make_unsigned) for exactly this but forgot to actually add it in the end...............\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/16544547/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": []}, "Keno": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1984", "title": "Intermittent failure in `mutex_pi_stress`", "body": "Just saw this on Anubis:\r\n```\r\n[FATAL /data/keno/rr/src/RecordSession.cc:1506:process_syscall_entry() errno: SUCCESS]\r\n (task 50829 (rec:50829) at time 20260)\r\n -> Assertion `t->desched_rec() || is_rrcall_notify_syscall_hook_exit_syscall( t->regs().original_syscallno(), t->arch()) || t->ip() == t->vm() ->privileged_traced_syscall_ip() .increment_by_syscall_insn_length(t->arch())' failed to hold.\r\n[FATAL /data/keno/rr/src/log.cc:289:emergency_debug() errno: SUCCESS] (session doesn't look interactive, aborting emergency debugging)\r\n```\r\n\r\nSeems like we also saw this on the KNL buildbot: https://ci.rr-project.org/#/builders/4/builds/93/steps/9/logs/stdio\r\n```\r\n[FATAL /home/rrbuildbot/rr-knl-baremetal/build/rr/src/RecordSession.cc:1508:process_syscall_entry() errno: SUCCESS]\r\n (task 228422 (rec:228422) at time 46702)\r\n -> Assertion `t->desched_rec() || is_rrcall_notify_syscall_hook_exit_syscall( t->regs().original_syscallno(), t->arch()) || t->ip() == t->vm() ->privileged_traced_syscall_ip() .increment_by_syscall_insn_length(t->arch())' failed to hold.\r\n[FATAL /home/rrbuildbot/rr-knl-baremetal/build/rr/src/log.cc:289:emergency_debug() errno: SUCCESS] (session doesn't look interactive, aborting emergency debugging)\r\n```", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1984/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1963", "title": "What do to about timeouts on the new buildbots", "body": "I've looked at the last couple of failures on the buildbots and a lot of them seem to be legitimate timeouts. I suspect what is happening is that two long-running tests get randomly assigned to the same CPU core, and the core isn't fast enough to get both done in the timeout window. Options I see\r\n- Just raise the timeout (not ideal, because a lot of rr bugs only manifest themselves as timeouts)\r\n- Somehow get ctest to tell rr which core to pin to\r\n- Have the rr instances coordinate to pick cores\r\n- Reduce parallelism when running the tests (Though I should point out that it's already only using 2/3 of the KNL because of this issue).\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1957", "title": "Useless counter now harmful on KNL", "body": "I originally wrote the KNL patch against a KNL running a Cray-ified version of Linux. However, on (recent) mainline kernels, the useless counter kicks off our actual counting events from the PMU, causing tick mismatches. I assume cray didn't write their own version of the KNL PMU allocation code, so this is probably a regression since some earlier version of mainline. It would be good to identify which.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1915", "title": "Filter out terminal queries when replaying", "body": "A bit of work, but it would be nice to filter out escape codes that cause the terminal to generate artificial data on stdin (e.g. `\\e[5n` or activation of mouse mode). Since the replaying process is not actually reading from stdin, this data just ends up in the output.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1915/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1908", "title": "flock test fails on lustrefs", "body": "```\r\n> $HOME/rr-build/bin/rr record $HOME/rr-build/bin/flock\r\nrr: Saving execution to trace directory `/global/homes/k/kfischer/.local/share/rr/flock-7'.\r\nparent pid is 61556\r\nsizeof(flock) = 32\r\nbefore lock: type: 2, pid: 0\r\n  after lock: type: 0, pid: 61556\r\nsizeof(flock64) = 32\r\nbefore lock: type: 2, pid: 0\r\n  after GETLK: type: 1, pid: 61556\r\nP: forcing child to block on LK, sleeping ...\r\nFAILED: errno=4 (Interrupted system call)\r\nflock: /global/homes/k/kfischer/rr/src/test/flock.c:98: main: Assertion `\"FAILED: !\" && check_cond(0 == err)' failed.\r\nP: ... awake, releasing lock\r\nFAILED: errno=0 (Success)\r\nflock: /global/homes/k/kfischer/rr/src/test/flock.c:120: main: Assertion `\"FAILED: !\" && check_cond(((((__extension__ (((union { __typeof(status) __in; int __i; }) { .__in = (status) }).__i))) & 0x7f) == 0) && 0 == ((((__extension__ (((union { __typeof(status) __in; int __i; }) { .__in = (status) }).__i))) & 0xff00) >> 8))' failed.\r\nAborted\r\n> stat --file-system --format=%T .\r\nlustre\r\n```\r\nWorks fine without rr as well as with `-n`.\r\nMount options are `rw,flock,lazystatfs` in case it makes a difference.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1821", "title": "Breakpointing/JIT", "body": "I've encountered the following issue. Suppose we set a breakpoint in JITted code. We will look at the value that is there, write the breakpoint byte and continue. Later, we come back and restore the byte that we read. However, in the mean time the JIT could have come along and modified the code, causing the written back value to no longer be the value that was actually supposed to be there. Of course this is also an issue for plain old gdb, but it's somewhat more problematic for rr, because in reverse mode, it can easily happen that rr goes back to before the jitted code was there, but still wants to set a breakpoint (vs. regular debugging where such an operation makes little sense since we don't know what code will be there a priori).\n\nMethods that I can think of by which JITs allocate modify executable memory:\n1. `/proc/self/mem`/`process_vm_writev`.\n2. Dual mapping with one RX and one RW page.\n3. RWX pages\n\nFor 1., I think a simple check in the relevant code path to update any breakpoint would be sufficient. 2&3 are more tricky. We'd probably have to detect this situation in the address space code and do the appropriate dance to disable writing/executing in lock step (i.e. when executing writing is disabled, but we catch that trap, flip the permissions, and do the same thing vice versa once we get back to executing). This could be sped up by using hardware breakpoints, though of course those are a limited resource.\n\nThoughts?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1821/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1778", "title": "Recording WINE is slow", "body": "Continuing from our IRC conversation, there is significant overhead to recording WINE. E.g.:\n\n```\n$ time wineconsole ./usr/bin/julia.exe -e 'quit()'\nreal    0m0.976s\nuser    0m0.006s\nsys 0m0.010s\n\n$ time ~/rr-build/bin/rr record wineconsole ./usr/bin/julia.exe -e 'quit()'\nreal    0m42.874s\nuser    0m32.998s\nsys 0m10.637s\n```\n#1777 has helped some, but unfortunately this is after (before it was 2x this). Most of the time is spent in rr. This workload appears notable in that it frequently descheds in `read` for synchronization purposes (requests made to the `wineserver`).\n\nA flamegraph of the whole execution tree is available here: \nhttps://gist.github.com/Keno/c1ec0b7f22ccb585d378ddf0e03cd426\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1778/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1638", "title": "\"Cannot call functions in reverse mode.\"", "body": "Maybe this is wishful thinking, but I was hoping to be able to set a conditional breakpoint during reverse-continue. Unfortunately gdb complains that it `\"Cannot call functions in reverse mode.\"`. I don't particularly care that it be fast, but it would be nice if there was some way that this could be made work.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1638/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/dbf9388c96681c3546c7b99bc9f9486bdddba89b", "message": "Fix RR_BUILD_SHARED build"}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1da22c9ad515eb670c39cb1b7cd496b215e02739", "message": "When building librr.so, tell CMake to set rpath on install\n\nThis is required when attempting to install an rr built with librr.so,\ninto a global prefix (executing from the build directory worked find\neven without this change)."}], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/1954", "title": "In new CPU binding code, use cpuset.effective_cpus", "body": "`cpuset.cpus` is the user configurable maximum setting for the current cgroup,\r\n`cpuset.effective_cpus` is the actual CPUs that members of this cgroup can run\r\non (e.g. if the cpus are restricted by parents or siblings).\r\n\r\ncc @yuyichao ", "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/1754", "title": "Early WIP: rr/sampling profiler hybrid", "body": "This is an idea I've been kicking around. When doing sampling profiling, you really want to minimize the amount of work you do while sampling in order for it to a) be fast and b) not disrupt the program too much. Unfortunately this is of course in direct conflict with actually collecting anything useful. What I'm proposing here is to use rr to do the actual data collection as a post-processing step. The way this is done is to sample the current ip and the value of the retired branch counter, thus hopefully allowing us to find this position again during replay and do whatever we want to do (backtrace, collect values, more fancy things, etc...).\n\nThis is nowhere near done, but I figured people may have early feedback.\n", "author_association": "CONTRIBUTOR"}], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/17606806", "body": "\ud83d\udc4d I was thinking about doing this myself. \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17606806/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17669464", "body": "This test fails for me in the 32bit case:\n\n```\nLoaded symbols for /lib/ld-linux.so.2\n0xf77990d0 in ?? () from /lib/ld-linux.so.2\n(rr) handle SIGKILL stop\nSignal        Stop  Print   Pass to program Description\nSIGKILL       Yes   Yes Yes     Killed\n(rr) c\nContinuing.\nEXIT-SUCCESS\n\nProgram received signal SIGKILL, Killed.\n0x70000002 in ?? ()\n(rr) reverse-continue\nContinuing.\n\n[Thread 4001.4001] #1 stopped.\n0xf77990d0 in ?? () from /lib/ld-linux.so.2\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17669464/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17686745", "body": "Yup!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17686745/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17686875", "body": "Hmm, not sure what else you changed (or maybe I changed something in my environment?) but after pulling master `reverse_step_threads_break-no-syscallbuf` now takes 26 `reverse-step`s. Should I submit a PR to bump the number or is that worth investigating?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17686875/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17966337", "body": "Not sure I understand this part.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17966337/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976678", "body": "I don't understand why. CLONE_VFORK by itself only affects scheduling not memory sharing as far as I know.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976678/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976742", "body": "Right, so I see why you would unset CLONE_VFORK (since the schedule is already recorded), but not why you would then set CLONE_VM if it wasn't there in the recording.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976742/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/17976916", "body": "If it's in the man page somebody will have used it, even if by mistake.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17976916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/18080725", "body": "the compiler is unhappy about this:\n\n```\n/home/kfischer/rr/src/record_syscall.cc:2494:54: error: typename specifier refers to non-type member 'flock' in 'rr::X86Arch'\n          syscall_state.reg_parameter<typename Arch::flock>(3, IN_OUT);\n                                      ~~~~~~~~~~~~~~~^~~~~\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18080725/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/18086740", "body": "Yes, it's clang.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18086740/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/18087129", "body": "Yep, builds for me as well.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18087129/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/18957899", "body": "This breaks the `when` test, which relies on `when` terminating a diversion.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18957899/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19103231", "body": "Is there a test we could add that would have triggered this?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19103231/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19153757", "body": "I'm seeing cases were `0xCF` pops up in what is supposed to be the xsave hardware reserved area (416-463)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19153757/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19154250", "body": "I have a fix. PR incoming.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19154250/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19177391", "body": "I see this test fail intermittently.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19177391/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19177669", "body": "```\n162: /home/keno/rr-vanilla/src/test/util.sh: line 219: 18804 Aborted                 (core dumped) _RR_TRACE_DIR=\"$workdir\" rr $GLOBAL_OPTIONS replay -a $replayflags > replay.out 2> replay.err\n162: Test 'intr_ppoll' FAILED: : error during replay:\n162: --------------------------------------------------\n162: [FATAL /home/keno/rr-vanilla/src/ReplaySession.cc:454:check_pending_sig() errno: SUCCESS]\n162:  (task 18805 (rec:17612) at time 239)\n162:  -> Assertion `0 < t->stop_sig()' failed to hold. Replaying `SIGNAL: SIGCHLD(async)': expecting tracee signal or trap, but instead at `rt_sigprocmask' (ticks: 42902)\n162: [FATAL /home/keno/rr-vanilla/src/log.cc:283:emergency_debug() errno: SUCCESS] (session doesn't look interactive, aborting emergency debugging)\n162: --------------------------------------------------\n162: replay.out:\n162: --------------------------------------------------\n162: iteration 0\n162: --------------------------------------------------\n162: Test intr_ppoll failed, leaving behind /tmp/rr-test-intr_ppoll-gmeHmxhaS\n162: To replay the failed test, run\n162:   _RR_TRACE_DIR=/tmp/rr-test-intr_ppoll-gmeHmxhaS rr replay\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19177669/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19512369", "body": "\ud83d\udc4d Thanks for fixing this!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19512369/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19512448", "body": "Missing `daemon_read.run`?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19512448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19567167", "body": "This semicolon placement is a little odd\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19567167/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19850381", "body": "Sounds like a bug to me. Are the KVM folks aware of this? Won't of course help us avoid the workaround, but would be nice for that to be fixed.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19850381/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993377", "body": "`syscall_state.expect_errno = EINVAL;` instead?\r\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993377/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993405", "body": "`(or -1 if not available on this hardware/kernel)`.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993405/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993432", "body": "Mask off the upper bits here? I believe cpuid ignores them, but the checks below do not.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993432/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19993762", "body": "Wouldn't that be an argument for just passing it through to the kernel as is, to make sure we don't alter behavior here (Not that too many people other than rr will be using this, but still).", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19993762/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/19994133", "body": "To some degree this whole project is an exercise in pedantry about kernel interfaces ;)", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19994133/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/20459952", "body": "@khuey Any news on your kernel patch?", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/20459952/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/20479500", "body": "How would we be relying on ~READ_IMPLIES_EXEC?", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/20479500/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/20479527", "body": "It's automatically set by the kernel if the executable has executable stacks (happens by accident quite a bit).", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/20479527/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/21715593", "body": "I have a system where $TMPDIR is a network file system :( (/tmp is not though). This is gonna cause problems there. Can we at least have an RR env variable to control its tempdir (don't want to override TMPDIR for the application I'm recording).", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/21715593/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/21723989", "body": "Thanks.", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/21723989/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119600", "body": "ReplayTimeline unapplies all breakpoints, but only reapplies those it knows about (which does not include the internal ones).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119727", "body": "To skip setting the breakpoint if it is already set (to make sure there's only one add/remove pair for this breakpoint).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62119727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120355", "body": "Ok, will do it that way instead.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120355/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120647", "body": "What if adding the breakpoint fails?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120647/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120771", "body": "Cool, makes sense.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62120771/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62121132", "body": "I'm not sure (I though so too). This may have just hidden a different bug that I fixed completely later. I'll remove it and run the test suite to see if it works.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62121132/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62124356", "body": "You are correct. It appears unnecessary.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62124356/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251393", "body": "That would be a good sanity check, but I don't think there ever should be a situation where they don't? I'll try adding it as an assertion and see what happens.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62251393/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62257697", "body": "Done (and no new test failures).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62257697/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255539", "body": "Yes, you are correct.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62255539/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256155", "body": "Yes, that's the intent. This is essentially a helper function. I should probably make it static.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256155/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256256", "body": "Seems reasonable to me to require that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62256256/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62257059", "body": "Yes, that's a different function (in the next commit). This function is the one that recreates the shared mapping upon a clone. It is simpler since we don't have to remap the region to be able to copy it's data.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62257059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62258423", "body": "There were a number of cases where syscallbuf_hdr was accessed after the child mapping was unmapped. I didn't get to look into whether any of those were necessary. If they are not, I think replacing syscallbuf_hdr is feasible. There is still a question of whether it is desirable, since we access it as a data structure in a number of places. It might make sense to have some template magic that allows transparent access to a data structure through a remote_ptr. Not sure. Will have to look into this more.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/62258423/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65013994", "body": "The reason this was in Task.h was because both RecordTask and Task need it. I'll look into making it just return the pointer though, in which case, I can move it out of Task.h.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65013994/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65738665", "body": "The concern I have is that, say somebody expands the mapping using remap. If we keep the local mapping, then it'll be shorter than the new remote mapping. Perhaps we should just clear the local address in an mremap? \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65738665/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65784871", "body": "Ok, I'll make it so changing the local mapping is the caller's responsibility and clear the mapping in remap. We can iterate on how to update local mappings later.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/65784871/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/66159470", "body": "Got it, thanks.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/66159470/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75243728", "body": "Oops, sorry - languages where this can happen are not my bread and butter anymore, so I keep making these mistakes ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/75243728/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78082875", "body": "Nope, I just copied this code from one of the tests and forgot to remove it ;). Will fix.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78082875/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/82539709", "body": "I had thought about that, but I didn't think anything that would get mapped there would actually get a local mapping. However, to be safe, we could add an extra flag similar to `IS_SYSCALLBUF`. \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/82539709/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/84619063", "body": "Not that I can tell, though I didn't really try (only whatever is done by default).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/84619063/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85471739", "body": "Right, I suppose that there could be concurrent write to the same file descriptor. Though, frankly if that happens, we probably already have problems right now, since the order in which the data is written depends on how the kernel happens to acquire the relevant looks, so is non-deterministic from our point of view. Making such mappings `PREVENT_SWITCH` seems best, if only for that consideration.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85471739/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85471868", "body": "Fine with me either way. Seems a little odd from a layering perspective, but I don't have a strong opinion.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85471868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85472213", "body": "I should write a make target that runs clang-format and clang-tidy on my most recent commit ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/85472213/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87477688", "body": "The boolean argument indicates whether to lock or not, so this locks only for `PTRACE_SYSCALL, PTRACE_SYSEMU, PTRACE_SYSEMU_SINGLESTEP` and unlocks for detach (and `PTRACE_CONT`).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87477688/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87480298", "body": "Can I claim doing most of my work in 1-based languages as an excuse ;)?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/87480298/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "chandlerc": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1955", "title": "When using RR with gdb 7.12.1 to debug the 'opt' binary in LLVM I get weird errors:", "body": "I have a buggy binary, it assert fails:\r\n\r\n```\r\n% rr record ./dbg/bin/opt -S -passes=inline,argpromotion -o - /home/chandlerc/src/llvm.git/test/Transforms/ArgumentPromotion/crash.ll                                                                                                                                                      \r\nrr: Saving execution to trace directory `/home/chandlerc/.local/share/rr/opt-1'.\r\nopt: ../../lib/Analysis/LazyCallGraph.cpp:1692: void llvm::LazyCallGraph::removeDeadFunction(llvm::Function &): Assertion `RC.Parents.empty() && \"Cannot have parents of a dead RefSCC!\"' failed.\r\n#0 0x00000000043275bc llvm::sys::PrintStackTrace(llvm::raw_ostream&) /home/chandlerc/src/llvm.git/build/dbg/../../lib/Support/Unix/Signals.inc:402:11\r\n#1 0x0000000004327ba9 PrintStackTraceSignalHandler(void*) /home/chandlerc/src/llvm.git/build/dbg/../../lib/Support/Unix/Signals.inc:466:1\r\n#2 0x00000000043246e7 llvm::sys::RunSignalHandlers() /home/chandlerc/src/llvm.git/build/dbg/../../lib/Support/Signals.cpp:0:5\r\n#3 0x0000000004327f30 SignalHandler(int) /home/chandlerc/src/llvm.git/build/dbg/../../lib/Support/Unix/Signals.inc:256:1\r\n#4 0x00007f586a086030 __restore_rt (/lib64/libpthread.so.0+0x11030)\r\n#5 0x0000000070000002\r\nStack dump:\r\n0.      Program arguments: ./dbg/bin/opt -S -passes=inline,argpromotion -o - /home/chandlerc/src/llvm.git/test/Transforms/ArgumentPromotion/crash.ll \r\nzsh: abort      rr record ./dbg/bin/opt -S -passes=inline,argpromotion -o - \r\n```\r\n\r\nWhen I go to replay:\r\n```\r\n% rr replay                                                                                                                          \r\nGNU gdb (Gentoo 7.12.1 vanilla) 7.12.1\r\nCopyright (C) 2017 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-pc-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<https://bugs.gentoo.org/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from /home/chandlerc/.local/share/rr/latest-trace/mmap_clone_4_opt...done.\r\nReally redefine built-in command \"restart\"? (y or n) [answered Y; input not from terminal]\r\n>>> >>> >>> >>> ... ... >>> ... ... >>> ... ... ... \r\n>>> \r\nRemote debugging using :33958\r\nwarning: unable to open /proc file '/proc/33946/task/33946/maps'\r\nwarning: remote target does not support file transfer, attempting to access files from local filesystem.\r\nReading symbols from /lib64/ld-linux-x86-64.so.2...(no debugging symbols found)...done.\r\n0x00007f586a292bc0 in ?? () from /lib64/ld-linux-x86-64.so.2\r\n(rr) bt\r\n#0  0x00007f586a292bc0 in ?? () from /lib64/ld-linux-x86-64.so.2\r\n#1  0x0000000000000006 in ?? ()\r\n#2  0x00007ffcf349d7b9 in ?? ()\r\n#3  0x00007ffcf349d7c7 in ?? ()\r\n#4  0x00007ffcf349d7ca in ?? ()\r\n#5  0x00007ffcf349d7e6 in ?? ()\r\n#6  0x00007ffcf349d7e9 in ?? ()\r\n#7  0x00007ffcf349d7eb in ?? ()\r\n#8  0x0000000000000000 in ?? ()\r\n(rr) r\r\n0x00007f586a292bc3 in ?? () from /lib64/ld-linux-x86-64.so.2\r\nThe program being debugged has been started already.\r\nStart it from the beginning? (y or n) y\r\nStarting program: /home/chandlerc/.local/share/rr/opt-1/mmap_clone_4_opt \r\nwarning: unable to open /proc file '/proc/33946/task/33946/maps'\r\n\r\nProgram stopped.\r\n0x00007f586a292bc0 in ?? () from /lib64/ld-linux-x86-64.so.2\r\n(rr) bt\r\n#0  0x00007f586a292bc0 in ?? () from /lib64/ld-linux-x86-64.so.2\r\n#1  0x0000000000000006 in ?? ()\r\n#2  0x00007ffcf349d7b9 in ?? ()\r\n#3  0x00007ffcf349d7c7 in ?? ()\r\n#4  0x00007ffcf349d7ca in ?? ()\r\n#5  0x00007ffcf349d7e6 in ?? ()\r\n#6  0x00007ffcf349d7e9 in ?? ()\r\n#7  0x00007ffcf349d7eb in ?? ()\r\n#8  0x0000000000000000 in ?? ()\r\n(rr) q\r\n```\r\n\r\nRR version is master `9961466`.\r\n\r\nAdding `RR_LOG=GdbConnection` based on what was suggested in another issue shows (in a gist due to size): https://gist.github.com/8d4ab83290063fc74b08f68c3181d8a7\r\n\r\nLet me know if I can provide more details!", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1955/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "petermayo": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1933", "title": "rr stopped working with chromium (or vice versa, as you prefer)", "body": "As a side effect of the following change:\r\n[https://codereview.chromium.org/2569413002](https://codereview.chromium.org/2569413002)\r\n\r\nchromium under rr on linux stopped showing contents and started just displaying a blue field less a rectangle in each corner.\r\n\r\nThe change referenced was submitted 2016-12-14 20:42:54 UTC.  It changes the handling of GPU support under single process mode (very useful for debugging with rr or gdb).\r\n\r\nI suspect chromium is now using some calls that aren't supported in rr.\r\n\r\nrr version 4.4.0, Ubuntu 14.04.1\r\n\r\nI haven't built rr from source to check that this hasn't been fixed already (yet)", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "jdm": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1905", "title": "Concurrent rr recordings behave worse than serialized ones", "body": "STR:\r\n1. clone https://github.com/servo/servo/\r\n2. run `./mach build --release`\r\n3. run `./mach test-wpt --release --chaos --processes 1 tests/wpt/mozilla/tests/mozilla/referrer-policy/no-referrer/http-rp/same-origin/http-http/iframe-tag/`\r\n4. 3 tests should finish running without incident, then the set of tests will be repeated until an unexpected result is found. Let it run at least once more, then interrupt it.\r\n5. run `./mach test-wpt --release --chaos --processes 2 tests/wpt/mozilla/tests/mozilla/referrer-policy/no-referrer/http-rp/same-origin/http-http/iframe-tag/`\r\n\r\nExpected:\r\nThe tests should take less time to run, and no unexpected timeouts should be encountered.\r\n\r\nActual:\r\n```\r\n  \u25b6 TIMEOUT [expected OK] /_mozilla/mozilla/referrer-policy/no-referrer/http-rp/same-origin/http-http/iframe-tag/generic.no-redirect.http.html\r\n  \u2502\r\n  \u2502 VMware, Inc.\r\n  \u2502 Gallium 0.4 on softpipe\r\n  \u2514 3.3 (Core Profile) Mesa 12.0.1\r\n```", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1484", "title": "Reverse execution doesn't work in gud-gdb", "body": "http://www.gnu.org/software/emacs/manual/html_node/emacs/Debugger-Operation.html#Debugger-Operation\n\nThis is different from regular `M-x gdb` mode in that it doesn't use the machine interface to gdb. It works quite well for `rr replay -s 9999`, except that any attempt to perform reverse execution on my traces yields:\n\n```\n(gdb) rn\nWarning:\nCannot insert breakpoint -17.\nCannot access memory at address 0x2aaaab10bb30\nCannot insert breakpoint -21.\nCannot access memory at address 0x2aaaab6acd60\n\ndl_main (phdr=<optimized out>, phdr@entry=0x400040, phnum=<optimized out>, phnum@entry=9, \n    user_entry=user_entry@entry=0x7fffffffde88, auxv=<optimized out>) at rtld.c:1592\n1592    in rtld.c\n```\n\nwhereas it works perfectly on the same recording when executed in gdb via `rr replay`:\n\n```\nBreakpoint 1, on_recv_data (conn=0x6182d0) at mongoose.c:4828\n4828        printf(\"Error reported while handling request.\\n\");\n(gdb) rn\n4827      if (error_flag) {\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1484/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18592971", "body": "I thought the majority of the archer branch was merged into gdb 6.something.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18592971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}], "commit_comments": [], "review_comments": []}, "SeanHeelan": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1894", "title": "Assertion fails while reverse-continuing after setting watchpoint", "body": "Hey,\r\n\r\nWhile trying to reverse continue after setting a watchpoint I get the following error: \r\n\r\n```rr: /home/sean/Documents/git/rr/rr/src/ReplayTimeline.cc:213: void rr::ReplayTimeline::mark_after_singlestep(const rr::ReplayTimeline::Mark&, const rr::ReplayResult&): Assertion `i + 1 < mark_vector.size() && mark_vector[i + 1] == m.ptr' failed.```\r\n\r\nOn a similar issue I saw you requested the output with RR_LOG=GdbConnection set, so I've gathered that and you can find it at https://gist.github.com/SeanHeelan/a424c20e0d63c255755a6205174daaee\r\n\r\nI am using the latest version from the master branch (1a1663373f8a4ca0d2c27e7a8c14cc35d642c93d), on Fedora 24 with a 4.8.4 kernel. The target application is a variant of the klee symbolic execution engine. \r\n\r\nIf you need any further details let me know!", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1894/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "toddmgreer": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1873", "title": "Assertion `!syscallbuf_child' failed to hold. Should not already have syscallbuf initialized!", "body": "I'm just starting to try rr. When running rr record on an integration test, it hits the following error: \"Assertion `!syscallbuf_child' failed to hold. Should not already have syscallbuf initialized!\". From my test's logs, it looks like this happens when my test is trying to start a subprocess.\r\n\r\nI can avoid this error by giving rr record the -n (--no-syscall-buffer) option, but then my test fails--it starts a subprocess and tries to read from it with recvmsg, but isn't getting anything (though the subprocess is still  alive). I don't know whether this is a consequence of the -n option, or just the next issue triggered by running under rr. (The test runs successfully without rr.)\r\n\r\nUbuntu 14.04 LTS\r\nIntel\u00ae Xeon(R) CPU E5-1650 0 @ 3.20GHz \u00d7 12\r\nrr version 4.4.0 installed following the rr site's Ubuntu instructions.\r\n\r\nWhat information can I provide to help debug this issue (or these two issues)?", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1873/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "bddicken": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1853", "title": "Reproducible assertion failure in check_ticks_consistency", "body": "I am running into an internal rr assertion failure. The program I originally ran into this assertion failure on is a bit more complicated, but I have boiled it down to a smaller example:\n\n``` c\n  1 #include <stdio.h>\n  2 \n  3 #define SIZE 97\n  4 \n  5 int main () {\n  6   int result;\n  7   int ia[SIZE];\n  8   int i = 0;\n  9   int some_number = 1234;\n 10 \n 11   printf(\"begin\\n\");\n 12 \n 13   for (i = 0; i < SIZE; ++i) {\n 14     ia[i] = some_number;\n 15   }\n 16 \n 17   result = ia[SIZE-10];\n 18   printf(\"result = %d\\n\", result);\n 19 \n 20   return 0;\n 21 }\n```\n\nI am using `gcc -g -O0 source01.c -o a.out` (gcc version 4.8.4) to compile the program, and I am running rr 4.4.0. I compile the program, run `rr record ./a.out`, and run `rr replay`. Then, run the following sequence of commands:\n\n```\nbreak source01.c:18\ncontinue\nwatch -l result\nreverse-cont\n```\n\nI get the following error from the `reverse-cont`:\n\n```\n[FATAL /home/roc/rr/rr/src/ReplaySession.cc:847:check_ticks_consistency() errno: SUCCESS] \n (task 32134 (rec:32128) at time 124)\n -> Assertion `ticks_now == trace_ticks' failed to hold. ticks mismatch for 'SYSCALL: mprotect'; expected 19400, got 19401\nLaunch gdb with \n  gdb '-l' '-1' '-ex' 'target extended-remote :32134' /home/bddicken/.local/share/rr/latest-trace/mmap_hardlink_3_a.out\n```\n\nGetting this error is reproducible as well. Interestingly, I tried several values for `SIZE` of 97 and above (97, 98, 99, 100) and I get this error for all of those values. I also tried several values less than 97 (96, 88, 75, 50) and I do _not_ get this assertion error for any of those values. Perhaps this has something to do with it. \n\nI see issues #1734 and #1771 report similar-looking errors. However, both of those issues remain open, and this error is slightly different.\n\nCan someone else reproduce this? And does anyone know of a solution? Thanks.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1853/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "ejpbruel": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1841", "title": "Replay diverges", "body": "Steps to reproduce:\n1. Create a recording with rr, performing the following steps:\n  a. Open a recent build of Firefox Nightly.\n  b. Open the webconsole\n  c. Evaluate the following string in the webconsole:\n\n```\nvar iframe = document.createElement('iframe');\niframe.sandbox = 'allow-scripts';\niframe.src = 'data:text/html,<!doctype html><script>'\n    + 'var f = function(){}; f.a=1; console.log(f);<\\/script>';\ndocument.body.appendChild(iframe);\n```\n\n  d. Click on the logged function in the console\n  e. Close Firefox Nightly.\n\n(see bug https://bugzilla.mozilla.org/show_bug.cgi?id=1281875 for details)\n1. Replay the recording with rr.\n2. Set a breakpoint in DebuggerObject::getOwnPropertyNames (Debugger.cpp:9718)\n3. Continue the replay.\n\nExpected results:\nThe breakpoint should trigger when we click on the logged function in the console.\n\nActual results:\nI get the following error:\n[ERROR /home/ejpbruel/Projects/rr/src/ReplaySession.cc:507:guard_overshoot() errno: SUCCESS] Replay diverged; target registers mismatched: \n[FATAL /home/ejpbruel/Projects/rr/src/ReplaySession.cc:511:guard_overshoot() errno: SUCCESS]\n\nNote: unlike the previous issue I opened, I made sure to do pull from the rr repo and do a fresh build first. The version of rr I'm using is currently 4.4.0.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1841/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "janisozaur": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1835", "title": "Release mode means no asserts", "body": "Hi,\nI just noticed in [release notes for 4.4.0](https://github.com/mozilla/rr/releases/tag/4.4.0) this bit:\n\n> Compile releases with `CMAKE_BUILD_TYPE=Release` for improved performance.\n\nI just wanted to check you are aware it means `-O3 -D_NDEBUG` which will disable all asserts and perhaps other checks in the code, which in the past have been reported and fixed. CMake also has `RelWithDebInfo` build type, which is `-O2 -g -DDEBUG` and may perhaps be better suited.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477610", "body": "This is in header file, but not `inline static`, is that correct?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477610/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "danilocesar": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1824", "title": "rr doesn't work with Clutter apps", "body": "I'm not sure why it happens, but rr fails with all applications using clutter.\n\nThe following code built with:\n**gcc clutter.c -o clutterapp `pkg-config clutter-1.0 --cflags --libs`**\n\n```\n#include <clutter/clutter.h>\n#include <stdlib.h>\n\nint main(int argc, char *argv[]) {\n    clutter_init(&argc, &argv);\n\n    ClutterColor stage_color = { 0, 0, 0, 255 };\n\n    ClutterActor *stage = clutter_stage_get_default();\n    clutter_actor_set_size(stage, 512, 512);\n    clutter_stage_set_color(CLUTTER_STAGE(stage), &stage_color);\n    clutter_actor_show(stage);\n\n    clutter_main();\n\n    return EXIT_SUCCESS;\n}\n```\n\nIt fails to grab a GL context\n(clutterapp:5165): Clutter-CRITICAL **: Unable to initialize Clutter: Unable to initialize the Clutter backend: no available drivers found.\n\nAll other clutter apps I tried failed for what seems to be a related reason.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1824/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "stepthom": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1818", "title": "make test fails for most tests on a Parallels VM", "body": "I didn't see Parallels either way on list of supported VMs on the wiki page (https://github.com/mozilla/rr/wiki/Building-And-Installing), so I'm not sure if I'm barking up the wrong tree by trying to use `rr` in Parallels... \n\nI'm running Parallels 9. I have PMU virtualization enabled. Guest OS is Ubuntu 14.04. I cloned the HEAD of `rr`'s `master` branch, currently b0ae677d36dd4fcbbef41be0c01f45ee657e11b8. Built fine, but `make test` is failing for most the tests:\n\n```\n[dev@ubuntu:~/rr/obj (master)] $ make test\nRunning tests...\nTest project /home/dev/rr/obj\n        Start   1: 64bit_child\n  1/1832 Test   #1: 64bit_child ...............................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.36 sec\n        Start   2: 64bit_child-no-syscallbuf\n  2/1832 Test   #2: 64bit_child-no-syscallbuf .................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.35 sec\n        Start   3: _llseek\n  3/1832 Test   #3: _llseek ...................................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.24 sec\n        Start   4: _llseek-no-syscallbuf\n  4/1832 Test   #4: _llseek-no-syscallbuf .....................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.25 sec\n        Start   5: accept\n  5/1832 Test   #5: accept ....................................................   Passed    0.33 sec\n        Start   6: accept-no-syscallbuf\n  6/1832 Test   #6: accept-no-syscallbuf ......................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.30 sec\n        Start   7: alarm\n  7/1832 Test   #7: alarm .....................................................***Failed  Error regular expression found in output. Regex=[FAILED]  1.27 sec\n        Start   8: alarm-no-syscallbuf\n  8/1832 Test   #8: alarm-no-syscallbuf .......................................***Failed  Error regular expression found in output. Regex=[FAILED]  1.24 sec\n        Start   9: alarm2\n  9/1832 Test   #9: alarm2 ....................................................***Failed  Error regular expression found in output. Regex=[FAILED]  1.24 sec\n        Start  10: alarm2-no-syscallbuf\n 10/1832 Test  #10: alarm2-no-syscallbuf ......................................***Failed  Error regular expression found in output. Regex=[FAILED]  1.23 sec\n        Start  11: alsa_ioctl\n 11/1832 Test  #11: alsa_ioctl ................................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.23 sec\n        Start  12: alsa_ioctl-no-syscallbuf\n 12/1832 Test  #12: alsa_ioctl-no-syscallbuf ..................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.24 sec\n        Start  13: arch_prctl\n 13/1832 Test  #13: arch_prctl ................................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.23 sec\n        Start  14: arch_prctl-no-syscallbuf\n 14/1832 Test  #14: arch_prctl-no-syscallbuf ..................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.26 sec\n        Start  15: async_segv_ignored\n 15/1832 Test  #15: async_segv_ignored ........................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.25 sec\n        Start  16: async_segv_ignored-no-syscallbuf\n 16/1832 Test  #16: async_segv_ignored-no-syscallbuf ..........................   Passed    0.16 sec\n        Start  17: at_threadexit\n 17/1832 Test  #17: at_threadexit .............................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.31 sec\n        Start  18: at_threadexit-no-syscallbuf\n 18/1832 Test  #18: at_threadexit-no-syscallbuf ...............................***Failed  Error regular expression found in output. Regex=[FAILED]  0.27 sec\n        Start  19: bad_ip\n 19/1832 Test  #19: bad_ip ....................................................   Passed    0.17 sec\n        Start  20: bad_ip-no-syscallbuf\n 20/1832 Test  #20: bad_ip-no-syscallbuf ......................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.24 sec\n        Start  21: bad_syscall\n 21/1832 Test  #21: bad_syscall ...............................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.24 sec\n        Start  22: bad_syscall-no-syscallbuf\n 22/1832 Test  #22: bad_syscall-no-syscallbuf .................................***Failed  Error regular expression found in output. Regex=[FAILED]  0.23 sec\n        Start  23: barrier\n```\n\nIf I look in `Testing/Temporary/LastTest.log.tmp`, I see things like:\n\n```\nStart testing: Sep 21 12:13 EDT\n----------------------------------------------------------\n1/1832 Testing: 64bit_child\n1/1832 Test: 64bit_child\nCommand: \"/bin/bash\" \"/home/dev/rr/src/test/basic_test.run\" \"-b\" \"/home/dev/rr\" \"/home/dev/rr/obj\" \"64bit_child\"\nDirectory: /home/dev/rr/obj\n\"64bit_child\" start time: Sep 21 12:13 EDT\nOutput:\n----------------------------------------------------------\n/home/dev/rr/src/test/util.sh: line 219: 18001 Aborted                 (core dumped) _RR_TRACE_DIR=\"$workdir\" rr $GLOBAL_OPTIONS replay -a $replayflags > replay.out 2> replay.err\nTest '64bit_child' FAILED: : error during replay:\n--------------------------------------------------\n[FATAL /home/dev/rr/src/ReplaySession.cc:847:check_ticks_consistency() errno: SUCCESS]\n (task 18002 (rec:17999) at time 104)\n -> Assertion `ticks_now == trace_ticks' failed to hold. ticks mismatch for 'SYSCALL: open'; expected 3086, got 4294970382\n[FATAL /home/dev/rr/src/log.cc:283:emergency_debug() errno: SUCCESS] (session doesn't look interactive, aborting emergency debugging)\n--------------------------------------------------\nreplay.out:\n--------------------------------------------------\n--------------------------------------------------\nTest 64bit_child failed, leaving behind /tmp/rr-test-64bit_child-P3OscNkkp\nTo replay the failed test, run\n  _RR_TRACE_DIR=/tmp/rr-test-64bit_child-P3OscNkkp rr replay\n<end of output>\nTest time =   0.36 sec\n----------------------------------------------------------\nTest Fail Reason:\nError regular expression found in output. Regex=[FAILED]\n\"64bit_child\" end time: Sep 21 12:13 EDT\n\"64bit_child\" time elapsed: 00:00:00\n----------------------------------------------------------\n```\n\nThe output of `perf list` is:\n\n```\n[dev@ubuntu:~/rr/obj (master)] $ perf list\n\nList of pre-defined events (to be used in -e):\n  cpu-cycles OR cycles                               [Hardware event]\n  instructions                                       [Hardware event]\n  cache-references                                   [Hardware event]\n  cache-misses                                       [Hardware event]\n  branch-instructions OR branches                    [Hardware event]\n  branch-misses                                      [Hardware event]\n  bus-cycles                                         [Hardware event]\n  stalled-cycles-frontend OR idle-cycles-frontend    [Hardware event]\n  ref-cycles                                         [Hardware event]\n\n  cpu-clock                                          [Software event]\n  task-clock                                         [Software event]\n  page-faults OR faults                              [Software event]\n  context-switches OR cs                             [Software event]\n  cpu-migrations OR migrations                       [Software event]\n  minor-faults                                       [Software event]\n  major-faults                                       [Software event]\n  alignment-faults                                   [Software event]\n  emulation-faults                                   [Software event]\n  dummy                                              [Software event]\n\n  L1-dcache-load-misses                              [Hardware cache event]\n  L1-dcache-store-misses                             [Hardware cache event]\n  L1-dcache-prefetch-misses                          [Hardware cache event]\n  L1-icache-load-misses                              [Hardware cache event]\n  LLC-loads                                          [Hardware cache event]\n  LLC-stores                                         [Hardware cache event]\n  LLC-prefetches                                     [Hardware cache event]\n  dTLB-load-misses                                   [Hardware cache event]\n  dTLB-store-misses                                  [Hardware cache event]\n  iTLB-loads                                         [Hardware cache event]\n  iTLB-load-misses                                   [Hardware cache event]\n  branch-loads                                       [Hardware cache event]\n  branch-load-misses                                 [Hardware cache event]\n\n  branch-instructions OR cpu/branch-instructions/    [Kernel PMU event]\n  branch-misses OR cpu/branch-misses/                [Kernel PMU event]\n  bus-cycles OR cpu/bus-cycles/                      [Kernel PMU event]\n  cache-misses OR cpu/cache-misses/                  [Kernel PMU event]\n  cache-references OR cpu/cache-references/          [Kernel PMU event]\n  cpu-cycles OR cpu/cpu-cycles/                      [Kernel PMU event]\n  instructions OR cpu/instructions/                  [Kernel PMU event]\n  mem-loads OR cpu/mem-loads/                        [Kernel PMU event]\n  mem-stores OR cpu/mem-stores/                      [Kernel PMU event]\n  stalled-cycles-frontend OR cpu/stalled-cycles-frontend/ [Kernel PMU event]\n\n  rNNN                                               [Raw hardware event descriptor]\n  cpu/t1=v1[,t2=v2,t3 ...]/modifier                  [Raw hardware event descriptor]\n   (see 'man perf-list' on how to encode it)\n\n  mem:<addr>[:access]                                [Hardware breakpoint]\n\n  [ Tracepoints not available: Permission denied ]\n```\n\nAlso:\n\n```\n[dev@ubuntu:~/rr/obj (master)] $ dmesg | grep PMU\n[    5.040752] Performance Events: PEBS fmt1+, 16-deep LBR, IvyBridge events, full-width counters, Intel PMU driver.\n[    5.253574] NMI watchdog: enabled on all CPUs, permanently consumes one hw-PMU counter.\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1818/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "bgirard": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1806", "title": "History command isn't reliable", "body": "I've been testing the history feature a bit more and I'm finding that it's not very reliable.\n\n```\nBreakpoint 1, breakpointA (i=0) at /home/bgirard/ben/rr-dev/rr/src/test/history.c:6\n6     int break_here = 1;\n(rr) si\n8   }\n(rr) back\n(rr) frame\n#0  breakpointA (i=0) at /home/bgirard/ben/rr-dev/rr/src/test/history.c:8\n```\n\nback should undo the step instruction. AFAIK we're getting pushing a mark properly for history.c:6 on 'si' and then poping it and calling seek_to_mark to on it.\n\nIs the any gotcha or something I should look into to debug this?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1806/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1651", "title": "Add checkpoint push/pop command", "body": "checkpoint push - Push an anonymous checkpoint and add it to a checkpoint stack\ncheckpoint pop - Restore to the current top of the checkpoint stack and pop\ninfo checkpoint stack - (optional) List the current checkpoint stack\n\nHaving the above command would make it easier to build user define commands that need change the program state. For instance I'd like to have something like to make it easier to debug reftest:\n\n```\ndefine show frame tree\n  checkpoint push\n  <goto prev refresh driver tick>\n  print \"Current:\"\n  call frame->DumpFrameTree()\n  <goto next refresh driver tick>\n  print \"Next:\"\n  call frame->DumpFrameTree()\n  checkpoint pop\nend\n```\n\nIf we think it's a good idea I can build a PR for this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1644", "title": "Frequent RR hangs when running mozilla' GTest suite", "body": "Running the following in a loop causes a lot of hangs either on startup or shutdown making it hard to 'run until failure'. I get the hangs after about 5 or 10 cycles.\n\n$ ./mach gtest --debugger=rr '--debugger-args= record -M -V' APZCBasicTester.Fling\n\nRunning it without RR I'm able to see 100 cycle without any hang.\n\nI don't see any activity happening. Here's the process tree:\n\n```\n        \u2502      \u2514\u2500sshd\u2500\u2500\u2500sshd\u2500\u2500\u2500bash\u2500\u2500\u2500run.sh\u2500\u252c\u2500python2.7\u2500\u2500\u2500rr\u2500\u252c\u2500firefox\u2500\u252c\u2500firefox\n        \u2502                                    \u2502                \u2502         \u251c\u2500{Gecko_IOThread}\n        \u2502                                    \u2502                \u2502         \u251c\u2500{Hang Monitor}\n        \u2502                                    \u2502                \u2502         \u251c\u25005*[{JS Helper}]\n        \u2502                                    \u2502                \u2502         \u251c\u2500{JS Watchdog}\n        \u2502                                    \u2502                \u2502         \u251c\u2500{Link Monitor}\n        \u2502                                    \u2502                \u2502         \u2514\u2500{Socket Thread}\n        \u2502                                    \u2502                \u251c\u2500{compress data_h}\n        \u2502                                    \u2502                \u251c\u25003*[{compress data}]\n        \u2502                                    \u2502                \u251c\u2500{compress events}\n        \u2502                                    \u2502                \u251c\u2500{compress mmaps}\n        \u2502                                    \u2502                \u2514\u2500{compress tasks}\n        \u2502                                    \u2514\u2500tee\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1644/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1634", "title": "Intermittent string_instructions_replay[-32-no-syscallbuf] (on host teenux)", "body": "I ran 'make check -j12' twice and seem to be getting intermittent test in either string_instructions_replay or string_instructions_replay-32-no-syscallbuf.\n\nBoth failures include:\n\n```\n1268: Test 'string_instructions_replay_32' FAILED: : error during recording:\n1268: --------------------------------------------------\n1268: [FATAL /home/bgirard/rr/src/AutoRemoteSyscalls.cc:137:syscall_helper() errno: 0 'Success'] \n1268:  (task 17816 (rec:17816) at time 14)\n1268:  ->  Assertion `t->regs().ip() - callregs.ip() == syscall_instruction_length(t->arch())' failed to hold. Should have advanced ip by one syscall_insn\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1634/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1629", "title": "Allowing setting a breakpoint on rr event bondaries", "body": "This would be helpful for making sure that you don't leave the interesting part of a replay (a particular reftest).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1629/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1624", "title": "Implement a 'history' command", "body": "Had a quick discussion with @jrmuizel about low hang fruits. We came up with 'history'.\n\nWhen debugging it's easy to get lost. Say you set a bp and you continue but that breakpoint is not hit and instead you hit an early return. You've lost your state. Breaking at the previous line might get you back to another invocation of that function.\n\nBy creating automatic 'anonymous' checkpoint every time we give a (rr) prompt we can implement the following command:\n\n'back': Jump back to the previous state\n'forward': Jump forward in history:\n'history': show your history, something like this:\nSteps Where\n-1   MyFunc.c:12\n0    MyFunc.c:13\n1    MyFunc.c:17\n2   Helper.c:1\n\nThis should be trivial to implement on top of my PR #1621.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1624/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1622", "title": "Can't set x=y 'Attempt to write memory outside diversion session'", "body": "I'm trying to intentionally diverge from a replay by tweaking a variable but I get the following error:\nAttempt to write memory outside diversion session\n\nI did some searches online and just found roc' blog:\nhttp://robert.ocallahan.org/2014/09/rr-20-released.html\n\nIt seems you can diverge for 'call' but not 'set'.\n\nIdeally I'd like to do something like this:\ndiversion start\nset shouldPrint = true\ncont\n<...>\ndiversion end\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1622/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1330", "title": "Create librr bindings", "body": "I'd like to propose librr. The goal of the library should be to expose a stable interface to rr to allow building front end tools without depending on the low level implementation of rr.\n\nThis would allow people to easy prototype various front-ends for rr. Particularly since rr style debugging is so new and there's no canonical interface.\n\nFor instance I'd like to experiment using rr + sample profiling. rr would provide a way to step through samples after the profile recording is completed. librr in this case would provide a way to load the replay and jump to a specific point in the program to start debugging.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1330/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/1814", "title": "flushregs on RRCmds because they can invalidate the GDB caches", "body": "What do you think about this fix?\n\nhttps://sourceware.org/gdb/onlinedocs/gdb/Maintenance-Commands.html\n\nWe might get hit later by another cache but so far this seems to work ok.\n\nI wrote a testcase to make sure we do the right thing when hitting the end of the program and we don't. I've added it as a todo for now.\n", "author_association": "CONTRIBUTOR"}], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/18957905", "body": "It was merged early. PR #1798 will address this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/18957905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/50851531", "body": "Yes, I plan on submitting that soon. I just wanted to make sure we were ok with this before I rebased my changes.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/50851531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51201192", "body": "If I understand correctly I think this will make the code worse:\n1. Not all commands will need private access to GdbServer. Some commands might just need their private storage tied to the lifetime of GdbServer which we can give them a better way to get that. (I'm not sure if we plan on having multiple GdbServer instances or not).\n2. I think this will make readability worse. Having a list of friend class in GdbServer is easy to understand. Its more difficult to understand why we're templating GdbCommandImpl and generating code just to save a few simple repetitive 'friend class' lines.\n3. Later if we need to we can define virtual attribute functions for GdbCommand that behave differently in some way. Example could be later add 'virtual bool SupportsDiversion()' and then easily let commands opt into supporting diversion session. With templates we'd have to keep adding more and more to the template arguments and/or use traits.\n\nI don't think making this change is worth it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51201192/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51202330", "body": "Your first comment is pointer at auto_args. This feature is used to have gdb automatically populate arguments. For instance getting the location of the current frame is much easier to do from gdb than it is from GdbServer since we don't have access to the symbolication features. In the checkpoint commands we're going to automatically populate a 'where' argument invisible to the user.\n\nThe auto parse is unrelated to the auto_args. I think in insights it wasn't worth writing the auto parse code for it. But now that it all works I do think it's nice. It gives us a easy way to and consistent way to validate arguments and produce errors. If we go with parse_to_tuple it will really look like this for every command:\nstd::string error_msg;\nif (auto args = parse_to_tuple<T1, T2, ...>(args, error_msg)) {\n   ....\n} else {\n  return error_msg;\n}\nBotond originally wrote the code out for variable argument parsing but I decided to leave that out since it was pretty complicated. Reverting this means well lose the central validation logic/consistent error messages and we'll get to drop the DispatchTo code.\n\nDo you still think we should drop this? I feel less strongly about this one.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51202330/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51483574", "body": "Yes, so that point is a wash for either solution.\n\nAnyways it's not important to the PR so I'm just going to split out these parts and rebase on top of what's already landed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51483574/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51483697", "body": "I'll split this out of the pull request too. I have to leave the auto_args stuff however since it's important to give good context for info checkpoint. That part is important to this PR.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/51483697/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78123054", "body": "I think it's a bit subjective. If you assume diversion are short-lived to perhaps evaluate a quick value, then yes you'd want no side effects. If longer running diversion are more typical then it make sense to consider consider that a 'navigation', clear the forward stack, and set the current mark as undefined.\n\nBut I don't use diversion with RR so I don't really know. I'll update the patch to have no side effects for now and I'm sure we will notice if that behavior is not good and we can change it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/78123054/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79747638", "body": "I was thinking about it but we need to have add attributes for commands (or hardcode this in). I though it might of been premature optimization at this point given how rarely commands were used and we don't really know this is costly. But I don't mind doing it now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/79747638/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "dbaron": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1785", "title": "can't run GPU-accelerated Firefox or Firefox WebGL under rr", "body": "On 2 different machines, I've been unable to run accelerated Firefox or run any WebGL in Firefox under rr.\n\nIn particular:\n- if I have a Firefox profile with <code>user_pref(\"layers.acceleration.force-enabled\", true)</code> in the prefs.js file, I can't start Firefox\n- if I run a WebGL test, WebGL isn't available\n\nSo far I've tracked down the underlying problem to something that happens in the glxtest process that Firefox fork()s to learn about the X server's capabilities in a process that is allowed to risk crashing.\n\nIn Firefox not running under rr, I see the output of that process as:\n\"VENDOR\\nNVIDIA Corporation\\nRENDERER\\nQuadro NVS 295/PCIe/SSE2\\nVERSION\\n3.3.0 NVIDIA 304.131\\nTFP\\nTRUE\\n\"\nwhereas when running under rr, the output is:\n\"X error occurred in GLX probe, error_code=2, request_code=154, minor_code=3\\n\"\n\nThis difference leads to the above symptoms.\n\nThe latter output happens as a result of the x_error_handler function being called here:\n\n```\n#0  0x00007f6ee91b949c in x_error_handler(Display*, XErrorEvent*) (ev=0x7ffd1db13a50)\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/toolkit/xre/glxtest.cpp:102\n#1  0x00007f6ef3e7bc4d in _XError (dpy=dpy@entry=0xbb80e0, rep=rep@entry=0xba04a0) at ../../src/XlibInt.c:1429\n#2  0x00007f6ef3e78ad7 in handle_error (dpy=0xbb80e0, err=0xba04a0, in_XReply=<optimized out>) at ../../src/xcb_io.c:213\n#3  0x00007f6ef3e78b95 in handle_response (dpy=dpy@entry=0xbb80e0, response=0xba04a0, in_XReply=in_XReply@entry=1) at ../../src/xcb_io.c:325\n#4  0x00007f6ef3e79b50 in _XReply (dpy=dpy@entry=0xbb80e0, rep=rep@entry=0x7ffd1db13c10, extra=extra@entry=0, discard=discard@entry=1)\n    at ../../src/xcb_io.c:627\n#5  0x00007f6ef3e7548d in XSync (dpy=0xbb80e0, discard=0)\n    at ../../src/Sync.c:44\n#6  0x00007f6ee39d59e3 in  () at /usr/lib/nvidia-304-updates/libGL.so.1\n#7  0x00007f6ee39c9301 in glXCreateContext ()\n    at /usr/lib/nvidia-304-updates/libGL.so.1\n#8  0x00007f6ee91ba52c in glxtest() ()\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/toolkit/xre/glxtest.cpp:248\n#9  0x00007f6ee91ba6ef in fire_glxtest_process() ()\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/toolkit/xre/glxtest.cpp:333\n#10 0x00007f6ee91b15de in XREMain::XRE_mainInit(bool*) (this=this@entry=0x7ffd1db144a8, aExitFlag=aExitFlag@entry=0x7ffd1db14430)\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/toolkit/xre/nsAppRunner.cpp:3052\n#11 0x00007f6ee91b6b74 in XREMain::XRE_main(int, char**, nsXREAppData const*) (this=this@entry=0x7ffd1db144a8, argc=argc@entry=4, argv=argv@entry=0x7ffd1db15898, aAppData=aAppData@entry=0x7ffd1db146b8)\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/toolkit/xre/nsAppRunner.cpp:4424\n#12 0x00007f6ee91b6f26 in XRE_main(int, char**, nsXREAppData const*, uint32_t) (argc=4, argv=0x7ffd1db15898, aAppData=0x7ffd1db146b8, aFlags=<optimized out>)\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/toolkit/xre/nsAppRunner.cpp:4535\n#13 0x000000000040496c in do_main(int, char**, char**, nsIFile*) (argc=argc@entry=4, argv=argv@entry=0x7ffd1db15898, envp=envp@entry=0x7ffd1db158c0, xreDirectory=0xba14e0)\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/browser/app/nsBrowserApp.cpp:259\n#14 0x0000000000404101 in main(int, char**, char**) (argc=4, argv=0x7ffd1db15898, envp=0x7ffd1db158c0)\n    at /home/dbaron/builds/ssd/mozilla-central/mozilla/browser/app/nsBrowserApp.cpp:392\n```\n\nwhich I presume doesn't happen when not running rr, since I don't see the output that results from it being called.\n\nI'm not sure what would be useful to debug next.\n\nNote that I see the first symptom (being unabled to run accelerated Firefox) on 2 different machines, though I've only checked the WebGL symptom on my desktop (which is also where I did the debugging above).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1785/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "sidkshatriya": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1775", "title": "Possible to do \"incremental\" record/replay?", "body": "I would like to use rr replay on a recording that is still continuing i.e. the trace is not fully saved yet and the program has not yet ended.\n\nBasically I want to use rr to go backward in time. But when I am going forward, normal execution (which gets recorded) happens. Is this possible? Maybe an experimental mode or a switch? (When I try to replay on a recording that is still under progress I get an error).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1775/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1768", "title": "Consistently getting Assertion `tp` failed error ", "body": "I have conditional breakpoint that looks something like this:\n\n```\ngdb> break xyz.c:99 if strcmp(\"some-string-here\", buf) == 0\ngdb> continue\n```\n\nI consistently get the following error during playback of a recording:\n\n```\n/build/gdb-cXfXJ3/gdb-7.11.1/gdb/thread.c:89: internal-error: inferior_thread: Assertion `tp' failed.\nA problem internal to GDB has been detected,\nfurther debugging may prove unreliable.\n```\n\nI'm on ubuntu 16.04 and rr (3db52cd5 from Aug 4) runs with a 100% pass rate when I do a `make test`. I'm using the system gdb (`GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1`).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1768/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1692", "title": "`reverse-continue N` does not work and quirk with `continue N`", "body": "_Issue with reverse-continue N_\nWhen I type in `reverse-continue 9`, gdb says:\n\n```\n(rr) reverse-continue 9\nWill ignore next 8 crossings of breakpoint 1.  Continuing.\n```\n\nThis does not seem to work as advertised. `reverse-continue` without any numerical argument works though.\n\n (I'm using gdb client 7.11)\n\n_Quirk with continue N_\nNote that `continue 10` works properly in the forward direction. But there is a caveat here: If I am already on a breakpoint (that I expect will be hit 10 times in the future) I need to do\n\n`continue` followed by `continue 9`\n\nIf I just say `continue 10` (without the initial argument-less continue) gdb says:\n\n```\n(rr) continue 10\nNot stopped at any breakpoint; argument ignored.\nContinuing.\n```\n\nI'm on a very recent commit of rr  ( 46abf2959278e58bab9aa8e9dad2be380276756a )\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1692/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1691", "title": "Going to an event nearby should not have to restart execution during replay", "body": "Lets say I type:\n\n```\nrun 20000\n```\n\ngdb asks me if I want to restart execution from the beginning: i.e.\n\n```\nThe program being debugged has been started already.\nStart it from the beginning? (y or n) y\n```\n\nAfter waiting for a bit:\n\n```\n--------------------------------------------------\n ---> Reached target process 42895 at event 20001.\n--------------------------------------------------\n```\n\nNow if I say `run 20010`, gdb asks me I _again_ I should start from the beginning. Why is that? Is it not possible for rr to replay 10 more events instead of all the way from the beginning?\n\nOr maybe there is some other syntax I need to enter in the gdb client?\n\nMy overall motivation is that I would like to use event numbers to do most of my analysis. I have some mappings from event numbers to \"interesting\" parts of my program ( #1688 ). Also I have a huge number of events and doing the replay from the very start will make `rr` extremely slow for me.\n\nNow I may want to go forward in the number of events or even backward (e.g. `run 19990` ). With forward, I can imagine `rr` should be able to just replay 10 more events. In the case of going backward I would probably need to do some checkpointing perhaps.\n\nSo basically\n- How to efficiently run forward a few events\n- How to efficiently run backward a few events\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1691/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1688", "title": "Create a separate file for associating rr events with arbitrary strings (-M on steroids)", "body": "The `-M` switch for `rr record` is very useful in associating stdio output with rr event numbers.\n\nHowever, while the output `[rr pid event-number]` being prepended is useful, I would like something more advanced: I want to be able to save such associations in a custom file and not mix it with stdio. \n\nMy goal is to build a machine readable file associating event ids with some string output (and write a script/program to read that back later)\n\nSo if I want to do something like (in my tracee code)\n\n```\nfprintf(fd, \"Some string here\");\n```\n\nIt could save \n\n```\n[rr 9875 123]Some string here\n```\n\nto the file `fd`. \n\n`rr -M` does that but it (1) changes stdio output (2) will produce a whole lot of extraneous junk if I want to do a lot of event-output associations.\n\nAn implementation approach here would be to have some sort of special file `fd` perhaps. When rr detects that you're writing to that special file (only), it will prepend `[rr pid event-id]` just like it does for the stdio monitor. It would not do prepending to any other file.\n\nAny suggestions on how I could do this?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1688/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/19107913", "body": "Sorry if I'm missing this for something else -- my C++ is a bit rusty...\n\n`extant_ = !!f;`\n\nIs there a reason why f is being double negated? Or is `!!` some other unary operator here?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/19107913/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": []}, "nbp": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1771", "title": "Assertion `ticks_now == trace_ticks' failed to hold", "body": "This issue happens while replaying firefox under rr 4.2.0, rr 4.3.0 fails with a different error message which spew all the different register content.\n\nI can reproduce this issue with some work-in-progress patches on top of firefox, which breaks the load/reload of pages ( https://github.com/nbp/gecko-dev/tree/bugzil.la/js-startup-cache/wip ).  Note, firefox crashes quite easily after reloading pages, and I replayed one of these crashed process.\n\nHere is the error message I got while replaying with `rr -M replay -a` (rr 4.2.0):\n\n```\n\u2026\n[rr 2172 113952][Child 2172] WARNING: No inner window available!: file /home/nicolas/mozilla/alternate-dev/dom/base/nsGlobalWindow.cpp, line 10026\n[rr 2172 113955][Child 2172] WARNING: No inner window available!: file /home/nicolas/mozilla/alternate-dev/dom/base/nsGlobalWindow.cpp, line 10026\n[rr 2172 115132]++DOMWINDOW == 2 (0x1822d10) [pid = 2172] [serial = 2] [outer = 0x173b200]\n[FATAL /tmp/nix-build-rr-4.2.0.drv-0/rr-4.2.0-src/src/ReplaySession.cc:742:check_ticks_consistency() errno: 0 'Success'] \n (task 3747 (rec:2091) at time 124280)\n -> Assertion `ticks_now == trace_ticks' failed to hold. ticks mismatch for 'SYSCALL: setsockopt'; expected 8318556, got 8318560\nLaunch gdb with\n  gdb /home/nicolas/.local/share/rr/firefox-25/mmap_1_hardlink_firefox\nand attach to the rr debug server with:\n  target remote :3747\n```\n\nLooking at the result of  `rr dump -b -m -p` command as suggested in the issue #1734 , and selecting some events above the one which has a matching global time, I obtain:\n\n```\n{\n  real_time:1440395.696222 global_time:124273, event:`SCHED' tid:2084, ticks:4662502892\n rax:0x1 rbx:0x0 rcx:0x1da1e70 rdx:0x7f4ff2e48a70 rsi:0x1 rdi:0x1d75d38 rbp:0x7ffe0c93e890 rsp:0x7ffe0c93e870 r8:0x7ffe0c93e6a0 r9:0x7f4f78de87e0 r10:0x7ffe0c93e570 r11:0x60 r12:0\nx4056e0 r13:0x7ffe0c941060 r14:0x0 r15:0x0 rip:0x7f4fe27fb8bc eflags:0x202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0xffffffffffffffff fs_base:0x7f4ff2e48740 gs_base:0\nx0\n}\n{\n  real_time:1440395.696243 global_time:124274, event:`SYSCALL: poll' (state:EXITING_SYSCALL) tid:2091, ticks:8287405\n rax:0x1 rbx:0x1d8 rcx:0xffffffffffffffff rdx:0xffffffffffffffff rsi:0x4 rdi:0x7f4fd18761f0 rbp:0x7f4fd1876000 rsp:0x7f4fd23751b8 r8:0x0 r9:0x0 r10:0x0 r11:0x246 r12:0x7f4fd237548\n0 r13:0xffffffff r14:0x4 r15:0x7f4fd23752d8 rip:0x7000000b eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x7 fs_base:0x7f4fd2376700 gs_base:0x0\n  { addr:0x7f4fd18761e0, length:0x8 }\n  { addr:0x7f4fd18761f0, length:0x20 }\n}\n{\n  real_time:1440395.696246 global_time:124275, event:`SYSCALLBUF_ABORT_COMMIT' tid:2091, ticks:8287405\n}\n{\n  real_time:1440395.696526 global_time:124276, event:`SYSCALL: rrcall_notify_syscall_hook_exit' (state:ENTERING_SYSCALL) tid:2091, ticks:8287415\n rax:0xffffffffffffffda rbx:0x7f4fd18761f0 rcx:0xffffffffffffffff rdx:0xffffffff rsi:0x4 rdi:0x7f4fd2375480 rbp:0x20 rsp:0x7f4fd23751e8 r8:0x0 r9:0x0 r10:0x2 r11:0x246 r12:0x7f4fd\n2375480 r13:0x70000009 r14:0x4 r15:0x7f4fd23752d8 rip:0x70000005 eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x1bc fs_base:0x7f4fd2376700 gs_base:0x0\n}\n{\n  real_time:1440395.696529 global_time:124277, event:`SYSCALLBUF_RESET' tid:2091, ticks:8287415\n}\n{\n  real_time:1440395.696569 global_time:124278, event:`SYSCALL: rrcall_notify_syscall_hook_exit' (state:EXITING_SYSCALL) tid:2091, ticks:8287415\n rax:0x1 rbx:0x7f4fd18761f0 rcx:0xffffffffffffffff rdx:0xffffffff rsi:0x4 rdi:0x7f4fd2375480 rbp:0x20 rsp:0x7f4fd23751e8 r8:0x0 r9:0x0 r10:0x2 r11:0x246 r12:0x7f4fd2375480 r13:0x7\n0000009 r14:0x4 r15:0x7f4fd23752d8 rip:0x70000005 eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x7 fs_base:0x7f4fd2376700 gs_base:0x0\n  { addr:0x7f4fd1876005, length:0x1 }\n}\n{\n  real_time:1440395.697022 global_time:124279, event:`SYSCALLBUF_FLUSH' tid:2091, ticks:8318556\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'read', ret:0x1, size:0x11 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'poll', ret:0x1, size:0x30 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'gettimeofday', ret:0x0, size:0x20 }\n  { syscall:'gettimeofday', ret:0x0, size:0x20 }\n  { syscall:'futex', ret:0x1, size:0x18 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'clock_gettime', ret:0x0, size:0x20 }\n  { syscall:'recvfrom', ret:0x5, size:0x15 }\n  { syscall:'recvfrom', ret:0x39, size:0x49 }\n}\n{\n  real_time:1440395.697027 global_time:124280, event:`SYSCALL: setsockopt' (state:ENTERING_SYSCALL) tid:2091, ticks:8318556\n rax:0xffffffffffffffda rbx:0x36 rcx:0xffffffffffffffff rdx:0x4 rsi:0x6 rdi:0x30 rbp:0x7f4fd2375250 rsp:0x7f4fd2374fb0 r8:0x4 r9:0xd1 r10:0x7f4fd2375238 r11:0x246 r12:0x0 r13:0x7ffe0c93ce3f r14:0x3 r15:0x7f4fd23750b0 rip:0x70000002 eflags:0x246 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x36 fs_base:0x7f4fd2376700 gs_base:0x0\n}\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1771/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1646", "title": "Suspend to RAM does not works while `rr replay` processes are running.", "body": "I have no idea if this is a Linux kernel issue or a `rr` issue.  I do not even know if there is any notifications send to the process which can make this bug actionable within `rr`.  In the mean time, I noticed that I am unable to suspend rr exec_stub processes to ram while I have debugging sessions running.\n\nWhen triggering a suspend to RAM, I got reports with the following lines in `dmesg`.\n\n```\n[283009.174166] Freezing of tasks failed after 20.006 seconds (2 tasks refusing to freeze, wq_busy=0):\n[283009.174218] mmap_1_hardlink D ffff88047e212c80     0  2896   2882 0x00010046\n[283009.174220]  ffff8803b510fb28 0000000000000086 ffff88046731c400 0000000000012c80\n[283009.174222]  ffff8803b510ffd8 0000000000012c80 ffff88046731b300 ffff88046731c400\n[283009.174224]  ffff880466590880 ffff8803b510fd50 7fffffffffffffff ffff8803b510fd48\n[283009.174226] Call Trace:\n[283009.174233]  [<ffffffff814b17b9>] schedule+0x29/0x70\n[283009.174235]  [<ffffffff814b472c>] schedule_timeout+0x1ac/0x290\n[283009.174238]  [<ffffffff8108badd>] ? ttwu_do_activate.constprop.105+0x5d/0x70\n[283009.174241]  [<ffffffff8108e588>] ? try_to_wake_up+0x1d8/0x300\n[283009.174243]  [<ffffffff814b23de>] wait_for_completion+0x9e/0x110\n[283009.174245]  [<ffffffff8108e720>] ? wake_up_state+0x20/0x20\n[283009.174248]  [<ffffffff81207c4d>] do_coredump+0x33d/0xea0\n[283009.174250]  [<ffffffff814b121a>] ? __schedule+0x2ea/0x860\n[283009.174254]  [<ffffffff81070101>] ? compat_ptrace_request+0x91/0x220\n[283009.174256]  [<ffffffff8107428f>] get_signal+0x21f/0x610\n[283009.174259]  [<ffffffff81057677>] ? bad_area+0x47/0x60\n[283009.174264]  [<ffffffff810124e8>] do_signal+0x28/0x720\n[283009.174266]  [<ffffffff8107403b>] ? ptrace_notify+0x5b/0x90\n[283009.174268]  [<ffffffff81070000>] ? ptrace_request+0x580/0x5b0\n[283009.174272]  [<ffffffff811adbfc>] ? vfs_write+0x15c/0x1f0\n[283009.174275]  [<ffffffff81012c50>] do_notify_resume+0x70/0x90\n[283009.174277]  [<ffffffff814b67a2>] retint_signal+0x48/0x86\n```\n\nLooking up the pid, highlights that these are only rr processes.\n\n```\n$ ls -l /proc/2882/exe /proc/2896/exe\nlrwxrwxrwx 1 nicolas nicolas 0 Feb 17 10:35 /proc/2882/exe -> /nix/store/niwpml90jdzkm83a4d1va5zhkwb73zmr-rr-4.1.0-35-g93b3630/bin/exec_stub*\nlrwxrwxrwx 1 nicolas nicolas 0 Feb 17 10:35 /proc/2896/exe -> /nix/store/niwpml90jdzkm83a4d1va5zhkwb73zmr-rr-4.1.0-35-g93b3630/bin/exec_stub*\n```\n\nLooking for the status (/proc/$pid/status) of the processes, I got the following information:\n\n```\n$ head -n 7 /proc/2882/status                          \nName:   JS Helper\nState:  t (tracing stop)\nTgid:   2882\nNgid:   0\nPid:    2882\nPPid:   1\nTracerPid:      31896\n\n$ head -n 7 /proc/2896/status                          \nName:   mmap_1_hardlink\nState:  D (disk sleep)\nTgid:   2895\nNgid:   0\nPid:    2896\nPPid:   2882\nTracerPid:      31896\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1646/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1180", "title": "build fails when cmake is called with -DCMAKE_BUILD_TYPE=Release", "body": "While packaging rr, the problem is that in Release mode the `-DNDEBUG` is omitted, and the warning-as-error compilation flag is catching debug-only variable declarations.\n\nA work-around is to give the additional argument `-DCMAKE_C_FLAGS_RELEASE:STRING=` to cmake.\n\n(spew obtained with `make VERBOSE=1`)\nWhen building with the Release mode:\n\n```\nbuilding CMakeFiles/accept.dir/src/test/accept.c.o\n/nix/store/vv90ccz0p6kyfasyhh1caxdjbrqdzqc1-cmake-2.8.11.2/bin/cmake -E cmake_progress_report /tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/CMakeFiles 2\n[  2%] Building C object CMakeFiles/accept.dir/src/test/accept.c.o\n/nix/store/xnb0w1i2jdjv178j1y28q4bfn79b8xia-gcc-wrapper-4.8.2/bin/cc   -pthread -O0 -g3 -Wall -Werror -m32 -Wstrict-prototypes -O3 -DNDEBUG -I/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/include    -o CMakeFiles/accept.dir/src/test/accept.c.o   -c /tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c\n/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c: In function \u2018client\u2019:\n/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c:6:6: erreur: variable \u2018clientfd\u2019 set but not used [-Werror=unused-but-set-variable]\n  int clientfd;\n      ^\n/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c: In function \u2018server\u2019:\n/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c:34:6: erreur: unused variable \u2018status\u2019 [-Werror=unused-variable]\n  int status;\n      ^\n/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c:33:12: erreur: unused variable \u2018len\u2019 [-Werror=unused-variable]\n  socklen_t len = sizeof(peer_addr);\n            ^\ncc1: all warnings being treated as errors\nmake[2]: *** [CMakeFiles/accept.dir/src/test/accept.c.o] Erreur 1\n```\n\nWhen building without the Release mode:\n\n```\nbuilding CMakeFiles/accept.dir/src/test/accept.c.o\n/nix/store/vv90ccz0p6kyfasyhh1caxdjbrqdzqc1-cmake-2.8.11.2/bin/cmake -E cmake_progress_report /tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/CMakeFiles 2\n[  2%] Building C object CMakeFiles/accept.dir/src/test/accept.c.o\n/nix/store/xnb0w1i2jdjv178j1y28q4bfn79b8xia-gcc-wrapper-4.8.2/bin/cc   -pthread -O0 -g3 -Wall -Werror -m32 -Wstrict-prototypes -I/tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/include    -o CMakeFiles/accept.dir/src/test/accept.c.o   -c /tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0/src/test/accept.c\nbuilding bin/accept\nLinking C executable bin/accept\n/nix/store/vv90ccz0p6kyfasyhh1caxdjbrqdzqc1-cmake-2.8.11.2/bin/cmake -E cmake_link_script CMakeFiles/accept.dir/link.txt --verbose=1\n/nix/store/xnb0w1i2jdjv178j1y28q4bfn79b8xia-gcc-wrapper-4.8.2/bin/cc   -pthread -O0 -g3 -Wall -Werror -m32 -Wstrict-prototypes    CMakeFiles/accept.dir/src/test/accept.c.o  -o bin/accept -rdynamic -lrt \nmake[2] : on quitte le r\u00e9pertoire \u00ab /tmp/nix-build-rr-1.3.0.drv-0/rr-1.3.0 \u00bb\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1180/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "fitzgen": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1770", "title": "\"Assertion `time == global_time' failed\" with spidermonkey arm simulator", "body": "I built rr from source on this commit:\n\n```\ncommit cdb22ede3c3039950a77c77e05044f3fd01411ca\nAuthor: Robert O'Callahan <robert@ocallahan.org>\nDate:   Tue Aug 9 18:20:16 2016 +1200\n\n    Awk string indices start at 1\n```\n\nI did a `ninja-build test` and all tests passed.\n\nOn Fedora with this kernel:\n\n```\n$ uname -a\nLinux localhost.localdomain 4.6.5-300.fc24.x86_64 #1 SMP Thu Jul 28 01:10:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n```\n\nOn this branch: https://github.com/fitzgen/gecko-dev/tree/rr-assertion-failure-test-case\n\nBuild the arm simulator like so:\n\n```\n$ ./js/src/devtools/automation/autospider.py --objdir $OBJDIR --build-only arm-sim\n```\n\nAnd then run like this:\n\n```\nbash-4.3$ ./js/src/tests/jstests.py $OBJDIR/dist/bin/js shell/futex.js -o --rr\n## shell/futex.js: rc = -9, run time = 150.001963\nSleeping for 2 seconds\nWaking the main thread now\nWoke up as I should have in 2.011s\nMain thread waiting on wakeup (2s)\nWoke up as I should have in 2.011s\nStarting outer wait\nIn the interrupt, starting inner wait with timeout 2s\nGot the interrupt exception!\nScript runs for too long, terminating.\nTIMEOUT - shell/futex.js\n[0|1|1|0] 100% ==========================================================>| 150.1s\nTIMEOUTS\n    shell/futex.js\nFAIL\nbash-4.3$ rr replay\nrr: ../src/TraceStream.cc:543: void rr::TraceReader::read_generic(vector<uint8_t> &): Assertion `time == global_time' failed.\nbash-4.3$ \n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1542", "title": "FATAL assert_same_rec", "body": "STR:\n- checkout my branch of m-c: https://github.com/fitzgen/gecko-dev/tree/heap-snapshots-e10s-copy\n- `$ ./mach build`\n- `$ ./mach xpcshell-test toolkit/devtools/heapsnapshot/tests/unit_ipc/test_saveHeapSnapshot_e10s_01.js --debugger rr`\n- `$ rr replay`\n- `(gdb) continue`\n\n---\n\nThis gist has my full `rr replay` session that led up to the assertion failure, as well as conecting gdb to rr and dumping rr's backtrace: https://gist.github.com/fitzgen/04d8d34ca7d059c59d13\n\nMy rr is built from this commit:\n\n```\ncommit a7f6a951d58d61a56a31dcff262e27024fa40aee\nAuthor: Robert O'Callahan <robert@ocallahan.org>\nDate:   Wed Sep 16 15:08:53 2015 +1200\n\n    Print errno name when assertion fails.\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1542/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1541", "title": "pending breakpoints don't seem to work", "body": "If I set a breakpoint on `somefile:1234` in a library that hasn't been loaded yet, say \"yes\" I do want a pending breakpoint, and then run the recording, my pending breakpoint is never hit (and it should be). If, after having run the recording once, I type in the same breakpoint command it will set a non-pending breakpoint and this will be hit in subsequent replays.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1541/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "tromey": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1755", "title": "rr test suite should pass -nx to gdb", "body": "I have a bunch of unusual stuff in my `~/.gdbinit`.  I was surprised to find that the `rr` test suite doesn't disable the reading of this file when running tests.  I think this would be a good idea; and it is easily done by passing `-nx` to gdb.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1425", "title": "rr fails to record mach mochitest-devtools", "body": "I built git master rr on x86-64 Fedora 20.  I commented out the 32-bit tests (didn't want to install the 32-bit toolchain) but the 64-bit tests all pass.\n\nI am building firefox fx-team.  I've tried various configurations but all with this in .mozconfig:\n\n```\nac_add_options --enable-devtools-perf\n```\n\nI tried to record a test run using:\n\n```\n./mach mochitest-devtools --slowscript --debugger rr  browser/devtools/performance/test/browser_perf-compatibility-04.js\n```\n\nThis fails like:\n\n```\n[FATAL /home/tromey/firefox-git/rr/src/task.cc:562:fstat() errno: 13 'Permission denied']\n (task 26191 (rec:26191) at time 3637)\n ->  Assertion `backing_fd.is_open()' failed to hold.\n[FATAL /home/tromey/firefox-git/rr/src/log.cc:16:emergency_debug() errno: 0 'Success']\n -> (session doesn't look interactive, aborting emergency debugging)\n```\n\nRe-running with rr in gdb, the backtrace is:\n\n```\n(gdb) bt\n#0  0x00007ffff6ab101f in accept4 (fd=4, addr=..., addr_len=0x7fffffffae9c, \n    flags=-1) at ../sysdeps/unix/sysv/linux/accept4.c:37\n#1  0x0000000000548ef7 in GdbConnection::await_debugger (this=0x6ab670, \n    listen_fd=...) at /home/tromey/firefox-git/rr/src/GdbConnection.cc:109\n#2  0x0000000000549119 in GdbConnection::await_client_connection (\n    desired_port=25814, probe=GdbConnection::PROBE_PORT, tgid=25814, \n    exe_image=\"\", client_params_fd=0x0)\n    at /home/tromey/firefox-git/rr/src/GdbConnection.cc:142\n#3  0x0000000000554eed in GdbServer::emergency_debug (t=0x690c40)\n    at /home/tromey/firefox-git/rr/src/GdbServer.cc:896\n#4  0x000000000056cfd8 in emergency_debug (t=0x690c40)\n    at /home/tromey/firefox-git/rr/src/log.cc:20\n#5  0x000000000056d09a in EmergencyDebugOstream::~EmergencyDebugOstream (\n    this=0x7fffffffd220, __in_chrg=<optimized out>)\n    at /home/tromey/firefox-git/rr/src/log.cc:27\n#6  0x00000000005e954f in Task::fstat (this=0x690c40, fd=9)\n    at /home/tromey/firefox-git/rr/src/task.cc:562\n#7  0x000000000058a827 in process_mmap (t=0x690c40, length=217032, prot=1, \n    flags=1, fd=9, offset_pages=0)\n    at /home/tromey/firefox-git/rr/src/record_syscall.cc:2424\n#8  0x000000000059470b in rec_process_syscall_arch<rr::X64Arch> (t=0x690c40, \n    syscall_state=...)\n    at /home/tromey/firefox-git/rr/src/record_syscall.cc:2645\n#9  0x000000000058b0a4 in rec_process_syscall_internal (t=0x690c40, \n    syscall_state=...)\n    at /home/tromey/firefox-git/rr/src/record_syscall.cc:2805\n#10 0x000000000058b0da in rec_process_syscall (t=0x690c40)\n    at /home/tromey/firefox-git/rr/src/record_syscall.cc:2810\n#11 0x0000000000580131 in RecordSession::syscall_state_changed (this=0x68f450, \n    t=0x690c40, step_state=0x7fffffffdeb0)\n    at /home/tromey/firefox-git/rr/src/RecordSession.cc:531\n#12 0x0000000000582ad1 in RecordSession::record_step (this=0x68f450)\n    at /home/tromey/firefox-git/rr/src/RecordSession.cc:1065\n#13 0x000000000057c12f in record (\n    args=std::vector of length 5, capacity 8 = {...}, flags=...)\n    at /home/tromey/firefox-git/rr/src/RecordCommand.cc:187\n#14 0x000000000057c374 in RecordCommand::run (\n    this=0x68ae40 <RecordCommand::singleton>, \n    args=std::vector of length 5, capacity 8 = {...})\n    at /home/tromey/firefox-git/rr/src/RecordCommand.cc:233\n#15 0x000000000056ea1e in main (argc=6, argv=0x7fffffffe128)\n    at /home/tromey/firefox-git/rr/src/main.cc:241\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1425/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71336694", "body": "When writing this originally I couldn't convince myself that `regs()` uses a regset; because I was under the impression (perhaps mistaken) that `PTRACE_GETREGS` and `PTRACE_GETREGSET` were not identical.  I will research a bit more to find out for sure.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71336694/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71366902", "body": "After talking with a more license-interested friend I became pretty confused about what the LGPL really requires here.  I didn't know what to write.  So instead I grabbed the FreeBSD header and made the trivial modifications necessary to make it match glibc.  Wondering if that is ok.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71366902/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71374285", "body": "It seems for x86-32 inferiors we have to use `PTRACE_GET_THREAD_AREA`, also apparently undocumented.\n\nI don't think `arch_prctl` can be used as, IIUC, it works on the current process, not some other process.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71374285/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71382194", "body": "After looking at the kernel source I think it's fine.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71382194/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71383760", "body": "For x86 we also have to be sure to load a different libthread_db.  (As an aside let me say that this API is unbelievably terrible and I can't wait for the replacement to land.)  I'm not 100% sure of the best way to do this, but it seems we'd need some way to find which libpthread is being used by the inferior, then find the corresponding libthread_db.  (I was under the impression that the 64 bit libthread_db could also understand 32 bit inferiors, but that doesn't seem to be the case.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71383760/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71590873", "body": "I found out that the 64-bit libthread_db does indeed support 32-bit inferiors; and previously my code was wrong.\n\nAlso I found out that modern kernels provide fs_base and gs_base in the user regs, so we can fetch those there.\n\nStill not sure whether rr already has the thread area.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71590873/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71596736", "body": "> Still not sure whether rr already has the thread area.\n\nOk, found that too.  I'll upload the updated patch momentarily.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71596736/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71757327", "body": "I did it this way so that GdbServer can easily see when there is no address.  Using a sentinel address is possible but seemed less clean.  I suppose I could stick a bool in there as well.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71757327/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71757664", "body": "Once they're found they don't get relocated.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71757664/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71774050", "body": "Done.  Sorry about that, it was mentioned in the previous review and I didn't deal with it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71774050/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71778136", "body": "libthread_db only calls ps_getpid an unusual situation, I think maybe when it's being used before NPTL has fully initialized.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/71778136/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "vashirov": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1752", "title": "QEMU Virtual CPU support", "body": "I'm getting a crash in my KVM virtual machine:\n\n```\n# rr record sleep\nrr: Saving execution to trace directory `/root/.local/share/rr/sleep-0'.\n[FATAL /home/roc/rr/rr/src/PerfCounters.cc:136:get_cpu_microarch() errno: ENOTTY] CPU 0x660 unknown.\nAborted (core dumped)\n# cat /proc/cpuinfo \nprocessor   : 0\nvendor_id   : GenuineIntel\ncpu family  : 6\nmodel       : 6\nmodel name  : QEMU Virtual CPU version 2.1.0\nstepping    : 3\nmicrocode   : 0x1\ncpu MHz     : 2693.764\ncache size  : 4096 KB\nphysical id : 0\nsiblings    : 1\ncore id     : 0\ncpu cores   : 1\napicid      : 0\ninitial apicid  : 0\nfpu     : yes\nfpu_exception   : yes\ncpuid level : 4\nwp      : yes\nflags       : fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pse36 clflush mmx fxsr sse sse2 syscall nx lm rep_good nopl pni cx16 x2apic popcnt hypervisor lahf_lm abm\nbogomips    : 5387.52\nclflush size    : 64\ncache_alignment : 64\naddress sizes   : 40 bits physical, 48 bits virtual\npower management:\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1752/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "neon12345": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1736", "title": "improve data handling", "body": "I want to write a proof of concept to improve the data handling of rr. My idea is to use a fuse file system that transparently does the compression and simply mmap the data areas. The compression algorithm should handle random reads well. This would remove the need to copy around and decomprress whole data when not needed. Transparently caching the uncompressed data.\n\nIt should not be too much work but I don't know the implementation of rr very well. Is there some document that describes the (data handling) process of rr during record and replay. An overview to when data read/write/compress/decomress/clone does happen would help.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1736/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1734", "title": "Assertion `ticks_now == trace_ticks' failed to hold", "body": "I get this error and don't know rr enough to see what is going wrong.\n\n[FATAL ReplaySession.cc:840:check_ticks_consistency() errno: SUCCESS](task 7646 %28rec:6129%29 at time 45583)\n -> Assertion `ticks_now == trace_ticks' failed to hold. ticks mismatch for 'SYSCALL: munmap'; expected 4306038, got 4306037\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1734/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/1735", "title": "New features and fixes", "body": "", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67154568", "body": "bug\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67154568/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67154670", "body": "According to the man page EOF is for read ony. I would expect write to fail with -1 if the disc is full.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67154670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67156148", "body": "The problem is that /dev/shm is fixed in size to e.g. half the ram and I don't want to tweak this if needed when there is a better interface. I guess it also has the benefit that there is no tmpfs overhead.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/67156148/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}]}, "mjfroman": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1727", "title": "crash when using reverse-cont in Firefox replay session", "body": "Debugging Firefox, I can repeatedly get the following assert/crash:\n[FATAL /home/mfroman/rr/rr/src/Task.cc:2021:write_bytes_helper() errno: EIO](task 19627 %28rec:19195%29 at time 820829)\n -> Assertion `nwritten == buf_size' failed to hold. Should have written 614400 bytes to 0x7f30c1e68000, but only wrote -1\n\nLinux 4.2.0-36-generic #42~14.04.1-Ubuntu SMP Fri May 13 17:27:22 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\nI'm on the lastest git commit for rr (3710623f9fbec963a8f8096092de1240f82a0091).\nDebugging on mozilla-central changeset: d98f20c25fee\n./mach run --debugger=rr https://web.ciscospark.com\nI start a call on spark (currently debugging a video freeze), and then quit after I see the freeze.\nrr replay\nb rtcp_utility.cc:1516\nb rtcp_receiver.cc:1107\nc\nc\nreverse-cont\nboom!\n\nLet me know if you need additional info, or if I can clarify anything.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "timdream": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1713", "title": "Cannot start rr on an updated Ubuntu 14.04 LTS: /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.21' not found (required by rr)", "body": "Console output:\n\n```\n$ uname -a\nLinux timdream-Ubuntu 3.13.0-86-generic #131-Ubuntu SMP Thu May 12 23:33:13 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n$ rr\nrr: /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.21' not found (required by rr)\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1713/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "Hassan-Ahmadi": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1685", "title": "terminate called after throwing an instance of 'std::domain_error'", "body": "When I'm trying to run our project , which is a large multi-thread C++ project, it stops and gives this error :\nterminate called after throwing an instance of 'std::domain_error'\nwhat(): Thread::wait failed. Because it was not started.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1685/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "jandem": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1684", "title": "Assertion `!flushed_syscallbuf || flushed_num_rec_bytes == hdr.num_rec_bytes' failed to hold", "body": "I wrote a little script to 'rr record' Firefox and then terminate (SIGTERM) rr after 10 seconds, to try to reproduce a crash. Sometimes (1 out of 50 runs or so) rr fails like this:\n\n> [FATAL /home/jan/dev/rr/rr/src/RecordTask.cc:1035:maybe_flush_syscallbuf() errno: ESRCH](task 13513 %28rec:13513%29 at time 150867)\n> -> Assertion `!flushed_syscallbuf || flushed_num_rec_bytes == hdr.num_rec_bytes' failed to hold. \n\nIt's probably caused by the SIGTERM.\n\nThis is with rr tip. Not sure what information is useful here, but I can add some debugging printfs if it helps.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1684/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "dreiss": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1680", "title": "Test broken by fa7fb04db4d72b9d", "body": "On my development server, at revision fa7fb04db4d72b9d, I got 100% reproducible failures for `thread_exit_signal` and `set_tid_address` (both with and without syscallbuf).  I could not reproduce on the previous revision, or on my laptop.  Both are 64-bit.\n\n`set_tid_address` was failing during record with \n\n```\nFAILED: errno=11 (Resource temporarily unavailable)\nset_tid_address: /home/dreiss/local/rr/src/test/set_tid_address.c:26: main: Assertion `\"FAILED: !\" && check_cond(0 == syscall(202, &v, 0, 1, ((void *)0), ((void *)0), 0))' failed.\n```\n\nThis suggests that the thread created on line 25 of set_tid_address.c is running to completion before the futex syscall starts.  When futex starts, v has already been set to zero, so futex fails with EAGAIN.  I ran the \"rr record\" command on both my laptop and server with RR_LOG=Scheduler and found this...\n\nlaptop (working):\n\n```\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at (none))\n[Scheduler]   and running; waiting for state change\n[Scheduler]   new status is 0x857f\n[Scheduler] Scheduling next task\n[Scheduler]   29307 is blocked on SYSCALL: clone; checking status ...\n[Scheduler]   ready with status 0x857f\n[Scheduler]   Carrying on with task 29307\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at SYSCALL: clone)\n[Scheduler] Scheduling next task\n[Scheduler]   29307 isn't blocked\n[Scheduler]   Carrying on with task 29307\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at (none))\n[Scheduler]   and running; waiting for state change\n[Scheduler]   new status is 0x7057f\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at (none))\n[Scheduler]   and running; waiting for state change\n[Scheduler]   new status is 0x857f\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at (none))\n[Scheduler]   and running; waiting for state change\n[Scheduler]   new status is 0x7057f\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at (none))\n[Scheduler]   and running; waiting for state change\n[Scheduler]   new status is 0x857f\n[Scheduler] Scheduling next task\n[Scheduler]   29307 is blocked on SYSCALL: futex; checking status ...\n[Scheduler]   still blocked\n[Scheduler]   need to reschedule\n[Scheduler]   29308 isn't blocked\n[Scheduler]   selecting task 29308\n[Scheduler] Switching from 29307(set_tid_address) to 29308(set_tid_address) (priority 0 to 0) at 180\n```\n\nWhen it checks the status of 29307, clone is not blocked, so it's able to start the futex syscall before running the new thread.\n\nserver (not working):\n\n```\n[Scheduler] Scheduling next task\n[Scheduler]   (29307 is un-switchable at (none))\n[Scheduler]   and running; waiting for state change\n[Scheduler]   new status is 0x857f\n[Scheduler] Scheduling next task\n[Scheduler]   29307 is blocked on SYSCALL: clone; checking status ...\n[Scheduler]   still blocked\n[Scheduler]   need to reschedule\n[Scheduler]   29308 isn't blocked\n[Scheduler]   selecting task 29308\n[Scheduler] Switching from 29307(set_tid_address) to 29308(set_tid_address) (priority 0 to 0) at 175\n```\n\n(note that I modified the task numbers in this log to match the laptop log for easier diffing.\n\nAny idea why clone would still be blocked on one machine, but continue right away on another?  My next step will be to try to get the contents of /proc/PID/stack when the scheduler sees clone as blocked.  I'm not sure whether that will be reliable, though.\n\n`thread_exit_signal` was failing during replay with\n\n```\n[FATAL /home/dreiss/local/rr/src/ReplaySession.cc:423:guard_unexpected_signal() errno: 0 'Success'] \n (task 1221071 (rec:1219426) at time 316)\n -> Assertion `false' failed to hold. Replay got unrecorded event SIGNAL: SIGSEGV(async) while awaiting signal\nLaunch gdb with\n  gdb /tmp/rr-test-thread_exit_signal-aIdgc8K9s/thread_exit_signal-aIdgc8K9s\n```\n\nI wasn't able to get any useful information by connecting to the emergency debug server, but I did attach gdb to rr itself and got this stack:\n\n```\n#4  0x000000000061c4e6 in rr::emergency_debug (t=0x998300) at /home/dreiss/local/rr/src/log.cc:267\n#5  0x000000000061c6c0 in rr::EmergencyDebugOstream::~EmergencyDebugOstream (this=0x7fff583d21f0, __in_chrg=<optimized out>) at /home/dreiss/local/rr/src/log.cc:287\n#6  0x000000000067be59 in rr::guard_unexpected_signal (t=0x998300) at /home/dreiss/local/rr/src/ReplaySession.cc:423\n#7  0x000000000067cd18 in rr::ReplaySession::emulate_async_signal (this=0x980fd0, t=0x998300, constraints=..., ticks=0) at /home/dreiss/local/rr/src/ReplaySession.cc:681\n#8  0x000000000067e40d in rr::ReplaySession::try_one_trace_step (this=0x980fd0, t=0x998300, constraints=...) at /home/dreiss/local/rr/src/ReplaySession.cc:990\n#9  0x000000000067f050 in rr::ReplaySession::replay_step (this=0x980fd0, constraints=...) at /home/dreiss/local/rr/src/ReplaySession.cc:1189\n#10 0x0000000000679c44 in rr::ReplaySession::replay_step (this=0x980fd0, command=rr::RUN_CONTINUE) at /home/dreiss/local/rr/src/ReplaySession.h:259\n#11 0x0000000000678c1e in rr::serve_replay_no_debugger (trace_dir=\"\", flags=...) at /home/dreiss/local/rr/src/ReplayCommand.cc:270\n#12 0x0000000000679039 in rr::replay (trace_dir=\"\", flags=...) at /home/dreiss/local/rr/src/ReplayCommand.cc:350\n```\n\nand this information about the pending signal\n\n```\n(gdb) frame 7\n#7  0x000000000067cd18 in rr::ReplaySession::emulate_async_signal (this=0x980fd0, t=0x998300, constraints=..., ticks=0) at /home/dreiss/local/rr/src/ReplaySession.cc:681\n681       guard_unexpected_signal(t);\n(gdb) p t->pending_sig()\n$1 = 11\n(gdb) p t->pending_siginfo\n$2 = {\n  si_signo = 11, \n  si_errno = 0, \n  si_code = 128, \n  _sifields = {\n    _pad = {0, 0, 113, 0, -503875560, 32568, -503875560, 32568, -503881280, 32568, 353, 0, -503875320, 32568, -503875320, 32568, -1, 0, 1886221359, 762475055, 1953719668, \n      1919448109, 1600414053, 1953069157, 1734964063, 762077550, 1734625633, 961230947}, \n    _kill = {\n      si_pid = 0, \n      si_uid = 0\n    }, \n    _timer = {\n      si_tid = 0, \n      si_overrun = 0, \n      si_sigval = {\n        sival_int = 113, \n        sival_ptr = 0x71\n      }\n    }, \n    _rt = {\n      si_pid = 0, \n      si_uid = 0, \n      si_sigval = {\n        sival_int = 113, \n        sival_ptr = 0x71\n      }\n    }, \n    _sigchld = {\n      si_pid = 0, \n      si_uid = 0, \n      si_status = 113, \n      si_utime = 139882285987864, \n      si_stime = 139882285987864\n    }, \n    _sigfault = {\n      si_addr = 0x0\n    }, \n    _sigpoll = {\n      si_band = 0, \n      si_fd = 113\n    }, \n    _sigsys = {\n      _call_addr = 0x0, \n      _syscall = 113, \n      _arch = 0\n    }\n  }\n}\n```\n\nThe strange thing is `si_code = 128`, which doesn't appear to be a valid value.  From my brief experiments, it seems like some fault addresses (for example, 0xdeadbeefdeadbeef) generate si_code = 128 with si_addr = 0.  I'll try to collect some more information about where the SIGSEGV came from, but I'm wondering if you have any ideas of what to look for.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "nical": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1674", "title": "Intermittent make check test failures", "body": "With a local build of [today's master branch](https://github.com/mozilla/rr/commit/b5ca4dbd99179f774a654f90d39c71accf737ffa), make check fails with this at the end of the log:\n\n```\nThe following tests FAILED:\n    720 - reverse_alarm-no-syscallbuf (Failed)\n    1452 - checkpoint_async_signal_syscalls_1000-32-no-syscallbuf (Failed)\n    1501 - reverse_alarm-32 (Failed)\n```\n\nI haven't tried to build rr for a while on this computer so I am not implying that this would be a recent regression.\n\nSome info about the computer:\nI am running Fedora 23 with gcc 5.3.1 installed (assuming that's what rr's build system uses)\n\n```\n$ cat /proc/version\nLinux version 4.4.4-301.fc23.x86_64 (mockbuild@bkernel02.phx2.fedoraproject.org) (gcc version 5.3.1 20151207 (Red Hat 5.3.1-2) (GCC) ) #1 SMP Fri Mar 4 17:42:42 UTC 2016\n```\n\n```\n$ lscpu\nArchitecture:          x86_64\nCPU op-mode(s):        32-bit, 64-bit\nByte Order:            Little Endian\nCPU(s):                12\nOn-line CPU(s) list:   0-11\nThread(s) per core:    2\nCore(s) per socket:    6\nSocket(s):             1\nNUMA node(s):          1\nVendor ID:             GenuineIntel\nCPU family:            6\nModel:                 63\nModel name:            Intel(R) Xeon(R) CPU E5-1650 v3 @ 3.50GHz\nStepping:              2\nCPU MHz:               1244.003\nCPU max MHz:           3800.0000\nCPU min MHz:           1200.0000\nBogoMIPS:              6984.35\nVirtualization:        VT-x\nL1d cache:             32K\nL1i cache:             32K\nL2 cache:              256K\nL3 cache:              15360K\nNUMA node0 CPU(s):     0-11\nFlags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm ida arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid cqm xsaveopt cqm_llc cqm_occup_llc\n```\n\nNot sure what other information could be useful, let me know.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1674/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "samth": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1649", "title": "Feature request: `rr record --remove-trace-on-success`", "body": "I regularly run `rr` in a bash `while` loop, which accumulates traces if I keep them around, all of which are useless until the test fails. I'd love an option to just delete the trace if the recorded process exits with 0, keeping it otherwise. \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "zumbi": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1642", "title": "Intel Silvermont support", "body": "Trying to run rr on a Silvermont CPU currently throws this error:\n\n[FATAL /usr/src/packages/BUILD/rr-4.0.3/src/PerfCounters.cc:129:get_cpu_microarch() errno: 0 'Success'] \n -> CPU 0x30670 unknown.\n\nI have looked the manual posted in issue#1607 but I have no clue if the PMU config values are safe to try out as is. Any hint on that regard would be welcome. I am happy to test it here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1642/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "mbrubeck": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1639", "title": "Assertion `time >= frame.time()' failed in read_raw_data_for_frame, during replay", "body": "I got this assertion when running \"rr replay\" on one recording of a 64-bit Servo process:\n\n`rr: /home/mbrubeck/src/rr/rr/src/TraceStream.cc:456: bool TraceReader::read_raw_data_for_frame(const TraceFrame&, TraceReader::RawData&): Assertion`time >= frame.time()' failed`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1639/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "snf": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1596", "title": "Can't defer deterministic or internal signals", "body": "Ok, the next one, I'm attaching the (last few lines of) LOG form RecordSession. Any insight on how to approach it?\n\n```\n[INFO log()] SYSCALL: socketpair\n[INFO log()] (none)\n[RecordSession] EXEC_SYSCALL_DONE: status=0x857f pevent=0\n[RecordSession]   original_syscallno:53 (socketpair); return val:0\n[RecordSession] EXEC_START: status=0x857f pevent=0\n[RecordSession] line 5000: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[RecordSession]   55897: handle_ptrace_event 7: event (none)\n[RecordSession] EXEC_START: status=0x7057f pevent=7\n[RecordSession] line 5000: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[RecordSession] EXEC_SYSCALL_ENTRY: status=0x857f pevent=0\n[RecordSession] after cont: status=0x857f pevent=0\n[RecordSession] EXEC_START: status=0x857f pevent=0\n[RecordSession] line 5001: Active task is 55897. Events:\n[INFO log()] SYSCALL: sendmsg\n[INFO log()] (none)\n[RecordSession] EXEC_IN_SYSCALL: status=0x857f pevent=0\n[RecordSession] line 5001: Active task is 55897. Events:\n[INFO log()] SYSCALL: sendmsg\n[INFO log()] (none)\n[RecordSession] EXEC_SYSCALL_DONE: status=0x857f pevent=0\n[RecordSession]   original_syscallno:46 (sendmsg); return val:20\n[RecordSession] EXEC_START: status=0x857f pevent=0\n[RecordSession] line 5002: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[RecordSession]   55897: handle_ptrace_event 7: event (none)\n[RecordSession] EXEC_START: status=0x7057f pevent=7\n[RecordSession] line 5002: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[RecordSession] EXEC_SYSCALL_ENTRY: status=0x857f pevent=0\n[RecordSession] after cont: status=0x857f pevent=0\n[RecordSession] EXEC_START: status=0x857f pevent=0\n[RecordSession] line 5003: Active task is 55897. Events:\n[INFO log()] SYSCALL: close\n[INFO log()] (none)\n[RecordSession] EXEC_IN_SYSCALL: status=0x857f pevent=0\n[RecordSession] line 5003: Active task is 55897. Events:\n[INFO log()] SYSCALL: close\n[INFO log()] (none)\n[RecordSession] EXEC_SYSCALL_DONE: status=0x857f pevent=0\n[RecordSession]   original_syscallno:3 (close); return val:0\n[RecordSession] EXEC_START: status=0x857f pevent=0\n[RecordSession] line 5004: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[RecordSession]   55897: handle_ptrace_event 7: event (none)\n[RecordSession] EXEC_START: status=0x7057f pevent=7\n[RecordSession] line 5004: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[RecordSession] EXEC_START: status=0x857f pevent=0\n[RecordSession] line 5005: Active task is 55897. Events:\n[INFO log_pending_events()] (no pending events)\n[FATAL /home/asdf/dev/rr/rr-snf/src/RecordSession.cc:1152:handle_signal_event() errno: 0 'Success'] \n (task 55897 (rec:55897) at time 5005)\n ->  Assertion `false' failed to hold. Can't defer deterministic or internal signals\n[INFO log_pending_events()] (no pending events)\n[FATAL /home/asdf/dev/rr/rr-snf/src/log.cc:23:emergency_debug() errno: 0 'Success'] \n -> (session doesn't look interactive, aborting emergency debugging)\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1596/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "frozencemetery": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1589", "title": "`rr replay` fails with errno: 0 'Success'", "body": "```\nrharwood@gssproxy:~/gssproxy/proxy$ rr replay\n[FATAL /home/rharwood/rr/src/Event.cc:75:Event() errno: 0 'Success'] \n -> Unexpected event [FATAL /home/rharwood/rr/src/Event.cc:340:type_name() errno: 0 'Success'] \n -> Unknown event type 31\nrharwood@gssproxy:~/gssproxy/proxy$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Debian\nDescription:    Debian GNU/Linux testing (stretch)\nRelease:    testing\nCodename:   stretch\nrharwood@gssproxy:~/gssproxy/proxy$ \n```\n\nPlease let me know if there is any more information I can provide.  Thanks!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1589/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1587", "title": "`rr replay` fails with \"Event::Event(EncodedEvent): Assertion `0 == e.data'\"", "body": "```\nrharwood@fedproxy:~/gssproxy/proxy$ rr replay\nrr: /home/rharwood/rr/src/Event.cc:52: Event::Event(EncodedEvent): Assertion `0 == e.data' failed.\nrharwood@fedproxy:~/gssproxy/proxy$ echo $_RR_TRACE_DIR\n/tmp/rr/\nrharwood@fedproxy:~/gssproxy/proxy$ ls -R /tmp/rr\n/tmp/rr:\ngssproxy-0  latest-trace\n\n/tmp/rr/gssproxy-0:\nargs_env  data  data_header  events  mmaps  tasks  version\nrharwood@fedproxy:~/gssproxy/proxy$ lsb_release -a\nLSB Version:    :core-4.1-amd64:core-4.1-noarch\nDistributor ID: Fedora\nDescription:    Fedora release 22 (Twenty Two)\nRelease:    22\nCodename:   TwentyTwo\nrharwood@fedproxy:~/gssproxy/proxy$ \n```\n\nThe problem occurs whether I build from source or use the provided RPMs.  Please let me know if there is any more information I can provide.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1587/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "neuschaefer": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1583", "title": "`rr ps` prints misleading error message when ~/.rr doesn't exist", "body": "```\n$ rr ps\n\nrr: error: Version file for recorded trace `/home/user/.rr/latest-trace/version' not found.  Did you record\n           `/home/user/.rr/latest-trace/version' with an older version of rr?  If so, you'll need to replay\n           `/home/user/.rr/latest-trace/version' with that older version.  Otherwise, your trace is\n           likely corrupted.\n```\n\nTo avoid confused first-time users, it should probably detect this case and print a more useful error message (something along the lines of \"No traces have been recorded yet\").\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1583/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "elfring": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1548", "title": "Fix signal handler", "body": "I guess that a different program design will be needed for your function \"[handle_SIGTERM](https://github.com/mozilla/rr/blob/96702caf69eca5834c894b386b48f3c6a6597102/src/RecordCommand.cc#L135)\".\n- [The variable \"term_request\"](https://github.com/mozilla/rr/blob/96702caf69eca5834c894b386b48f3c6a6597102/src/RecordCommand.cc#L133) should [use the data type \"sig_atomic_t\"](https://www.securecoding.cert.org/confluence/display/c/SIG31-C.+Do+not+access+shared+objects+in+signal+handlers) (instead of \"bool\").\n- [The function \"LOG\"](https://github.com/mozilla/rr/blob/41c9529bb3d60a65b5e0abaff8a43d1736afac09/src/log.h#L147) does not belong to the list of [async-signal-safe functions](https://www.securecoding.cert.org/confluence/display/c/SIG30-C.+Call+only+asynchronous-safe+functions+within+signal+handlers).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1548/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1545", "title": "Completion of error handling", "body": "Would you like to add more error handling for return values from functions like the following?\n- [close](http://pubs.opengroup.org/onlinepubs/9699919799/functions/close.html) \u21d2 [AutoRemoteSyscalls::retrieve_fd_arch](https://github.com/mozilla/rr/blob/bad1d75f86e68aace5cce61d7eced4f1e9b707da/src/AutoRemoteSyscalls.cc#L397)\n- [fprintf](http://pubs.opengroup.org/onlinepubs/9699919799/functions/fprintf.html) \u21d2 [Command::print_help_all](https://github.com/mozilla/rr/blob/bfcfc0d392c73bf70b98873bc581abc202085a48/src/Command.cc#L46)\n- [pthread_create](http://pubs.opengroup.org/onlinepubs/9699919799/functions/pthread_create.html) \u21d2 [main](https://github.com/mozilla/rr/blob/d0706399699c26d914d685160d744924fdb4ec5d/src/test/threads.c#L39)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1545/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "heycam": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1539", "title": "unexpected signal delivery when replaying Firefox crashtest recording", "body": "```\n$ ./mach crashtest layout/base/crashtests/ --filter 374193-1.xhtml --debugger=rr --debugger-args=-M\n... (crashtest runs and exists after a fatal assertion, with some patches applied) ...\n$ rr replay\n...\n(gdb) c\n...\n[FATAL /z/rr/rr/src/ReplaySession.cc:560:guard_unexpected_signal() errno: 0 'Success'] \n (task 19000 (rec:18881) at time 8064)\n ->  Assertion `child_sig_is_zero_or_sigtrap' failed to hold. Replay got unrecorded event SIGNAL: SIGSEGV(async) while awaiting signal\n```\n\nLog around time 8064:\n\n```\n{\n  global_time:8056, event:`SYSCALL: munmap' (state:ENTERING_SYSCALL) tid:18879, ticks:8770267 rax:0xffffffffffffffda rbx:0xb rcx:0xffffffffffffffff rdx:0x2 rsi:0x2c13c80 rdi:0x2b7c1c72b000 rbp:0x7fff41268b80 rsp:0x7fff41268500 r8:0x0 r9:0xca r10:0x2b7c1f2a8e80 r11:0x202 r12:0x2b7c08d99800 r13:0x4f r14:0x0 r15:0x7fff41268620 rip:0 x70000018 eflags:0x202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0xb\n}\n{\n  global_time:8057, event:`SYSCALL: munmap' (state:EXITING_SYSCALL) tid:18879, ticks:8770267 rax:0x0 rbx:0xb rcx:0xffffffffffffffff rdx:0x2 rsi:0x2c13c80 rdi:0x2b7c1c72b000 rbp:0x7fff41268b80 rsp:0x7fff41268500 r8:0x0 r9:0xca r10:0x2b7c1f2a8e80 r11:0x202 r12:0x2b7c08d99800 r13:0x4f r14:0x0 r15:0x7fff41268620 rip:0x70000018 eflags:0x202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0xb\n}\n{\n  global_time:8058, event:`PATCH_SYSCALL' tid:18879, ticks:8770630\n}\n{\n  global_time:8059, event:`SYSCALLBUF_FLUSH' tid:18879, ticks:8770922\n}\n{\n  global_time:8060, event:`PATCH_SYSCALL' tid:18879, ticks:8770922\n}\n{\n  global_time:8061, event:`SYSCALLBUF_RESET' tid:18879, ticks:8770922\n}\n{\n  global_time:8062, event:`SYSCALL: exit_group' (state:ENTERING_SYSCALL) tid:18879, ticks:8770923 rax:0xffffffffffffffda rbx:0xe7 rcx:0xffffffffffffffff rdx:0x0 rsi:0x7fff41268d50 rdi:0x0 rbp:0x7fff412692b0 rsp:0x7fff41269020 r8:0x3c r9:0xe7 r10:0xffffffffffffff20 r11:0x202 r12:0x2b7c11e4d8fc r13:0x7fff4126a980 r14:0x0 r15:0x7fff41269140 rip:0x70000018 eflags:0x202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0xe7\n}\n{\n  global_time:8063, event:`EXIT' tid:18879, ticks:8770923\n}\n{\n  global_time:8064, event:`SIGNAL: SIGCHLD(async)' tid:18881, ticks:0 rax:0x0 rbx:0x2b7c1d50c700 rcx:0xffffffffffffffff rdx:0x2b7c1d50c9d0 rsi:0x2b7c1d50bf70 rdi:0x3d0f00 rbp:0x7fff41269100 rsp:0x2b7c1d50bf70 r8:0x2b7c1d50c700 r9:0x2b7c1d50c700 r10:0x2b7c1d50c9d0 r11:0x202 r12:0x0 r13:0x0 r14:0x2b7c1d50c9c0 r15:0x2b7c1d50c700 rip:0x2b7c08884441 eflags:0x202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x38\n}\n{\n  global_time:8065, event:`SIGNAL_DELIVERY: SIGCHLD(async)' tid:18881, ticks:0 rax:0x0 rbx:0x2b7c1d50c700 rcx:0xffffffffffffffff rdx:0x2b7c1d50c9d0 rsi:0x2b7c1d50bf70 rdi:0x3d0f00 rbp:0x7fff41269100 rsp:0x2b7c1d50bf70 r8:0x2b7c1d50c700 r9:0x2b7c1d50c700 r10:0x2b7c1d50c9d0 r11:0x202 r12:0x0 r13:0x0 r14:0x2b7c1d50c9c0 r15:0x2b7c1d50c700 rip:0x2b7c08884441 eflags:0x202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0x38\n}\n{\n  global_time:8066, event:`SEGV_RDTSC' tid:18881, ticks:3 rax:0xdc4a5aae rbx:0x2b7c1d50c700 rcx:0xffffffffffffffff rdx:0x8e7bf rsi:0x2b7c1d50bf70 rdi:0x2b7c1d50c700 rbp:0x0 rsp:0x2b7c1d50bee0 r8:0x2b7c1d50c700 r9:0x2b7c1d50c700 r10:0x2b7c1d50c9d0 r11:0x202 r12:0x0 r13:0x0 r14:0x2b7c1d50c9c0 r15:0x2b7c1d50c700 rip:0x2b7c07b500d2 eflags:0x10202 cs:0x33 ss:0x2b ds:0x0 es:0x0 fs:0x0 gs:0x0 orig_rax:0xffffffffffffffff\n}\n```\n\nWhen I record with `-n` the replay runs fine.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1539/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1415", "title": "add rr commands to manage recordings", "body": "Sometimes I lose track of which recordings I've made and which I want to keep. It would be nice if rr had command line commands to manage recordings by name so you can do things like:\n\n```\n$ rr list\nfirefox-0\nfirefox-1 (latest)\nfirefox-4\n$ rr mv firefox-0 firefox-bug123-repro\n$ rr rm firefox-1  # maybe rr rm latest, too\n$ rr replay firefox-bug123-repro\n```\n\nI can of course do this by moving directories around in ~/.rr.  But it would be nice just like it's nice with Mercurial queue management.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1415/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "glandium": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1527", "title": "Assertion `t->child_sig == sig' failed to hold. Replay got unrecorded signal 16 (expecting 11)", "body": "This is happening while reverse-continuing with a watchpoint on a crash on a firefox 18 (yes, that old) build.\nFull error is:\n\n```\n[FATAL /tmp/rr/src/ReplaySession.cc:970:emulate_deterministic_signal() errno: 0 'Success'] \n (task 9394 (rec:20931) at time 245168)\n ->  Assertion `t->child_sig == sig' failed to hold. Replay got unrecorded signal 16 (expecting 11)\n```\n\nThe rr backtrace when this assertion happens is (as per irc request):\n\n```\n(gdb) bt\n#0  ReplaySession::emulate_deterministic_signal (this=0xa6c7850, t=0x8adb250, sig=11, constraints=...)\n    at /tmp/rr/src/ReplaySession.cc:970\n#1  0x0000000000636276 in ReplaySession::try_one_trace_step (this=0xa6c7850, t=0x8adb250, constraints=...)\n    at /tmp/rr/src/ReplaySession.cc:1370\n#2  0x0000000000637172 in ReplaySession::replay_step (this=0xa6c7850, constraints=...) at /tmp/rr/src/ReplaySession.cc:1573\n#3  0x00000000006441d1 in ReplayTimeline::replay_step_to_mark (this=0x7ffdd3612438, mark=..., strategy=...)\n    at /tmp/rr/src/ReplayTimeline.cc:447\n#4  0x00000000006476f4 in ReplayTimeline::reverse_continue(std::function<bool ()>) (this=0x7ffdd3612438, interrupt_check=...)\n    at /tmp/rr/src/ReplayTimeline.cc:880\n#5  0x0000000000649d20 in ReplayTimeline::replay_step(RunCommand, RunDirection, unsigned int, std::function<bool ()>) (\n    this=0x7ffdd3612438, command=RUN_CONTINUE, direction=RUN_BACKWARD, stop_at_time=0, interrupt_check=...)\n    at /tmp/rr/src/ReplayTimeline.cc:1227\n#6  0x00000000005c94da in GdbServer::debug_one_step (this=0x7ffdd3612410, last_direction=0x7ffdd361229c)\n    at /tmp/rr/src/GdbServer.cc:882\n#7  0x00000000005ca4a8 in GdbServer::serve_replay (this=0x7ffdd3612410, flags=...) at /tmp/rr/src/GdbServer.cc:1085\n#8  0x000000000062f822 in replay (trace_dir=\"\", flags=...) at /tmp/rr/src/ReplayCommand.cc:369\n#9  0x000000000062fff2 in ReplayCommand::run (this=0x93c490 <ReplayCommand::singleton>, args=std::vector of length 0, capacity 1)\n    at /tmp/rr/src/ReplayCommand.cc:457\n#10 0x00000000005e5d9d in main (argc=2, argv=0x7ffdd3612b18) at /tmp/rr/src/main.cc:258\n```\n\nroc also asked this:\n\n```\n<roc> another thing that'd be useful is to log in Task::resume_execution via fprintf(stderr) usage of non-zero tick_period\n<roc> and enable DEBUG_TAG in GdbConnection.cc and ReplayTimeline.cc and dump the results\n```\n\nThe corresponding output looks like the following after the reverse-continue which leads to the error:\nhttps://gist.github.com/glandium/a745b5975616a064f40f\n\nI tried this patch, based on what other places in the same file do:\n\n``` diff\ndiff --git a/src/ReplaySession.cc b/src/ReplaySession.cc\nindex cc028ed..f1306af 100644\n--- a/src/ReplaySession.cc\n+++ b/src/ReplaySession.cc\n@@ -966,6 +966,11 @@ Completion ReplaySession::emulate_deterministic_signal(\n              is_debugger_trap(t, sig, DETERMINISTIC_SIG, UNKNOWN,\n                               constraints)) {\n     return INCOMPLETE;\n+  } else if (t->child_sig == PerfCounters::TIME_SLICE_SIGNAL) {\n+    // This would normally be triggered by constraints.ticks_target but it's\n+    // possible to get stray signals here.\n+    t->child_sig = 0;\n+    return INCOMPLETE;\n   }\n   ASSERT(t, t->child_sig == sig) << \"Replay got unrecorded signal \"\n                                  << t->child_sig << \" (expecting \" << sig\n```\n\nIt allows to go past the error, but then fail with:\n\n```\n[FATAL /tmp/rr/src/ReplayTimeline.cc:408:replay_step_to_mark() errno: 5 'Input/output error'] \n (task 4630 (rec:20931) at time 245145)\n ->  Assertion `current->trace_reader().time() == mark.ptr->key.trace_time' failed to hold. \n[INFO log_pending_events()] (no pending events)\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1527/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "bholley": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1509", "title": "rr fails running mochitest with: rr: /home/roc/rr/rr/src/task.cc:2422: void Task::open_mem_fd(): Assertion `remote_fd >= 0' failed.", "body": "Running rr-3.2.0 in a linux64 vm. Fails every time: log below:\n\n```\nbholley@ubuntu:~/repos/gecko-dev$ mach mochitest --debugger=rr dom/media/webaudio/test/test_waveDecoder.html \n/usr/bin/make -s -j5 -s install-tests\nFrom _tests: Kept 38822 existing; Added/updated 0; Removed 0 files and 0 directories.\n\n######\n### Now running mochitest-plain.\n######\n\nChecking for orphan ssltunnel processes...\nChecking for orphan xpcshell processes...\nSUITE-START | Running 1 tests\npk12util: PKCS12 IMPORT SUCCESSFUL\nMochitestServer : launching [u'/home/bholley/repos/gecko-dev/obj-x86_64-unknown-linux-gnu/dist/bin/xpcshell', '-g', u'/home/bholley/repos/gecko-dev/obj-x86_64-unknown-linux-gnu/dist/bin', '-v', '170', '-f', u'/home/bholley/repos/gecko-dev/obj-x86_64-unknown-linux-gnu/dist/bin/components/httpd.js', '-e', \"const _PROFILE_PATH = '/tmp/tmp4drTar.mozrunner'; const _SERVER_PORT = '8888'; const _SERVER_ADDR = '127.0.0.1'; const _TEST_PREFIX = undefined; const _DISPLAY_RESULTS = true;\", '-f', '/home/bholley/repos/gecko-dev/obj-x86_64-unknown-linux-gnu/_tests/testing/mochitest/server.js']\nruntests.py | Server pid: 3694\n[3694] WARNING: Re-registering a CID?: file /home/bholley/repos/gecko-dev/xpcom/components/nsComponentManager.cpp, line 551\nruntests.py | Websocket server pid: 3697\nruntests.py | SSL tunnel pid: 3705\nruntests.py | Running tests: start.\n\nruntests.py | Application pid: 3721\n(process:3733): GLib-CRITICAL **: g_slice_set_config: assertion 'sys_page_size == 0' failed\n### XPCOM_MEM_BLOAT_LOG defined -- logging bloat/leaks to /tmp/tmp4drTar.mozrunner/runtests_leaks.log\n[3733] WARNING: Attempt to add property GnomeProgram::sm-connect after class was initialised: 'glib warning', file /home/bholley/repos/gecko-dev/toolkit/xre/nsSigHandlers.cpp, line 140\n(firefox:3733): GLib-GObject-WARNING **: Attempt to add property GnomeProgram::sm-connect after class was initialised\n[3733] WARNING: Attempt to add property GnomeProgram::show-crash-dialog after class was initialised: 'glib warning', file /home/bholley/repos/gecko-dev/toolkit/xre/nsSigHandlers.cpp, line 140\n(firefox:3733): GLib-GObject-WARNING **: Attempt to add property GnomeProgram::show-crash-dialog after class was initialised\n[3733] WARNING: Attempt to add property GnomeProgram::display after class was initialised: 'glib warning', file /home/bholley/repos/gecko-dev/toolkit/xre/nsSigHandlers.cpp, line 140\n(firefox:3733): GLib-GObject-WARNING **: Attempt to add property GnomeProgram::display after class was initialised\n[3733] WARNING: Attempt to add property GnomeProgram::default-icon after class was initialised: 'glib warning', file /home/bholley/repos/gecko-dev/toolkit/xre/nsSigHandlers.cpp, line 140\n(firefox:3733): GLib-GObject-WARNING **: Attempt to add property GnomeProgram::default-icon after class was initialised\n[3733] WARNING: Re-registering a CID?: file /home/bholley/repos/gecko-dev/xpcom/components/nsComponentManager.cpp, line 551\n++DOCSHELL 0x2aaad36ac000 == 1 [pid = 3733] [id = 1]\n++DOMWINDOW == 1 (0x2aaad6146c00) [pid = 3733] [serial = 1] [outer = (nil)]\n[3733] WARNING: Enabling vsync refresh driver: file /home/bholley/repos/gecko-dev/layout/base/nsRefreshDriver.cpp, line 859\n[3733] WARNING: Hardware Vsync support not yet implemented. Falling back to software timers: file /home/bholley/repos/gecko-dev/gfx/thebes/gfxPlatform.cpp, line 2410\n++DOMWINDOW == 2 (0x2aaad6153400) [pid = 3733] [serial = 2] [outer = 0x2aaad6146c00]\nLoadPlugin() /tmp/tmp4drTar.mozrunner/plugins/libnptest.so returned 2aaad0769040\nLoadPlugin() /tmp/tmp4drTar.mozrunner/plugins/libnpsecondtest.so returned 2aaad07691c0\nLoadPlugin() /tmp/tmp4drTar.mozrunner/plugins/libnptestjava.so returned 2aaad0769490\nLoadPlugin() /usr/lib/mozilla/plugins/librhythmbox-itms-detection-plugin.so returned 2aaad0769700\nLoadPlugin() /usr/lib/mozilla/plugins/libtotem-narrowspace-plugin.so returned 2aaadf89feb0\nLoadPlugin() /usr/lib/mozilla/plugins/libtotem-cone-plugin.so returned 2aaadf8a01f0\nLoadPlugin() /usr/lib/mozilla/plugins/libtotem-gmp-plugin.so returned 2aaadf8a07f0\nLoadPlugin() /usr/lib/mozilla/plugins/libtotem-mully-plugin.so returned 2aaadf8a0b20\n++DOCSHELL 0x2aaae0a71000 == 2 [pid = 3733] [id = 2]\n++DOMWINDOW == 3 (0x2aaae0a9e000) [pid = 3733] [serial = 3] [outer = (nil)]\n++DOMWINDOW == 4 (0x2aaae0a9e800) [pid = 3733] [serial = 4] [outer = 0x2aaae0a9e000]\n++DOMWINDOW == 5 (0x2aaae0ce6000) [pid = 3733] [serial = 5] [outer = 0x2aaad6146c00]\n-*- Webapps.jsm : Saving /tmp/tmp4drTar.mozrunner/webapps/webapps.json\n-*- Webapps.jsm : Saving /tmp/tmp4drTar.mozrunner/webapps/webapps.json\n-*- Webapps.jsm : Success saving /tmp/tmp4drTar.mozrunner/webapps/webapps.json\n-*- Webapps.jsm : Success saving /tmp/tmp4drTar.mozrunner/webapps/webapps.json\n++DOCSHELL 0x2aaad3657000 == 3 [pid = 3733] [id = 3]\n++DOMWINDOW == 6 (0x2aaad4a11000) [pid = 3733] [serial = 6] [outer = (nil)]\n++DOCSHELL 0x2aaad3659800 == 4 [pid = 3733] [id = 4]\n++DOMWINDOW == 7 (0x2aaad4a11400) [pid = 3733] [serial = 7] [outer = (nil)]\n[3733] WARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80040111: file /home/bholley/repos/gecko-dev/dom/base/nsFrameLoader.cpp, line 266\n++DOCSHELL 0x2aaaea309800 == 5 [pid = 3733] [id = 5]\n++DOMWINDOW == 8 (0x2aaae957a800) [pid = 3733] [serial = 8] [outer = (nil)]\n[3733] WARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80040111: file /home/bholley/repos/gecko-dev/dom/base/nsFrameLoader.cpp, line 266\n++DOMWINDOW == 9 (0x2aaaea3ec400) [pid = 3733] [serial = 9] [outer = 0x2aaae957a800]\n[3733] WARNING: NS_ENSURE_TRUE(globalObject && globalObject->GetGlobalJSObject()) failed: file /home/bholley/repos/gecko-dev/dom/base/nsDocument.cpp, line 8318\n[3733] WARNING: NS_ENSURE_TRUE(globalObject && globalObject->GetGlobalJSObject()) failed: file /home/bholley/repos/gecko-dev/dom/base/nsDocument.cpp, line 8318\n++DOMWINDOW == 10 (0x2aaae4d5bc00) [pid = 3733] [serial = 10] [outer = 0x2aaad4a11000]\n++DOMWINDOW == 11 (0x2aaae4d5c400) [pid = 3733] [serial = 11] [outer = 0x2aaad4a11400]\n++DOMWINDOW == 12 (0x2aaae4d5e400) [pid = 3733] [serial = 12] [outer = 0x2aaae957a800]\n[3733] WARNING: OpenGL-accelerated layers are not supported on this system: file /home/bholley/repos/gecko-dev/widget/nsBaseWidget.cpp, line 889\n[3733] WARNING: Could not get disk status from nsIDiskSpaceWatcher: file /home/bholley/repos/gecko-dev/uriloader/prefetch/nsOfflineCacheUpdateService.cpp, line 317\n++DOMWINDOW == 13 (0x2aaae459e800) [pid = 3733] [serial = 13] [outer = 0x2aaae957a800]\n[3733] WARNING: Suboptimal indexes for the SQL statement 0x2aaae328c420 (http://mzl.la/1FuID0j).: file /home/bholley/repos/gecko-dev/storage/mozStoragePrivateHelpers.cpp, line 109\n[3733] WARNING: Failed to retarget HTML data delivery to the parser thread.: file /home/bholley/repos/gecko-dev/parser/html/nsHtml5StreamParser.cpp, line 951\n[3733] WARNING: Suboptimal indexes for the SQL statement 0x2aaae328c420 (http://mzl.la/1FuID0j).: file /home/bholley/repos/gecko-dev/storage/mozStoragePrivateHelpers.cpp, line 109\n[3733] WARNING: Suboptimal indexes for the SQL statement 0x2aaae328c420 (http://mzl.la/1FuID0j).: file /home/bholley/repos/gecko-dev/storage/mozStoragePrivateHelpers.cpp, line 109\n[3733] WARNING: Suboptimal indexes for the SQL statement 0x2aaae328c420 (http://mzl.la/1FuID0j).: file /home/bholley/repos/gecko-dev/storage/mozStoragePrivateHelpers.cpp, line 109\n[3733] WARNING: Suboptimal indexes for the SQL statement 0x2aaae328c420 (http://mzl.la/1FuID0j).: file /home/bholley/repos/gecko-dev/storage/mozStoragePrivateHelpers.cpp, line 109\n[3733] WARNING: Suboptimal indexes for the SQL statement 0x2aaae328c420 (http://mzl.la/1FuID0j).: file /home/bholley/repos/gecko-dev/storage/mozStoragePrivateHelpers.cpp, line 109\n++DOCSHELL 0x2aaae2983000 == 6 [pid = 3733] [id = 6]\n++DOMWINDOW == 14 (0x2aaaed640000) [pid = 3733] [serial = 14] [outer = (nil)]\n++DOMWINDOW == 15 (0x2aaae09e8c00) [pid = 3733] [serial = 15] [outer = 0x2aaaed640000]\n[3733] WARNING: NS_ENSURE_TRUE(aURI) failed: file /home/bholley/repos/gecko-dev/netwerk/dns/nsEffectiveTLDService.cpp, line 158\n[3733] WARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80070057: file /home/bholley/repos/gecko-dev/dom/base/ThirdPartyUtil.cpp, line 355\nSimpleTest START\nTEST-START | /tests/dom/media/webaudio/test/test_waveDecoder.html\n++DOMWINDOW == 16 (0x2aaad0315c00) [pid = 3733] [serial = 16] [outer = 0x2aaaed640000]\n[3733] WARNING: NS_ENSURE_TRUE(aURI) failed: file /home/bholley/repos/gecko-dev/netwerk/dns/nsEffectiveTLDService.cpp, line 158\n[3733] WARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80070057: file /home/bholley/repos/gecko-dev/dom/base/ThirdPartyUtil.cpp, line 355\n[3733] WARNING: NS_ENSURE_SUCCESS(rv, BadImage(newImage)) failed with result 0x80004005: file /home/bholley/repos/gecko-dev/image/ImageFactory.cpp, line 244\n++DOMWINDOW == 17 (0x2aaad4edd800) [pid = 3733] [serial = 17] [outer = 0x2aaaed640000]\nrr: /home/roc/rr/rr/src/task.cc:2422: void Task::open_mem_fd(): Assertion `remote_fd >= 0' failed.\nTEST-INFO | Main app process: killed by out-of-range signal, number 122\nTEST-UNEXPECTED-FAIL | automation.py | application terminated with exit code -134\nruntests.py | Application ran for: 0:00:18.932396\nzombiecheck | Reading PID log: /tmp/tmp_yOEDrpidlog\nStopping web server\nStopping web socket server\nStopping ssltunnel\nTEST-INFO | leakcheck | default process: leak threshold set at 0 bytes\nTEST-INFO | leakcheck | plugin process: leak threshold set at 0 bytes\nTEST-INFO | leakcheck | tab process: leak threshold set at 10000 bytes\nTEST-INFO | leakcheck | geckomediaplugin process: leak threshold set at 20000 bytes\n\nTEST-UNEXPECTED-FAIL | leakcheck | default process: missing output line for total leaks!\nTEST-INFO | leakcheck | missing output line from log file /tmp/tmp4drTar.mozrunner/runtests_leaks.log\nruntests.py | Running tests: end.\nSUITE-END | took 20s\nbholley@ubuntu:~/repos/gecko-dev$ \n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1509/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "tbsaunde": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1497", "title": "rr crashes while replaying", "body": "str\ncheckout and build rr at commit 6915ac0\nthen record firefox startup just until the first page is shown is more than enough.\nrun rr replay\nset a breakpoint on do_main\nrun continue in gdb\nobserve after js pretty printers say they have been loaded gdb prints connection closed, and the rr process is now a zombie.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "BenjaminSchubert": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1480", "title": "PTRACE_INTERRUPT raced with another event", "body": "I've got a problem while running RR under docker on an old buggy version of transmission (v1.42). Here is what rr -V record gives me : \n\n[WARN wait() errno: 0 'Success'] PTRACE_INTERRUPT raced with another even 0x857f\n[Warn done_preparing() errno: 0 'Success'] `epoll_wait' neede a scratch bugger of size 6291448, but only 2097152 was available. Disabling context switching : deadlock may follow.\n\nThis message keeps getting printed again and again. The exact same command did work on an older version of RR. (don't remember which though)\n\nDo you have any idea of what it could be ?\n\nThanks\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1480/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "luser": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1468", "title": "Get Jenkins to set project status, do builds for pull requests, remove Travis", "body": "I stood up a Jenkins instance that's doing builds + tests for master. It needs a little more fiddling to be comparable to what Travis gives us:\n- Set project status\n- Build pull requests\n\nOnce we get those working we can remove Travis.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1468/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1440", "title": "Bring back a prerelease indicator in version", "body": "While implementing https://github.com/mozilla/rr/pull/1437 I wished that the version number would differentiate between a prerelease and official release. I saw that @cgjones had removed this at some point in the past and there's an exasperated comment in the source, so maybe this is hard to do?\nhttps://github.com/mozilla/rr/blob/0e9fe8332674f4ce36e0ae079c4ba4c57884a7f6/CMakeLists.txt#L12\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1440/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26291421", "body": "Yeah, I would have left that out entirely but I didn't want to rewrite all the option-parsing code.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/26291421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "MEMBER"}]}, "kellerb": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1467", "title": "Assertion failure stepping through execv", "body": "Encountered assertion error while replaying process created with fork-exec. Started replay with `rr replay -f <pid>`, and stepped (gdb `s` command) three times into `execv` call.\n\nA workaround (for single exec processes) is to use `-f` to replay the behavior before the exec and `-p` to replay the behavior after.\n\nRunning latest master 7bf7fd443888ad7c5ee8f6120f95d2c719c3b9ae\n\n```\nCannot access memory at address 0x2a6\n[FATAL /home/kellerb/software/rr/rr/src/ReplayTimeline.cc:564:remove_breakpoint() errno: 5 'Input/output error'] \n (task 4754 (rec:2948) at time 9983)\n ->  Assertion `it != breakpoints.end()' failed to hold. \n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "joneschrisg": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1431", "title": "Test string_instructions-32-no-syscallbuf failing on fedora 21 (\"Assertion `(pending_sig() == SIGTRAP || ReplaySession::is_ignored_signal(pending_sig()))' failed to hold. PENDING SIG IS SIGSTKFLT\")", "body": "Seeing the following gdb interaction\n\n```\n(gdb) break string_store\nbreak string_store\nBreakpoint 1 at 0x8048841: file /home/cjones/rr/obj/32/string_instructions.c, line 36.\nc\n(gdb) c\nContinuing.\n\nBreakpoint 1, string_store (dest=0x55995008 \"\", a=1633771873, size=10485760, unit=1, dir=1) at /home/cjones/rr/obj/32/string_instructions.c:36\n36    set_dir(dir);\nfinish\nwatch -l p[1000000]\n(gdb) finish\nRun till exit from #0  string_store (dest=0x55995008 \"\", a=1633771873, size=10485760, unit=1, dir=1) at /home/cjones/rr/obj/32/string_instructions.c:36\n0x08048c51 in main (argc=1, argv=0xffffd5c4) at /home/cjones/rr/obj/32/string_instructions.c:254\n254     string_store(p, pattern, size_units, unit, dir);\n(gdb) watch -l p[1000000]\nHardware watchpoint 2: -location p[1000000]reverse-continue\n\n(gdb) reverse-continue\nContinuing.\n[FATAL /home/cjones/rr/rr/src/task.cc:353:finish_emulated_syscall() errno: 0 'Success'] \n (task 31530 (rec:31475) at time 294)\n ->  Assertion `(pending_sig() == SIGTRAP || ReplaySession::is_ignored_signal(pending_sig()))' failed to hold. PENDING SIG IS SIGSTKFLT\n```\n\nSeeing if I can repro.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1431/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1416", "title": "Replay graphics for graphical programs", "body": "This is a pretty oft-requested feature and would be a majestic increase of rr's killing power.  We've brainstormed a few ways to do this.  The most promising way is probably to emulate the X command stream, though of course that's a tremendous amount of work.  Perhaps someone has already done that as part of an X debugger?  Another way is to let client programs \"opt in\" to graphics replay by writing presented buffers back to rr somehow.  This would be dirt simple but has the disadvantage of slowing down recording and potentially ballooning the trace saved-data.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1416/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1405", "title": "rr never attaches gdb if -g specified beyond end-of-trace", "body": "For example, if a trace has 10 events, and the user says `rr replay -g 20`, then the behavior is the same as `rr replay -a` --- the gdb client is never loaded, so the user never sees the gdb UI.  This is probably not what the user expects.  Better is probably to attach gdb when the last task exits.\n\nBut this is edge-case enough that I don't really care.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1405/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1396", "title": "Track growth of MAP_GROWSDOWN segments", "body": "Followup to #1355.  These segments can be automatically grown downward by the kernel when userspace accesses outside the segment bounds.  rr gets no notification of this.  This is a potentially bad bug if one of these segments actually does grow, and then userspace tries to map or unmap some pages near the stack.  rr's stale cache could cause it to misinterpret m{,re,un}map semantics.\n\nOne way to handle this is, if there's a m{,re,un}map operation on a memory cell that falls in the range (lower-segment, map-grows-down-segment], then throw out the mmap cache and rebuild it before interpreting the operation.  Another option is to always map a guard page just below a MAP_GROWSDOWN segment, and have rr implement the segment auto-growth semantics itself.\n\nNeither of these is exactly trivial, so I'm favor of leaving this alone until it becomes a problem in practice.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1396/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1394", "title": "Divergence recording FF on x64", "body": "Found while looking at #1355, but apparently unrelated.  Haven't tried to reproduce yet, but the steps I took were\n- record FF with `rr -K`.  Open XUL menu, load new non-e10s window, load google.com\n- replay with `rr -K`\n\nWe hit the following divergence\n\n```\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> rbx 0x2aaaab100218 != 0x2aaad386f420 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> rdx 0 != 0x2aaaab040108 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> rsi 0 != 0x7c1b (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> rdi 0x2aaaab100218 != 0x2aaac0597000 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> rbp 0 != 0x1 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r8 0 != 0x2aaad38da730 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r9 0 != 0x50 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r10 0 != 0x7fffffff8060 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r11 0x246 != 0x202 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r13 0x7fffffff7bd0 != 0x2aaad8313e00 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r14 0x2aaab7d703e8 != 0 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> r15 0x7fffffff7b88 != 0x7fffffff8740 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> rip 0x70000004 != 0x3bbbeef657 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> eflags 0x244 != 0x200 (replaying vs. recorded)\n[ERROR /home/cjones/rr/rr/src/Registers.cc:292:maybe_print_reg_mismatch() errno: 0 'Success'] \n -> orig_rax 0x60 != 0xb (replaying vs. recorded)\n[FATAL /home/cjones/rr/rr/src/Registers.cc:412:compare_register_files() errno: 0 'Success'] \n (task 24043 (rec:23904) at time 147230)\n ->  Assertion `!bail_error || match' failed to hold. Fatal register mismatch (ticks/rec:384335579/384325013)\n```\n\nfrom this context\n\n```\n(gdb) bt\n#0  0x0000000070000004 in ?? ()\n#1  0x00002aaaaacb2a0b in _untraced_raw_syscall () at /home/cjones/rr/rr/src/preload/traced_syscall_shared.S:67\n#2  0x00002aaaaacb2020 in untraced_syscall (a5=0, a4=0, a3=0, a2=0, a1=0, a0=46912502759960, syscallno=96)\n    at /home/cjones/rr/rr/src/preload/preload.c:409\n#3  sys_gettimeofday (call=0x7fffffff7b88) at /home/cjones/rr/rr/src/preload/preload.c:1275\n#4  syscall_hook (call=0x7fffffff7b88) at /home/cjones/rr/rr/src/preload/preload.c:1655\n#5  0x00002aaaaacb2a22 in _syscall_hook_trampoline () at /home/cjones/rr/rr/src/preload/syscall_hook.S:135\n#6  0x00002aaaaaaade5a in gettimeofday ()\n#7  0x00002aaaad126ef8 in js::gc::GCRuntime::maybePeriodicFullGC() () from /home/cjones/Desktop/firefox/libxul.so\n#8  0x00002aaaacf7e08f in mozilla::dom::AutoEntryScript::~AutoEntryScript() () from /home/cjones/Desktop/firefox/libxul.so\n#9  0x00002aaaacf3f697 in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) () from /home/cjones/Desktop/firefox/libxul.so\n#10 0x00002aaaad1f6261 in PrepareAndDispatch () from /home/cjones/Desktop/firefox/libxul.so\n#11 0x00002aaaad1f5753 in SharedStub () from /home/cjones/Desktop/firefox/libxul.so\n#12 0x00002aaaad8ff482 in nsXMLHttpRequest::GetInterface(nsID const&, void**) () from /home/cjones/Desktop/firefox/libxul.so\n#13 0x00002aaaad234558 in void NS_QueryNotificationCallbacks<nsIChannel>(nsIChannel*, nsID const&, void**) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#14 0x00002aaaad2347e6 in NS_UsePrivateBrowsing(nsIChannel*) () from /home/cjones/Desktop/firefox/libxul.so\n#15 0x00002aaaad2f164c in mozilla::net::nsHttpChannelAuthProvider::Init(nsIHttpAuthenticableChannel*) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#16 0x00002aaaad342d30 in mozilla::net::nsHttpChannel::BeginConnect() () from /home/cjones/Desktop/firefox/libxul.so\n#17 0x00002aaaad3435da in mozilla::net::nsHttpChannel::OnProxyAvailable(nsICancelable*, nsIURI*, nsIProxyInfo*, tag_nsresult) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#18 0x00002aaaad25c7a4 in nsAsyncResolveRequest::DoCallback() () from /home/cjones/Desktop/firefox/libxul.so\n#19 0x00002aaaad25ca90 in nsAsyncResolveRequest::Run() () from /home/cjones/Desktop/firefox/libxul.so\n#20 0x00002aaaad25cc10 in nsProtocolProxyService::AsyncResolveInternal(nsIURI*, unsigned int, nsIProtocolProxyCallback*, nsICancelable**, bool) () from /home/cjones/Desktop/firefox/libxul.so\n#21 0x00002aaaad32230d in mozilla::net::nsHttpChannel::ResolveProxy() () from /home/cjones/Desktop/firefox/libxul.so\n#22 0x00002aaaad3437dd in mozilla::net::nsHttpChannel::AsyncOpen(nsIStreamListener*, nsISupports*) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#23 0x00002aaaad9005f7 in nsXMLHttpRequest::Send(nsIVariant*, mozilla::dom::Nullable<nsXMLHttpRequest::RequestBody> const&) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#24 0x00002aaaadd0ae0d in nsXMLHttpRequest::Send(JSContext*, nsAString_internal const&, mozilla::ErrorResult&) [clone .isra.531]\n    () from /home/cjones/Desktop/firefox/libxul.so\n#25 0x00002aaaadd35876 in mozilla::dom::XMLHttpRequestBinding::send(JSContext*, JS::Handle<JSObject*>, nsXMLHttpRequest*, JSJitMethodCallArgs const&) () from /home/cjones/Desktop/firefox/libxul.so\n#26 0x00002aaaacf91c2f in mozilla::dom::GenericBindingMethod(JSContext*, unsigned int, JS::Value*) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#27 0x00002aaaad15dbd2 in js::Invoke(JSContext*, JS::CallArgs, js::MaybeConstruct) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#28 0x00002aaaad151a56 in Interpret(JSContext*, js::RunState&) () from /home/cjones/Desktop/firefox/libxul.so\n#29 0x00002aaaad15d839 in js::RunScript(JSContext*, js::RunState&) () from /home/cjones/Desktop/firefox/libxul.so\n#30 0x00002aaaad15dcb8 in js::Invoke(JSContext*, JS::CallArgs, js::MaybeConstruct) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#31 0x00002aaaad15e5a6 in js::Invoke(JSContext*, JS::Value const&, JS::Value const&, unsigned int, JS::Value const*, JS::MutableHandle<JS::Value>) () from /home/cjones/Desktop/firefox/libxul.so\n#32 0x00002aaaad1064d2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) () from /home/cjones/Desktop/firefox/libxul.so\n#33 0x00002aaaacf3f4bd in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) () from /home/cjones/Desktop/firefox/libxul.so\n#34 0x00002aaaad1f6261 in PrepareAndDispatch () from /home/cjones/Desktop/firefox/libxul.so\n#35 0x00002aaaad1f5753 in SharedStub () from /home/cjones/Desktop/firefox/libxul.so\n#36 0x00002aaaad1f55d0 in NS_InvokeByIndex () from /home/cjones/Desktop/firefox/libxul.so\n#37 0x00002aaaacf3c40e in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#38 0x00002aaaacf3ead5 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) () from /home/cjones/Desktop/firefox/libxul.so\n#39 0x00002aaaad15dbd2 in js::Invoke(JSContext*, JS::CallArgs, js::MaybeConstruct) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#40 0x00002aaaad151a56 in Interpret(JSContext*, js::RunState&) () from /home/cjones/Desktop/firefox/libxul.so\n#41 0x00002aaaad15d839 in js::RunScript(JSContext*, js::RunState&) () from /home/cjones/Desktop/firefox/libxul.so\n#42 0x00002aaaad15dcb8 in js::Invoke(JSContext*, JS::CallArgs, js::MaybeConstruct) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#43 0x00002aaaad15e5a6 in js::Invoke(JSContext*, JS::Value const&, JS::Value const&, unsigned int, JS::Value const*, JS::MutableHandle<JS::Value>) () from /home/cjones/Desktop/firefox/libxul.so\n#44 0x00002aaaad1064d2 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) () from /home/cjones/Desktop/firefox/libxul.so\n#45 0x00002aaaacf3f4bd in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) () from /home/cjones/Desktop/firefox/libxul.so\n#46 0x00002aaaad1f6261 in PrepareAndDispatch () from /home/cjones/Desktop/firefox/libxul.so\n#47 0x00002aaaad1f5753 in SharedStub () from /home/cjones/Desktop/firefox/libxul.so\n#48 0x00002aaaad1f1095 in nsTimerImpl::Fire() () from /home/cjones/Desktop/firefox/libxul.so\n#49 0x00002aaaad1f1afe in nsTimerEvent::Run() () from /home/cjones/Desktop/firefox/libxul.so\n#50 0x00002aaaacf0ecd1 in nsThread::ProcessNextEvent(bool, bool*) () from /home/cjones/Desktop/firefox/libxul.so\n#51 0x00002aaaacf16f4e in NS_ProcessNextEvent(nsIThread*, bool) () from /home/cjones/Desktop/firefox/libxul.so\n#52 0x00002aaaad1f2f99 in nsThread::Shutdown() () from /home/cjones/Desktop/firefox/libxul.so\n#53 0x00002aaaad1f3043 in nsRunnableMethodImpl<tag_nsresult (nsIThread::*)(), void, true>::Run() ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#54 0x00002aaaacf0efa6 in nsThread::ProcessNextEvent(bool, bool*) () from /home/cjones/Desktop/firefox/libxul.so\n#55 0x00002aaaacf16f4e in NS_ProcessNextEvent(nsIThread*, bool) () from /home/cjones/Desktop/firefox/libxul.so\n#56 0x00002aaaacf2a673 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) ()\n   from /home/cjones/Desktop/firefox/libxul.so\n#57 0x00002aaaad3e7ac2 in MessageLoop::Run() () from /home/cjones/Desktop/firefox/libxul.so\n#58 0x00002aaaae16c828 in nsBaseAppShell::Run() () from /home/cjones/Desktop/firefox/libxul.so\n#59 0x00002aaaae6a3a08 in nsAppStartup::Run() () from /home/cjones/Desktop/firefox/libxul.so\n#60 0x00002aaaae6d9354 in XREMain::XRE_mainRun() () from /home/cjones/Desktop/firefox/libxul.so\n#61 0x00002aaaae6db865 in XREMain::XRE_main(int, char**, nsXREAppData const*) () from /home/cjones/Desktop/firefox/libxul.so\n#62 0x00002aaaae6dbafa in XRE_main () from /home/cjones/Desktop/firefox/libxul.so\n#63 0x0000000000407a66 in do_main(int, char**, nsIFile*) ()\n#64 0x0000000000404ceb in main ()\n```\n\nIt looks like we've trampolined off into the woods, but I'm not sure why.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1394/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1382", "title": "Make a docker-style tutorial", "body": "Check out this tutorial (just a few steps suffices to get the point)\n\nhttps://www.docker.com/tryit/\n\nI don't know what alchemy went into making it, but ... yeah that's the right way to do that.\n\nrr would greatly greatly benefit from something like this, I suspect.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1382/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1287", "title": "Add support for cross-OS replay", "body": "This is a mostly-crazy idea but I wanted to jot it down while it's fresh.\n\nrr traces are actually quite OS-independent (modulo lack of filesystem independence from not using reflink), because rr essentially records the OS \"semantics\".  It sounds a little crazy, but it wouldn't be conceptually hard to replay rr traces on OS X or even win32 as long as (i) can set up syscall insns to trap to tracer; (ii) can program perf counter interrupts for tracees.\n\nNot conceptually hard, but it'd be a lot of work.  Also unclear how debugging would work.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1287/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1284", "title": "Does rr work correctly on Broadwell CPUs?", "body": "This is the \"tick\" for Haswell so should be straightforward.  These should be released soon-ish.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1276", "title": "valgrind aborts after fork during replay", "body": "#16.  My guess is that valgrind saves a tid value before ptrace-seize, then after makes a syscall that exposes a tid.  Since before-seize the tid is real, and afterwards emulated from the recording, the world changes out from under valgrind and it's unhappy.\n\n```\nvalgrind: ../../coregrind/m_scheduler/sema.c:139 (vgModuleLocal_sema_up): Assertion 'sema->owner_lwpid == VG_(gettid)()' failed.\n```\n\nThis obviously causes a replay divergence and rr abort.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1272", "title": "Handling of scratch-needed-but-not-allowed syscalls is poor", "body": "Nonexistent?\n\nThis popped up in the context of #16: valgrind is doing a sigtimedwait from a context that can't use scratch (which I need to poke at more), and the code to process the syscall outparams doesn't handle the scratch-aborted case.\n\nThe naive fixes for this are messy and verbose.  I'm going to paper over the valgrind issue and leave this open for a cleaner general solution, if one exists.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1272/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1262", "title": "CPUID-triggered rcb undercounts are not reliably handled", "body": "... and then replay diverges :/.  I've never seen this warning printed on my Ivy Bridge machine before, and IIRC this was a Haswell bug.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1262/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1251", "title": "Replay of Firefox reftest-ipc-like tests takes a long time", "body": "The crashtest-ipc and reftest-ipc suites.  Recording doesn't seem to take unusually long, but I've had to abort two replay runs.  I also don't remember noticing this before, but there seem to be a lot more -ipc tests enabled now (which is great!).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1251/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1228", "title": "Followup to #605 (gdb's \"call foo()\")", "body": "One item I was on the fence about in #605 but ended up not doing was printing a warning to the user when they enter `call` mode that any mutation will be discarded.  Things will 99.9% Just Work if we do this right, so I figured the warning would mostly be distracting noise.\n\nThe remaining followups are related to the following set of corner cases.  Usually, a `call foo()` invocation is made, returns, and gdb cleans up immediately.  However, there are several ways gdb can stop _in the middle_ of a `call foo()`: signals triggered by `foo()`, breakpoints hit, etc (transitively).  When this happens, control returns to the user and they can do arbitrary gdb-things, except they're doing them on the experiment session.  Here's an initial list of things that might be problematic if done within a stopped `call foo()`\n- checkpoint/restore\n- restart debugging session\n- nested `call foo()` (this may Just Work, actually)\n- single-stepping all the way through gdb call prevents terminate-call heuristic from being hit, so experiment persists indefinitely (this may have been due to a bug in an old version of my patch)\n\nIn each case, we can just add a test and sort out the necessary hacks as demand presses.\n\nRelated to corner cases around interrupted `call foo()`, it might be worthwhile to add a command to rr's `.gdbinit` to explicitly terminate a `call foo()` session.  Awkward for users though.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1228/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1163", "title": "Add syscall-interruption checkpointing tests", "body": "Followup to #1139.  These are tricky because the pexpect script has to deal with gdb entering signal-stop when the tests kill themselves.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1163/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1156", "title": "Interrupting an rr test blows away the test directory", "body": "After #1147, we default to blowing away the tmp dir on exit.  Previously we only did this when the test explicitly passed.  The problem is when I Ctrl-c interrupt a test, I often want to do something with the contents of the test dir.\n\nWe can make the leave_data var be tri-state, initially \"?\" or something, and then updating it would be `leave_data = ('y' == leave_data ? 'y' : test_passed() ? 'n' : 'y')`.  @rocallahan do you see any problems with that?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1156/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1120", "title": "Running rr test parent_no_stop_child_crash: \"`unstable || PTRACE_EVENT_EXIT == ptrace_event()' failed\"", "body": "<pre>\n277: buffer (last 100 chars): Assertion `unstable || PTRACE_EVENT_EXIT == ptrace_event()' failed.\n</pre>\n\nSeen on x86 VM.  Not reproducible.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1120/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1119", "title": "Recording FF crashtest-ipc: \"Should be entering mmap2, but instead at clone\"", "body": "<pre>\nAssertion `t->regs().orig_eax == syscallno' failed to hold. Should be entering mmap2, but instead at clone\n</pre>\n\nI've seen this happen twice now with gecko-dev sha1 876943a61001e8ccf48ce6cfb9cd0724100b0bb8.  This is at the very end of the recording session, so it's not going to cause significant issues in practice, so not blocking 1.3 on it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1119/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1113", "title": "rr doesn't process all heap updates correctly", "body": "Discovered while working on #603.  Now that we're not re-`exec()`ing the replayer process on restarts, the initial tracee forks into whatever random address space rr has at the time of restart.  In the test I'm debugging, the bottom of the vm looks like\n\n<pre>\n081c2000-081cc000 rw-p 00179000 fd:02 3539042                            /home/cjones/rr/obj/bin/rr\n081cc000-082cf000 rw-p 00000000 00:00 0 \n09120000-09141000 rw-p 00000000 00:00 0                                  [heap]\n09141000-09161000 rw-p 00000000 00:00 0                                  [heap]\n4cee1000-4cf00000 r-xp 00000000 fd:00 1315350                            /usr/lib/ld-2.18.so\n</pre>\n\nSeveral things here that would confuse our vm tracking code\n- a non-heap region has been mapped just after the data segment. rr doesn't know to update the program break if this happens.\n- the heap isn't contiguous.  Presumably part of it has been unmapped.  (Perhaps glibc's memory allocator has gotten smarter?)  rr assumes a contiguous heap.\n- the heap isn't adjacent to the last non-heap page.  It could be that it was originally adjacent, but then the adjacent part was unmapped.\n\nWe've apparently been able to get away with this for so long because FF uses jemalloc, which doesn't touch the vm heap.\n\nWe need to support this eventually, but for #603 I might hack in a temporary workaround that skips inferring the vm for non-verified processes (initial rr fork child).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1113/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1060", "title": "Test \"block_intr_sigchld\" intermittently hanging", "body": "I've seen this twice now today.  I don't remember it doing this before, but I also don't know of any recent changes that might have caused these hangs to trigger.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1060/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1053", "title": "Implement remaining syscalls", "body": "We're probably at about the point where it makes more sense to audit and implement the remaining linux x86 syscalls instead of waiting for user programs to hit them in the field.  Of course, some syscalls like ptrace will remaining NYI.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1053/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/998", "title": "Implement gdb transfers of dynamically-sized data", "body": "Currently, rr makes the crummy assumption that the data it sends is capped at the size of the packet outbuffer.  That's not true, and we'll just keep hitting this limit until we implement chunked sends.\n\nThe changes that need to be made should be described here https://sourceware.org/gdb/onlinedocs/gdb/Packets.html#Packets .\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/998/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/972", "title": "Add support for rr recorder hosting gdbserver for running task", "body": "This came up in #971, and has been an issue prior.  To fix this, we can have rr listen to a particular signal (waking up its waitpid), and then PTRACE_INTERRUPT all the running tracees.  After that rr can be manipulated in gdb to start the server for whichever task.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/940", "title": "Replaying FF mochitest-chrome: \"Failed to stat .../libjsctyp\u00e8s-t\u00eb\u00dft.so: replay is impossible\"", "body": "The test appears to copy libjsctypes-test.so to this unicode path and then remove the unicode name.  For some reason that temp file seems to be mmap'd by something.  That file breaks rr's avoid-copying-on-mmap heuristics because it's read-only and executable and not on tmpfs, so removing it during recording breaks replay.\n\nI would probably be OK punting this problem for 1.0.  Another option is to make our avoid-copying-mmap'd-file heuristics less aggressive.  They were tuned by optimizing FF startup time, but that's less important over minutes-long test suites.  Depends on what we want to optimize for.  Or maybe there's some other clever thing we can do (f.e. keep a record of mmap'd files that pass the don't-need-to-copy heuristic, and if one of them is unlink()d during recording, copy it).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/940/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/891", "title": "Emulate all syscalls", "body": "And then inject and execute the handful of syscalls we can't emulate (yet): clone, munmap, etc.  This is already the model we use for mmap.\n\nThis would greatly simplify #212, but I'm afraid it's too risky for 1.0.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/891/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/889", "title": "Audit outparam syscalls to ensure all use scratch", "body": "I've fallen into the trap several times of thinking that only may-block syscalls need scratch, but in fact any syscall with outparams needs to use scratch.  We should ensure that this is the case.  On the fence about this for 1.0; lean towards no because we're not seeing problems in the field (or #876 might be this, but I doubt it).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/884", "title": "Honor MSG_DONTWAIT for all relevant socketcalls", "body": "", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/884/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/882", "title": "Set up scratch for recvmmsg/sendmmsg", "body": "", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/882/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/879", "title": "Recognize irregular ioctls and abort if they're unhandled", "body": "We're having several problems in #876 with code making irregular ioctls (that don't use the _IOC() macro) and rr not recognizing that they have outparams that need to be recorded.  We should instead abort.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/879/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/854", "title": "Get gcov data for rr running test suite", "body": "I'd like to see which parts are still untested.  Would be cool to make this part of the test suite itself, and institute a no-gcov-regression policy.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/854/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/836", "title": "Investigate why sunspider overhead is higher in-browser vs. jsshell", "body": "We saw in #10 that, before meliorizations, rr record overhead was about 2.2x for sunspider in-browser, and about 1.9x in jsshell.  After meliorizations, we got it down to 1.2x for jsshell but I didn't re-measure in-browser.\n\nOn my bare metal x64 machine, I'm seeing ~1.4x overhead in-browser.  It's more complicated to measure jsshell overhead, but I expect it to be no worse than 1.2x.  So we're seeing ballpark the same difference in overhead.\n\nIt'd be interesting to see why the difference is this big.  1.4x is palatable for 1.0, so my inclination is to punt this for now.  (This also might end up requiring analysis from someone with serious gecko or SM chops, which I don't have.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/836/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/828", "title": "Add a time or disk-space cap to rr", "body": "I think I recorded [this bug](https://bugzilla.mozilla.org/show_bug.cgi?id=762774), but I was off playing my fiddle and didn't notice until too late.  The test appeared to livelock or something like that and kept generating events until I ran out of disk space.\n\nFor unattended infra, this would be a bad problem.  Similarly, if the test had deadlocked, it would have been nice for rr to time out after a while with an error message.\n\n@rocallahan not sure how you feel about this for 1.0.  My inclination is to punt.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/820", "title": "Remove all manual memory management", "body": "We have a lot of legacy malloc/frees lying around.  Now that we're in C++, we can do much better.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/820/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/803", "title": "Don't disable/close/open/enable rbc for every event", "body": "Followup to #279:\n\n> What we should do instead is use absolute counter values and never close/ioctl these counters. Our time-slice interrupt guarantees that a counter can't overflow past its initial value during one event, and anyway it would take ~50,000 years of 100% CPU load for a counter to even overflow in the first place.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/803/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/800", "title": "Make rr's scheduler more sophisticated", "body": "With the exception of strict priority classes, rr's scheduler is about as simple as it could be.  One way to improve things is with #799.\n\nAnother, potentially complementary, way is to make rr's scheduler more sophisticated.  OS schedulers are pretty much a solved problem on the research side.  State of the art is HFSC and derivatives (linux does something related called CFS), at least as of a few years ago.  It's relatively simple to implement and would let rr's scheduler behave more like linux's.  This might improve perf or perceived responsiveness on recorder workloads.\n\nWe would want this to be the default, but also allow rr to have another mode where it scheduled using random or directed heuristics, for bug finding.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/800/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/799", "title": "Use desched event for all task scheduling", "body": "Thought I'd filed this, but I guess not.\n\nThe machinery we've built for monitoring desched's could actually be made quite general.  If we arm the event when a tracee is scheduled, then we could just let the tracee run until either it traps to a traced syscall, or the desched event fires.  This would let the kernel do most of rr's task scheduling for it.\n\nIt would also make eliminate the notion of a may-block syscall from syscallbuf, making things much simpler and potentially more efficient.  The desched event would _always_ be armed, so any buffered syscall could potentially fire the event.\n\nThe mechanics of arming and disarming the event from within the tracer are a bit tricky, but I think doable.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/799/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/792", "title": "Prevent tracees from unsetting PR_TSC_SIGSEGV", "body": "Obviously not urgent, filed in the pedantry category.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/792/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/778", "title": "Use rr for randomized fault injection", "body": "Complementary to @rocallahan's gecko chaos mode.  There are bazillion other tools that do this, but implementing this in rr is particularly compelling because\n- no PRELOAD hacks required; rr 100% precisely sees all syscalls (through ptrace and syscallbuf)\n- low overhead\n- and most importantly of all, rr is recording execution the whole damn time! :)  So if a failure pops up, you can immediately switch to debugging the trace.\n\nThis could be done with relatively little pain by adding a fault injection hook to rec_process_event.cc, and then recording pseudo-events when faults are injected so that they can be replayed.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/778/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/774", "title": "PR_SET_DEATHSIG isn't preserved across fork()", "body": "We depend on that to kill orphaned tracees, but it's turned off when the grandchildr is forked.  Those are created during almost all FF test suites, and they do get orphaned from FF fairly often.  Tentative 1.0 issue, but the list is getting long so we can take another look.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/774/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/743", "title": "Save all initial-tracer-process state", "body": "We currently init some task attributes like sighandler and blocked signals from the initial rr process, but that's wrong.  Like the env, the attributes could be different for |rr record| than for |rr replay|.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/743/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/726", "title": "Somehow prevent test.run scripts from referring to the wrong binary", "body": "For the second time, I found a .run file that was invoking the wrong binary.  That costs us regression coverage.  I don't have any great ideas, but making the common-case .run link to a generic version that infers the binary name from the .run filename might work.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/726/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/722", "title": "Add another run of tests with jemalloc (or another complex custom allocator)", "body": "We've had a number of really nasty rr bugs due to subtle interactions with jemalloc.  #721 should hopefully make all that go away, but it would be great to ensure that by adding a third test run with jemalloc or another similarly complex allocator.  Marking 1.0 to see if this is easy to do, but #721 may eliminate these interactions and lower the priority of this below 1.0.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/722/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/703", "title": "Interrupting dbg_await_client_connection() aborts with \"Can't GETFD flags\"", "body": "We don't check the return from accept().  Minor cosmetic issue.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/703/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/681", "title": "Create explicit DEBUG / RELEASE build configs", "body": "rr currently saves a fair amount of not-strictly-necessary data to trace that's used for relatively expensive debugging checks.  When rr is production quality, we can assume it's going to replay traces faithfully and drop the extra data in a RELEASE format.\n\nOn the other side of the coin, there's a lot of extra data that we could be saving in a DEBUG config but aren't currently, like register states at buffered syscalls.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/681/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/674", "title": "Investigate emulating SYS_futex during recording", "body": "Followup to #673.  We would need to work some magic with seccomp-bpf to allow us to distinguish entry to futex from entry to other syscalls, so that we could PTRACE_SYSEMU instead of PTRACE_SYSCALL the tracee into the call.  But if we got that to work, emulating futex would avoid bugs like #673 (and the even worse hell that's going to break loose when we have to deal with robust futexes), and probably more importantly, gives us more control over thread scheduling.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/674/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/672", "title": "\"Success\" sometimes shows up in failing tests' replay.err files", "body": "I've seen this before but never really payed much attention to it.  @rocallahan ran into it today.  I don't know where that output comes from; a quick scan of util.sh doesn't show any clues.  The output can safely be ignored, but it's kind of misleading.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/672/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/657", "title": "Remove vestigial fault-on-access-shared-page code", "body": "Partial followup to #278.\n\nUntil we decide to do #320 (with proper tests and so forth), we should remove the vestigial code in support of it.  There's a fair amount of it and it's kind of confusing (plus it's completely untested).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/656", "title": "Use memory map cache in debugging code", "body": "Followup to #278.\n- dump-process-memory helper\n- checksum verifier\n\nshould be migrated to use the memory map cache.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/645", "title": "Try to avoid installing jdk during travis builds", "body": "We install a pretty innocent-looking set of packages for rr\n\n<pre>\nsudo apt-get update && \\\n    sudo apt-get install gcc-multilib libc6-dev:i386 libdisasm-dev:i386 \\\n         linux-libc-dev rpm && \\\n</pre>\n\nbut for some reason something pulls in the oracle jdk.  Installing (or upgrading) that is a complete waste of time and bandwidth.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/616", "title": "Integrate libvex into rr", "body": "For #609.  We'll want a libvex preferably\n- split out of the valgrind repo.  (Not a hard requirement.)\n- in a git repo that we can optionally submodule into rr\n- scripted to be easily update-able from main V, and able to run V unit tests specific to libvex (if there are any).  Bonus points for mirroring entire commit history, in case we have to push any patches relevant to rr, or need to bisect history.\n\nI know an attempt was made to write python bindings for VEX, but I don't know if any other project has already done the work described here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/616/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/615", "title": "Record pseduo-mmap events for exec and clone", "body": "For #609 we'll want to be able to emulate exec and clone.  This requires recording kernel side-effects that we usually rely on being deterministic across record/replay.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/615/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/610", "title": "Investigate using instructions-retired counter (irc)", "body": "There's been some discussion of this in #544, but filing separately to track.\n\nUsing the irc solves all kinds of problems for us (including possibly #544).  Unfortunately, irc it's [not strictly deterministic](http://web.eece.maine.edu/~vweaver/projects/deterministic/ispass2013_deterministic.pdf).  Specifically, it overcounts on hardware interrupts, page faults, x87/sse exceptions, and lazy FP handling.  The latter two aren't a concern for \"normal replay\", but we do have to account for the first two.  Initial experiments I did were _somewhat_ promising: the irc matched across record/replay most of the time.  When it didn't, it was off 1-3 insns.  That sounds pretty bad, but my experiment wasn't quite fair because I was still driving execution using the rbc, and just cross-checking the irc data.  A fair experiment would drive execution using the irc.\n\nI'm also filing this to remind myself that in light of #609, we can't use microarch-dependent counters like load-insns/store-insns.  Instrumented code has to be able to sync with the counter value saved to trace, and obviously instrumentation won't emulate microarch RISC transformations faithfully.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/610/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/609", "title": "Integrate chronicle-recorder", "body": "The goal is to record a crash / whatever at event Y, then replay up to event X that's \"far enough\" before Y and generate a \"supertrace\" of the execution in (X, Y) using [chronicle-recorder](http://code.google.com/p/chronicle-recorder).  That supertrace lets other tools answer questions like, \"where was the last write to addr A\".\n\nIt's going to be rather nontrivial to get rr to spit out these DBs.  A few ideas that don't look feasible\n- stepi through execution and generate the DB from effects.  This is prohibitively expensive (~4500x, in an underestimating experiment).  We could also be forced to duplicate the logic that a tool like libvex or Pin already have.\n- step through store insns.  Sells ourselves short and also has instrumentation-logic-duplication problem.\n- recast problem as \"valgrind attach\" --- have rr hand off tracees to valgrind and valgrind instrument existing processes.  There are a few reasons why this doesn't look feasible, chief among them that the instrumentation would share the tracee's address space, which opens a can of worms.  Also, ~all existing tools assume they start running at process start, so we wouldn't be able to use them \"out of the box\".\n- roll-our-own valgrind-alike using some instrumentation library other than libvex.  The popular ones I looked at are either non-free, don't have the on-demand model required, don't support non-x86(-64), or some combination thereof.\n\nSo I think we're down to roll-our-own valgrind-alike with libvex.\n\nWhile writing this though, I just had another idea: if we implement a persistent checkpoint operation that additionally stores \"resume-replay\" information (trace-file offsets etc.), then we could theoretically chronicle-record a tool that consumes that checkpoint and resumes replay.  That is, the resume operation and rr replay code would be recorded into the chronicle DB along with tracee execution.  We run into #16 trying to do that though, in addition to the \"wasted\" rr traces in the DB (although that would be jaw-droppingly awesome for rr devs ... ;) ).\n\nWe've tentatively settled on an approach in which we\n- fork a 64-bit chronicle process\n- run a mini-valgrind-alike in that process: use the rr trace to schedule threads and replay syscall outparam writes, but otherwise follow the valgrind model pretty closely, except\n- allocate 4GB of address space per tracee process (really, 3GB if we wanted to get cute) in the chronicle process\n- add virtual \"offset register\" to the emulated CPU, where the offset points at the start of tracee's memory area.  Add that offset to all read/write operations.\n- when a page is first accessed, \"fault\" it in by reading the tracee process's /proc/mem\n\n... I just realized while writing this that this scheme won't handle shmem properly, and can't easily be fixed to do so.  D'oh!\n\nThere were two other ideas we floated for memory operations for the virtual CPU\n- emulate load/store by read(mem-fd)/write(mem-fd).  Make it faster by emulating a cache hierarchy, where actual read()/write() only happen on cache miss/eviction, munmap, and process context switch (not thread).  Load/store would manipulate the in-process cache.  Avoids the shmem problem by directly manipulating (eventually, at cache flush time) the tracee's original memory mappings.  The chronicle process in this model could be 32 or 64 bit, doesn't particularly matter.\n- 64-bit chronicle process.  give each process an array of pages.  On first access, \"fault\" in the page and add it to the array.  Emulate load/store by looking up the page by address.  Make it faster by e.g. multi-level hierarchy.  Avoids the mmap problem because (in theory) shared pages can be detected and multiple process's page arrays can point at the same memory.\n\nI think as far as emulated load/store are concerned, the performance of both approaches should be about the same because they both boil down to a fast address->mem-chunk look-up.  The first approach has to flush, and therefore would fault more.  But the second approach pays for that in extra complexity in detecting shared pages and updating appropriately on munmap etc.  (The first approach may be friendlier to real CPU cache, but I don't think we're going to be anywhere near the level of caring.)  We probably want to use the existing shared trace and util code in the chronicle process, and it would be much more convenient do so if the image were 32-bit, which could do with the first approach.\n\nMy gut tells me the first way would be simpler, so I lean towards that.  @rocallahan thoughts?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/609/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/607", "title": "Investigate isolating rr tracees in their own pid namespace", "body": "There's some fairly nontrivial code spent on ensuring that tracees see the same tid across record/replay, and a bit of logic keeping recorded/replayed tids straight.  We could theoretically eliminate that code by running tracees in their own tid namespace.  This could also simplify #603 and the upcoming chronicle recording.\n\nA problem is that something like `rr record ps -e` would behave differently than `ps -e`, which is an anti-goal.  So not sure atm if this is worth it (probably not).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/607/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/601", "title": "Use \"Branch Trace Store\" to compare executions", "body": "This is like #532 on steroids: we use the hardware branch recorder to log all branches in recording, say.  Then we do the same thing in replay and compare.  The upside is that it's perfectly precise, always up-to-date, fast, and doesn't require any recompiling.  Downside is that it will generate a lot more data than #532 in general, so maybe not appropriate for checking long executions, and it requires burrowing a software hole down to privileged hardware.\n\nWe got _this_ close to having a |perf branch| tool [1], but AFAICT the implementation died in committee [2].  Argh!  So won't get this interface \"for free\".\n\n[1] https://events.linuxfoundation.org/slides/2011/linuxcon-japan/lcj2011_nagai.pdf\n[2] https://lkml.org/lkml/2011/5/30/234\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/600", "title": "Emulate PR_TASK_PERF_EVENTS_DISABLE", "body": "While we're filing perf-event trivia: turns out tasks can disable events attached to them, even if another process created the event (e.g., rr tracer).  Obviously this would be disastrous for rr.  I doubt if any program we'll ever see uses this though, so just filing for completeness's sake.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/592", "title": "Only store exec info to trace file for debugging builds", "body": "Been meaning to file this for a long time: rr traces can get pretty fat because they're quite inefficient (there hasn't been any reason to care until now :) ).  I have to redo the trace logging incidentally to implement something else, so might as well get these listed as I come across them.  The biggest source of bloat is the ASCII format, which I need to change for my new use.\n\nThe second biggest source of bloat is the register and counter values, which for non-async-signals, are only used for assertions (or convenience).  We can drop that data for \"release\" builds, once we're more confident in rr correctness ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/592/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/584", "title": "librrpreload is (probably) leaking main-thread buffers", "body": "While working on #532, I've seen that a TLS data destructor doesn't seem to be called for the main thread when it exits with `return 0`.  It is called when exited through `pthread_exit(NULL)`.  If this is indeed the case, we can probably hack around this by registering an atexit handler to clean up the main thread.\n\nNot particularly high priority.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/584/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/581", "title": "Mapping scratch memory as PROT_NONE can cause /proc/.../maps divergence", "body": "Found this a while back but have neglected to file: during recording, we obviously map scratch as PROT_READ|PROT_WRITE, but during replay we map it as PROT_NONE to catch illegal accesses (should never be touched).  When the kernel display /proc/maps, it coalesces subsequent anonymous pages with the same metadata.  So when, during replay, the protection bits of scratch segments differ, then the kernel's coalescing can differ as well.\n\nThere's an outside chance that a task reading its own /proc/maps would be affected (maybe FF does that for about:memory?),  but it's definitely been a problem for checksumming, because the checksummed segments change.\n\nI hacked around this by not changing the protection bits, but a better fix is to name the scratch regions by allocating them from /dev/shm.  That makes them non-anonymous so not coalescable.   Also makes it easy to quickly identify scratch regions, which is a big pain otherwise, and extremely annoying when they get coalesced.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/581/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/529", "title": "Back-to-back USR_SCHED, SYSCALLBUF_RESET events cause checksum divergence", "body": "This is relevant for checksumming at events other than syscall exit.  I'm trying to checksum time-slice events in a last-ditch event to pin down #416 with checksumming, but on the unit tests we fail when the following occurs\n\n<pre>\n-1018 (SYSCALLBUF_FLUSH)\n-1020 (USR_SCHED)\n-1016 (SYSCALLBUF_RESET)\n</pre>\n\n\nThe problem is that the syscallbuf byte counter won't be reset after we finish replaying the USR_SCHED (not until the SYSCALLBUF_RESET), but during recording it was reset when the checksum was made.\n\nIt's looking like checksumming was a fairly productive digression, but isn't going to catch #416.  So I don't consider this specific issue very important.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/528", "title": "Time taken for thread_stress test is surprisingly high", "body": "With the syscallbuf enabled, it takes about 30s on my very fast machine (VM though).  Outside rr, the test takes 0.12s.  So ~300x overhead.\n\nThe test just creates and joins 1500 threads, so some kind of degenerate behavior seems to be triggered.  The syscallbuf setup we do should be relatively cheap.\n\nThere's a maximum ~5-6s overhead from the workaround for not handling `CLONE_CHILD_CLEARTID`, but that's still not a significant chunk of the 300x.  My VM is 4x parallel, but that factor is still only chipping away at the overhead.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/513", "title": "Make fcntl tests cover supported API", "body": "I don't think we have any right now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/513/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/493", "title": "Use PTRACE_{GET,SET}SIGMASK to block signals at inopportune times", "body": "This has been a TODO in handle_signal for a while: when we're stepping the tracee to a safe point, we just don't want to deal with signals interrupting us (except maybe SIG_DESCHED).  These ptrace commands are exactly what we want.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/493/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/488", "title": "Finish implementing gdb non-stop mode", "body": "Punted from 0.1.  The gdb in fedora 19 really really wants us to be using it, and when we don't, it manifests a bug (#459) that appears to be caused by assuming that the stub is using non-stop when it isn't.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/488/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/466", "title": "Implement conditional logging", "body": "In which we can say things like, \"start logging after trace line 498\", or \"only log for trace line 12\".  Logging is only statically enabled currently.  This is the one of the features that the lack of really hurts when working with big traces.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/466/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/374", "title": "Simplify scratch processing", "body": "There's a lot of (rather deilcate) code in place to handle various cases around scratch-buffer management.  I'd really like to simplify that if possible.\n\nAn idea that strikes me is that for syscalls like `read()` with unbounded buffer sizes, allocate scratch buffers on a _best-effort_ basis, rather than all-or-none.  The kernel can return as little data as it wants<sup>&#10033;</sup>, so rr can take advantage of that to pass a smaller input buffer to the kernel if not enough scratch is available.\n\nThis would be unsound for syscalls with inoutparams, so it would still be possible to exhaust scratch, but those cases are so edge (deep sighandler interrupts of huge `poll` buffers, e.g.) I'm inclined not to care if it simplifies the code a lot. \n\n<sup>&#10033;</sup> In reality, there are certain \"gentlemen's agreements\" linux makes with userspace, like reads of 4096 bytes or under on files succeed or fail atomically, IIRC.  And the notion of \"best-effort\" is horrendously hard to define for a syscall like recvmsg().  And `ioctl()`s and interacting with special devices ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/374/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/364", "title": "Ignored core-dumping signals violate rr scheduling invariant", "body": "While working on the slides, I realized there's a potential bug that could happen under the following circumstances\n1. Tracee sets disposition of signal _s_ that by default dumps core to SIG_IGN.  (Are there any core-dumping signals where that actually has the effect of ignoring the signal?  It doesn't for SIGABRT, I don't think.)\n2. _s_ pending for tracee.\n3. rr delivers _s_ and then continues execution of tracee, _but_ sets it switchable.\n4. Tracee continues executing and doesn't die.\n5. Another tracee in the same address space is continued.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/364/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/285", "title": "Map tracee scratch memory into rr address space", "body": "This would make the setup of scratch args much simpler and a bit faster.  We do the same thing already for the syscallbuf.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/285/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/284", "title": "Scratch memory isn't reentrant with inout params", "body": "For example\n- enter an _un_buffered may-block syscall like `read()`\n- fudge a pointer into scratch memory for the outparam buf argument to read\n- `read()` is interrupted by a signal\n- the signal handler enters another may-block syscall, say `recv()`\n- try to set up scratch pointers\n\nBoom.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/244", "title": "Add back openat() wrapper", "body": "It's originating from libc in a way that we can't wrap.  Here's the impl, not tested obviously\n\n<pre>\nint openat(int dirfd, const char* pathname, int flags, ...)\n{\n    void* ptr = prep_syscall(NO_DESCHED);\n    int mode = 0;\n    long ret;\n\n    if (O_CREAT & flags) {\n        va_list mode_arg;\n        va_start(mode_arg, flags);\n        mode = va_arg(mode_arg, int);\n        va_end(mode_arg);\n    }\n    if (!can_buffer_syscall(ptr)) {\n        return syscall(SYS_openat, dirfd, pathname, flags, mode);\n    }\n    ret = untraced_syscall4(SYS_openat, dirfd, pathname, flags, mode);\n    return commit_syscall(SYS_openat, ptr, ret, NO_DESCHED);\n}\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/244/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/231", "title": "Improve record/replay of time-slice interrupts", "body": "If syscall buffering works well, then the \"problem\" we saw in #218 should become common.  Besides the syscall buf, this already exists (and is a real problem, not a scare-quotes one) for CPU-intensive applications.\n\nThe underlying issue is that replaying async signals is slow, since we (may be) forced to skid/step because of HW limitations.  Shrinking the skid region speeds things up considerably, but I have no idea how the current region size was chosen, so shrinking it is a bit scary.  That's a separate issue though.\n\nFor this issue, I'll take as a given that replaying async signals is slow.  We can be smarter about how we record time-slice interrupts to avoid having to replay so many.  Here's a heuristic that should handle both cases above\n\n> If a USR_SCHED interrupt doesn't result in a context-switch, don't record it.\n\nFor the CPU-intensive (non-syscall) case, this is pretty obvious.  For the syscallbuf case, this will let the tracee just continue filling the buffer.  If the buffer overflows rr will be separately notified.\n\nThis would be a pretty major PITA to implement in the current code, unfortunately.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/231/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/214", "title": "Support segfaults generated by the syscallbuf lib", "body": "#213 adds support for delivering async signals to the syscallbuf lib, but not deterministic ones.  The only case we need to worry about is the lib reading bad pointers passed by the user.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/214/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/211", "title": "Use the support in #210 to ensure old tests fail", "body": "Need to go back and double-check that the tests in #199 and #202 fail with the new default params.  Or if they don't, use the new runtime-configurable support in the tests configurable (should be able to record with custom command-line args already).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/211/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/197", "title": "Share more test code", "body": "We've developed some common patterns for things like \"chew a bunch of CPU\", \"make a bunch of syscalls\", etc.  It would be best to share that so we can be smart about what limits we choose based on machine etc.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/195", "title": "Add more stringent checks of buffered syscalls in DEBUG", "body": "In #183, something is going way off the rails during replay, and I bet we could catch it earlier if we checked the pointer values and other non-outparam data passed to the syscall wrappers.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/195/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/190", "title": "Replay point for async signals is indeterminate", "body": "Quoting #187 \n\n> I think this is both a shallow and a deep bug. The shallow part is, I'm pretty sure that ccba02f regressed this, because it moved us from determining if we'd reached the replay point of an async signal by comparing all regs, to just comparing $ip. But obviously, we can reach the same $ip an unbounded number of times without retiring a conditional branch, with other registers differing. So undoing that non-semantics-preserving refactoring ought to fix this case. (Here we're stopped at __x86.get_pc_thunk.bx in very tight C++, which is probably the most frequently-executed $ip.)\n> \n> The deeper problem is that all regs can have the same value an unbounded number of times within a basic block, with memory mutated in between, so this \"fix\" would only paper over things a little more. Execution could still diverge if we pick the wrong reg state to stop at. This feels pretty unlikely, but since it's really the core of rr we should give it a think.\n> \n> The natural reaction is to reach for the insns-retired counter, but from what I've seen so far the quality of the data is pretty close to junk. It's not even deterministic across subsequent replays of a trace, let alone across record/replay. I see differences of 1-40 across replays, and differences in the thousands across record/replay. But we might be able to massage out higher-quality data somehow. Then the problem would be trivial.\n> \n> CC @rocallahan\n\nThe project here is to either decide we can live with this (somewhat edge-casey) indeterminacy, or try to resolve it with better insns-retired-counter data, or find some other clever approach.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/190/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/181", "title": "Extend socketcall tests to cover supported API", "body": "We have a lot of code supporting the `socketcall` syscalls, but none of it is tested.  This would have caught #180.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/181/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/178", "title": "Consider restoring don't-preempt-SYS_write-until-k-ms optimization", "body": "As part of #7, I'm ripping out the code that previously disabled preemption for `write` but up to a \"grace period\".  `write` will soon be a buffered syscall and we'll usually not even get a trace event for it; this is optimal.  And even if it is preempted, we'll be able to near-optimally resume it.\n\nSo the previous optimization would only apply to the (hopefully!) rare case when the syscall buffer is full.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/178/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/176", "title": "Traced may-block syscall with outparam buffer larger than scratch buffer can cause deadlock", "body": "If the scratch buffer is too small, then we disable context-switching the target context.  This can lead to deadlocks.  It's probably best to abort for now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/176/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/143", "title": "Syscallbuf doesn't correctly handle arg pointer to inaccessible memory", "body": "If any memory we try to record happens to be inaccessible, then the tracee will crash.  Usually bad memory results in EFAULT or EINVAL being spit out.  We can probably avoid changing semantics in most cases by being more careful, but it might be preferable to just defer to the `--sound` (i.e. slow) mode that's been proposed before.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/143/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/110", "title": "Breakpoint on trap instruction isn't hit", "body": "The problem is that if the breakpoint target is already a trap instruction, gdb never asks rr to set the breakpoint.  rr has logic to handle breakpoint-on-trap-instruction, but gdb doesn't allow that logic to kick in.  And for some reason gdb doesn't know how to handle the notifications that rr sends it, which AFAICT follow spec.\n\nI consider this to be something of a problem, but I don't think it's worth the time right now to figure out what dance gdb wants us to do.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/110/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/100", "title": "Find a way to test breakpoints interrupting async signals", "body": "To test interrupting a signal event, we have to construct a trace like\n\n```\n(some trace event)\nensure that a specific function is called, that we break on\nsignal-delivered event\n```\n\nIt's really easy to do this for synchronous signals, since we can arrange for a synchronous interrupt right after calling our function.  It's also pretty easy to test interrupting time-slice pseudo-signals, because a program can call the magic function and then just spin the CPU until the hpc fires.\n\nIt's much harder to test interruption from an async signal, reliably.  The signal has to be delivered by a program external to the test, or else the `raise()` event will come between the breakpoint and the signal delivery.  So we have to spin CPU to receive the signal, but then if we do, then we can't reliably call the breakpoint function before the signal arrives or we might see a time-slice pseudo-signal.\n\nIn the near future, the async signal code will look almost exactly like the time-slice interrupt code, so this won't be a huge problem.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/100/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/78", "title": "Run unit tests with checksumming enabled", "body": "In addition to without.  Could help catch some subtle bugs.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/78/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/75", "title": "Make epoll_wait and poll IRREGULAR (checked) syscalls", "body": "Currently it's (EMU, 1).  The man pages say EFAULT is returned if the `events` structure isn't writeable, so I guess we should be checking this somehow.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/75/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/65", "title": "Investigate not recording until the first recorded program execs on top of rr fork", "body": "There's a fair amount of code devoted to \"have we exec'd yet? if so, do X\", where it would be simpler to say, \"do X\".  I don't know yet why things are currently done the way they are; this may not be possible.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/65/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/41", "title": "Find libc test suite to import and run under rr", "body": "(More of a \"note to self\".)  We're kind of playing whack-a-mole with libc/syscall support, which is fine and a good way to bootstrap quickly, but we want to know ahead of time how complete our support is.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/41/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/26", "title": "Set up PPA for rr and build deps", "body": "This will greatly simplify the setup process.  The only snag is that the libpfm build system is kind of a PITA, so getting cross-compiled libs built may be an issue.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/26/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/16", "title": "Get rr working with valgrind (or vice versa), as far as possible", "body": "It appears that valgrind identifies itself as Merom, which apparently isn't supported yet.  I'm testing with distro-supplied valgrind 3.7.0, so things may be different in later valgrind.  If not, then we can either add Merom support to rr, or add later support for a newer architecture to valgrind.\n\nThe question of _how well_ rr+valgrind could work is also interesting.  Needs some thought.  But even basic checking allowed me to diagnose #15.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/16/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/8", "title": "Implement a performace-testing script", "body": "Most basically, the script would run a workload, then run the same workload under rr and compare elapsed wall-clock time.  Something like\n\n```\n$ ./script/measure.sh firefox --blah\n'firefox --blah' took 10.3s\n'rr --record firefox --blah' took 13.6s\n```\n\nLater on it might also be interesting to measure context switches, memory usage, and other such things that we find are important.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/8/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17627809", "body": "Sorry, forgot to update this yesterday.  The build error was from incorrectly using $ebx in code compiled with -fPIC.  After that was fixed, libc malloc started asserting early in startup.  I've just established that that's (somehow) caused by the length or format of arguments on the command line.  This command works with the Eclipse build but causes the assertion failure in the CMake build\n\n```\n./rr --record --filter_lib=../rr/obj/lib/librr_wrap_syscalls.so ./hello\n```\n\nHowever, this command works fine in the CMake build\n\n```\n./rr --record --filter_lib=/home/cjones/rr/rr/obj/lib/librr_wrap_syscalls.so ./hello\n```\n\nSmelling like a fencepost bug somewhere ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17627809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17682331", "body": "(This is blocking followup work, and I don't think anyone cares to review this.  So I'm going to ask forgiveness for rather than permission to merge this ;). )\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17682331/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17694444", "body": "_/me asks for forgiveness_\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17694444/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17700377", "body": "Pretty trivial and has a test.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17700377/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17743057", "body": "The priority of this is bumped up a bit by the fact that the CII isn't running unit tests.  So the tests aren't being built _or_ run.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17743057/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17745494", "body": "Yep! :)  (Not anymore ;).)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17745494/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17748932", "body": "And of course, when I run this in gdb, it shuts down cleanly.  Smells like a waitpid race condition or something like that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17748932/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17749037", "body": "It's something to do with this log spew\n\n```\nGLib-GIO-Message: Using the 'memory' GSettings backend.  Your settings will not be saved or shared with other applications.\n```\n\nWhen this appears, I get the livelock.  When it doesn't, shutdown is clean.  Oddly, this is an intermittent issue.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17749037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17749155", "body": "Solved!  (I think.)\n\n```\nsudo apt-get install dconf-tools:i386 libdconf0:i386 libdconf-dbus-1-0:i386\n```\n\nSolution adapted from [here](https://bugs.launchpad.net/ubuntu/+source/glib2.0/+bug/757866).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17749155/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17750413", "body": "So hm.  #32 shows that all the tests are passing when run with the filter lib.  So this appears to be some new issue specific to FF.\n\n@rocallahan do you recall the last time you successfully recorded FF with the filter lib?  What was the FF version?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17750413/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17750579", "body": "(Seen in ubuntu 12.04 x64, running rr cross-compiled to x86, inside VMWare Workstation 9.  So a lot of moving parts.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17750579/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17752667", "body": "Disabling the seccomp-bpf and bisecting narrows the problem down to some subset of the socket interface\n\naccept4\naccept\ngetpeername\ngetsockname\ngetsockopt\nrecv\nrecvfrom\nsocket\nbind\nconnect\nlisten\nsendmsg\nsend\nsendto\nsetsockopt\nshutdown\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17752667/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17753216", "body": "Ended up being pretty complex.  Here's what's busted\n\nclock_gettime\ngettimeofday\naccept4 - shutdown (socketcall API)\n\nI'm running an x86 build in an x86-64 VM.  I know that the ABI for clock_gettime/gettimeofday is significantly different across x86/x86-64, so this is pretty suspicious.  Will either disable or switch (back, sigh) to an x86 VM.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17753216/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17754248", "body": "Broken the same way in an x86 VM, too ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17754248/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17754321", "body": "\"Fixed\" (worked around temporarily) by #35.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17754321/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17910256", "body": "#42 \n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17910256/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17910751", "body": "It depends on where we restore the saved initial environment.  If we do it after `fork()` and before `exec*p()`, then all will be well.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17910751/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17911614", "body": ">  I think that rr may be changing execution semantics. There's an error message printed from rr runs that I don't think I see sans rr.\n\nPretty sure now that this isn't happening.  I let the automation run on bare metal for 850 runs and didn't repro, but when I ran the test outside of rr on the same machine, it only repro'd 1/10 times, and I saw the same symptoms as in the VM when it didn't repro.  So almost certainly a scheduling issue or something in that neighborhood.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17911614/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17913794", "body": "Some more data\n- `taskset 0x1` vs `taskset 0x3` doesn't seem to make a difference; bare metal is at ~700 runs with the latter and no failures\n- running the test under a no-op wrapper still reproduces the bug.  So some scheduler quirk around terminals or process hierarchies doesn't seem to be \"it\".\n- the bug doesn't reproduce under strace either\n\nSkimming the actual bug, it sounds like some code is running on a off-main thread too late after shutdown.  So it might be that the scheduling under ptrace is actually too _fair_.  rr isn't letting the buggy thread get far enough behind to exhibit the bug (or resp., main thread far enough ahead).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17913794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17913869", "body": "That might explain too why the bug reproduces much less frequently on bare metal with many cores; the threads can actually run in parallel.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17913869/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17918501", "body": "The problem is that find_library_location() is going into an infinite loop.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17918501/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17921557", "body": "This looks like a big patch but there are really just two small actual fixes along with a lot more insubstantial changes.  So I'll conserve limited review bandwidth here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17921557/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17921592", "body": "First part of this is #44.  I forgot to update the name of the wrapper lib, and we need to use `struct stat64`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17921592/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17921793", "body": "Whole-system lock-ups are getting annoying.\n\nI saw a whole passel of gettimeofday/clock_gettime calls under strace for this test, so I wondered if those calls were disturbing things too much.  I finished #43 to test this out, but the results were\n- a seemingly-related error reproduces more frequently, but not the orange itself\n- recording firefox is now broken under the filter lib :/\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17921793/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17923468", "body": "According to the tests defined in the man page, the task should have generated an event.  However, the algorithm for computing the triggered event from the status isn't showing a known code.  So hm.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17923468/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17923534", "body": "Hey Albert, yep, I tried the values `1` and `INT_MAX` and a few others in between.  Unfortunately they didn't help the bug reproduce :/.  That was pretty surprising.  Still digging :).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17923534/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17924537", "body": "The task isn't exited or dumped core.  The task we're trying to inject the mmap into is the first thread (tid 2861) of the firefox process (2860).  Both tasks are showing up as being ptraced by rr, as expected.  `/proc/status` says that\n    $ cat /proc/2861/status | grep State\n    State:  D (disk sleep)\n    $ cat /proc/2860/status | grep State\n    State:  t (tracing stop)\n\nSo hm, that still doesn't make sense.  It looks like the task is in a `write()` or `read()` but we didn't expect that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17924537/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17925797", "body": "/build/buildd/eglibc-2.15/misc/../sysdeps/unix/sysv/linux/i386/clone.S:111\n    => int  $0x80\n\nso it's in a clone syscall.  Seems related to https://github.com/mozilla/rr/blob/master/src/share/wrap_syscalls.c#L123 .\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17925797/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17970657", "body": "I wrote a library to start gathering information about the executions themselves, but the output is hard to interpret.  So nothing substantial to report, but getting closer.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17970657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17976390", "body": "> Enabling all the socket syscalls in wrap-syscalls doesn't look fine. Some of them are blocking right? So we can't currently support them.\n\nThey were enabled previously, and I disabled them after I broke the filter lib.  FF seems to run OK with them enabled but gecko pretty much only uses async IO.  But I'm happy to leave them disabled until we have tests.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17976390/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18016976", "body": "Agreed.  (Was afk most of yesterday.)  When making the change, I noticed that the wrappers for the `stat` API are live, but those are also potentially-blocking syscalls so I flipped them off too.  Merging with assumed r=roc ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18016976/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18040704", "body": "I should add that this is good news, because we don't know yet if the clock_gettime/gettimeofday changes are actually letting #40 repro.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18040704/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18042804", "body": "The silly xpcshell harness was indeed creating 31 arguments, which (should have) failed the assertion guarding that.  But bumping the max didn't resolve the bug.  Either the 32-arg limit is hardcoded somewhere else, or there's another bug popping up.  Efforts to use valgrind for a quick win turned into a tar baby, have to give up for the day.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18042804/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18065224", "body": "Straightforward fix, -> auto-merge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18065224/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18065257", "body": "Fixed by #48.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18065257/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18066051", "body": "Still not able to reproduce in VM with the fix from #48.  Maybe will have better luck on bare metal.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18066051/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18068079", "body": "Small change, -> auto-merge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18068079/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18068123", "body": "Fixed by #46.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18068123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18070552", "body": "Finally, some data.  The monitoring lib is dumping context-switching stats on exit (and receipt of usually-fatal signals).  The `vol` item is voluntary context switches, which happen at syscalls.  `nonvol` is when a task exhausts its timeslice.\n\nHere's what I see running the testcase outside of rr, when it passes\n\n<pre>\npass:\n    RRMON[6531][xpcshell]: vol: 10; nonvol: 124\n    RRMON[6611][xpcshell]: vol: 10; nonvol: 124\n    RRMON[6976][xpcshell]: vol: 10; nonvol: 125\n</pre>\n\nI'd like to dump stats from when it fails too, but Gecko is stomping the signal handlers for my monitor lib.\n\nHere's what things look like running under rr-without-filter-lib, which will soon be an obsolete configuration\n\n<pre>\npass:\n    RRMON[6409][xpcshell]: vol: 14103; nonvol: 209\n    RRMON[6451][xpcshell]: vol: 14097; nonvol: 216\n    RRMON[6491][xpcshell]: vol: 14103; nonvol: 222\n</pre>\n\nand with the filter lib\n\n<pre>\npass:\n    RRMON[5392][xpcshell]: vol: 5120; nonvol: 134\n    RRMON[5433][xpcshell]: vol: 5130; nonvol: 129\n    RRMON[6316][xpcshell]: vol: 5115; nonvol: 125\n</pre>\n\nAnd for comparison, results from `ptrace`\n\n<pre>\npass:\n    RRMON[7025][xpcshell]: vol: 14086; nonvol: 107\n    RRMON[7065][xpcshell]: vol: 14096; nonvol: 108\n    RRMON[7104][xpcshell]: vol: 14094; nonvol: 111\n</pre>\n\nThis doesn't give any information about the actual schedule itself, but shows some interesting things\n1. The filter lib removes a bunch of switching overhead, as expected.  Unexpectedly though, it's cutting down on nonvol switches too, meaning straight-line code is running faster.  I can't really explain that except maybe from cache effects?\n2. The trace _with_ the filter lib is looking more like the actual execution, except there are 500x (!!) more vol switches.  I can't explain that yet either, but seems like the next place to look.  One candidate is overflowing scratch buffers a lot.\n3. `strace`'s execution looks a lot like rr's without the filter lib.  So there's hope rr can be lower overhead on the tracee side than `strace`.  The fewer nonvol switches compared to rr-without-filter-lib might be explained by `strace` being friendlier to cache.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18070552/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18073988", "body": "With a better measuring mechanism, I get similar but slightly different data.  Each listing is representative\n\n<pre>\nno-rr\n  vol: 61; nonvol: 142; sig: 0; hard-fault: 0\nptrace\n  vol: 14140; nonvol: 137; sig: 0; hard-fault: 0\nrr-no-filter\n  vol: 15933; nonvol: 257; sig: 0; hard-fault: 0\nrr-10000 (default)\n  vol: 6538; nonvol: 146; sig: 0; hard-fault: 0\nrr-1\n  vol: 7105; nonvol: 116; sig: 0; hard-fault: 0\nrr-(1&lt;&lt;30)\n  vol: 6568; nonvol: 151; sig: 0; hard-fault: 0\nrr-1000\n  vol: 6570; nonvol: 141; sig: 0; hard-fault: 0\nrr-100000\n  vol: 6598; nonvol: 148; sig: 0; hard-fault: 0\n</pre>\n\nThe `rr-[n]` measurements are done with `MAX_SWITCH_COUNTER` set to `n`.  So it appears that the number of preemptions we can force between syscalls during this test run is pretty low.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18073988/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18075195", "body": "Aha!  In my VM, the `RBC` is always returning 0, but that can't possibly be correct.  That means that preemption is effectively disabled.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18075195/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18075795", "body": "On bare metal, rbc is working, but the execution profile isn't significantly different.  So I expect there's a very frequent syscall that we're not filtering.  Likely candidate is `write`, since this test is very spew-happy.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18075795/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18076190", "body": "> Aha! In my VM, the RBC is always returning 0, but that can't possibly be correct.\n\n(7f2094613a00e3333192440ad3c6e08db47000be :} )\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18076190/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18079008", "body": "Top unfiltered syscalls on this testcase, summed over 5 runs\n\n<pre>\nsyscall count\n 224      2644  # gettid [Ed: mostly buffer flushes]\n 192      2160  # mmap2\n 240      2006  # futex\n 195      1640  # stat64\n 125      1560  # mprotect\n 197       970  # fstat64\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18079008/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18086389", "body": "(Just to satisfy my own pedantry, here's a histogram without filtering for one run\n\n<pre>\nsyscall count\n  78     11250  # gettimeofday\n 265       480  # clock_gettime\n 192       410  # mmap2\n 240       386  # futex\n 195       320  # stat64\n 125       306  # mprotect\n 197       192  # fstat64\n</pre>\n\nSo we definitely chose the right syscalls to filter first.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18086389/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18088436", "body": "Beyond filtering may-block syscalls, there doesn't look like much win here.  mprotect was pretty high up in the list, and it's trivial to wrap, but doing so didn't make much difference\n\n<pre>\n 125       306  # mprotect\n----- filter -----\n 125       294  # mprotect\n</pre>\n\nThe vast majority of the calls must be coming from ld/libc, which isn't too surprising.\n\nSimilarly, I tried _un_-filtering `futex`, and got similar results\n\n<pre>\n 240       386  # futex\n----- un-filter -----\n 240       406  # futex\n</pre>\n\nThis one is a bit surprising.  libc uses futexes to protect some internal state, and those might invoke the syscall directly.  But if that were the case, I would expect libc to enter the kernel through the same interface as for the \"real\" futex.  Or it's possible that `ld` is doing a crazy number of futex operations on startup.  (Which reminds me, the `futex()` wrapper doesn't do blocking correctly.  Need to turn that off.)\n\nI'm going to see if `perf sched` sheds any light.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18088436/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18090064", "body": "OK, `perf sched` is pretty hot :D.  I recorded traces from a failed run not-under-rr, and a passing run under rr.  There's a huge amount of data so will take longer than I have left today to analyze.  But very exciting.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18090064/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18324280", "body": "I haven't been updating this bug not because I haven't been working on it, but because I haven't figured it out yet.  Early this week I wrote a little [tool to visualize perf schedules](https://github.com/cgjones/perf-sched-viz).  That's helped a lot, but still not there.  From what I've seen\n- the failing thread is the 9th xpcshell thread.  That thread isn't created on the passing runs I've seen\n- xpcshell eats a lot more CPU when running under rr.  This is somewhat unexpected.\n- rr uses quite a bit of CPU (not unexpected), and contends heavily with `perf`.\n- we may be able to deduce the problem(s) with rr's scheduling, but it's also looking increasingly likely that the important difference is just adding too much overhead.  In that case, it might be better to implement wrapped blocking syscalls to \"guess and check\" rather than keep sinking time in analysis, since we want those anyway.\n\nAnyway, atm I'm enjoying being \"distracted\" by gdb ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18324280/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18435426", "body": "Not very pretty, but straightforward, -> auto-merge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18435426/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18437687", "body": "Straightforward again, -> auto-merge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18437687/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18576793", "body": "Somewhat nontrivial, but no new structure so -> auto-merge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18576793/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18592056", "body": "Don't think anyone would care to review this, also pretty straightforward, -> auto-merge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18592056/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18592118", "body": "I should also add for posterity that archer-gdb is probably more the \"right\" way to do this, but it doesn't seem to be widely available in distro repositories.  Oh well.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18592118/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18594302", "body": "Possibly, but neither the gdb in my ubuntu 12.04 VM nor the one in my fedora 18 install seems to support the python API, which is what I want to use from archer.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18594302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18595225", "body": "Er, ignore this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18595225/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18627239", "body": "Problems identified so far\n- gdb is poking at the child process before `exec()`, so the `rr` image is still loaded\n- asking gdb to debug the `rr` image causes a similar abort, but poking a different address.  That new address is also not mapped.\n- however, the \"get all registers\" request isn't implemented yet.  That might be contributing.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18627239/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18627337", "body": "I'm also not yet sure what gdb is probing, but the address falls in the read-only data segment of the `rr` object.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18627337/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18632478", "body": "> - however, the \"get all registers\" request isn't implemented yet. That might be contributing.\n\nNope, doesn't change the symptom.  That's not unexpected.\n\n> I'm also not yet sure what gdb is probing, but the address falls in the read-only data segment of the rr object.\n\nThe address is \n\n<pre>\n(gdb) info symbol 0x8070F6C\n_DYNAMIC + 84 in section .dynamic of /mnt/hgfs/rr/rr/obj/bin/rr\n</pre>\n\nNot 100% sure what that is yet either.  If I swizzle the returned bytes, gdb probes a different followup address, so gdb must be computing the next address to look at based on the value it reads.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18632478/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18639146", "body": ">  cgjones closed this issue from a commit a minute ago\n>   cgjones     Fix signed-ness bugs in read-memory request code. Resolves #60. \n\nWhoa, I had no idea I could do that.  gh++.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18639146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18640521", "body": "I should also add, this gets extremely basic debugging working\n\n<pre>\n(gdb) target remote :1111\nRemote debugging using :1111\nReading symbols from /lib/ld-linux.so.2...Reading symbols from /usr/lib/debug/lib/i386-linux-gnu/ld-2.15.so...done.\ndone.\nLoaded symbols for /lib/ld-linux.so.2\n0xf7fdd1d0 in _start () from /lib/ld-linux.so.2\n(gdb) bt\n#0  0xf7fdd1d0 in _start () from /lib/ld-linux.so.2\n(gdb) c\nContinuing.\n  C-c C-c\n[Thread 38325] #1 stopped.\n[Switching to Thread 38325]\n0x08048495 in spin () at ../rr/src/test/interrupt.c:13\n(gdb) bt\n#0  0x08048495 in spin () at ../rr/src/test/interrupt.c:13\n#1  0x080484d1 in main (argc=1, argv=0xffffd754) at ../rr/src/test/interrupt.c:20\n(gdb) f 1\n#1  0x080484d1 in main (argc=1, argv=0xffffd754) at ../rr/src/test/interrupt.c:20\n(gdb) p argv[0]\n$1 = 0xffffd8ef \"./spin\"\n(gdb) f 0\n#0  0x08048495 in spin () at ../rr/src/test/interrupt.c:13\n(gdb) p i\n$2 = 496854691\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18640521/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18761093", "body": "This is a failed PTRACE_POKEDATA from here\n\n<pre>\n#6  0x0805fa55 in sys_ptrace (request=5, pid=44975, addr=0x557fb728, data=0xaf7a) at /home/cjones/rr/rr/src/share/sys.c:185\n#7  0x0805e2a6 in write_child_data_word (pid=44975, addr=0x557fb728, data=0xaf7a) at /home/cjones/rr/rr/src/share/ipc.c:122\n#8  0x0805eefd in write_child_data_n (tid=44975, size=16, addr=1434433320, data=0x95ab470) at /home/cjones/rr/rr/src/share/ipc.c:477\n#9  0x0805a5b3 in rep_process_syscall (context=0x95ab218, syscall=120, rr_flags=...) at /home/cjones/rr/rr/src/replayer/rep_process_event.c:1737\n#10 0x0805d302 in replay (rr_flags=...) at /home/cjones/rr/rr/src/replayer/replayer.c:376\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18761093/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18782057", "body": "I just went ahead and did this in a WIP patch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18782057/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18875691", "body": "I've run into some scary-ish things that make me want this enabled sooner rather than later.  -Werror isn't always a great idea, but with fast builds, 1+\\epsilon regular contributors, and 1 supported compiler/OS combo, maybe it'll work for now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18875691/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18883171", "body": "D'oh ... replay was failing in a similar manner as of b6752ef4150a383f10da29581f54ebf8161c6ad6 and 8c27194adb4f03e1fe5c0547fe02ba3ae438d7d7, which is around the time I thought it was working.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18883171/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18944075", "body": "Right, fair enough :).  What I meant was my build environment somehow violating rr's current requirements, one of which e.g. is that the recorded binary not change in between runs.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18944075/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18944759", "body": "Not too interesting of a change, will save my review budget -> automerge.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18944759/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18945904", "body": "Ftr, this change has been nothing but candy and rainbows so far.  Let's hope it keeps up for a while!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18945904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18994856", "body": "This invocation works\n\n<pre>\n$ rr --record a.out\n$ rr --replay --autopilot trace_0/\n</pre>\n\nand this one fails\n\n<pre>\n$ rr --record a.out | cat\n$ rr --replay --autopilot trace_0/\n</pre>\n\nOh my ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18994856/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18999567", "body": "(Aside: I'm using the gdb shim to debug this :D.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/18999567/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19001261", "body": "Here's what I know so far: we're (obviously) blowing up at an `exit(0)` call.  This one is in rr after forking a second child for replay.  I don't know why we do this instead of just exec'ing the existing child, but that's a separate issue.  gdb tells me that we're here in the `_exit` routine in libc\n\n<pre>\n(gdb) disass\nDump of assembler code for function _exit:\n   0xf7e102c8 <+0>: mov    0x4(%esp),%ebx\n   0xf7e102cc <+4>: mov    $0xfc,%eax\n   0xf7e102d1 <+9>: call   *%gs:0x10\n   0xf7e102d8 <+16>:    mov    $0x1,%eax\n   0xf7e102dd <+21>:    int    $0x80\n=> 0xf7e102df <+23>:    hlt    \n</pre>\n\nThat's really strange; the `call` in the middle of the dump is supposed to trap to the `exit_group` syscall (252 = 0xfc).  Somehow we didn't trap to there.  If I manually trap to exit_group in sys.c\n\n<pre>\n//  exit(0);\n    int ret;\n    __asm__ __volatile__(\"int $0x80\" : \"=a\"(ret) : \"0\"(252/*__NR_exit_group*/));\n</pre>\n\nthen replay continues normally.  _me scratches head_\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19001261/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19001324", "body": "FTR, we shouldn't be using `exit()` here, instead we should be using `_exit()`.  But it ends up not mattering wrt this bug.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19001324/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19015423", "body": "Good and bad news: I \"fixed\" the exec problem by removing the seemingly-unnecessary `fork()`.  But it turns out the problem underlying #89 and probably #62 is purely a difference in behavior between `gdb` and `gdb --annotate=3` (what emacs gud-gdb uses).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19015423/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19016246", "body": "The behavior also differs depending on whether gdb is run in a dumb terminal.  Sigh.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19016246/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19085844", "body": ">  It should have fixed all NYI deterministic signals\n\nOops, `int $3` is still broken.  Not too concerned about that atm though.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19085844/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19086648", "body": "(Whups, the tgkill test was testing the wrong thing, but luckily it passes when fixed!)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19086648/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19134783", "body": "> but I don't think it's worth the time right now to figure out what dance gdb wants us to do.\n\nTo be clearer, we'll signal-stop on the SIGTRAP, which is probably good enough for now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19134783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19134822", "body": ">  I don't think this is a big deal yet\n\nTo be clearer, not a big deal yet because the user can `bt` in gdb to see which instruction triggered the trap.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19134822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19145243", "body": "Another argument for fixing this is that the tests take about 4.5 minutes to run, even though only a few of them are long-running.  The lion's share of the time goes to gdb.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19145243/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19789447", "body": "ld.so and the vdso seem to be mapped at different addresses during record and replay.  Very odd ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19789447/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19790414", "body": "OK, this is one of those creepy ones.  I was making the recording with a script helper but then replaying it \"by hand\".  The script helper invokes the rr binary directly, but when I run \"by hand\" I invoke rr through a symbolic link.  Somehow that difference (or something like it) is causing the process to get a different address space layout.\n\nWhen I record and replay by hand, all is well.  Adding a script helper to replay and using helpers for both record and replay also is happy.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19790414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19790692", "body": "This is no longer happening.  I don't know if the original bug was actually fixed or not, but nothing more to do here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19790692/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19790869", "body": "There were some bugs in the debugger-test helpers which have since been fixed, so I /think/ this is resolved now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19790869/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19791188", "body": "I think this is the same as #71.  Whups.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19791188/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19793155", "body": "rr gets a PTRACE_EXIT notification for the thread-group leader (main thread), but there are other tasks still alive in the task group.  My guess is that firefox is calling `_exit()` which invokes `exit_group`, and ptrace is trying to notify rr of PTRACE_EXIT for all the tasks in the group before they all are destroyed.  So rr is deadlocking itself with ptrace.\n\nI'm not sure why this code exists in the first place, to be honest.  Removing it gets us through the recording phase, but we trip an assertion during replay.  So maybe it has something to do with SIGCHLDs.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19793155/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19797314", "body": "(Sorry, delayed by NBA finals.)  A test that `_exit`s from the main thread when there's still another live thread shows the same symptom, so lends support to the hypothesis.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19797314/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19798098", "body": "<pre>\n\"../rr/obj/bin/rr\" --replay --autopilot trace_0\nnsStringStats\n => mAllocCount:              4\n => mReallocCount:            0\n => mFreeCount:               4\n => mShareCount:              1\n => mAdoptCount:              0\n => mAdoptFreeCount:          0\neip registers do not match: replaying: 55577430 and recorded: 55577431\n08048000-08060000 r-xp 00000000 00:14 3552534                            /mnt/hgfs/rr/workbench/.ff/firefox/firefox\n08060000-08061000 rw-p 00017000 00:14 3552534                            /mnt/hgfs/rr/workbench/.ff/firefox/firefox\n08061000-08108000 rw-p 00000000 00:00 0                                  [heap]\n55555000-55575000 r-xp 00000000 08:01 406981                             /lib/i386-linux-gnu/ld-2.15.so\n55575000-55576000 r--p 0001f000 08:01 406981                             /lib/i386-linux-gnu/ld-2.15.so\n55576000-55577000 rw-p 00020000 08:01 406981                             /lib/i386-linux-gnu/ld-2.15.so\n55577000-55578000 r-xp 00000000 00:00 0                                  [vdso]\n55778000-5577a000 rw-p 00000000 00:00 0 \n5577a000-5577b000 r--p 00000000 00:00 0 \n5577b000-5577f000 r-xp 00000000 00:00 0 \n5577f000-55780000 rw-p 00000000 00:00 0 \n55780000-55783000 r-xp 00000000 00:00 0 \n55783000-55784000 rw-p 00000000 00:00 0 \n55784000-55786000 r-xp 00000000 00:00 0 \n55786000-55787000 rw-p 00000000 00:00 0 \n55787000-5578f000 r-xp 00000000 00:00 0 \n5578f000-55790000 r--p 00000000 00:00 0 \n55790000-55791000 rw-p 00000000 00:00 0 \n55792000-557a9000 r-xp 00000000 00:00 0 \n557a9000-557aa000 r--p 00000000 00:00 0 \n557aa000-557ad000 rw-p 00000000 00:00 0 \n557ad000-557b0000 r-xp 00000000 00:00 0 \n557b0000-557b1000 r--p 00000000 00:00 0 \n557b1000-557b3000 rw-p 00000000 00:00 0 \n557b3000-557ba000 r-xp 00000000 00:00 0 \n557ba000-557bb000 r--p 00000000 00:00 0 \n557bb000-557bc000 rw-p 00000000 00:00 0 \n557bc000-55894000 r-xp 00000000 00:00 0 \n55894000-55895000 ---p 00000000 00:00 0 \n55895000-55899000 r--p 00000000 00:00 0 \n55899000-558a1000 rw-p 00000000 00:00 0 \n558a1000-558cb000 r-xp 00000000 00:00 0 \n558cb000-558cc000 r--p 00000000 00:00 0 \n558cc000-558cd000 rw-p 00000000 00:00 0 \n558cd000-558e9000 r-xp 00000000 00:00 0 \n558e9000-558ea000 r--p 00000000 00:00 0 \n558ea000-558eb000 rw-p 00000000 00:00 0 \n558eb000-55a8e000 r-xp 00000000 00:00 0 \n55a8e000-55a90000 r--p 00000000 00:00 0 \n55a90000-55a97000 rw-p 00000000 00:00 0 \n55a97000-55adc000 r-xp 00000000 00:00 0 \n55adc000-55adf000 rw-p 00000000 00:00 0 \n55adf000-55b07000 r-xp 00000000 00:00 0 \n55b07000-55b0b000 rw-p 00000000 00:00 0 \n55b0b000-55c6e000 r-xp 00000000 00:00 0 \n55c6e000-55c73000 rw-p 00000000 00:00 0 \n55c73000-55ca2000 r-xp 00000000 00:00 0 \n55ca2000-55ca5000 rw-p 00000000 00:00 0 \n55ca5000-55cf5000 r-xp 00000000 00:00 0 \n55cf5000-55cf8000 rw-p 00000000 00:00 0 \n55cf8000-55cfd000 r-xp 00000000 00:00 0 \n55cfd000-55cfe000 ---p 00000000 00:00 0 \n55cfe000-55db7000 r-xp 00000000 00:00 0 \n55db7000-55dba000 rw-p 00000000 00:00 0 \n55dba000-55e75000 r-xp 00000000 00:00 0 \n55e75000-56088000 ---p 00000000 00:00 0 \n56088000-5881b000 r-xp 00000000 00:00 0 \n5881b000-5968d000 rw-p 00000000 00:00 0 \n5968d000-59694000 r--s 00000000 00:04 35616                              /dev/zero (deleted)\n59694000-59697000 r-xp 00000000 00:00 0 \n59697000-59698000 r--p 00000000 00:00 0 \n59698000-59699000 rw-p 00000000 00:00 0 \n59699000-596a0000 r-xp 00000000 00:00 0 \n596a0000-596a1000 r--p 00000000 00:00 0 \n596a1000-596a2000 rw-p 00000000 00:00 0 \n596a5000-59792000 r-xp 00000000 00:00 0 \n59792000-59796000 r--p 00000000 00:00 0 \n59796000-59797000 rw-p 00000000 00:00 0 \n59797000-597bb000 r-xp 00000000 00:00 0 \n597bb000-597bc000 r--p 00000000 00:00 0 \n597bc000-597bd000 rw-p 00000000 00:00 0 \n597bd000-59804000 r-xp 00000000 00:00 0 \n59804000-59805000 r--p 00000000 00:00 0 \n59805000-59806000 rw-p 00000000 00:00 0 \n59806000-59853000 r-xp 00000000 00:00 0 \n59853000-59854000 r--p 00000000 00:00 0 \n59854000-59855000 rw-p 00000000 00:00 0 \n59855000-5994c000 r-xp 00000000 00:00 0 \n5994c000-5994d000 r--p 00000000 00:00 0 \n5994d000-5994e000 rw-p 00000000 00:00 0 \n5994e000-59dae000 r-xp 00000000 00:00 0 \n59dae000-59db2000 r--p 00000000 00:00 0 \n59db2000-59db6000 rw-p 00000000 00:00 0 \n59db6000-59dd3000 r-xp 00000000 00:00 0 \n59dd3000-59dd5000 r--p 00000000 00:00 0 \n59dd5000-59dd6000 rw-p 00000000 00:00 0 \n59dd6000-59f29000 r-xp 00000000 00:00 0 \n59f29000-59f2b000 r--p 00000000 00:00 0 \n59f2b000-59f2d000 rw-p 00000000 00:00 0 \n59f2d000-59f57000 r-xp 00000000 00:00 0 \n59f57000-59f58000 r--p 00000000 00:00 0 \n59f58000-59f59000 rw-p 00000000 00:00 0 \n59f59000-59fee000 r-xp 00000000 00:00 0 \n59fee000-59ff2000 r--p 00000000 00:00 0 \n59ff2000-59ff3000 rw-p 00000000 00:00 0 \n59ff3000-5a025000 r-xp 00000000 00:00 0 \n5a025000-5a026000 r--p 00000000 00:00 0 \n5a026000-5a027000 rw-p 00000000 00:00 0 \n5a027000-5a0d2000 r-xp 00000000 00:00 0 \n5a0d2000-5a0d3000 ---p 00000000 00:00 0 \n5a0d3000-5a0d5000 r--p 00000000 00:00 0 \n5a0d5000-5a0d6000 rw-p 00000000 00:00 0 \n5a0d6000-5a0f5000 r-xp 00000000 00:00 0 \n5a0f5000-5a0f6000 r--p 00000000 00:00 0 \n5a0f6000-5a0f7000 rw-p 00000000 00:00 0 \n5a0f7000-5a102000 r-xp 00000000 00:00 0 \n5a102000-5a103000 r--p 00000000 00:00 0 \n5a103000-5a104000 rw-p 00000000 00:00 0 \n5a104000-5a14b000 r-xp 00000000 00:00 0 \n5a14b000-5a14c000 ---p 00000000 00:00 0 \n5a14c000-5a14d000 r--p 00000000 00:00 0 \n5a14d000-5a14e000 rw-p 00000000 00:00 0 \n5a14e000-5a215000 r-xp 00000000 00:00 0 \n5a215000-5a216000 r--p 00000000 00:00 0 \n5a216000-5a219000 rw-p 00000000 00:00 0 \n5a219000-5a21c000 r-xp 00000000 00:00 0 \n5a21c000-5a21d000 r--p 00000000 00:00 0 \n5a21d000-5a21e000 rw-p 00000000 00:00 0 \n5a21e000-5a34e000 r-xp 00000000 00:00 0 \n5a34e000-5a34f000 r--p 00000000 00:00 0 \n5a34f000-5a352000 rw-p 00000000 00:00 0 \n5a352000-5a362000 r-xp 00000000 00:00 0 \n5a362000-5a363000 r--p 00000000 00:00 0 \n5a363000-5a364000 rw-p 00000000 00:00 0 \n5a364000-5a3bc000 r-xp 00000000 00:00 0 \n5a3bc000-5a3bd000 r--p 00000000 00:00 0 \n5a3bd000-5a3c0000 rw-p 00000000 00:00 0 \n5a3c0000-5a3c1000 r-xp 00000000 00:00 0 \n5a3c1000-5a3c2000 r--p 00000000 00:00 0 \n5a3c2000-5a3c3000 rw-p 00000000 00:00 0 \n5a3c3000-5a3c8000 r-xp 00000000 00:00 0 \n5a3c8000-5a3c9000 r--p 00000000 00:00 0 \n5a3c9000-5a3ca000 rw-p 00000000 00:00 0 \n5a3ca000-5a404000 r-xp 00000000 00:00 0 \n5a404000-5a405000 r--p 00000000 00:00 0 \n5a405000-5a406000 rw-p 00000000 00:00 0 \n5a406000-5a40a000 r-xp 00000000 00:00 0 \n5a40a000-5a40b000 r--p 00000000 00:00 0 \n5a40b000-5a40c000 rw-p 00000000 00:00 0 \n5a40c000-5a420000 r-xp 00000000 00:00 0 \n5a420000-5a421000 r--p 00000000 00:00 0 \n5a421000-5a422000 rw-p 00000000 00:00 0 \n5a422000-5a43f000 r-xp 00000000 00:00 0 \n5a43f000-5a440000 r--p 00000000 00:00 0 \n5a440000-5a441000 rw-p 00000000 00:00 0 \n5a441000-5a454000 r-xp 00000000 00:00 0 \n5a454000-5a455000 ---p 00000000 00:00 0 \n5a455000-5a456000 r--p 00000000 00:00 0 \n5a456000-5a459000 rw-p 00000000 00:00 0 \n5a459000-5a47f000 r-xp 00000000 00:00 0 \n5a47f000-5a480000 ---p 00000000 00:00 0 \n5a480000-5a482000 r--p 00000000 00:00 0 \n5a482000-5a483000 rw-p 00000000 00:00 0 \n5a483000-5a485000 r-xp 00000000 00:00 0 \n5a485000-5a486000 r--p 00000000 00:00 0 \n5a486000-5a487000 rw-p 00000000 00:00 0 \n5a487000-5a495000 r-xp 00000000 00:00 0 \n5a495000-5a496000 r--p 00000000 00:00 0 \n5a496000-5a497000 rw-p 00000000 00:00 0 \n5a497000-5a49e000 r-xp 00000000 00:00 0 \n5a49e000-5a49f000 r--p 00000000 00:00 0 \n5a49f000-5a4a0000 rw-p 00000000 00:00 0 \n5a4a0000-5a4a9000 r-xp 00000000 00:00 0 \n5a4a9000-5a4aa000 r--p 00000000 00:00 0 \n5a4aa000-5a4ab000 rw-p 00000000 00:00 0 \n5a4ab000-5a4ad000 r-xp 00000000 00:00 0 \n5a4ad000-5a4ae000 r--p 00000000 00:00 0 \n5a4ae000-5a4af000 rw-p 00000000 00:00 0 \n5a4af000-5a4b1000 r-xp 00000000 00:00 0 \n5a4b1000-5a4b2000 r--p 00000000 00:00 0 \n5a4b2000-5a4b3000 rw-p 00000000 00:00 0 \n5a4b3000-5a546000 r-xp 00000000 00:00 0 \n5a546000-5a54a000 r--p 00000000 00:00 0 \n5a54a000-5a54b000 rw-p 00000000 00:00 0 \n5a54b000-5a573000 r-xp 00000000 00:00 0 \n5a573000-5a574000 r--p 00000000 00:00 0 \n5a574000-5a575000 rw-p 00000000 00:00 0 \n5a575000-5a577000 r-xp 00000000 00:00 0 \n5a577000-5a578000 r--p 00000000 00:00 0 \n5a578000-5a579000 rw-p 00000000 00:00 0 \n5a579000-5a581000 r-xp 00000000 00:00 0 \n5a581000-5a582000 r--p 00000000 00:00 0 \n5a582000-5a583000 rw-p 00000000 00:00 0 \n5a583000-5a5a2000 r-xp 00000000 00:00 0 \n5a5a2000-5a5a3000 r--p 00000000 00:00 0 \n5a5a3000-5a5a4000 rw-p 00000000 00:00 0 \n5a5a4000-5a5ab000 r-xp 00000000 00:00 0 \n5a5ab000-5a5ac000 r--p 00000000 00:00 0 \n5a5ac000-5a5ad000 rw-p 00000000 00:00 0 \n5a5ad000-5a5c3000 r-xp 00000000 00:00 0 \n5a5c3000-5a5c4000 r--p 00000000 00:00 0 \n5a5c4000-5a5c7000 rw-p 00000000 00:00 0 \n5a5c7000-5a5c9000 r-xp 00000000 00:00 0 \n5a5c9000-5a5ca000 r--p 00000000 00:00 0 \n5a5ca000-5a5cb000 rw-p 00000000 00:00 0 \n5a5cb000-5a5d0000 r-xp 00000000 00:00 0 \n5a5d0000-5a5d1000 r--p 00000000 00:00 0 \n5a5d1000-5a5d2000 rw-p 00000000 00:00 0 \n5a5d2000-5a5d6000 r-xp 00000000 00:00 0 \n5a5d6000-5a5d7000 r--p 00000000 00:00 0 \n5a5d7000-5a5d8000 rw-p 00000000 00:00 0 \n5a5d8000-5a5d9000 ---p 00000000 00:00 0 \n5a5d9000-5a7d9000 rw-p 00000000 00:00 0 \n5a7d9000-5a9d9000 ---p 00000000 00:00 0 \n5a9d9000-5a9de000 r-xp 00000000 00:00 0 \n5a9de000-5a9df000 r--p 00000000 00:00 0 \n5a9df000-5a9e0000 rw-p 00000000 00:00 0 \n5a9e0000-5a9e4000 r-xp 00000000 00:00 0 \n5a9e4000-5a9e5000 r--p 00000000 00:00 0 \n5a9e5000-5a9e6000 rw-p 00000000 00:00 0 \n5a9e6000-5a9ee000 r-xp 00000000 00:00 0 \n5a9ee000-5a9ef000 r--p 00000000 00:00 0 \n5a9ef000-5a9f0000 rw-p 00000000 00:00 0 \n5a9f1000-5a9fb000 r-xp 00000000 00:00 0 \n5a9fb000-5a9fc000 r--p 00000000 00:00 0 \n5a9fc000-5a9fd000 rw-p 00000000 00:00 0 \n5aa00000-5aa21000 rw-p 00000000 00:00 0 \n5aa21000-5ab00000 ---p 00000000 00:00 0 \n5ab00000-5ad00000 r--p 00000000 00:00 0 \n5ad00000-5ad16000 r-xp 00000000 00:00 0 \n5ad16000-5ad17000 r--p 00000000 00:00 0 \n5ad17000-5ad1a000 rw-p 00000000 00:00 0 \n5ad1a000-5ad25000 r-xp 00000000 00:00 0 \n5ad25000-5ad26000 r--p 00000000 00:00 0 \n5ad26000-5ad27000 rw-p 00000000 00:00 0 \n5ad27000-5ad5c000 r-xp 00000000 00:00 0 \n5ad5c000-5ad5d000 r--p 00000000 00:00 0 \n5ad5d000-5ad5e000 rw-p 00000000 00:00 0 \n5ad76000-5ad85000 r-xp 00000000 00:00 0 \n5ad85000-5ad86000 r--p 00000000 00:00 0 \n5ad86000-5ad87000 rw-p 00000000 00:00 0 \n5ad87000-5ad98000 r-xp 00000000 00:00 0 \n5ad98000-5ad99000 r--p 00000000 00:00 0 \n5ad99000-5ad9a000 rw-p 00000000 00:00 0 \n5ad9a000-5ada2000 r-xp 00000000 00:00 0 \n5ada2000-5ada3000 r--p 00000000 00:00 0 \n5ada3000-5ada4000 rw-p 00000000 00:00 0 \n5ada4000-5adcd000 r-xp 00000000 00:00 0 \n5adcd000-5adce000 r--p 00000000 00:00 0 \n5adce000-5adcf000 rw-p 00000000 00:00 0 \n5adcf000-5add5000 r-xp 00000000 00:00 0 \n5add5000-5add6000 r--p 00000000 00:00 0 \n5add6000-5add7000 rw-p 00000000 00:00 0 \n5add7000-5afd7000 ---p 00000000 00:00 0 \nf0dea000-f0deb000 ---p 00000000 00:00 0 \nfffdd000-ffffe000 rw-p 00000000 00:00 0                                  [stack]\n[FATAL] (/home/cjones/rr/rr/src/share/util.c:600: errno: None) [event -17, state -1, trace file line 4660]\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19798098/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19835895", "body": "gdb is pretty much unusable on firefox-in-rr, need to diagnose this at least.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19835895/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19847565", "body": "This seems to have something to do with the \"glxtest\" process firefox forks during startup.  We need to have a way for this to not trip up gdb.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19847565/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19847659", "body": "Looking closer, the string counts are not even in the same ballpark as during recording.  This is a symptom of a replay divergence which seems related to #127.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19847659/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19849601", "body": "> This seems to have something to do with the \"glxtest\" process firefox forks during startup.\n\nForgot to mention, I confirmed that hacking out glxtest makes this specific symptom go away.  But not much of a solution ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19849601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19850543", "body": "I tried telling gdk not to use MIT-SHM\n\n<pre>\ndiff --git a/toolkit/xre/nsAppRunner.cpp b/toolkit/xre/nsAppRunner.cpp\n--- a/toolkit/xre/nsAppRunner.cpp\n+++ b/toolkit/xre/nsAppRunner.cpp\n@@ -3382,17 +3384,19 @@ XREMain::XRE_mainStartup(bool* aExitFlag\n #if defined(MOZ_WIDGET_GTK)\n   mGdkDisplay = gdk_display_open(display_name);\n   if (!mGdkDisplay) {\n     PR_fprintf(PR_STDERR, \"Error: cannot open display: %s\\n\", display_name);\n     return 1;\n   }\n   gdk_display_manager_set_default_display (gdk_display_manager_get(),\n                                            mGdkDisplay);\n-    \n+\n+  gdk_set_use_xshm(FALSE);\n+\n   // g_set_application_name () is only defined in glib2.2 and higher.\n   _g_set_application_name_fn _g_set_application_name =\n     (_g_set_application_name_fn)FindFunction(\"g_set_application_name\");\n</pre>\n\nbut no dice.  Might have to disable server side, which is the \"correct\" fix anyway, until we properly support shmem again.  Or maybe time to fix shmem support.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19850543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19851122", "body": "There's some WIP code in the tree to fault on reads of shared segments, and record the read word for replay.  That will be observable to the code being recorded and isn't particularly cheap, but works.\n\nBut yeah, just going to disable MIT-SHM for now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19851122/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19851347", "body": "Disabling shm harder on the server makes this go away.  Firefox replays happily!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19851347/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19851554", "body": "For posterity, that's\n\n<pre>\ndiff --git a/toolkit/xre/Makefile.in b/toolkit/xre/Makefile.in\n--- a/toolkit/xre/Makefile.in\n+++ b/toolkit/xre/Makefile.in\n@@ -19,17 +19,17 @@ milestone_txt = $(topsrcdir)/config/mile\n \n LIBRARY_NAME = xulapp_s\n MSVC_ENABLE_PGO := 1\n LIBXUL_LIBRARY = 1\n \n FORCE_STATIC_LIB = 1\n \n ifeq ($(MOZ_GL_DEFAULT_PROVIDER),GLX)\n-DEFINES += -DUSE_GLX_TEST\n+#DEFINES += -DUSE_GLX_TEST\n endif\n \n DEFINES += -DIMPL_XREAPI \\\n   -DMOZ_APP_NAME='\"$(MOZ_APP_NAME)\"' \\\n   -DMOZ_APP_VERSION='\"$(MOZ_APP_VERSION)\"'\n \n ifdef MOZ_UPDATER\n ifneq (android,$(MOZ_WIDGET_TOOLKIT))\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19851554/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19941359", "body": "We need this to prevent synchronous signals received in the syscall buffer from blowing up the world, and to better handle buffer overflows when we buffer variable-sized output data.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19941359/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19949605", "body": "I have the original branch rebased and cleaned up a bit (with some of my own riders) at https://github.com/cgjones/rr/tree/syscall-buffer-cleanup .  The change to filtering semantics requires double-checking WRAP_SYSCALLS_CALLSITE_IN_WRAPPER() and its users, which I'll do before merging.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19949605/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19953177", "body": "> Change to \"buffer\"?\n\nErrm yeah :).  I never claimed our test coverage for the buffer was there yet ;).\n\n> I think signals/context-switches inside the buffer library are still completely broken with this patch (but no worse than the state I had it in). I assume fixing that will be a followup patch.\n\nWell, this code is off by default, and even then all the broken syscalls were already disabled before your patch.  There's existing signal brokenness that your patch didn't change.  The only \"regression\" here AFAIK is temporarily disabling `futex`, which I'd like to un-regress before landing.  But since it's effectively dead code atm, I'm not in a huge hurry.  But also no big hurry to get on upstream/master.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19953177/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19990410", "body": "It turns out that the `futex` code isn't used, because glibc directly traps to the kernel.  So except for the CALLSITE_IN_LIB issue, I think we're back to where we were functionality-wise with a nice cleanup on top.  Then the hard work begins :).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/19990410/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20001998", "body": "I came across some code that busy-waits on the `ptrace(SYSCALL)` for `write`, so this bug is invalid as written.  Another instance of #141.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20001998/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20002169", "body": "> - rr uses quite a bit of CPU (not unexpected), and contends heavily with `perf`.\n\nIt turns out that rr will often busy-wait, which might explain some of the fairly surprising CPU usage.  This in turn might be affecting recording fidelity, but that's a bit more of a stretch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20002169/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20005070", "body": "We're back to (actually, as opposed to apparently, #145) passing all tests and recording firefox.  We fail replaying FF, but so does master.  I think we're about ready to merge.  Would like to get the lib rename in for 0.0 to reduce future hassle.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20005070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018258", "body": "@rocallahan did you want to take another look?  Nothing particularly substantial has changed since the last time you commented, just a few small bugs squashed.  (I fixed the `futex` impl, but it turns out to be dead code.  Oh well.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018258/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018503", "body": "I should add, the reason I want to merge this sooner rather than later is because it renames the syscall PRELOAD library, and I'd like that to happen before we get too many rr packages distributed.  This is also a pretty big hunk of code, and has lots of nice juicy deletions.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018503/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018630", "body": "Resolved by #148.  What landed was mostly a cleanup, lots more work remains.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20018630/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20019001", "body": "I've seen this kind of problem happen a few times if the following happens\n- start running a test\n- interrupt the test before `cleanup`, leaving behind `trace_0`\n- run another test, which records to `trace_1`\n- try to replay `trace_0` for a different binary.  Whups.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20019001/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20021235", "body": "Yep!\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20021235/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20027416", "body": "(This is a trivial patch I already have sitting on a branch, but I'll give this a few days to see if there are any objections, or if we find there are prerelease users who might be disturbed.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20027416/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20027452", "body": "Also, we now have many unit tests that are sharing the same execution targets.  It would be nice to streamline that a bit.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20027452/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20030391", "body": "In #156, we now have to do this in the main rr process to test whether or not we can preload the syscall buffer, so the syscall buffer is no longer to blame per se.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20030391/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20074393", "body": "I put together a PoC that signals the ptrace-er when a ptrace-ee has been context-switched a configurable number of times (we'd want that to be \"1\" for our purposes here).  Initial testing suggests that the signals are being delivered as one would expect.  The signaling works basically the same way as for the hpc interrupts, except that in our case here the trace-ee has to program the interrupt, from within the syscall buffer lib.  There are some corner cases to figure out but this seems like it might work.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20074393/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20089868", "body": "After a few more experiments, I'm now pretty confident we can make this work.  My little test program is [here](https://github.com/cgjones/rr-workbench/blob/master/cs_signal.c).  To make this \"actually\" work, we need to process the de-sched interrupts in the parent process and disarm the counter there, which is pretty straightforward but needs a bunch of nasty POSIX gloop to pull off.  Will prove that out next, since that part must be bulletproof.\n\n@rocallahan I should have asked this before I got started, but (i) was your approach about the same as this? (iI) if not, do you happen to have your old test program around?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20089868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20092690", "body": "The ptrace and UNIXbeard hackery is mostly working [here](https://github.com/cgjones/rr-workbench/blob/master/notify_desched.c), but I'm getting a seemingly-spurious desched notification that I don't understand yet.  Or, there's an actual desched happening and I don't know where it's coming from.  I have a hackaround that's not so bad and works, but will see if I can tell what's causing it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20092690/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20097676", "body": "The extra SIGIO doesn't seem to be an extra desched, because the switch counter is the same in the first and second.  I also tried monitoring desched on syscalls that block for increasingly longer durations, and the extra SIGIO is always sent immediately after desched, not at arbitrary times.  So I'm pretty close to ascribing this to magic for the time being and moving on.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20097676/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20098288", "body": "Here's about the only hypothesis I have\n- child gets descheduled, bumps counter to _i_ and schedules SIGIO\n- SIGIO notification \"schedules\" child, but it doesn't run\n- child is being ptraced, so we \"deschedule\" child to notify parent and bump counter to _i+1_\n- counter signal generated, but SIGIO is already pending so this one is queued\n- parent is notified and sees counter value _i+1_\n- parent stops delivery of first signal and shuts off counter\n- second SIGIO dequeued and delivered, notififying parent (counter is off, so no pseudo-desched possible here)\n- parent notified and sees counter value _i+1_ again\n- parent stops delivery of second SIGIO and we continue on\n\nIf this is what's happening, then the current hackaround should be a reliable way of dealing with this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20098288/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20098952", "body": "This regressed rr invocations like `rr record ./foo -b blah`, because getopt is too smart and thinks that the args to `./foo` are meant for rr.  Easy fix, coming up.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20098952/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20100463", "body": "Running the test in gdb shows gdb catching an internal trap meant for gdb itself.  That's bad.  I'm not 100% sure whether this is in the forked process or not, but that seems likely.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20100463/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20149822", "body": "The problem isn't limited to ignored signals, it just happens that's the only case in our tests where execution resumes after signal delivery.  Modifying async_usr1 to resume after catching the signal intermittently reproduces the same symptom.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20149822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20158675", "body": "Er, no one told gh to close this ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20158675/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20158754", "body": "The magic sauce that makes this bug reproduce, intermittently however, is\n- deliver async signal\n- resume execution\n- chew a bunch of CPU cycles and hit USR_SCHED interrupt\n\nAfter that, we step the right rcb and ip, but when we get there other registers are not in the state we expect.  I suspect that we're recording the wrong rcb in recording, or we're not resetting it properly in record/replay/both.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20158754/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20158880", "body": "> Er, no one told gh to close this ...\n\nHeh, I said \"This doesn't resolve (current issue) however\".  I guess the gh parser is too smart (or too dumb).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20158880/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20161809", "body": "(I also confirmed that the $ip doesn't advance during the pseudo-step, when the program being traced isn't blocked on a syscall.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20161809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168476", "body": "> - futex\n\nAs a note for posterity, glibc directly invokes futex; there's no unresolved symbol we can preload on top of.  So we can't buffer it with our current approach.  Shame.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168476/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168759", "body": "I would guess that pthread_mutex_{lock, unlock} and cond_wait would get us the vast vast majority.  Doing that is a little scary and nontrivial though.  But it's relatively easy to quantify how worth doing it would be once we have the structure in place.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168759/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168894", "body": "We can do this in two steps: first replace the on-disk file with /dev/shm.  This should be pretty straightforward.  Second, actually execute (instead of emulate) the `open()` for the buffer file, and then also actually execute the mmap for that fd.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20168894/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20170654", "body": "I have a PoC for \"rpc syscalls\", where a tracee requests that the tracer make syscall(s) on its behalf, [here](https://github.com/cgjones/rr-workbench/blob/master/rpc_syscall.c).  I think this is the last piece of technology we need.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20170654/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171069", "body": "We have to do a pretty tricky dance to set up the cs counter and syscall buffer region across record/replay.  During recording, the counter fd has to be shared with rr, but in replay it should be emulated.  This requires letting rr know the fd number that's to be shared.  In both record and replay, the buffer region has to be actually opened and mmap'd by both the tracee and rr.  rr also has to know it's the syscall buffer initialization code it's talking to.  The cleanest way I could think of to implement this is with a fake syscall; use an unallocated syscall number (like -42) to trap into rr, then let rr decide what to do.  That's what the PoC does.\n\nI think we could make this work by keying off syscall param pattern matching and so forth, but I'd rather get away from that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171069/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171160", "body": "In other words, instead of assuming various things about the sequence of mmap/socket/recv/etc calls and patterns of parameters thereto, we could instead do something like\n\n<pre>\nint counterfd = perf_event_open(...);\nchar* shmfile = \"/dev/shm/rr-tracee-[tid]\";\nstruct msghdr msg;\n// set up msg\nsyscall(MAGIC_SYSCALL_BUF_INIT, counterfd, shmfile, &msg);\n</pre>\n\nthen rr decides what do with the params based on record vs. replay.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171160/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171292", "body": "(Note to self: need to sigprocmask during this setup or things will get very hard.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20171292/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20219310", "body": "I should note explicitly that this commit purposely removes the initialize-buffer-at-pthread-creation code.  With this change, if a task never happens to touch a buffered syscall, then we never allocate memory for the buffer.  (I doubt that will be common, but it's less code anyway.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20219310/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20321252", "body": "(Note to self: investigate what happens when may-block syscalls are interrupted with signals.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20321252/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20325456", "body": "All the necessary new technology is in place.  What remains is\n- figure out the right buffer-flush dance to do during recording so that we know to replay the _first_ buffered syscall, instead of blowing up trying to advance to where rr saw the desched event\n- see how this code works when signals are being delivered, revise as necessary\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20325456/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20364364", "body": "I think I got this licked\n- when rr receives the desched notification for task _T_ at syscall _s_, record a buffer flush event ... but **don't** zero the byte counter.  So then during replay, we stop at the first buffered syscall, and refill the buffer appropriately to let them finish.\n- record a normal syscall-entry into _s_.  Since we haven't reset the record counter yet, just refilled the buffer, _T_ will still compute the same record pointers during replay of the preamble of _s_ as it did during recording.\n- continue normally, descheduling _T_ if necessary, and advance to the syscall-exit of _s_.  Record a normal syscall-exit event for _T_ at _s_, including outparam data.  This will in effect have _T_ use the syscall buffer as undistinguished scratch space for the syscall _s_.\n- record a zero-syscallbuf-record-counter event.  Now _T_ can proceed using the syscall buffer \"normally\".\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20364364/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20374105", "body": "Hitting a scary problem now where finishing desched-interrupted syscalls with ptrace(SYSCALL) doesn't seem to be stopping at the syscall exit properly.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20374105/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20388198", "body": "So the situation is pretty strange, and different for different syscalls.  My experiments are [here](https://github.com/cgjones/rr-workbench/blob/master/notify_desched.c).  There's a tracee that essentially looks like (in a loop)\n\n```\narm_desched_event();  // ioctl(...);\n[syscall(...)];\ndisarm_desched_event();  // ioctl(...);\n```\n\nAnd the the tracer is basically (in a loop)\n\n```\nwaitpid(tracee);\n// status 1\nptrace(SYSCALL, tracee);\nwaitpid(tracee);\n// status 2\nptrace(SYSCALL, tracee);\nwaitpid(tracee);\n// status 3\nptrace(SYSCALL, tracee);\nwaitpid(tracee);\n// status 4\n```\n\nThe behaviors I see for the different syscalls are\n- `sched_yield()`\n  1. SIGIO (orig_eax = SYS_sched_yield; other registers look like syscall is finished)\n  2. SIGIO (orig_eax = SYS_sched_yield; same regs)\n  3. syscall trap (orig_eax = SYS_ioctl; regs look like syscall entry)\n  4. syscall trap (orig_eax = SYS_ioctl; regs look like syscall exit)\n- `write(stdout, '.', 1)`\n  1. SIGIO (orig_eax = SYS_write; other registers look like syscall is finished)\n  2. SIGIO (orig_eax = SYS_write; same regs)\n  3. syscall trap (orig_eax = SYS_ioctl; regs look like syscall entry)\n  4. syscall trap (orig_eax = SYS_ioctl; regs look like syscall exit)\n- `system(sleep 1)` (this blocks on waitpid)\n  1. SIGIO (orig_eax = SYS_waitpid; other registers don't look like syscall entry or exit)\n  2. SIGIO (orig_eax = SYS_waitpid; other registers don't look like syscall entry or exit)\n  3. syscall trap (orig_eax = SYS_waitpid; regs look like syscall entry)\n  4. syscall trap (orig_eax = SYS_waitpid; regs look like syscall exit)\n- `nanosleep(1sec)`\n  1. SIGIO (orig_eax = SYS_nanosleep; other registers don't look like syscall entry or exit)\n  2. SIGIO (orig_eax = SYS_nanosleep; other registers don't look like syscall entry or exit)\n  3. syscall trap (orig_eax = 0; regs look like syscall entry)\n  4. syscall trap (orig_eax = 0; regs look like syscall exit)\n\nIn the last, an orig_eax of 0 probably means SYS_restart_syscall.\n\nThe first two behaviors look like a syscall that finishes, but the task is descheduled on syscall exit.  So the tracer just sees the exit.  Then we enter and exit the `disarm_desched_event()` ioctl.\n\nThe second two look like actual blocking; the SIGIO seems to arrive before the syscall \"really starts\" (no idea what that might mean in the kernel).  We \"restart\" the syscall and enter it, and then we see it finish.\n\nI don't understand the `SYS_restart_syscall` complication.\n\nThe annoying things are\n- in the finish-and-preempt cases, we can't access the tracee regs on syscall entry.  This makes the plan above trickier.  But not a major obstacle.\n- I don't see a way yet to reliably distinguish the finished-but-preempted reg state from the not-yet-entered reg state.  We can safely assume that the next syscall following the one seen on SIGIO is always `ioctl`, which lets us machete-hack our way out of the problem.  Ugly though.  Will poke more.\n- the SYS_restart_syscall wrinkle is puzzling, but seems relatively easy to paper over\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20388198/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20389891", "body": "> (even for single-address-space)\n\nActually I take that back, I think the prior impl would have been ok with single-address-space.  9a5e74ea64ca779c640397324c6024ac81de9b13 regressed that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20389891/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20390208", "body": "Nope, that commit wouldn't have regressed things either.  We have lots of work to do for multiprocess, so I'll just go ahead and close this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20390208/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20390232", "body": "I'm getting headaches thinking through the changes I need to make to the recorder code, so I'm afraid I'm going to need to take a detour for some rewritin' :/\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20390232/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20395763", "body": "> take a detour for some rewritin' \n\n(That proved to be more than I wanted to chew on right now too.  But will need to happen soon.)\n\n> The first two behaviors look like a syscall that finishes, but the task is descheduled on syscall exit. So the tracer just sees the exit. Then we enter and exit the disarm_desched_event() ioctl.\n\nThis proved to be quite easy to handle: we step over the extraneous SIGIO (`status 2` above) and then `ptrace(SYSCALL)` to see what `status 3` we got.  If it's for sure the ioctl for `disarm_desched_event()`, which is fairly simple to check, then we just run the ioctl to completion.  (It won't block.)\n\nThe cute part is that we don't have to record any trace data or change any execution state.  The syscall buffer must not have been full for us to arm the desched event, therefore it doesn't need flushing.  And the replayer doesn't need any extra data to know to step over the desched ioctls during replay, so we can just carry on!  The next \"normal\" buffer flush will record what we want.\n\nThe other case won't be so easy though ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20395763/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20396767", "body": "I have an idea for how we can avoid that, but it's going to be a bit until I can prove it out.  Note though that (i) rr has to do something similar already with the hpc counters; (ii) ptrace traps are not cheap compared to this ioctl; (iii) rr invokes a bunch of not-so-cheap syscalls (many unnecessarily) to process traps now anyways.  My guess is that we'll see considerably better perf by wrapping as many common syscalls as we can non-optimally, compared to now.  But we'll soon see :).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20396767/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20399927", "body": "I've got things working in [this patch](https://github.com/cgjones/rr/commit/a2c91d94093a917a5402d613510545462c2c8f50), except for a couple niggling details.  Not pretty, but oh well.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20399927/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20434621", "body": "It turns out we need to share the syscallbuf during replay as well for #7, so we get this ~for free.  I already have this in a patch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20434621/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20452127", "body": "This patch ended up being less straightforward than I was hoping, so I'll try to put up a wiki page with a walkthrough in the near future.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20452127/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20453046", "body": "Started with f11b33ff5e87570b64236c446202e2aa01da9b5c.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20453046/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20453406", "body": "The cleanup of `allow_ctx_switch/prep_event` wasn't quite as semantics-preserving as it was meant to be ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20453406/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20455194", "body": "I saw this a few times when working on #180, so it's definitely something users will hit in the field.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20455194/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20459752", "body": "> I'm not sure how that would work. Somehow we'd have to avoid executing the system calls and instead pull the right register values from the trace buffer, all while preserving HPC counts for replay vs recording.\n\nWe don't need to load registers from the trace, and indeed they're not saved there.  The only register that's modified is `eax`, which we explicitly store in the syscallbuf as `ret`.\n\nBut hm, does trapping to the kernel reset the hpc and/or count towards retired branches?  I never checked that.\n\n> Maybe we can do something fancy where the \"untraced system call\" entry point is padded with noops during recording, and during replay we replace that code with another sequence that loads registers from the trace buffer, using the same number of instructions and no conditional branches.\n\nThat was sort of what I had in mind, except I'm not sure about the no-op stuff.\n\nThe trick was that if we can force an interrupt sometime before the last syscallbuf is replayed, then we can do the usual slow SYSCALL stepping through that, but before then do something you suggest, replace the int with a no-op and just load data from the syscallbuf.  But I realized as I was walking out the door that we don't know a priori where in the syscallbuf the last record is; second-to-last page isn't good enough.  We could add that metadata but it starts getting ugly.\n\n> A completely different tack would be to implement checkpointing so we just don't have to replay very long execution sequences. I kinda prefer that actually.\n\nWell of course, but that's a big chunk of work :).  Even if we just make the replay between two checkpoints be 10-15x faster with a few tweaks in replay, I think it'd be worth it (seconds down to instantaneous).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20459752/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20460448", "body": "This apparently happens when replaying exactly the first `USR_SCHED` following delivery of the async signal.  I was somewhat confused by variously waaaaaay overshooting the target, but that's from compressing successive USR_SCHED events for the same task.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20460448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20464412", "body": "No concrete ideas yet, but some observations\n- divergence always occurs when `SIGUSR1` is delivered _just after/at_ a USR_SCHED.  The `$ip` is the same, and rcb/insn counters 0.\n- haven't seen divergence when rcb at `SIGUSR1` is nonzero\n- when divergence, `$ip`s around `SIGUSR` delivery are within 2 instructions of a conditional branch\n- making the SKID_SIZE much larger or smaller doesn't make a difference\n- insns-retired counter doesn't seem to be too useful, and gets higher during replay the larger the skid-size (which doesn't make sense)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20464412/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20464987", "body": "Next step is to try to repro on bare metal instead of a VM.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20464987/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20465450", "body": "> Maybe we can do something fancy where the \"untraced system call\" entry point is padded with noops during recording, and during replay we replace that code with another sequence that loads registers from the trace buffer, using the same number of instructions and no conditional branches.\n\nYep, I had overlooked loading the syscall return into `eax` at the the no-op `int` instruction.  You're right, we could do some fancy footwork to mov that value into place where we overwrite `int`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20465450/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20651786", "body": "Reproduces on bare HW, and ...\n\n> - divergence always occurs when SIGUSR1 is delivered just after/at a USR_SCHED. The $ip is the same, and rcb/insn counters 0.\n\n... isn't true (at least on bare HW).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20651786/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20652000", "body": "> ... isn't true (at least on bare HW).\n\nAlso just seen in VM.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20652000/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20653549", "body": "It looks like that we're not replaying this trick [1] properly.  In this test, we don't enter a signal handler, so the insns retired is > 0.  Looks less creepy, but not sure how to handle it yet.\n\n[1] https://github.com/mozilla/rr/blob/master/src/recorder/handle_signal.c#L271\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20653549/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20656896", "body": "We're at\n\n```\n=> 0x56417700 <+0>: mov    (%esp),%ebx\n```\n\nso this might be an annoying fencepost bug.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20656896/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20688869", "body": "I think this is both a shallow and a deep bug.  The shallow part is, I'm pretty sure that ccba02f620063f48fdb5f2bc0cc67edfb1696648 regressed this, because it moved us from determining if we'd reached the replay point of an async signal by comparing _all_ regs, to just comparing `$ip`.  But obviously, we can reach the same `$ip` an unbounded number of times without retiring a conditional branch, with other registers differing.  So undoing that non-semantics-preserving refactoring ought to fix this case.  (Here we're stopped at `__x86.get_pc_thunk.bx` in very tight C++, which is probably the most frequently-executed `$ip`.)\n\nThe deeper problem is that _all_ regs can have the same value an unbounded number of times within a basic block, with memory mutated in between,  so this \"fix\" would only paper over things a little more.  Execution could still diverge if we pick the wrong reg state to stop at.  This feels pretty unlikely, but since it's really the core of rr we should give it a think.\n\nThe natural reaction is to reach for the insns-retired counter, but from what I've seen so far the quality of the data is pretty close to junk.  It's not even deterministic across subsequent replays of a trace, let alone across record/replay.  I see differences of 1-40 across replays, and differences in the _thousands_ across record/replay.  But we might be able to massage out higher-quality data somehow.  Then the problem would be trivial.\n\nCC @rocallahan\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20688869/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20692196", "body": "Actually, since I've filed this FF is making progress here and there.  The UX is still a hang though.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20692196/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20694991", "body": "This doesn't reproduce anymore.  We've had two async-signal fixes that most likely resolved this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20694991/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20695190", "body": "Oops, was accidentally testing with syscallbuf _disabled_.  This still reproduces with it _enabled_.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20695190/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20696529", "body": "The problem is that we're recording `clone()` in the syscallbuf, not tracing it, but the replay code has no idea how to handle the generated PTRACE_EVENT_CLONE notification.  (The recording code doesn't record it in the trace.)  I don't see much point in trying to buffer `clone`, and trying to handle those ptrace events is going to get quite complicated.  But there may be some other reason things are how they are.  Let's see ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20696529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20699032", "body": "We handle the ptrace event by continuing to the syscall, which works out about the same as tracing.  The \"real\" problem is actually a lot more interesting than that: replay is diverging for some reason related to\n\n```\nWARNING: Last startup was detected as a crash.: file /home/cjones/rr/mozilla-central/toolkit/components/startup/nsAppStartup.cpp, line 806\n```\n\nwhich is printed during replay, but not recording.  And not printed during no-syscallbuf-replay.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20699032/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20706156", "body": "The divergence boils down to reading a set-pref on startup that we don't in the good case\n\n<pre>\n== BAD ==\n[rec] GOOD STARTUP?: lockSeconds 1373403293, lastSuccessful 1373403292\n[rep] GOOD STARTUP?: lockSeconds 1373403293, lastSuccessful 1373403340\n== GOOD ==\n[rec] GOOD STARTUP?: lockSeconds 1373403343, lastSuccessful 1373403340\n[rep] GOOD STARTUP?: lockSeconds 1373403343, lastSuccessful 1373403340\n</pre>\n\nThe read pref is `lastSuccessful`, and in the diverging case we seem to read the value we set, whereas in the correct case we read the originally-read value.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20706156/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20717155", "body": "I should add that this test is not very effective as-is because of #198, but manually shrinking the switch-event limit to 1 makes it 100% reproducible.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20717155/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20717286", "body": "(Signal handling was \"not it\", and even in a relatively simple test this got very tricky, very quickly.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20717286/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20717872", "body": "It seems again like the\n\n```\nfirefox: Fatal IO error 2 (No such file or directory) on X server :0.\n```\n\ndivergence is the scary thing; I expect the failed USR_SCHED is a symptom.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20717872/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20718826", "body": "The test in #202 is similarly hamstrung.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20718826/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20723429", "body": "I wasn't able to find a guarantee that the initial contents of the stack pages are deterministic, and indeed switching to `syscall(SYS_gettid, 0, 0, 0, 0, 0, 0)` fixed the bug I was seeing.  I ran an experiment checksumming the first stack page and saw different garbage, but I accidentally did it in an ASLR environment.  In my rr VM the results are consistent.\n\nI agree it would make sense to map the stack COW to a zero page, but I don't know where that's guaranteed :).  I'll try to poke through the kernel source.  In the meantime, the `syscall()` issue may be pointing at another bug.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20723429/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20723513", "body": "Switching to counting _all_ retired branches, if that's reliable and available everywhere, would make this problem go away too.  Need to investigate.  Sandy Bridge seems to have the right thing at least.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20723513/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20725841", "body": "My bug ended up being caused by rr, so I'm happy to assume linux does the reasonable thing here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20725841/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20726070", "body": "Some things \"not it\" so far\n- gettimeofday on its own reproduces the bug\n- clock_gettimeofday on its own reproduces a similar bug\n- when both are on but are forced to take the fallback traced path, _no_ bug\n- with both on but a forced buffer-flush after every `commit_syscall()`, no bug\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20726070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20791663", "body": "FTR, I got the data I cited here by gathering a few FF traces and using [this script](https://github.com/cgjones/rr-workbench/blob/master/histogram-trace)\n\n```\n./histogram-trace isns/rcb trace_0 trace_...\n```\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20791663/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20838818", "body": "Unfortunately this affects unit tests, because there are some tests I want to write that are impractical when replay is 100x slower.  I guess we can skip verifying replay for the time being (since other tests can approximately cover that).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20838818/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20853852", "body": "I've got all the corner cases worked out, but the more code I write the more I'm afraid the recorder main loop will need to be rewritten to support this :/.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20853852/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20857146", "body": "> I've got all the corner cases worked out, but the more code I write the more I'm afraid the recorder main loop will need to be rewritten to support this :/.\n\nI was able to squeeze in enough support that didn't require rewriting the loop that I _think_ we might be OK.\n\nAs an aside, it really sucks working on the recorder now, because I can't use gdb to look at the tracee ;).  It might be useful enough to hook that up to justify the cost.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20857146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20862454", "body": "r? @rocallahan on the analysis in the long comment in `go_to_a_happy_place()`.  The code is pretty straightforward, but the analysis was much harder.  I want to make sure I didn't miss anything.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20862454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20898095", "body": "> It looks right to me, although I'm not ultra-confident. This is tricky code. It's good that we can leverage the syscall lock flag though, I was hoping we'd be able to.\n\nYeah, that flag proved quite useful :).\n\nFwiw I feel like we have a good handle on the possible behaviors around here, but this first implementation leaves a lot of things NYI.  I'm pretty sure we're going to get bitten by that pretty soon.  But we can cross that bridge when we come to it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20898095/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20898719", "body": "As part of this support, we should sigprocmask-off all signals when we try to step the tracee to a happy place.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20898719/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20900857", "body": "Addressed review comments.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20900857/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20900988", "body": "Resolves #196.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20900988/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20901015", "body": "Drat, the magic words didn't work.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20901015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20901516", "body": "There are two measures that are interesting here: first is raw syscall count, which is easy to measure.  The second is syscalls that \"break the chain\".  For example, if `gettimeofday` is one of the top syscalls, we should buffer it, but if 1/3 of the time it's followed by `stat` say, then the buffering won't be as effective.  We'd want to buffer `stat` too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20901516/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20901800", "body": "On a small representative Firefox workflow, histogram-trace says the top 10 are\n\n<pre>\nsyscall count\n------- -----\n  78    145704  (gettimeofday)\n 265    128062  (clock_gettime)\n 240     31596  (futex)\n 102     28834  (socketcall)\n 168     19642  (poll)\n   3     18464  (read)\n 219      9700  (madvise???)\n   4      7446  (write)\n 221      7016  (fcntl64)\n   5      6694  (open)\n...\n</pre>\n\nThis pretty much matches historical data.  Unfortunately `futex` and `socketcall` are giant pains in the butt to support, but looks like we'll want to.  The rest are trivial though.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20901800/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20903454", "body": "I think this patch broke desched events, but since they weren't enabled or tested that doesn't count as a regression ;).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20903454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20906693", "body": ">  219      9700  (madvise???)\n\nThis seems to be coming from a *Monkey [1] JIT.  So not so surprising.\n\n[1] I just realized I don't know what monkey FF is on anymore! _sniffle_\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20906693/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20907776", "body": "The desched event, which was working so well in early testing, ain't doing so well with FF.  I added wrappers for the easy syscalls above (futex, socketcall, and fcntl are hard), and FF blows up.  However, when I was able to get a run that avoided the landmines, FF recorded about 10% faster just from wrapping `poll` (loading the start page).  That's good news.\n\nThe wrapper for `open` also doesn't seem to be working all the time.  rr ends up processing a significant number of `open` syscalls, even though we do sometimes hit the `open` wrapper, and the buffer isn't full.  Needs investigation.  However, even without wrapping all the open calls, FF is about 5% faster with the wrapper.  That's also great news.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/20907776/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21010174", "body": "The desched event turned out to still be working just fine, only a recent commit regressed it embarrassingly.  I guess that's what happens when effectively dead code is committed.  The basic syscalls above, sans `poll` too now, are working.  Just needs some cleanup before commit.  `poll` is proving to be a bit of a pain, and the work here is starting to pile up, so splitting that out into a followup.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21010174/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21016307", "body": "Testing shows that `close` and `writev` might be worth buffering.  The latter is used by xlib, IIRC.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21016307/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21020355", "body": "This is preventing me from replaying a recording I made of an xpcshell test.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21020355/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21021833", "body": "A call to `open64` originating from NSPR was ~300/~1500 of the traced calls.\n\n_Edit: the script was counting all `open` events, not pairing entry exit. So the number of calls is ~1/2._\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21021833/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21023121", "body": "A random sampling of the remaining traced `open`s shows most of them in hidden (un-overridable) libc helpers, most of those called from dlopen-related code.  Feh.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21023121/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21023237", "body": "There may be something clever we can do for some of the remaining traced calls, but IMHO the energy is better spent elsewhere for now.  Can revisit later.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21023237/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21024377", "body": "<pre>\n[DEBUG] (replay_one_trace_frame) 58344: replaying event USR_SYSCALLBUF_FLUSH, state STATE_SYSCALL_ENTRY\n[DEBUG] (replay_one_trace_frame)     (syscllbufsz:0, abrtcmt:0)\n[DEBUG] (replay_one_trace_frame) 58344: replaying event socketcall, state STATE_SYSCALL_ENTRY\n[DEBUG] (replay_one_trace_frame)     (syscllbufsz:0, abrtcmt:0)\nebx registers do not match: replaying: 4 and recorded: 9\necx registers do not match: replaying: 2400 and recorded: ffffa550\nedx registers do not match: replaying: 0 and recorded: 5b657d88\nedi registers do not match: replaying: 0 and recorded: ffffa56f\nebp registers do not match: replaying: ffffa518 and recorded: 15\neip registers do not match: replaying: 5577ac8b and recorded: 55577430\neflags registers do not match: replaying: 0x282 and recorded: 0x296\n</pre>\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21024377/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21025136", "body": "The other workload I'm focusing on now is for #40.  There the top syscalls are\n\n<pre>\nsyscall count\n------- -----\n   5      2554  (open)\n   6       884  (close)\n 197       764  (fstat64)\n 221       722  (fcntl64)\n 195       696  (stat64)\n 240       488  (futex)\n 192       486  (mmap2)\n   3       308  (read)\n 196       256  (lstat64)\n 125       182  (chown???)\n</pre>\n\nNot surprisingly, their characteristics are pretty different.  But shooting for cost/benefit and focusing a bit more on the xpcshell workload, looks like the close/*stat/fcntl calls are worth doing next.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21025136/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21025206", "body": "It's sorta-kinda looking like librr_syscall_buffer.so is evolving towards a libc drop-in.  If we keep moving there, we _definitely_ need a libc test suite.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21025206/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21026779", "body": "The implementation of `*stat` turns out to be a smelly pile of trash for historical reasons, so wrapping those calls is frustratingly annoying.  `close` is easy though.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21026779/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21059950", "body": "It's about 50x slower with the syscallbuf enabled.  The extra time seems to entirely be in the replayer.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21059950/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21061529", "body": "The \"problem\" is that the thread being recorded only invokes `write` in a loop, so to rr it looks like the thread is just spinning CPU, along with buffer flushes at the time-slice interrupts.  I.e. this is the ideal case for syscall buffering.  Replaying async signals is slow because of the skid/step cruft, so replay bogs down replaying all the time-slice interrupts.\n\nThere are a variety of things we can do to make replaying these kinds of workloads faster, but I think the easiest thing for this test atm is to tweak the scheduling params.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21061529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21064835", "body": "There are ways that linux can introduce imprecision into the counter interrupts, so that even 100% precisely interrupting counters would require skidding, but I somewhat optimistically hope it's not doing that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21064835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21064962", "body": "@rocallahan and yes, checkpointing would help too ;), but again we want replaying in between checkpoints to be fast.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21064962/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21070849", "body": "I would have preferred not to have taken on #22, but that ends up looking like the shortest path to victory.  More cleanup will be needed to make the tests parallelizable, unfortunately, but that'll be a good excuse to leave things better than I found them.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21070849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21080244", "body": "> I suspect the reason the skid region size is so important for performance is because once we've entered the skid region we single-step to our final destination, which is of course slow.\n\nYep, no doubt about it.\n\n> One idea I had was, once we start skidding, set a breakpoint on the destination PC and repeatedly run to the breakpoint instead of single-stepping. That could massively reduce the number of ptrace interrupts we take.\n\nClever.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21080244/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21081063", "body": "Yeah.  We have the same problem with debugger breakpoints, but it's much less likely a user would set one on generated/modifiable code.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21081063/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21094486", "body": "Oh, almost forgot: this change seems to have brought in a new random failure in the `threads` test.  Not sure what's up yet.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21094486/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21138004", "body": "Recording FF start->render about:home is considerably faster when rr is pinned to CPUs 0 and 1, and it's a little faster still when pinned just to CPU 0.  It's looking like it would be better to introduce a \"batch mode\" for unit tests and default to pinning rr to one CPU.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21138004/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21141159", "body": "Another datum that might argue for this is that the most common reason for buffer flushes is USR_SCHED interrupts, which isn't particularly surprising.  Combined with #239 this is probably slowing down recording too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21141159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21143013", "body": "A `perf` profile of rr starting up FF shows (AFAICT anyway; the profile is hard to interpret) the majority of the CPU cycles consumed under `waitpid` in rr.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21143013/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21143585", "body": "OK, if I'm interpreting the perf \"task-clock\" event correctly (samples of real time while the task is running _and_ blocked), then the nonblocking waitpid here is almost 10% of the total execution time.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21143585/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21146470", "body": "It's not sampling real-time, because the super-expensive recordings of mmap regions aren't showing up.  I can't seem to squeeze real-time sampling out of perf :/.  Wish I had the gecko profiler handy ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21146470/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21161671", "body": "I just came across a cute trick: apparently `msync()`ing a (page-aligned) pointer can incidentally be used to tell if that page is mapped, whether or not it's backed by a file.  I agree that it would still be better (i.e. faster in the common case) to handle bad pointers by trapping to rr.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21161671/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21163033", "body": "Replay is just too mind-numbingly slow as things stand.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21163033/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21208850", "body": "Execution diverges pretty early in replay, which seems to be a clue.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21208850/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21212712", "body": "The changes we'll want to make here are\n- separate tasks into a \"runqueue\" (tasks a runnable state) and a \"waitlist\" (possibly-blocked tasks)\n- when about to schedule a task, do `waitpid(-1, NOHANG)` as long as it returns newly-runnable tasks (i.e. as long as it returns > 0).  Add the tasks to the runqueue.\n- if the runqueue isn't empty, choose a task using _waves hands_ some scheduling algorithm.  (The algorithm is separately interesting, but not in the context of this issue.)\n- otherwise, `waitpid(-1)` (blocking) until it returns a runnable task.\n\nA task entering a syscall moves it to the waitlist.\n\nWe don't have to explicitly track the waitlist, because the kernel does that for us.  So we just need to maintain the runqueue.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21212712/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21222948", "body": "One option available to us is preloading on top of NSPR symbols.  FF only uses the NSPR primitives (to a very good first approximation), and not in any unusual ways.  (I would know, because I wrote that code ;) .)  I'm not sure if this makes the problem easier or harder, but the behaviors of the NSPR types are a strict subset of pthread primitives, and the users are a very small subset too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21222948/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21223718", "body": "Happily, on FF startup, there's `recv` and then there's everything else\n\n<pre>\ncall    count\n------- -----\n   recv   2696\nrecvmsg     50\n   send     48\n socket     40\n...\n</pre>\n\nChecking a longer run ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21223718/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224233", "body": "Not quite as dramatic for a longer run, but close enough.\n\n<pre>\ncall    count\n------- -----\n   recv  28510\nconnect   1124\ngetsckn    866\n   send    604\n socket    438\nrecvmsg    372\ngetpern    296\nstskopt    198\ngtskopt    140\n   bind    108\n</pre>\n\nsocketcall is also the top overall syscall and top buffer-flushing call too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224394", "body": "I agree with all that, however, I still point back at the fact that with NSPR we're dealing with a smaller set of behaviors (even for the basic pthread options) and fewer users.  This code is fantastically tricky to write, and libc/linux have historically gotten it wrong several times.  Just pointing out that, as a first step, we have the option to make the problem easier.\n\nI'm sure the answer will become clear when we start hacking on this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224394/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224641", "body": "I hope there's something cleverer we can do, but I don't have any ideas at the moment.  (Well, maybe one, but I don't think it'll work.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224641/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224862", "body": "> (Well, maybe one, but I don't think it'll work.)\n\nFTR, the idea is to interpose our own code at the __kernel_vsyscall entry point in the vdso.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21224862/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21226312", "body": "I forgot to add the most important part!  This gets startup a good bit under 23s, so we're now about 20% faster with all the new buffered syscalls.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21226312/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21228360", "body": "I have a WIP patch to make the minimal change with a \"surgical strike\", not implementing all the changes above.  Along with it I added some instrumentation.  We (would have) spent about 0.2s spinning on waitpid during FF startup.  That's not cool but only around 1% of overhead, so nothing to get excited about.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21228360/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21434103", "body": "I'm seeing\n\n```\n[ERROR] (/home/cjones/rr/rr/src/replayer/rep_process_event.c:200:emulate_buffered_syscall: errno: None) Caught SIGCHLD advancing to emulated syscall entry\n```\n\nreplaying FF.  It's easier to fix that with the machinery already in replayer.c, so I'm going to use that bug as an excuse to tackle the larger issue.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21434103/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21500549", "body": "A basic prototype of this is about 5-6x faster on artificial, tight-loop test cases.  That kind of code (and PIC-call-heavy code) are about the worst cases for the breakpoint approach, so that result looks pretty good.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21500549/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21535748", "body": "Turns out that the ioctl params are OK, and this is a request to `/dev/dri/card0`.  There's some code to ostensibly fail opening that, and DRI is supposed to be disabled to begin with, so something smells fishy.  I'm also a bit concerned that it's so hard to find what the 0x64 (100) ioctl types are, since I don't have proprietary drivers installed.  But will continue later.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21535748/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21575238", "body": "Finally, a clue.  Much of what was confusing me is that if I `strace` FF directly, the ioctl doesn't show up, but obviously does when running under rr.  But if I make a bash script that fork/execs FF and then waits on that child process, I see exactly this unknown ioctl (along with a barrel load of other 0x64 ioctls).  So the difference in behavior seems to have something to do with the tty?  Not sure.\n\nAt any rate, `strace` doesn't know what these 0x64 ioctls are either, which also sucks.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21575238/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21576388", "body": "OK!  The difference was `strace -f` with the bash script, but `strace` with plain FF.  It's the glxtest process triggering these ioctls.  gdb shows ioctl 0x6402 coming from\n\n<pre>\n(gdb) info reg\n[snip]\necx            0x80046402 [snip]\n(gdb) bt\n#0  0xb7dacb6d in ioctl () from /lib/i386-linux-gnu/libc.so.6\n#1  0xb2fd69a4 in drmIoctl () from /usr/lib/i386-linux-gnu/libdrm.so.2\n#2  0xb2fd6fcc in drmGetMagic () from /usr/lib/i386-linux-gnu/libdrm.so.2\n#3  0xb305ae56 in ?? () from /usr/lib/i386-linux-gnu/mesa/libGL.so.1\n#4  0xb303119a in ?? () from /usr/lib/i386-linux-gnu/mesa/libGL.so.1\n#5  0xb302d493 in ?? () from /usr/lib/i386-linux-gnu/mesa/libGL.so.1\n#6  0xb302d81a in glXChooseVisual () from /usr/lib/i386-linux-gnu/mesa/libGL.so.1\n#7  0xb4c81f99 in glxtest () at /home/cjones/rr/mozilla-central/toolkit/xre/glxtest.cpp:159\n</pre>\n\nNow to chase down libdrm ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21576388/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21576649", "body": "In /usr/lib/drm/drm.h\n\n```\n#define DRM_IOCTL_BASE          'd'\n```\n\nCute.  Who wouldn't have thought to search for a character constant.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21576649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21585472", "body": "So it turns out that the ioctl-handling code is severely broken.  Turning into a nontrivial project.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21585472/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21593402", "body": "The next crasher is that some code is mmap'ing /dev/dri/card0, so we try to read the mapping.  That's a magic device file, so, oops.  rr has existing code that tries to block `open(\"/dev/dri/card0\")`, but we never hit that code.  It looks like one of the DRM ioctls is opening the device file as a side effect.  Between fixing the code that mediates access to shared maps and finding out how to disable accelerated nouveau/DRM even harder, I'm inclined towards the latter for 0.1.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21593402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21597116", "body": "Very strange indeed: what's happening is that an off-main-thread task enters a `poll()`, but the poll blocks for a long time.  Eventually the poll ends and we successfully waitpid the task.  We schedule it, it exits the poll, and then we schedule it to run again.  But this time, it just hangs.\n\nThis is in a subprocess of firefox, so almost certainly the glxtest code.  If so, the bug may be a variant of #177, but that seems a little unlikely.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21597116/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21604903", "body": "I don't feel confident that this patch was correct; there's too much hairy stuff in recorder.c around `waitpid` with signals and ptrace events.  I think this is indeed going to need to await a bigger refactoring.\n\nTwo problems I missed in v1: #259 #260.  WIP in my tree handles both.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21604903/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21604939", "body": "In the trace I saw this occur, fixing this specific issue wouldn't matter too much because we'd hit #141.  In theory this could help on its own.  But will tentatively block this on a fix for that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21604939/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21605541", "body": "I'm beginning to think this is an actual FF bug.  Yay?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21605541/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21640319", "body": "Resolved by #236, forgot to close this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21640319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21653356", "body": "Unfortunately, gdb isn't smart enough to realize it's already tracing the inferior (gdb is PID 3368)\n\n<pre>\nAttaching to program: /tmp/gdbtest, process 3369\nwarning: process 3369 is already traced by process 3368\nptrace: Operation not permitted.\n</pre>\n\ngdb will of course attach if rr detaches first, but that's less useful.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21653356/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21656129", "body": "To elaborate on the first comment: we resume the tracee with `ptrace(CONT)` (awaiting a seccomp trap, since we've installed the filter already), but never get a notification.\n\nAfter building a lot of (otherwise really useful) debugging machinery that still didn't let me directly debug this, a good ol' fashioned bisect points at #186.  That doesn't quite make sense yet, but perhaps we're single-stepping into a syscall that blocks (I verified with my gdb machinery that the tracee is blocked in poll()), and so missing the entered-syscall notification.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21656129/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21656529", "body": "Scratch that; it's more intermittent-er on older builds, but still happens majority of the time.  Further back in time things are too different.  Sigh.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21656529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21657983", "body": "I know what's wrong now: sequence of events is something like\n1. dbus background thread blocks on `poll()`\n2. glxtest junk runs and finishes\n3. (SIGCHLD should be generated)\n4. (other code runs)\n5. dbus-thread poll \"finishes\", but with a restart error code\n6. rr tries to enter the next syscall with `ptrace(CONT)`\n\nSo what I thought was happening is that the dbus thread happily restarts the `poll()`, but since rr restarted the thread with CONT, it's not notified of the syscall entry.  I have a patch that fixes that bug.\n\nHowever, I'm not able to replicate this in a test :/.  (This is a horribly subtle bug, really want a test.)  I'm able to replicate the restarted `poll`, but rr somehow detects syscall (re-)entry and seems to do the right thing.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21657983/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21658016", "body": "I should add that we only continue the tracee with CONT when the seccomp-bpf is installed, so this bug was likely around Forever.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21658016/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21743925", "body": "What seems to be happening is something I feared when I originally wrote the desched code: we're apparently getting a desched notification during the `ioctl` that disarms the desched notification :/.  The ptrace(SYSCALL) we issue to skip the redundant notification then results in the tracee running ahead to the next syscall.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21743925/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21745502", "body": "I guess unsurprisingly, we're also getting desched notifications when the tracee is in the ioctl that _arms_ the desched event.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21745502/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21745670", "body": "And they're delivered in between exiting the buffered syscall and disarming the desched event :).  The message is becoming clear.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21745670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21765653", "body": "Wasn't able to find anything talking about this condition on the intarwebs.  I have a patch that addresses the specific symptom, but #265 keeps popping up just after the new code here kicks in, so these two must be related somehow.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21765653/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21765828", "body": "Very dumb bug: a buffered `socketcall` is being descheduled, but the rr tracer thinks that it had set up a scratch buffer for the socketcall and tries to poke the saved size into `0x0`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21765828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21770384", "body": "I think all the crashes have been sorted now.  FF still \"locks up\".  What's happening is that rr spins looking for progress to be made on a futex call.  My guess is that the futex call isn't marked as interruptible and rr is accidentally dead-locking FF.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21770384/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21771053", "body": "(FTR, the incorrectly un-switchable futex call was FUTEX_LOCK_PI.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21771053/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21771190", "body": "I've also seen these syscalls block for a long time (i.e., rr spins for a while waiting for them to finish):\n- fstat64\n- mmap2\n- futex\n\nWe can't make mmap2 interruptible in general.  The futex issue may have been fixed by #271.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21771190/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21771374", "body": "In the (thousands of?) FF runs I've made recently, I haven't reproduced this.  Going to optimistically (or pessimistically, if it's a real bug staying latent) close.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21771374/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21815910", "body": "Error is\n\n```\nesi registers do not match: replaying: a and recorded: 23\npwrite64 in state 1\n```\n\nI realize now that the new code was incorrect anyway, because both pwrite and pread can block, and pread needs a scratch buffer.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21815910/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21826538", "body": "S'an odd one: the 0x23 (35) value seems to be coming from the kernel.  On syscall entry, we record esi=10, which is what the test passes in that argument slot (i.e., 10 is the value that's supposed to be there), but at syscall exit esi has been clobbered to 35.  Suspiciously, the test passes the value 25 in the argument slot before esi ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21826538/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21828584", "body": "(I noticed that my VM was running linux-3.2, and bare metal was on 3.5, but upgrading the VM to 3.5 didn't change anything.  VM is x86-64 though, while bare metal is x86.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21828584/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21830421", "body": "The bug reproduces with and without the syscallbuf.  Unfortunately strace can't trace raw register values, so I wrote the absolute barest-bones tracer to do so[1].  In my VM, regtrace reports the correct esi values, just like rr is recording, and on my bare-metal install ... the bug reproduces!  So it's not rr's fault; either a syscall bug or a ptrace bug.  Will poke for a little bit to see if something jumps, but not going to waste much time on it.  (Blecch, we'll be able to smell the needed workaround from miles away ...)\n\n[1] https://github.com/cgjones/rr-workbench/blob/master/regtrace.c\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21830421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21832870", "body": "Yep, time's up on poking through the relevant code.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21832870/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21835757", "body": "Filed at https://bugs.launchpad.net/ubuntu/+source/linux-lts-quantal/+bug/1206746 for anyone following along at home.\n\nWorkaround landed, nothing more we can do here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21835757/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21843658", "body": "(We're also recording the mmap'd region to the trace file rather inefficiently, but I'd rather not worry about that if we don't have to.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21843658/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21844522", "body": "Not to beat a dead horse, but the current algorithm also has the downside of being O(n^2) in the number of maps (with a relatively high constant factor), and, unfortunately, FF creates a _lot_ of mmaps.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21844522/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21844648", "body": "I'm not sure yet how big of a perf win this would be, but one problem it's causing is generating so many syscall events that it seems to be overflowing perf buffers and preventing later data from being collected on behalf of profilers.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21844648/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21845418", "body": "> Hmm, so will we have to do these two extra ioctls around every potentially-blocking syscall? That's very unfortunate.\n\nThese are taking ~600-800ns each, which, unfortunately, ends up being small potatoes compared to the overhead of a traced syscall.  >1us per syscall doesn't make me happy but it's not significantly impacting execution time in the traces I'm looking at.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21845418/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21892881", "body": "The heuristics I put together shave about 2 seconds off of startup (~6s -> ~4s).  (The overhead of recording the mapped regions is considerably higher in my VM running on an SSD vs. bare metal on a rotating disk.  That speaks poorly of the VMWare drivers.)  That takes us down to a little over twice as slow vs. no-rr FF startup.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21892881/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21916216", "body": "Hm, this probably started showing up after a bunch of the desched _recording_ bugs were fixed.  I hadn't done much testing of replay, so this isn't too surprising.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21916216/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21917087", "body": "If I hack out the assertion failing, then we replay a step or two more and die again from not reaching an arm-desched ioctl we're supposed to be.  So something is definitely wrong in the way we resume or record that ERESTARTSYS case.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21917087/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21918232", "body": "Resolves #277.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21918232/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21982097", "body": "Classic tar baby: started out as a small bugfix that turned into a bigger bugfix when a test broke, which led me to write another test which revealed massive separate brokenness, and that brokenness is requiring a ~rewrite of the scratch_ptr code.  (That in turn is revealing more broken things that I'm deciding to punt :/.)  Coming along but turning into a lot of stuff.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21982097/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21988310", "body": "This seems to be because `prctl()` doesn't restore the arg data that it saves to the scratch buffer.  Changes related to #282 should incidentally fix this.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/21988310/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22161882", "body": "It appears that we're resetting the syscallbuf header in the wrong place, so we end up inspecting the record of whatever happened to be first in the buffer.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22161882/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22205214", "body": "The sequence of events is\n- flush syscall buf\n- replay desched'd `read()`\n- flush syscall buf\n  - replay buffered `read`\n  - try to advance to entry of buffered `access`\n\nThis fails, and we hit the arm-desched ioctl of a buffered `read`.  Nothing is jumping out yet :/.  Might be execution divergence.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22205214/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22217609", "body": "This seems to be a replay divergence.  We seem to have recorded the reading of an ICE reply that leads to an auth check (which does the `access`), but in replay we see an error message that leads to another `read` call.  At least, if I'm reading things correctly.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22217609/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22218843", "body": "I just reproduced this while working on another bug.  This happens when a SIGABRT is being delivered.  Odd ...\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22218843/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22219545", "body": "It's a non-main thread raising the signal to the \"pid\" (tgid).  Perhaps linux wants to do something in the context of the thread-group leader, and we're waiting on the wrong task.  This is getting tricky :(.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/22219545/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/7293068", "body": "Something to do with yama?  Otherwise this doesn't make sense :).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7293068/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7417935", "body": "> Is handlers[0] deliberately skipped?\n\nYes, valgrind issues a warning for `sigaction(0)`.  (There's no harm caused by that though.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7417935/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7542239", "body": "I tried this approach way back when we first diagnosed the CPUID core-number leak.  Unfortunately, it was big slowdown on the test suite compared to the \"unbound\" approach, IIRC 2x or more slower.  That was a big enough productivity hit that I did the \"unbound\" hack.  Did you happen to test the test suite before/after to see if runtime was dinged too much?  (Either way, it makes sense for this to be the default \"production\" behavior.)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7542239/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/7646315", "body": "Grr, stupid @cgjones!  Thanks for the fix.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7646315/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/9907683", "body": "I don't think it matters too much, but what's the rationale behind blocking that?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/9907683/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/9920750", "body": "Well that's odd ... thanks for the explanation.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/9920750/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/5093702", "body": "Yeah, that code is old but has made me nervous too.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/5093702/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/7106070", "body": "More generally, files created on tmpfs file systems always need to be copied to be able to replay across reboots.  I'd prefer to check for that with an `fstatfs`, but I'll need to check if that's going to be awkward here.  Otherwise this looks pretty much OK; I would change the condition to `filename == strstr(filename, \"/tmp/\")`, but that's just a nit.\n\nbrb\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/7106070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/11474046", "body": "We have a `page_size()` helper to let avoid the magic 4096 constant, but of course that's not going to matter in practice.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/11474046/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/11474852", "body": "Ah, the linux mmap2 syscall interface, right.  Ignore me :).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/11474852/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12073583", "body": "Ftr, I'd like the rr code to move towards C++ stream-style logging, since this is the common idiom.  (I.e. iostream and `operator <<()`s.)  But this patch is perfectly fine as is, a move in the right direction.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12073583/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12073585", "body": "Drop the explicit `std::` qualification in .cc files.  There are some more uses below.  This is in the [new coding style doc](https://github.com/mozilla/rr/wiki/Code-style), which I think we wrote while you were writing this patch :).  Sorry about that.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12073585/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12073588", "body": "Prefer using `vector` to manual memory management.  You can achieve the equivalent of what you do here by making `mem` a `vector`, then doing\n\n``` C++\nmem.resize(first.num_bytes()).\nvalid_mem_len = t->read_bytes_fallible(first.start,\n                mem.size(), mem.data());\n```\n\nIt gets really nasty managing explicit `free / delete`s, and C++'s greatest feature RAII frees you from having to do that :).\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12073588/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12078983", "body": "Another minor nit: elsewhere in the code we've used `Foo::str()` for this kind of method, which is a little more STL-y.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12078983/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12718517", "body": "I didn't look closely at this patch, but `t` might end up holding the last reference to the session, so unless you've prepared otherwise, `sess` might be dead after this call.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/12718517/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/15950589", "body": "I'm not sure we want to assume this, but it's fine for now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/15950589/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910204", "body": "Would be nice to add an overview comment here or on `add_task_to_yield_queue()`.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910204/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910209", "body": "Oops, we wanted `auto& tasks = ...` here.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910209/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910210", "body": "No need for `std::` qualification AFAICT.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910210/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910213", "body": "`for (auto& kv : task_priority_set)`\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/16910213/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "nth10sd": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1423", "title": "Support AMD Opteron", "body": "I'm unable to run rr 3.0.0 on a js shell.\n\n$ rr record /home/gkwong/shell-cache/js-dbg-64-prof-nsprBuild-linux-3cda3997f45d/js-dbg-64-prof-nsprBuild-linux-3cda3997f45d\nrr: Saving the execution of `/home/gkwong/shell-cache/js-dbg-64-prof-nsprBuild-linux-3cda3997f45d/js-dbg-64-prof-nsprBuild-linux-3cda3997f45d' to trace directory`/home/gkwong/.rr/js-dbg-64-prof-nsprBuild-linux-3cda3997f45d-2'.\n[FATAL /home/roc/rr/rr/src/PerfCounters.cc:131:get_cpu_microarch() errno: 0 'Success']\n -> CPU 0xf10 unknown.\nAborted\n\nI'm using a 32-core (as seen from the OS) AMD CPU, e.g.:\n\nprocessor   : 0\nvendor_id   : AuthenticAMD\ncpu family  : 21\nmodel       : 1\nmodel name  : AMD Opteron(TM) Processor 6272\nstepping    : 2\nmicrocode   : 0x600063d\ncpu MHz     : 2100.000\ncache size  : 2048 KB\nphysical id : 0\nsiblings    : 16\ncore id     : 0\ncpu cores   : 8\napicid      : 32\ninitial apicid  : 0\nfpu     : yes\nfpu_exception   : yes\ncpuid level : 13\nwp      : yes\nflags       : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc extd_apicid amd_dcm aperfmperf pni pclmulqdq monitor ssse3 cx16 sse4_1 sse4_2 popcnt aes xsave avx lahf_lm cmp_legacy svm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ibs xop skinit wdt lwp fma4 nodeid_msr topoext perfctr_core perfctr_nb arat cpb hw_pstate npt lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassists pausefilter pfthreshold vmmcall\nbogomips    : 4189.45\nTLB size    : 1536 4K pages\nclflush size    : 64\ncache_alignment : 64\naddress sizes   : 48 bits physical, 48 bits virtual\npower management: ts ttp tm 100mhzsteps hwpstate cpb\n\nand can be seen here too: http://pastebin.mozilla.org/8548446\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1423/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "benturner": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/1308", "title": "Assertion `SYSCALL_MAY_RESTART(result) || -ENOSYS == result || -EAGAIN == result' ", "body": "I just got this, haven't seen it before.\n\n> (gdb) p mRefCnt.get()\n> [FATAL /home/bent/src/mozilla/rr/rr/src/task.cc:2358:clone_syscall_is_complete() errno: 0 'Success'](task 29660 %28rec:22581%29 at time 805443)\n>  ->  Assertion `SYSCALL_MAY_RESTART(result) || -ENOSYS == result || -EAGAIN == result' failed to > hold. Unexpected task status 0xb7f (syscall result:1081578240)\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1308/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/1295", "title": "Command to \"immortalize\" a particular recording", "body": "I have a recording that I would like to preserve for future debugging, but I can't continue normal development (rebuilding binaries, updating system libs, etc.) without invalidating that recording. I understand that rr shouldn't save binaries by default for performance reasons, but it would be nice to have some command to tell rr to \"immortalize\" a particular recording when I know I want to save it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/1295/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "nviennot": {"issues": [{"url": "https://api.github.com/repos/mozilla/rr/issues/984", "title": "Previous work", "body": "Hi there,\n\nI've been doing record/replay mechanism for a while on the Linux kernel. Judging by https://github.com/mozilla/rr/wiki/Kernel-API-wishlist it might be useful to take some of the code from the Scribe's kernel implementation.\nWhile Scribe does not rely on performance counters, the ideas are similar. There is a major difference with shared memory as Scribe modifies the page table mechanism to track memory access ordering.\n\nHere's how it works (screencast included):\nhttp://velvetpulse.com/2012/11/27/scribe-the-deterministic-transparent-record-replay-engine/\n\nPapers:\nhttp://viennot.biz/sigmetrics2010_scribe.pdf\nhttp://viennot.biz/sosp2011_racepro.pdf\nhttp://viennot.biz/asplos2013_dora.pdf\n\nSources:\nhttps://github.com/nviennot/linux-2.6-scribe\nhttps://github.com/columbia/mreplay (mutable replay)\n\nVM to play with Scribe:\nhttp://velvetpulse.s3.amazonaws.com/vm/scribe-ubuntu-1204.tar.bz2\n\nLet me know if there is some interest to salvage some of Scribe's code.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/984/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "jun0": {"issues": [], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/a6206f04892ced9434363832a2e12daf8a6edc8f", "message": "Fix cmake flag detection"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "Manouchehri": {"issues": [], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/d4c2f69fcbe2964d3e2f5f930418647d3b62ab02", "message": "Added Vagrant support."}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "dcci": {"issues": [], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/dd7f29a56061579146a43f8e6ec6cf23bc60149f", "message": "[ftrace] Make sure all paths to the exit of the functions return.\n\nThis removes an undefined behaviour and also suppresses a warning\non FreeBSD + clang."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a92bdb16bed165ee9f02b85c0bc810552eacac84", "message": "[test] Remove duplicated include of <sys/mount.h>\n\nFound by inspection."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/56a04e814f4a6415100933adc63f0ddbeda696e2", "message": "[test-monitor] Include headers used explicitly.\n\nOn FreeBSD, this fails because the file uses std::string and\nerrno without including the correct header. On Linux, it happens\nto work because those headers are transitively included by some\nother header. Let's bee more explicit here."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/1f306e26a74b1e91b57632525667786c6ca54b95", "message": "[kernel-abi] Don't use a reserved keyword.\n\n__unused is reserved by compilers somehow (even though it's an\nextension) so compiling this code with clang on FreeBSD results\nin an error, i.e.\n\n/home/davide/rr/src/kernel_abi.h:1046:27: error: expected member\nname or ';' after declaration specifiers\n    unsigned_long __unused[4];\n    ~~~~~~~~~~~~~         ^\n\nRename to avoid the clash."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/627a46e97d053168e8f30dedbac6a325ba0ee219", "message": "[chaos-test] Use sysconf(_SC_PAGE_SIZE) instead of PAGE_SIZE.\n\nThe former is the POSIX way of handling this."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/22a0083cc0fbe87be092184a2129d430b6dca391", "message": "[build] Use env to improve portability on other systems.\n\nFreeBSD, for example, has no bash in the default installation,\nand when it's installed, it resides in /usr/local/bin."}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "espindola": {"issues": [], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/07ece07ba3b399ace83c4788b1efe3264f036aff", "message": "Delete dead page_faults_attr."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/a0b65b658e27baa623cd069e52470dfb55c3c280", "message": "Sleep before gdb_rr.close.\n\nIt is not clear why, but we have to sleep before\nBufferedRWPair.close() (which is called from gdb_rr.close). If we\ndon't, python freezes instead of exiting."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/f811d96949a714ffb031f1bc3aaeb27c3a5d360f", "message": "Expand the gcrypt handling to openat.\n\nThis fixes src/test/gcrypt_rdrand.run on fedora 27. It was failing\nbecause the newer glibc implements open with SYS_openat."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/d7454cd1bd24fceeb8fdda4d26a1b560c3ceb8a1", "message": "Use syscall directly in another test.\n\nStarting with glibc 2.26, it uses SYS_openat to implement open.\n\nThis fixes a test failure on fedora 27."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/7f692c5ae35376fa48c49161e48998c0023851b1", "message": "Use syscall directly in test.\n\nStarting with glibc 2.26, it uses SYS_openat to implement open.\n\nThis fixes a test failure on fedora 27."}, {"url": "https://api.github.com/repos/mozilla/rr/commits/68fb4c4df8e0d0fea0a25dc705cc2f365e14a654", "message": "Delete dead code.\n\nThe infrastructure for collecting instructions retired is not used\nanymore."}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "bkin": {"issues": [], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/8468cd1cd53febe646744816a41771b363f54334", "message": "Fix Monkeypatching of functions at section start"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "Jesin": {"issues": [], "commits": [{"url": "https://api.github.com/repos/mozilla/rr/commits/45d2c60d64df64ffe9e34f9dfd614448d7050162", "message": "Fix build for systems that HAVE_SSE41\n\nWhen building for systems that define HAVE_SSE41, blake2b-round.h\nincludes \"blake2b-load-sse41.h\". That file did not exist in the rr\nsource tree, so the build would fail.\n\nThis commit fixes that problem by copying blake2b-load-sse41.h from\nhttps://github.com/BLAKE2/BLAKE2/commit/5cbb39c9ef8007f0b63723e3aea06cd0887e36ad\nwhich is the same place the rest of the files in third-party/blake2\ncame from."}], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/23500558", "body": "Is this commit really more than a year old?", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/23500558/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": []}, "bgamari": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/2101", "title": "[WIP] Compatibility with LLDB", "body": "This teaches rr to respect the client debuggers's advertised support of\r\nthe GDB multiprocess protocol. We parse the state of the client's\r\nmultiprocess support from its qSupported message and use this to\r\ndetermine whether we produce old-style thread IDs or the\r\nmultiprocess-style pPID.TID format.\r\n\r\nThis fixes #2078.", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "szborows": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/1617", "title": "More meaningful message when ~/.rr doesn't exist.", "body": "Fixes #1583 \n", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "zmaril": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/1581", "title": "CLI `ls` command", "body": "These two commits implement the `ls` command for `rr` (per #1415). The `ls` command supports `-r`, `-l`, and `-t`. It uses the `st_ctime` of a traces `version` file to find the date the trace was recorded and takes the difference between that and the `data` file.\n", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "synlestidae": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/1486", "title": "Detect and avoid Monkeypatch patching when vdso unmapped", "body": "", "author_association": "CONTRIBUTOR"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "andreasgal": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17629051", "body": "The new occupant gets to make the rules. Feel free to dictate a new style guide.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17629051/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17629113", "body": "Moar C++ please.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17629113/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/5083080", "body": "probably a good idea to file an issue here\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/5083080/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}, "anoll": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17712257", "body": "Hi Chris,\nsystem call number 96 is unimplemented.\n\nAlbert\n\nVon meinem iPhone gesendet\n\nAm 09.05.2013 um 03:55 schrieb Chris Jones notifications@github.com:\n\n> This is with today's nightly i686 build, running in an x86 VM on an x86-64 system. Lots of moving parts here, not sure yet where the problem is. Full output below.\n> \n> $ rr --record ./firefox/firefox -no-remote -P garbage\n> [INFO](/home/cjones/rr/rr/src/main.c:164) Start recording...\n> \n> .[ERROR](/home/cjones/rr/rr/src/recorder/rec_process_event.c:2162: errno: None) recorder: unknown syscall 96 -- bailing out\n> [ERROR](/home/cjones/rr/rr/src/recorder/rec_process_event.c:2163: errno: None) execuction state: 4 sig 0\n> Printing register file:\n> eax: 14\n> ebx: 0\n> ecx: 0\n> edx: b7c6aff4\n> esi: 1\n> edi: b781a240\n> ebp: bfffbd98\n> esp: bfffbd48\n> eip: b7fdd424\n> eflags 200292\n> orig_eax 60\n> xcs: 73\n> xds: 7b\n> xes: 7b\n> xfs: 0\n> xgs: 33\n> xss: 7b\n> \n> [ERROR](/home/cjones/rr/rr/src/share/sys.c:117: errno: None) Exiting\n> rr: /home/cjones/rr/rr/src/share/sys.c:120: sys_exit: Assertion `0' failed.\n> Aborted (core dumped)\n> \u2014\n> Reply to this email directly or view it on GitHub.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17712257/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17923079", "body": "Hi Chris,\n\nDid you try smaller values for thread preemption? I think the current value is set to 1000000 retired conditional branches. That might increase the chance of hitting the bug.\n\nAlbert\n\nVon meinem iPhone gesendet\n\nAm 15.05.2013 um 08:13 schrieb Chris Jones notifications@github.com:\n\n> Whole-system lock-ups are getting annoying.\n> \n> I saw a whole passel of gettimeofday/clock_gettime calls under strace for this test, so I wondered if those calls were disturbing things too much. I finished #43 to test this out, but the results were\n> \n> a seemingly-related error reproduces more frequently, but not the orange itself\n> recording firefox is now broken under the filter lib :/\n> \u2014\n> Reply to this email directly or view it on GitHub.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/issues/comments/17923079/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [], "review_comments": []}, "nimrodpar": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/1884655", "body": "Well, for some of the tests i added, i do want to see a print to a file in the standard output, but i guess printing ALL output is an overkill, we'll just redirect stdout and stderr intended calls for now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/1884655/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/comments/1884685", "body": "I also had trouble with this function, i added read_child_buffer() which worked a lot better for me. You're welcome to try it if you encounter more problems with this one.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/1884685/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": []}, "jey": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/7413197", "body": "Is `handlers[0]` deliberately skipped?\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/7413197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}, "GSam": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/mozilla/rr/comments/17394614", "body": "Not sure if this is relevant, but on one machine, I found that it was using a shim-layer for quotactl akin to http://lxr.free-electrons.com/source/include/linux/quotacompat.h\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/comments/17394614/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}, "tpltnt": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": [{"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023332", "body": "I copied the xmalloc() implementation to rrutil.h, pretty much at the beginning of the file.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023332/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023379", "body": "I am doing this right now.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023379/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023529", "body": "done\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023682", "body": "done\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023835", "body": "I already changed this on my local branch.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023941", "body": "done\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/80023941/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477902", "body": "No, it was meant to be `inline static`. I fixed and squashed it. Thank you for catching it.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81477902/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81478097", "body": "Ah, cool. My main source was [this presentation](https://mozilla.github.io/rr/rr.html) and it didn't mention 64bit support. I updated the readme. Thank you for pointing out the 64bit support.\n", "reactions": {"url": "https://api.github.com/repos/mozilla/rr/pulls/comments/81478097/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}]}}}}